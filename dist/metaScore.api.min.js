/*! metaScore - v0.0.2 - 2015-09-21 - Oussama Mubarak */
(function(){function t(t,e){"string"==typeof t&&(t=document.getElementById(t)),this.target=t,this.origin="*",this.ready=!1,this.callbacks={},this.target.addEventListener("load",this.onLoad.bind(this,e),!1),window.addEventListener("message",this.onMessage.bind(this),!1)}var e=/^http?:\/\/metascore.philharmoniedeparis.fr/;t.prototype.postMessage=function(t,e){var n;return this.target.contentWindow.postMessage?(n=JSON.stringify({method:t,params:e}),this.target.contentWindow.postMessage(n,this.origin),void 0):!1},t.prototype.onLoad=function(t){this.on("ready",function(){t.call(null,this)})},t.prototype.onMessage=function(t){var n,i,o;if(!e.test(t.origin))return!1;try{n=JSON.parse(t.data)}catch(s){return!1}return"callback"in n&&(i=this.callbacks[n.callback])?(o="params"in n?n.params:null,i.call(this,o),void 0):!1},t.prototype.on=function(t,e){var n=""+(new Date).valueOf()+Math.random();return this.callbacks[n]=e,this.postMessage("addEventListener",{type:t,callback:n}),this},t.prototype.play=function(t,e,n){return this.postMessage("play",{inTime:t,outTime:e,rIndex:n}),this},t.prototype.pause=function(){return this.postMessage("pause"),this},t.prototype.seek=function(t){return this.postMessage("seek",{seconds:parseFloat(t)}),this},t.prototype.page=function(t,e){return this.postMessage("page",{block:t,index:parseInt(e)-1}),this},t.prototype.paused=function(t){var e=""+(new Date).valueOf()+Math.random();return this.callbacks[e]=t,this.postMessage("paused",{callback:e}),this},t.prototype.time=function(t){var e=""+(new Date).valueOf()+Math.random();return this.callbacks[e]=t,this.postMessage("time",{callback:e}),this},document.addEventListener("DOMContentLoaded",function(){var e,n,i,o,s,a=[];for(e=document.querySelectorAll('a[rel="metascore"][data-guide]'),o=0;e.length>o;++o)n=e[o],0>a.indexOf(n.dataset.guide)&&a.push(n.dataset.guide);if(a.length>0){i=document.querySelectorAll("iframe.metascore-embed#"+a.join(",iframe.metascore-embed#")),s=function(t){var e,n;e=document.querySelectorAll('a[rel="metascore"][data-guide="'+t.target.id+'"]'),n=function(e){var n=e.target,i=n.dataset.action,o=n.dataset.args?n.dataset.args.split(","):null;i in t&&t[i].apply(t,o)};for(var i=0;e.length>i;++i)e[i].addEventListener("click",n)};for(o=0;i.length>o;++o)new t(i[o],s)}}),window.metaScoreAPI=t})();