/*! metaScore - v0.9.1 - 2017-02-01 - Oussama Mubarak */

window.metaScoreAPI=function(){function a(a,b){"string"==typeof a&&(a=document.getElementById(a)),this.target=a,this.origin="*",this.ready=!1,this.callbacks={},this.target.addEventListener("load",this.onLoad.bind(this,b),!1),window.addEventListener("message",this.onMessage.bind(this),!1)}var b=/^http?:\/\/metascore.philharmoniedeparis.fr/;return a.prototype.postMessage=function(a,b){var c;return!!this.target.contentWindow.postMessage&&(c=JSON.stringify({method:a,params:b}),this.target.contentWindow.postMessage(c,this.origin),this)},a.prototype.onLoad=function(a){this.on("ready",function(){a.call(null,this)})},a.prototype.onMessage=function(a){var c,d,e;if(!b.test(a.origin))return!1;try{c=JSON.parse(a.data)}catch(f){return!1}return!!("callback"in c&&(d=this.callbacks[c.callback]))&&(e="params"in c?c.params:null,void d.call(this,e))},a.prototype.on=function(a,b){var c=(new Date).valueOf().toString()+Math.random();return this.callbacks[c]=b,this.postMessage("addEventListener",{type:a,callback:c}),this},a.prototype.play=function(a,b,c){return this.postMessage("play",{inTime:a,outTime:b,rIndex:c}),this},a.prototype.pause=function(){return this.postMessage("pause"),this},a.prototype.seek=function(a){return this.postMessage("seek",{seconds:parseFloat(a)}),this},a.prototype.page=function(a,b){return this.postMessage("page",{block:a,index:parseInt(b)-1}),this},a.prototype.rindex=function(a){return this.postMessage("rindex",{index:parseInt(a)}),this},a.prototype.playing=function(a){var b=(new Date).valueOf().toString()+Math.random();return this.callbacks[b]=a,this.postMessage("playing",{callback:b}),this},a.prototype.time=function(a){var b=(new Date).valueOf().toString()+Math.random();return this.callbacks[b]=a,this.postMessage("time",{callback:b}),this},document.addEventListener("DOMContentLoaded",function(b){var c,d,e,f,g,h=[];for(c=document.querySelectorAll('a[rel="metascore"][data-guide]'),f=0;f<c.length;++f)d=c[f],h.indexOf(d.dataset.guide)<0&&h.push(d.dataset.guide);if(h.length>0){e=document.querySelectorAll("iframe#"+h.join(",iframe#")),g=function(a){var b,c;b=document.querySelectorAll('a[rel="metascore"][data-guide="'+a.target.id+'"]'),c=function(b){for(var c,d=b.target,e=d.hash.replace(/^#/,"").split("&"),f=0,g=e.length;f<g;f++)c=e[f].split("="),c[0]in a&&a[c[0]].apply(a,c[1].split(","));b.preventDefault()};for(var d=0;d<b.length;++d)b[d].addEventListener("click",c)};for(f=0;f<e.length;++f)new a(e[f],g)}}),a}();
//# sourceMappingURL=metaScore.api.min.js.map