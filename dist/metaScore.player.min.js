/*! metaScore - v0.0.2 - 2015-10-16 - Oussama Mubarak */

!function(a){"use strict";var b=a.metaScore;Element&&!Element.prototype.matches&&(Element.prototype.matches=Element.prototype.matchesSelector=Element.prototype.matchesSelector||Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||function(a){for(var b=this,c=(b.document||b.ownerDocument).querySelectorAll(a),d=0;c[d]&&c[d]!==b;)d++;return c[d]?!0:!1}),Element&&!Element.prototype.closest&&(Element.prototype.closest=function(a){for(var b=this;b;){if(b.matches(a))return b;b=b.parentElement}return null}),window.CustomEvent&&"function"==typeof window.CustomEvent||(window.CustomEvent=function(a,b){var c;return b=b||{bubbles:!1,cancelable:!1,detail:void 0},c=document.createEvent("CustomEvent"),c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c},window.CustomEvent.prototype=window.Event.prototype),function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var d=(new Date).getTime(),e=Math.max(0,16-(d-a)),f=window.setTimeout(function(){b(d+e)},e);return a=d+e,f}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),b=a.metaScore={getVersion:function(){return"0.0.2"},getRevision:function(){return"9010bd"},namespace:function(a){for(var b,c=this,d=a.split("."),e=0,f=d.length;f>e;e++)b=d[e],c[b]=c[b]||{},c=c[b];return c}},b.Class=function(){function a(){}return a.defaults={},a.extend=function(a){a.prototype=Object.create(this.prototype,{constructor:{value:a}}),a.parent=this,a.extend=this.extend,"defaults"in a||(a.defaults={});for(var b in this.defaults)b in a.defaults||(a.defaults[b]=this.defaults[b])},a.prototype.getConfigs=function(a){a=a||{};for(var b in this.constructor.defaults)b in a||(a[b]=this.constructor.defaults[b]);return a},a}(),b.Evented=function(){function a(){a.parent.call(this),this.listeners={}}return b.Class.extend(a),a.prototype.addListener=function(a,b){return"undefined"==typeof this.listeners[a]&&(this.listeners[a]=[]),this.listeners[a].push(b),this},a.prototype.removeListener=function(a,b){if(this.listeners[a]instanceof Array)for(var c=this.listeners[a],d=0,e=c.length;e>d;d++)if(c[d]===b){c.splice(d,1);break}return this},a.prototype.triggerEvent=function(a,c,d,e){var f,g;return this.listeners[a]instanceof Array&&(f=this.listeners[a],g={target:this,type:a,detail:c,bubbles:d!==!1,cancelable:e!==!1},b.Object.each(f,function(a,b){b.call(this,g)},this)),this},a}(),b.Ajax=function(){function a(){}return b.Class.extend(a),a.send=function(a,c){var d=new XMLHttpRequest,e={method:"GET",headers:{},async:!0,data:{},dataType:"json",complete:null,success:null,error:null,scope:this};return c=b.Object.extend({},e,c),d.open(c.method,a,c.async),b.Object.each(c.headers,function(a,b){d.setRequestHeader(a,b)}),d.onreadystatechange=function(){4===d.readyState&&(b.Var.is(c.complete,"function")&&c.complete.call(c.scope,d),d.status>=200&&d.status<300||304===d.status?b.Var.is(c.success,"function")&&c.success.call(c.scope,d):b.Var.is(c.error,"function")&&c.error.call(c.scope,d))},d.send(c.data),d},a.get=function(c,d){return b.Object.extend(d,{method:"GET"}),a.send(c,d)},a.post=function(c,d){return b.Object.extend(d,{method:"POST"}),a.send(c,d)},a.put=function(c,d){return b.Object.extend(d,{method:"PUT"}),a.send(c,d)},a}(),b.Array=function(){function a(){}return b.Class.extend(a),a.inArray=function(a,b){var c,d=0;if(b){if(b.indexOf)return b.indexOf(a);for(c=b.length;c>d;d++)if(d in b&&b[d]===a)return d}return-1},a.copy=function(a){return[].concat(a)},a.shuffle=function(b){var c=a.copy(b);return c.sort(function(){return(3*Math.random()|0)-1}),c},a.unique=function(a){for(var b=[],c=a.length,d=0;c>d;d++){for(var e=d+1;c>e;e++)a[d]===a[e]&&(e=++d);b.push(a[d])}return b},a.each=function(a,b,c){for(var d,e=0,f=a.length,g=void 0!==c;f>e&&(d=b.call(g?c:a[e],e,a[e]),d!==!1);e++);return a},a.remove=function(b,c){for(var d=a.inArray(c,b);d>-1;)b.splice(d,1),d=a.inArray(c,b);return b},a.naturalSort=function(a){return function(b,c){var d,e,f=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,g=/(^[ ]*|[ ]*$)/g,h=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,i=/^0x[0-9a-f]+$/i,j=/^0/,k=function(b){return a&&(""+b).toLowerCase()||""+b},l=k(b).replace(g,"")||"",m=k(c).replace(g,"")||"",n=l.replace(f,"\x00$1\x00").replace(/\0$/,"").replace(/^\0/,"").split("\x00"),o=m.replace(f,"\x00$1\x00").replace(/\0$/,"").replace(/^\0/,"").split("\x00"),p=parseInt(l.match(i))||1!==n.length&&l.match(h)&&Date.parse(l),q=parseInt(m.match(i))||p&&m.match(h)&&Date.parse(m)||null;if(q){if(q>p)return-1;if(p>q)return 1}for(var r=0,s=Math.max(n.length,o.length);s>r;r++){if(d=!(n[r]||"").match(j)&&parseFloat(n[r])||n[r]||0,e=!(o[r]||"").match(j)&&parseFloat(o[r])||o[r]||0,isNaN(d)!==isNaN(e))return isNaN(d)?1:-1;if(typeof d!=typeof e&&(d+="",e+=""),e>d)return-1;if(d>e)return 1}return 0}},a}(),b.Color=function(){function a(){}return b.Class.extend(a),a.rgb2hsv=function(a){var b,c,d,e=a.r,f=a.g,g=a.b,h=Math.max(e,f,g),i=Math.min(e,f,g),j=h-i;if(c=0===h?0:j/h,d=h,h===i)b=0;else{switch(h){case e:b=(f-g)/j+(g>f?6:0);break;case f:b=(g-e)/j+2;break;case g:b=(e-f)/j+4}b/=6}return{h:b,s:c,v:d}},a.parse=function(a){var c,d;return c={r:0,g:0,b:0,a:0},b.Var.is(a,"object")?(c.r="r"in a?a.r:0,c.g="g"in a?a.g:0,c.b="b"in a?a.b:0,c.a="a"in a?a.a:1):b.Var.is(a,"string")&&(a=a.replace(/\s\s*/g,""),(d=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})/.exec(a))?(c.r=parseInt(d[1],16),c.g=parseInt(d[2],16),c.b=parseInt(d[3],16),c.a=1):(d=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])/.exec(a))?(c.r=17*parseInt(d[1],16),c.g=17*parseInt(d[2],16),c.b=17*parseInt(d[3],16),c.a=1):(d=/^rgba\(([\d]+),([\d]+),([\d]+),([\d]+|[\d]*.[\d]+)\)/.exec(a))?(c.r=+d[1],c.g=+d[2],c.b=+d[3],c.a=+d[4]):(d=/^rgb\(([\d]+),([\d]+),([\d]+)\)/.exec(a))&&(c.r=+d[1],c.g=+d[2],c.b=+d[3],c.a=1)),c},a}(),b.Dom=function(){function a(){var a;this.elements=[],arguments.length>0&&((a=b.Dom.elementsFromString.apply(this,arguments))?(this.add(a),arguments.length>1&&this.attr(arguments[1])):(a=b.Dom.selectElements.apply(this,arguments))&&(this.add(a),arguments.length>2&&this.attr(arguments[2])))}return b.Class.extend(a),a.stringRe=/^<(.)+>$/,a.camelRe=/-([\da-z])/gi,a.camelReplaceFn=function(a,b){return b.toUpperCase()},a.camel=function(b){return b.replace(a.camelRe,a.camelReplaceFn)},a.bubbleEvents={click:!0,submit:!0,mousedown:!0,mousemove:!0,mouseup:!0,mouseover:!0,mouseout:!0,transitionend:!0},a.selectElement=function(a,c){var d;return c||(c=document),d=b.Var.is(a,"string")?c.querySelector(a):a.length?a[0]:a},a.selectElements=function(c,d){var e;return void 0!==c&&(d?d instanceof a&&(d=d.get(0)):d=document,e=b.Var.is(c,"string")?d.querySelectorAll(c):"length"in c?c:[c]),e},a.elementsFromString=function(a){var b,c,d,e={option:[1,"<select multiple='multiple'>","</select>"],optgroup:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tbody:[1,"<table>","</table>"],tfoot:[1,"<table>","</table>"],colgroup:[1,"<table>","</table>"],caption:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],th:[3,"<table><tbody><tr>","</tr></tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[1,"<div>","</div>"]},f=document.createElement("div"),g=/<\s*\w.*?>/g.exec(a);if(null!=g){for(b=g[0].replace(/</g,"").replace(/\/?>/g,""),c=e[b]||e._default,a=c[1]+a+c[2],f.innerHTML=a,d=c[0];d--;)f=f.lastChild;return f.childNodes}return null},a.getElementWindow=function(a){var b=a.ownerDocument;return b.defaultView||b.parentWindow},a.hasClass=function(a,b){return a.classList.contains(b)},a.addClass=function(a,b){for(var c=b.split(" "),d=0,e=c.length;e>d;d++)a.classList.add(c[d])},a.removeClass=function(a,b){for(var c=b.split(" "),d=0,e=c.length;e>d;d++)a.classList.remove(c[d])},a.toggleClass=function(a,b,c){var d=b.split(" "),e=0,f=d.length;if(void 0===c)for(;f>e;e++)a.classList.toggle(d[e]);else for(;f>e;e++)a.classList.toggle(d[e],c)},a.addListener=function(b,c,d,e){return void 0===e&&(e="type"in a.bubbleEvents?a.bubbleEvents[c]:!1),b.addEventListener(c,d,e)},a.removeListener=function(b,c,d,e){return void 0===e&&(e="type"in a.bubbleEvents?a.bubbleEvents[c]:!1),b.removeEventListener(c,d,e)},a.triggerEvent=function(b,c,d,e,f){var g=CustomEvent||a.getElementWindow(b).CustomEvent,h=new g(c,{detail:d,bubbles:e!==!1,cancelable:f!==!1});return b.dispatchEvent(h)},a.text=function(a,b){return void 0!==b&&(a.innerHTML=b),a.innerHTML},a.val=function(a,b){return void 0!==b&&(a.value=b),a.value},a.attr=function(c,d,e){if(b.Var.is(d,"object"))b.Object.each(d,function(b,d){a.attr(c,b,d)},this);else switch(d){case"class":this.addClass(c,e);break;case"text":this.text(c,e);break;default:if(null!==e)return void 0!==e&&c.setAttribute(d,e),c.getAttribute(d);c.removeAttribute(d)}},a.css=function(a,b,c,d){var e,f;return e=this.camel(b),void 0!==c&&(a.style[e]=c),f=d===!0?a.style:window.getComputedStyle(a),f.getPropertyValue(b)},a.data=function(a,b,c){return b=this.camel(b),null===c?a.dataset[b]&&delete a.dataset[b]:void 0!==c&&(a.dataset[b]=c),a.dataset[b]},a.append=function(a,c){b.Var.is(c,"array")||(c=[c]),b.Array.each(c,function(b,c){a.appendChild(c)},this)},a.before=function(a,c){b.Var.is(c,"array")||(c=[c]),b.Array.each(c,function(b,c){a.parentElement.insertBefore(c,a)},this)},a.after=function(a,c){b.Var.is(c,"array")||(c=[c]),b.Array.each(c,function(b,c){a.parentElement.insertBefore(c,a.nextSibling)},this)},a.empty=function(a){for(;a.firstChild;)a.removeChild(a.firstChild)},a.remove=function(a){a.parentElement&&a.parentElement.removeChild(a)},a.is=function(b,c){var d;return b instanceof Element?Element.prototype.matches.call(b,c):(d=a.getElementWindow(b),b instanceof d.Element&&Element.prototype.matches.call(b,c))},a.closest=function(a,b){var c,d;return a instanceof Element?Element.prototype.closest.call(a,b):(c=a.ownerDocument)&&(d=c.defaultView||c.parentWindow)&&a instanceof d.Element?Element.prototype.closest.call(a,b):null},a.prototype.add=function(a){if("length"in a)for(var b=0;b<a.length;b++)this.elements.push(a[b]);else this.elements.push(a)},a.prototype.count=function(){return this.elements.length},a.prototype.get=function(a){return this.elements[a]},a.prototype.filter=function(b){var c=new a;return this.each(function(d,e){a.is(e,b)&&c.add(e)},this),c},a.prototype.index=function(b){var c=-1;return this.each(function(d,e){return a.is(e,b)?(c=d,!1):void 0},this),c},a.prototype.find=function(b){var c=new a;return this.each(function(d,e){c.add(a.selectElements.call(this,b,e))},this),c},a.prototype.children=function(b){var c=new a;return this.each(function(a,b){c.add(b.children)},this),b&&(c=c.filter(b)),c},a.prototype.child=function(b){return new a(this.children(b).get(0))},a.prototype.parents=function(b){var c=new a;return this.each(function(a,b){c.add(b.parentElement)},this),b&&(c=c.filter(b)),c},a.prototype.each=function(a,c){c=c||this,b.Array.each(this.elements,a,c)},a.prototype.hasClass=function(b){var c;return this.each(function(d,e){return c=a.hasClass(e,b),!c},this),c},a.prototype.addClass=function(b){return this.each(function(c,d){a.addClass(d,b)},this),this},a.prototype.removeClass=function(b){return this.each(function(c,d){a.removeClass(d,b)},this),this},a.prototype.toggleClass=function(b,c){return this.each(function(d,e){a.toggleClass(e,b,c)},this),this},a.prototype.addListener=function(b,c,d){return this.each(function(e,f){a.addListener(f,b,c,d)},this),this},a.prototype.addDelegate=function(b,c,d,e,f){return e=e||this,this.addListener(c,function(c){for(var f,g=c.target;g;){if(a.is(g,b)){f=g;break}g=g.parentElement}f&&d.call(e,c,f)},f)},a.prototype.removeListener=function(b,c,d){return this.each(function(e,f){a.removeListener(f,b,c,d)},this),this},a.prototype.triggerEvent=function(b,c,d,e){var f=!0;return this.each(function(g,h){f=a.triggerEvent(h,b,c,d,e)&&f},this),f},a.prototype.text=function(b){return void 0===b?a.text(this.get(0)):void this.each(function(c,d){a.text(d,b)},this)},a.prototype.val=function(b){return void 0!==b?(this.each(function(c,d){a.val(d,b)},this),this):a.val(this.get(0))},a.prototype.attr=function(c,d){return void 0!==d||b.Var.is(c,"object")?(this.each(function(b,e){a.attr(e,c,d)},this),this):a.attr(this.get(0),c)},a.prototype.css=function(b,c,d){return void 0!==c?(this.each(function(e,f){a.css(f,b,c,d)},this),this):a.css(this.get(0),b,c,d)},a.prototype.data=function(b,c){return void 0!==c?(this.each(function(d,e){a.data(e,b,c)},this),this):a.data(this.get(0),b)},a.prototype.append=function(b){return b instanceof a&&(b=b.elements),a.append(this.get(0),b),this},a.prototype.appendTo=function(b){return b instanceof a||(b=new a(b)),b=b.get(0),this.each(function(c,d){a.append(b,d)},this),this},a.prototype.insertAt=function(b,c){var d;return b instanceof a||(b=new a(b)),d=b.children().get(c),d?a.before(d,this.elements):this.appendTo(b),this},a.prototype.empty=function(){return this.each(function(b,c){a.empty(c)},this),this},a.prototype.show=function(){return this.css("display",""),this},a.prototype.hide=function(){return this.css("display","none"),this},a.prototype.focus=function(){return this.get(0).focus(),this},a.prototype.blur=function(){return this.get(0).blur(),this},a.prototype.remove=function(){return this.triggerEvent("beforeremove")!==!1&&this.each(function(b,c){var d=c.parentElement;a.remove(c),a.triggerEvent(d,"childremove",{child:c})},this),this},a.prototype.is=function(b){var c;return this.each(function(d,e){return c=a.is(e,b)},this),c},a.prototype.closest=function(b){var c;return this.each(function(d,e){return c=a.closest(e,b),null!==c},this),c},a}(),b.Draggable=function(){function a(a){this.configs=this.getConfigs(a),this.configs.container=this.configs.container||new b.Dom("body"),this.doc=new b.Dom(this.configs.container.get(0).ownerDocument),this.onMouseDown=b.Function.proxy(this.onMouseDown,this),this.onMouseMove=b.Function.proxy(this.onMouseMove,this),this.onMouseUp=b.Function.proxy(this.onMouseUp,this),this.configs.handle.addListener("mousedown",this.onMouseDown),this.enable()}return a.defaults={limits:{top:null,left:null}},b.Class.extend(a),a.prototype.onMouseDown=function(a){this.enabled&&(this.start_state={left:parseInt(this.configs.target.css("left"),10)-a.clientX,top:parseInt(this.configs.target.css("top"),10)-a.clientY},this.doc.addListener("mouseup",this.onMouseUp).addListener("mousemove",this.onMouseMove),this.configs.target.addClass("dragging").triggerEvent("dragstart",null,!1,!0),a.stopPropagation())},a.prototype.onMouseMove=function(a){var b=a.clientX+this.start_state.left,c=a.clientY+this.start_state.top;isNaN(this.configs.limits.top)||(c=Math.max(c,this.configs.limits.top)),isNaN(this.configs.limits.left)||(b=Math.max(b,this.configs.limits.left)),this.configs.target.css("left",b+"px").css("top",c+"px").triggerEvent("drag",null,!1,!0),a.stopPropagation()},a.prototype.onMouseUp=function(a){this.doc.removeListener("mousemove",this.onMouseMove).removeListener("mouseup",this.onMouseUp),this.configs.target.removeClass("dragging").triggerEvent("dragend",null,!1,!0),a.stopPropagation()},a.prototype.enable=function(){return this.configs.target.addClass("draggable"),this.configs.handle.addClass("drag-handle"),this.enabled=!0,this},a.prototype.disable=function(){return this.configs.target.removeClass("draggable"),this.configs.handle.removeClass("drag-handle"),this.enabled=!1,this},a.prototype.destroy=function(){return this.disable(),this.configs.handle.removeListener("mousedown",this.onMouseDown),this},a}(),b.Function=function(){function a(){}return b.Class.extend(a),a.proxy=function(a,c,d){return b.Var.type(a,"function")?function(){var b;return d?(b=Array.prototype.slice.call(d),b=b.concat(Array.prototype.slice.call(arguments))):b=arguments,a.apply(c||this,b)}:void 0},a.emptyFn=function(){},a}(),b.Object=function(){function a(){}return b.Class.extend(a),a.extend=function(){for(var a,b,c,d,e=arguments[0]||{},f=1,g=arguments.length;g>f;f++)if(null!=(a=arguments[f]))for(b in a)c=e[b],d=a[b],c!==d&&void 0!==d&&(e[b]=d);return e},a.copy=function(b){return a.extend({},b)},a.each=function(a,b,c){var d,e,f=void 0!==c;for(d in a)if(e=b.call(f?c:a[d],d,a[d]),e===!1)break;return a},a}(),b.String=function(){function a(){}return b.Class.extend(a),a.capitalize=function(a){return a.replace(/(?:^|\s)\S/g,function(a){return a.toUpperCase()})},a.uuid=function(a,b){var c,d=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],e=[];if(b=b||d.length,a)for(c=0;a>c;c++)e[c]=d[0|Math.random()*b];else{var f;for(e[8]=e[13]=e[18]=e[23]="-",e[14]="4",c=0;36>c;c++)e[c]||(f=0|16*Math.random(),e[c]=d[19===c?3&f|8:f])}return e.join("")},a.pad=function(a,b,c,d){var e,f,g;if("undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=" "),"undefined"==typeof d&&(d="right"),a+="",b+1>=a.length)switch(d){case"left":a=Array(b+1-a.length).join(c)+a;break;case"both":g=b-a.length,e=Math.ceil(g/2),f=g-e,a=Array(f+1).join(c)+a+Array(e+1).join(c);break;default:a+=Array(b+1-a.length).join(c)}return a},a}(),b.StyleSheet=function(){function a(a){this.configs=this.getConfigs(a),b.Dom.call(this,"<style/>",{type:"text/css"}),this.el=this.get(0),this.setInternalValue("")}return b.Dom.extend(a),a.prototype.addRule=function(a,b,c){var d=this.el.sheet;return void 0===c&&(c=d.cssRules.length),"insertRule"in d?d.insertRule(a+"{"+b+"}",c):"addRule"in d?d.addRule(a,b,c):void 0},a.prototype.removeRule=function(a){var b=this.el.sheet;return"deleteRule"in b?b.deleteRule(a):"removeRule"in b&&b.removeRule(a),this},a.prototype.removeRulesBySelector=function(a){var b=this.el.sheet,c=b.cssRules||b.rules;a=a.toLowerCase();for(var d=0;d<c.length;d++)if(c[d].selectorText.toLowerCase()===a){this.removeRule(d);break}return this},a.prototype.removeRules=function(){for(var a=this.el.sheet,b=a.cssRules||a.rules;b.length>0;)this.removeRule(0);return this},a.prototype.setInternalValue=function(a){return this.el.styleSheet?this.el.styleSheet.cssText=a:this.text(a),this},a}(),b.Var=function(){function a(){}var c={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"};return b.Class.extend(a),a.type=function(a){return null==a?String(a):c[Object.prototype.toString.call(a)]||"object"},a.is=function(b,c){return a.type(b)===c.toLowerCase()},a.isEmpty=function(a){return void 0===a||null==a?!0:a.hasOwnProperty("length")?a.length<=0:b.Var.is(a,"object")?Object.keys(a).length<=0:!1},a}(),b.Resizable=function(){function a(a){this.configs=this.getConfigs(a),this.configs.container=this.configs.container||new b.Dom("body"),this.doc=new b.Dom(this.configs.container.get(0).ownerDocument),this.handles={},this.onMouseDown=b.Function.proxy(this.onMouseDown,this),this.onMouseMove=b.Function.proxy(this.onMouseMove,this),this.onMouseUp=b.Function.proxy(this.onMouseUp,this),b.Array.each(this.configs.directions,function(a,c){this.handles[c]=new b.Dom("<div/>",{"class":"resize-handle"}).data("direction",c).addListener("mousedown",this.onMouseDown).appendTo(this.configs.target)},this),this.enable()}return a.defaults={directions:["top","right","bottom","left","top-left","top-right","bottom-left","bottom-right"]},b.Class.extend(a),a.prototype.onMouseDown=function(a){this.enabled&&(this.start_state={handle:a.target,x:a.clientX,y:a.clientY,left:parseInt(this.configs.target.css("left"),10),top:parseInt(this.configs.target.css("top"),10),w:parseInt(this.configs.target.css("width"),10),h:parseInt(this.configs.target.css("height"),10)},this.doc.addListener("mousemove",this.onMouseMove,this).addListener("mouseup",this.onMouseUp,this),this.configs.target.addClass("resizing").triggerEvent("resizestart",null,!1,!0),a.stopPropagation())},a.prototype.onMouseMove=function(a){var c,d,e,f,g=new b.Dom(this.start_state.handle);switch(g.data("direction")){case"top":d=this.start_state.h-a.clientY+this.start_state.y,e=this.start_state.top+a.clientY-this.start_state.y;break;case"right":c=this.start_state.w+a.clientX-this.start_state.x;break;case"bottom":d=this.start_state.h+a.clientY-this.start_state.y;break;case"left":c=this.start_state.w-a.clientX+this.start_state.x,f=this.start_state.left+a.clientX-this.start_state.x;break;case"top-left":c=this.start_state.w-a.clientX+this.start_state.x,d=this.start_state.h-a.clientY+this.start_state.y,e=this.start_state.top+a.clientY-this.start_state.y,f=this.start_state.left+a.clientX-this.start_state.x;break;case"top-right":c=this.start_state.w+a.clientX-this.start_state.x,d=this.start_state.h-a.clientY+this.start_state.y,e=this.start_state.top+a.clientY-this.start_state.y;break;case"bottom-left":c=this.start_state.w-a.clientX+this.start_state.x,d=this.start_state.h+a.clientY-this.start_state.y,f=this.start_state.left+a.clientX-this.start_state.x;break;case"bottom-right":c=this.start_state.w+a.clientX-this.start_state.x,d=this.start_state.h+a.clientY-this.start_state.y}void 0!==e&&this.configs.target.css("top",e+"px"),void 0!==f&&this.configs.target.css("left",f+"px"),this.configs.target.css("width",c+"px").css("height",d+"px").triggerEvent("resize",null,!1,!0),a.stopPropagation()},a.prototype.onMouseUp=function(a){this.doc.removeListener("mousemove",this.onMouseMove,this).removeListener("mouseup",this.onMouseUp,this),this.configs.target.removeClass("resizing").triggerEvent("resizeend",null,!1,!0),a.stopPropagation()},a.prototype.getHandle=function(a){return this.handles[a]},a.prototype.enable=function(){return this.configs.target.addClass("resizable"),this.enabled=!0,this},a.prototype.disable=function(){return this.configs.target.removeClass("resizable"),this.enabled=!1,this},a.prototype.destroy=function(){return this.disable(),b.Object.each(this.handles,function(a,b){b.remove()},this),this},a}(),b.Locale=function(){function a(){}return b.Class.extend(a),a.t=function(b,c,d){return"undefined"!=typeof metaScoreLocale&&metaScoreLocale.hasOwnProperty(b)&&(c=metaScoreLocale[b]),a.formatString(c,d)},a.formatString=function(a,c){return b.Object.each(c,function(b,d){a=a.replace(b,c[b])},this),a},a}(),b.Player=function(){function a(c){this.configs=this.getConfigs(c),a.parent.call(this,"<div></div>",{"class":"metaScore-player"}),this.configs.api&&b.Dom.addListener(window,"message",b.Function.proxy(this.onAPIMessage,this)),this.appendTo(this.configs.container),this.load()}return a.defaults={url:"",container:"body",ajax:{},keyboard:!1,api:!1},b.Dom.extend(a),a.prototype.onKeydown=function(a){switch(a.keyCode){case 32:this.togglePlay(),a.preventDefault();break;case 37:this.find('.metaScore-component.block:hover .pager .button[data-action="previous"]').triggerEvent("click"),a.preventDefault();break;case 39:this.find('.metaScore-component.block:hover .pager .button[data-action="next"]').triggerEvent("click"),a.preventDefault()}},a.prototype.onAPIMessage=function(a){var b,c,d,e,f,g,h=this;try{b=JSON.parse(a.data)}catch(i){return!1}if(!("method"in b))return!1;switch(c=a.source,d=a.origin,e=b.method,f="params"in b?b.params:null,e){case"play":h.play(f.inTime,f.outTime,f.rIndex);break;case"pause":h.getMedia().pause();break;case"seek":h.getMedia().setTime(100*parseFloat(f.seconds,10));break;case"page":g=h.getComponent('.block[data-name="'+f.block+'"]'),g._metaScore&&g._metaScore.setActivePage(f.index);break;case"rindex":h.setReadingIndex(isNaN(f.index)?0:f.index);break;case"paused":c.postMessage(JSON.stringify({callback:f.callback,params:!h.getMedia().isPlaying()}),d);break;case"time":c.postMessage(JSON.stringify({callback:f.callback,params:h.getMedia().getTime()/100}),d);break;case"addEventListener":switch(f.type){case"ready":h.addListener("loadsuccess",function(a){c.postMessage(JSON.stringify({callback:f.callback}),d)});break;case"timeupdate":h.addListener(f.type,function(a){c.postMessage(JSON.stringify({callback:f.callback,params:a.detail.media.getTime()/100}),d)});break;case"rindex":h.addListener(f.type,function(a){c.postMessage(JSON.stringify({callback:f.callback,params:a.detail.value}),d)})}break;case"removeEventListener":}},a.prototype.onControllerButtonClick=function(a){var c=b.Dom.data(a.target,"action");switch(c){case"rewind":this.getMedia().reset();break;case"play":this.togglePlay()}a.stopPropagation()},a.prototype.onMediaLoadedMetadata=function(a){this.getMedia().reset()},a.prototype.onMediaPlay=function(a){this.controller.addClass("playing")},a.prototype.onMediaPause=function(a){this.controller.removeClass("playing")},a.prototype.onMediaTimeUpdate=function(a){var b=a.detail.media.getTime();this.controller.updateTime(b)},a.prototype.onPageActivate=function(a){var b=a.target._metaScore,c=a.detail.page,d=a.detail.basis;b.getProperty("synched")&&"pagecuepoint"!==d&&this.getMedia().setTime(c.getProperty("start-time"))},a.prototype.onCursorElementTime=function(a){this.getMedia().setTime(a.detail.value)},a.prototype.onTextElementPlay=function(a){this.play(a.detail.inTime,a.detail.outTime,a.detail.rIndex)},a.prototype.onTextElementPage=function(a){var b;b=this.getComponent('.block[data-name="'+a.detail.block+'"]'),b._metaScore&&b._metaScore.setActivePage(a.detail.index)},a.prototype.onComponenetPropChange=function(a){var b=a.detail.component;switch(a.detail.property){case"start-time":case"end-time":b.setCuePoint({media:this.getMedia()})}},a.prototype.onLoadSuccess=function(a){this.json=JSON.parse(a.response),this.setId(this.json.id).setRevision(this.json.vid),this.css=(new b.StyleSheet).setInternalValue(this.json.css).appendTo(document.head),this.rindex_css=(new b.StyleSheet).appendTo(document.head),b.Array.each(this.json.blocks,function(a,c){switch(c.type){case"media":this.addMedia(b.Object.extend({},c,{type:this.json.type})),this.getMedia().setSources([this.json.media]);break;case"controller":this.addController(c);break;default:this.addBlock(c)}},this),this.configs.keyboard&&new b.Dom("body").addListener("keydown",b.Function.proxy(this.onKeydown,this)),this.removeClass("loading"),this.triggerEvent("loadsuccess",{player:this,data:this.json},!0,!1)},a.prototype.onLoadError=function(a){this.removeClass("loading"),this.triggerEvent("loaderror",{player:this},!0,!1)},a.prototype.load=function(){var a;this.addClass("loading"),a=b.Object.extend({},{success:b.Function.proxy(this.onLoadSuccess,this),error:b.Function.proxy(this.onLoadError,this)},this.configs.ajax),b.Ajax.get(this.configs.url,a)},a.prototype.getId=function(){return this.data("id")},a.prototype.setId=function(a,b){return this.data("id",a),b!==!0&&this.triggerEvent("idset",{player:this,id:a},!0,!1),this},a.prototype.getRevision=function(){return this.data("vid")},a.prototype.setRevision=function(a,b){return this.data("vid",a),b!==!0&&this.triggerEvent("revisionset",{player:this,vid:a},!0,!1),this},a.prototype.getData=function(){return this.json},a.prototype.getMedia=function(){return this.media},a.prototype.updateData=function(a){b.Object.extend(this.json,a),"css"in a&&this.updateCSS(a.css),"media"in a&&this.getMedia().setSources([a.media]),"vid"in a&&this.setRevision(a.vid)},a.prototype.getComponent=function(a){return this.getComponents(a).get(0)},a.prototype.getComponents=function(a){var b;return b=this.find(".metaScore-component"),a&&(b=b.filter(a)),b},a.prototype.addMedia=function(a,c){return this.media=new b.player.component.Media(a).addListener("loadedmetadata",b.Function.proxy(this.onMediaLoadedMetadata,this)).addListener("play",b.Function.proxy(this.onMediaPlay,this)).addListener("pause",b.Function.proxy(this.onMediaPause,this)).addListener("timeupdate",b.Function.proxy(this.onMediaTimeUpdate,this)).appendTo(this),c!==!0&&this.triggerEvent("mediaadd",{player:this,media:this.media},!0,!1),this},a.prototype.addController=function(a,c){return this.controller=new b.player.component.Controller(a).addDelegate(".buttons button","click",b.Function.proxy(this.onControllerButtonClick,this)).appendTo(this),c!==!0&&this.triggerEvent("controlleradd",{player:this,controller:this.controller},!0,!1),this},a.prototype.addBlock=function(a,c){var d;return a instanceof b.player.component.Block?(d=a,d.appendTo(this)):d=new b.player.component.Block(b.Object.extend({},a,{container:this,listeners:{propchange:b.Function.proxy(this.onComponenetPropChange,this)}})).addListener("pageactivate",b.Function.proxy(this.onPageActivate,this)).addDelegate('.element[data-type="Cursor"]',"time",b.Function.proxy(this.onCursorElementTime,this)).addDelegate('.element[data-type="Text"]',"play",b.Function.proxy(this.onTextElementPlay,this)).addDelegate('.element[data-type="Text"]',"page",b.Function.proxy(this.onTextElementPage,this)),c!==!0&&this.triggerEvent("blockadd",{player:this,block:d},!0,!1),d},a.prototype.updateCSS=function(a){this.css.setInternalValue(a)},a.prototype.togglePlay=function(){var a=this.getMedia();a.isPlaying()?a.pause():a.play()},a.prototype.play=function(a,c,d){var e=this,f=this.getMedia();this.cuepoint&&this.cuepoint.destroy(),a=parseFloat(a),c=parseFloat(c),d=parseInt(d),isNaN(a)?f.play():(this.cuepoint=new b.player.CuePoint({media:this.getMedia(),inTime:a,outTime:isNaN(c)?null:c,onStart:function(a){e.setReadingIndex(isNaN(d)?0:d)},onEnd:function(a){a.getMedia().pause()},onSeekOut:function(a){a.destroy(),delete e.cuepoint,e.setReadingIndex(0)},considerError:!0}),this.getMedia().setTime(a).play())},a.prototype.setReadingIndex=function(a,b){return this.rindex_css.removeRules(),0!==a?(this.rindex_css.addRule('.metaScore-component.element[data-r-index="'+a+'"]',"display: block;"),this.rindex_css.addRule('.metaScore-component.element[data-r-index="'+a+'"]:not([data-start-time]) .contents',"display: block;"),this.rindex_css.addRule('.metaScore-component.element[data-r-index="'+a+'"].active .contents',"display: block;"),this.rindex_css.addRule('.in-editor.editing.show-contents .metaScore-component.element[data-r-index="'+a+'"] .contents',"display: block;"),this.data("rindex",a)):this.data("rindex",null),b!==!0&&this.triggerEvent("rindex",{player:this,value:a},!0,!1),this},a}(),b.namespace("player").Component=function(){function a(c){this.configs=this.getConfigs(c),a.parent.call(this,"<div/>",{"class":"metaScore-component",id:"component-"+b.String.uuid(5)}),this.get(0)._metaScore=this,this.configs.container&&(b.Var.is(this.configs.index,"number")?this.insertAt(this.configs.container,this.configs.index):this.appendTo(this.configs.container)),b.Object.each(this.configs.listeners,function(a,b){this.addListener(a,b)},this),this.setupDOM(),this.setProperties(this.configs)}return b.Dom.extend(a),a.defaults={container:null,index:null,properties:{}},a.prototype.setupDOM=function(){},a.prototype.getId=function(){return this.attr("id")},a.prototype.getName=function(){return this.getProperty("name")},a.prototype.instanceOf=function(a){return a in b.player.component&&this instanceof b.player.component[a]},a.prototype.hasProperty=function(a){return a in this.configs.properties},a.prototype.getProperty=function(a){return this.hasProperty(a)&&"getter"in this.configs.properties[a]?this.configs.properties[a].getter.call(this):void 0},a.prototype.getProperties=function(a){var c,d={};return b.Object.each(this.configs.properties,function(b,e){"getter"in e&&(c=e.getter.call(this,a),null!==c&&(d[b]=c))},this),d},a.prototype.setProperty=function(a,b,c){return a in this.configs.properties&&"setter"in this.configs.properties[a]&&(this.configs.properties[a].setter.call(this,b),
c!==!0&&this.triggerEvent("propchange",{component:this,property:a,value:b})),this},a.prototype.setProperties=function(a,c){return b.Object.each(a,function(a,b){this.setProperty(a,b,c)},this),this},a.prototype.setCuePoint=function(a){var c=this.getProperty("start-time"),d=this.getProperty("end-time");return this.cuepoint&&this.cuepoint.destroy(),(null!=c||null!=d)&&(this.cuepoint=new b.player.CuePoint(b.Object.extend({},a,{inTime:c,outTime:d,onStart:this.onCuePointStart?b.Function.proxy(this.onCuePointStart,this):null,onUpdate:this.onCuePointUpdate?b.Function.proxy(this.onCuePointUpdate,this):null,onEnd:this.onCuePointEnd?b.Function.proxy(this.onCuePointEnd,this):null,onSeekOut:this.onCuePointSeekOut?b.Function.proxy(this.onCuePointSeekOut,this):null}))),this.cuepoint},a.prototype.setDraggable=function(a){return!1},a.prototype.setResizable=function(a){return!1},a}(),b.namespace("player").CuePoint=function(){function a(a){this.configs=this.getConfigs(a),this.id=b.String.uuid(),this.running=!1,this.launch=b.Function.proxy(this.launch,this),this.stop=b.Function.proxy(this.stop,this),this.onMediaTimeUpdate=b.Function.proxy(this.onMediaTimeUpdate,this),this.onMediaSeeked=b.Function.proxy(this.onMediaSeeked,this),this.configs.media.addListener("timeupdate",this.onMediaTimeUpdate),this.max_error=0}return b.Evented.extend(a),a.defaults={media:null,inTime:null,outTime:null,onStart:null,onUpdate:null,onEnd:null,onSeekOut:null,considerError:!1},a.prototype.onMediaTimeUpdate=function(a){var b=this.configs.media.getTime();this.running?(this.configs.considerError&&("previous_time"in this&&(this.max_error=Math.max(this.max_error,Math.abs(b-this.previous_time))),this.previous_time=b),(Math.ceil(b)<this.configs.inTime||null!==this.configs.outTime&&Math.floor(b+this.max_error)>=this.configs.outTime)&&this.stop(),this.configs.onUpdate&&this.configs.onUpdate(this,b)):Math.floor(b)>=this.configs.inTime&&(null===this.configs.outTime||Math.ceil(b)<this.configs.outTime)&&this.launch(),this.configs.onSeekOut&&this.configs.media.addListener("seeking",this.onMediaSeeked)},a.prototype.onMediaSeeked=function(a){var b;this.configs.media.removeListener("play",this.onMediaSeeked),this.configs.onSeekOut&&(b=this.configs.media.getTime(),(Math.ceil(b)<this.configs.inTime||Math.floor(b)>this.configs.outTime)&&this.configs.onSeekOut(this))},a.prototype.getMedia=function(){return this.configs.media},a.prototype.getInTime=function(){return this.configs.inTime},a.prototype.getOutTime=function(){return this.configs.outTime},a.prototype.launch=function(){this.running||(this.configs.onStart&&this.configs.onStart(this),null===this.configs.outTime||!this.configs.onUpdate&&!this.configs.onEnd?this.stop():this.running=!0)},a.prototype.stop=function(a){a!==!1&&this.configs.onEnd&&(this.configs.onEnd(this),this.configs.onSeekOut&&this.configs.media.addListener("play",this.onMediaSeeked)),this.configs.considerError&&(this.max_error=0,delete this.previous_time),this.running=!1},a.prototype.destroy=function(){this.stop(!1),this.configs.media.removeListener("timeupdate",this.onMediaTimeUpdate).removeListener("seeking",this.onMediaSeeked).removeListener("play",this.onMediaSeeked)},a}(),b.namespace("player").Pager=function(){function a(c){this.configs=this.getConfigs(c),a.parent.call(this,"<div/>",{"class":"pager"}),this.count=new b.Dom("<div/>",{"class":"count"}).appendTo(this),this.buttons=new b.Dom("<div/>",{"class":"buttons"}).addListener("mousedown",function(a){a.stopPropagation()}).appendTo(this),this.buttons.first=new b.Dom("<div/>",{"class":"button","data-action":"first"}).appendTo(this.buttons),this.buttons.previous=new b.Dom("<div/>",{"class":"button","data-action":"previous"}).appendTo(this.buttons),this.buttons.next=new b.Dom("<div/>",{"class":"button","data-action":"next"}).appendTo(this.buttons)}return b.Dom.extend(a),a.prototype.updateCount=function(a,c){this.count.text(b.Locale.t("player.Pager.count","page !current/!count",{"!current":a+1,"!count":c})),this.buttons.first.toggleClass("inactive",1>a),this.buttons.previous.toggleClass("inactive",1>a),this.buttons.next.toggleClass("inactive",a>=c-1)},a}(),b.namespace("player.component").Block=function(){function a(b){a.parent.call(this,b)}return b.player.Component.extend(a),a.defaults={container:null,properties:{name:{type:"Text",configs:{label:b.Locale.t("player.component.Block.name","Name")},getter:function(a){return this.data("name")},setter:function(a){this.data("name",a)}},locked:{type:"Boolean",configs:{label:b.Locale.t("player.component.Block.locked","Locked ?")},getter:function(a){return"true"===this.data("locked")},setter:function(a){this.data("locked",a?"true":null)}},x:{type:"Number",configs:{label:b.Locale.t("player.component.Block.x","X")},getter:function(a){return parseInt(this.css("left"),10)},setter:function(a){this.css("left",a+"px")}},y:{type:"Number",configs:{label:b.Locale.t("player.component.Block.y","Y")},getter:function(a){return parseInt(this.css("top"),10)},setter:function(a){this.css("top",a+"px")}},width:{type:"Number",configs:{label:b.Locale.t("player.component.Block.width","Width")},getter:function(a){return parseInt(this.css("width"),10)},setter:function(a){this.css("width",a+"px")}},height:{type:"Number",configs:{label:b.Locale.t("player.component.Block.height","Height")},getter:function(a){return parseInt(this.css("height"),10)},setter:function(a){this.css("height",a+"px")}},"background-color":{type:"Color",configs:{label:b.Locale.t("player.component.Block.background-color","Background color")},getter:function(a){return this.css("background-color",void 0,a)},setter:function(a){var c=b.Color.parse(a);this.css("background-color","rgba("+c.r+","+c.g+","+c.b+","+c.a+")")}},"background-image":{type:"Image",configs:{label:b.Locale.t("player.component.Block.background-image","Background image")},getter:function(a){var c=this.css("background-image",void 0,a);return"none"!==c&&b.Var.is(c,"string")?c.replace(/^url\(["']?/,"").replace(/["']?\)$/,""):null},setter:function(a){a="none"!==a&&b.Var.is(a,"string")&&a.length>0?"url("+a+")":null,this.css("background-image",a)}},"border-width":{type:"Number",configs:{label:b.Locale.t("player.component.Block.border-width","Border width")},getter:function(a){var b=this.css("border-width",void 0,a);return null!==b?parseInt(b,10):null},setter:function(a){this.css("border-width",a+"px")}},"border-color":{type:"Color",configs:{label:b.Locale.t("player.component.Block.border-color","Border color")},getter:function(a){return this.css("border-color",void 0,a)},setter:function(a){var c=b.Color.parse(a);this.css("border-color","rgba("+c.r+","+c.g+","+c.b+","+c.a+")")}},"border-radius":{type:"BorderRadius",configs:{label:b.Locale.t("player.component.Block.border-radius","Border radius")},getter:function(a){return this.css("border-radius",void 0,a)},setter:function(a){this.css("border-radius",a)}},synched:{type:"Boolean",configs:{label:b.Locale.t("player.component.Block.synched","Synchronized pages ?"),readonly:!0},getter:function(a){return"true"===this.data("synched")},setter:function(a){this.data("synched",a)}},pages:{editable:!1,getter:function(a){var b=[];return this.getPages().each(function(c,d){b.push(d._metaScore.getProperties(a))},this),b},setter:function(a){this.getPages().remove(),b.Array.each(a,function(a,b){this.addPage(b)},this),this.setActivePage(0)}}}},a.prototype.setupDOM=function(){a.parent.prototype.setupDOM.call(this),this.addClass("block"),this.page_wrapper=new b.Dom("<div/>",{"class":"pages"}).addDelegate(".page","cuepointstart",b.Function.proxy(this.onPageCuePointStart,this)).appendTo(this),this.pager=(new b.player.Pager).addDelegate(".button","click",b.Function.proxy(this.onPagerClick,this)).appendTo(this)},a.prototype.onPageCuePointStart=function(a){this.setActivePage(a.target._metaScore,"pagecuepoint")},a.prototype.onPagerClick=function(a){var c,d=!b.Dom.hasClass(a.target,"inactive");if(d)switch(c=b.Dom.data(a.target,"action")){case"first":this.setActivePage(0);break;case"previous":this.setActivePage(this.getActivePageIndex()-1);break;case"next":this.setActivePage(this.getActivePageIndex()+1)}a.stopPropagation()},a.prototype.getPages=function(){return this.page_wrapper.children(".page")},a.prototype.addPage=function(a,c,d){var e;return a instanceof b.player.component.Page?(e=a,b.Var.is(c,"number")?e.insertAt(this.page_wrapper,c):e.appendTo(this.page_wrapper)):e=new b.player.component.Page(b.Object.extend({},a,{container:this.page_wrapper,index:c})),this.setActivePage(e),d!==!0&&this.triggerEvent("pageadd",{block:this,page:e}),e},a.prototype.removePage=function(a,b){return a.remove(),b!==!0&&this.triggerEvent("pageremove",{block:this,page:a}),a},a.prototype.getPage=function(a){var b=this.getPages(),c=b.get(a);return c?c._metaScore:null},a.prototype.getActivePage=function(){return this.getPage(this.getActivePageIndex())},a.prototype.getActivePageIndex=function(){var a=this.getPages(),b=a.index(".active");return b},a.prototype.getPageCount=function(){return this.getPages().count()},a.prototype.setActivePage=function(a,c,d){var e=this.getPages();b.Var.is(a,"number")&&(a=e.get(parseInt(a,10)),a=a?a._metaScore:null),a instanceof b.player.component.Page&&(e.removeClass("active"),a.addClass("active"),this.updatePager(),d!==!0&&this.triggerEvent("pageactivate",{block:this,page:a,basis:c}))},a.prototype.updatePager=function(){var a=this.getActivePageIndex(),b=this.getPageCount();this.pager.updateCount(a,b),this.data("page-count",b)},a.prototype.setDraggable=function(a){return a=a!==!1,this.getProperty("locked")&&a?!1:(a&&!this._draggable?this._draggable=new b.Draggable({target:this,handle:this.child(".pager"),container:this.parents(),limits:{top:0,left:0}}):!a&&this._draggable&&(this._draggable.destroy(),delete this._draggable),this._draggable)},a.prototype.setResizable=function(a){return a=a!==!1,this.getProperty("locked")&&a?!1:(a&&!this._resizable?this._resizable=new b.Resizable({target:this,container:this.parents()}):!a&&this._resizable&&(this._resizable.destroy(),delete this._resizable),this._resizable)},a}(),b.namespace("player.component").Controller=function(){function a(b){a.parent.call(this,b)}return b.player.Component.extend(a),a.defaults={properties:{locked:{type:"Boolean",configs:{label:b.Locale.t("player.component.Controller.locked","Locked ?")},getter:function(a){return"true"===this.data("locked")},setter:function(a){this.data("locked",a?"true":null)}},x:{type:"Number",configs:{label:b.Locale.t("player.component.Controller.x","X")},getter:function(a){return parseInt(this.css("left"),10)},setter:function(a){this.css("left",a+"px")}},y:{type:"Number",configs:{label:b.Locale.t("player.component.Controller.y","Y")},getter:function(a){return parseInt(this.css("top"),10)},setter:function(a){this.css("top",a+"px")}},"border-radius":{type:"BorderRadius",configs:{label:b.Locale.t("player.component.Controller.border-radius","Border radius")},getter:function(a){return this.css("border-radius",void 0,a)},setter:function(a){this.css("border-radius",a)}}}},a.prototype.setupDOM=function(){a.parent.prototype.setupDOM.call(this),this.addClass("controller"),this.timer=new b.Dom("<div/>",{"class":"timer",text:"00:00.00"}).appendTo(this),this.rewind_btn=new b.Dom("<button/>").data("action","rewind"),this.play_btn=new b.Dom("<button/>").data("action","play"),new b.Dom("<div/>",{"class":"buttons"}).append(this.rewind_btn).append(this.play_btn).appendTo(this)},a.prototype.getName=function(){return"[controller]"},a.prototype.updateTime=function(a){var c=b.String.pad(parseInt(a%100,10),2,"0","left"),d=b.String.pad(parseInt(a/100%60,10),2,"0","left"),e=b.String.pad(parseInt(a/6e3,10),2,"0","left");this.timer.text(e+":"+d+"."+c)},a.prototype.setDraggable=function(a){return a=a!==!1,this.getProperty("locked")&&a?!1:(a&&!this._draggable?this._draggable=new b.Draggable({target:this,handle:this.child(".timer"),container:this.parents(),limits:{top:0,left:0}}):!a&&this._draggable&&(this._draggable.destroy(),delete this._draggable),this._draggable)},a.prototype.setResizable=function(a){return!1},a}(),b.namespace("player.component").Element=function(){function a(b){a.parent.call(this,b)}return b.player.Component.extend(a),a.defaults={properties:{name:{type:"Text",configs:{label:b.Locale.t("player.component.Element.name","Name")},getter:function(a){return this.data("name")},setter:function(a){this.data("name",a)}},type:{editable:!1,getter:function(a){return this.data("type")},setter:function(a){this.data("type",a)}},locked:{type:"Boolean",configs:{label:b.Locale.t("player.component.Element.locked","Locked ?")},getter:function(a){return"true"===this.data("locked")},setter:function(a){this.data("locked",a?"true":null)}},x:{type:"Number",configs:{label:b.Locale.t("player.component.Element.x","X")},getter:function(a){return parseInt(this.css("left"),10)},setter:function(a){this.css("left",a+"px")}},y:{type:"Number",configs:{label:b.Locale.t("player.component.Element.y","Y")},getter:function(a){return parseInt(this.css("top"),10)},setter:function(a){this.css("top",a+"px")}},width:{type:"Number",configs:{label:b.Locale.t("player.component.Element.width","Width"),min:10},getter:function(a){return parseInt(this.css("width"),10)},setter:function(a){this.css("width",a+"px")}},height:{type:"Number",configs:{label:b.Locale.t("player.component.Element.height","Height"),min:10},getter:function(a){return parseInt(this.css("height"),10)},setter:function(a){this.css("height",a+"px")}},"r-index":{type:"Number",configs:{label:b.Locale.t("player.component.Element.r-index","Reading index"),min:0},getter:function(a){var b=this.data("r-index");return null!==b?parseInt(b,10):null},setter:function(a){this.data("r-index",a)}},"z-index":{type:"Number",configs:{label:b.Locale.t("player.component.Element.z-index","Display index")},getter:function(a){var b=this.css("z-index",void 0,a);return null!==b?parseInt(b,10):null},setter:function(a){this.css("z-index",a)}},"background-color":{type:"Color",configs:{label:b.Locale.t("player.component.Element.background-color","Background color")},getter:function(a){return this.contents.css("background-color",void 0,a)},setter:function(a){var c=b.Color.parse(a);this.contents.css("background-color","rgba("+c.r+","+c.g+","+c.b+","+c.a+")")}},"background-image":{type:"Image",configs:{label:b.Locale.t("player.component.Element.background-image","Background image")},getter:function(a){var c=this.contents.css("background-image",void 0,a);return"none"!==c&&b.Var.is(c,"string")?c.replace(/^url\(["']?/,"").replace(/["']?\)$/,""):null},setter:function(a){a="none"!==a&&b.Var.is(a,"string")&&a.length>0?"url("+a+")":null,this.contents.css("background-image",a)}},"border-width":{type:"Number",configs:{label:b.Locale.t("player.component.Element.border-width","Border width")},getter:function(a){var b=this.contents.css("border-width",void 0,a);return null!==b?parseInt(b,10):null},setter:function(a){this.contents.css("border-width",a+"px")}},"border-color":{type:"Color",configs:{label:b.Locale.t("player.component.Element.border-color","Border color")},getter:function(a){return this.contents.css("border-color",void 0,a)},setter:function(a){var c=b.Color.parse(a);this.contents.css("border-color","rgba("+c.r+","+c.g+","+c.b+","+c.a+")")}},"border-radius":{type:"BorderRadius",configs:{label:b.Locale.t("player.component.Element.border-radius","Border radius")},getter:function(a){return this.contents.css("border-radius",void 0,a)},setter:function(a){this.contents.css("border-radius",a)}},opacity:{type:"Number",configs:{label:b.Locale.t("player.component.Element.opacity","Opacity"),min:0,max:1,step:.1},getter:function(a){return this.contents.css("opacity",void 0,a)},setter:function(a){this.contents.css("opacity",a)}},"start-time":{type:"Time",configs:{label:b.Locale.t("player.component.Element.start-time","Start time"),checkbox:!0,inButton:!0,outButton:!0},getter:function(a){var b=parseFloat(this.data("start-time"));return isNaN(b)?null:b},setter:function(a){this.data("start-time",isNaN(a)?null:a)}},"end-time":{type:"Time",configs:{label:b.Locale.t("player.component.Element.end-time","End time"),checkbox:!0,inButton:!0,outButton:!0},getter:function(a){var b=parseFloat(this.data("end-time"));return isNaN(b)?null:b},setter:function(a){this.data("end-time",isNaN(a)?null:a)}}}},a.prototype.setupDOM=function(){a.parent.prototype.setupDOM.call(this),this.addClass("element"),this.contents=new b.Dom("<div/>",{"class":"contents"}).appendTo(this)},a.prototype.getPage=function(){var a,b=this.parents().get(0);return b&&(a=b._metaScore),a},a.prototype.onCuePointStart=function(a){this.addClass("active")},a.prototype.onCuePointEnd=function(a){this.removeClass("active")},a.prototype.onCuePointSeekOut=a.prototype.onCuePointEnd,a.prototype.setDraggable=function(a){return a=a!==!1,this.getProperty("locked")&&a?!1:(a&&!this._draggable?this._draggable=new b.Draggable({target:this,handle:this,container:this.parents()}):!a&&this._draggable&&(this._draggable.destroy(),delete this._draggable),this._draggable)},a.prototype.setResizable=function(a){return a=a!==!1,this.getProperty("locked")&&a?!1:(a&&!this._resizable?this._resizable=new b.Resizable({target:this,container:this.parents()}):!a&&this._resizable&&(this._resizable.destroy(),delete this._resizable),this._resizable)},a}(),b.namespace("player.component").Media=function(){function a(c){a.parent.call(this,c),this.addClass("media").addClass(this.configs.type),this.el=new b.Dom("<"+this.configs.type+"></"+this.configs.type+">",{preload:"auto"}).addListener("loadedmetadata",b.Function.proxy(this.onLoadedMetadata,this)).addListener("play",b.Function.proxy(this.onPlay,this)).addListener("pause",b.Function.proxy(this.onPause,this)).addListener("timeupdate",b.Function.proxy(this.onTimeUpdate,this)).addListener("seeking",b.Function.proxy(this.onSeeking,this)).appendTo(this),this.dom=this.el.get(0),this.playing=!1}return b.player.Component.extend(a),a.defaults={type:"audio",useFrameAnimation:!0,properties:{locked:{type:"Boolean",configs:{label:b.Locale.t("player.component.Media.locked","Locked ?")},getter:function(a){return"true"===this.data("locked")},setter:function(a){this.data("locked",a?"true":null)}},x:{type:"Number",configs:{label:b.Locale.t("player.component.Media.x","X")},getter:function(a){return parseInt(this.css("left"),10)},setter:function(a){this.css("left",a+"px")}},y:{type:"Number",configs:{label:b.Locale.t("player.component.Media.y","Y")},getter:function(a){return parseInt(this.css("top"),10)},setter:function(a){this.css("top",a+"px")}},width:{type:"Number",configs:{label:b.Locale.t("player.component.Media.width","Width")},getter:function(a){return parseInt(this.css("width"),10)},setter:function(a){this.css("width",a+"px")}},height:{type:"Number",configs:{label:b.Locale.t("player.component.Media.height","Height")},getter:function(a){return parseInt(this.css("height"),10)},setter:function(a){this.css("height",a+"px")}},"border-radius":{type:"BorderRadius",configs:{label:b.Locale.t("player.component.Media.border-radius","Border radius")},getter:function(a){return this.css("border-radius",void 0,a)},setter:function(a){this.css("border-radius",a)}}}},a.prototype.setSources=function(a,c){var d="";return b.Array.each(a,function(a,b){d+='<source src="'+b.url+'" type="'+b.mime+'"></source>'},this),this.el.text(d),this.dom.load(),c!==!0&&this.triggerEvent("sourcesset",{media:this}),this},a.prototype.getName=function(){return"[media]"},a.prototype.onLoadedMetadata=function(a){this.triggerEvent("loadedmetadata",{media:this})},a.prototype.onPlay=function(a){this.playing=!0,this.triggerEvent("play",{media:this}),this.configs.useFrameAnimation&&this.triggerTimeUpdate()},a.prototype.onPause=function(a){this.playing=!1,this.triggerEvent("pause",{media:this})},a.prototype.onTimeUpdate=function(a){this.configs.useFrameAnimation||this.triggerTimeUpdate(!1)},a.prototype.onSeeking=function(a){this.triggerEvent("seeking",{media:this})},a.prototype.isPlaying=function(){return this.playing},a.prototype.reset=function(){return this.setTime(0),this},a.prototype.play=function(){return this.dom.play(),this},a.prototype.pause=function(){return this.dom.pause(),this},a.prototype.triggerTimeUpdate=function(a){a!==!1&&this.isPlaying()&&window.requestAnimationFrame(b.Function.proxy(this.triggerTimeUpdate,this)),this.triggerEvent("timeupdate",{media:this})},a.prototype.setTime=function(a){return this.dom.currentTime=parseFloat(a)/100,this.triggerTimeUpdate(!1),this},a.prototype.getTime=function(){return 100*parseFloat(this.dom.currentTime)},a.prototype.getDuration=function(){return 100*parseFloat(this.dom.duration)},a.prototype.setDraggable=function(a){return a=a!==!1,this.getProperty("locked")&&a?!1:(a&&!this._draggable?this._draggable=new b.Draggable({target:this,handle:this.child("video"),container:this.parents(),limits:{top:0,left:0}}):!a&&this._draggable&&(this._draggable.destroy(),delete this._draggable),this._draggable)},a}(),b.namespace("player.component").Page=function(){function a(b){a.parent.call(this,b)}return b.player.Component.extend(a),a.defaults={properties:{"background-color":{type:"Color",configs:{label:b.Locale.t("player.component.Page.background-color","Background color")},getter:function(a){return this.css("background-color",void 0,a)},setter:function(a){var c=b.Color.parse(a);this.css("background-color","rgba("+c.r+","+c.g+","+c.b+","+c.a+")")}},"background-image":{type:"Image",configs:{label:b.Locale.t("player.component.Page.background-image","Background image")},getter:function(a){var c=this.css("background-image",void 0,a);return"none"!==c&&b.Var.is(c,"string")?c.replace(/^url\(["']?/,"").replace(/["']?\)$/,""):null},setter:function(a){a="none"!==a&&b.Var.is(a,"string")&&a.length>0?"url("+a+")":null,this.css("background-image",a)}},"start-time":{type:"Time",configs:{label:b.Locale.t("player.component.Page.start-time","Start time"),checkbox:!1,inButton:!0,outButton:!0},getter:function(a){var b=parseFloat(this.data("start-time"));return isNaN(b)?null:b},setter:function(a){this.data("start-time",isNaN(a)?null:a)}},"end-time":{type:"Time",configs:{label:b.Locale.t("player.component.Page.end-time","End time"),checkbox:!1,inButton:!0,outButton:!0},getter:function(a){var b=parseFloat(this.data("end-time"));return isNaN(b)?null:b},setter:function(a){this.data("end-time",isNaN(a)?null:a)}},elements:{editable:!1,getter:function(a){var b=[];return this.getElements().each(function(c,d){b.push(d._metaScore.getProperties(a))},this),b},setter:function(a){b.Array.each(a,function(a,b){this.addElement(b)},this)}}}},a.prototype.setupDOM=function(){a.parent.prototype.setupDOM.call(this),this.addClass("page")},a.prototype.addElement=function(a,c){var d;return a instanceof b.player.component.Element?(d=a,d.appendTo(this)):d=new b.player.component.element[a.type](b.Object.extend({},a,{container:this})),c!==!0&&this.triggerEvent("elementadd",{page:this,element:d}),d},a.prototype.getBlock=function(){var a,b=this.parents().parents().get(0);return b&&(a=b._metaScore),a},a.prototype.getElements=function(){return this.children(".element")},a.prototype.onCuePointStart=function(a){this.triggerEvent("cuepointstart")},a.prototype.onCuePointEnd=function(a){this.triggerEvent("cuepointend")},a.prototype.onCuePointSeekOut=a.prototype.onCuePointEnd,a}(),b.namespace("player.component.element").Cursor=function(){function a(b){a.parent.call(this,b)}return b.player.component.Element.extend(a),a.defaults={properties:b.Object.extend({},b.player.component.Element.defaults.properties,{direction:{type:"Select",configs:{label:b.Locale.t("player.component.element.Cursor.direction","Direction"),options:{right:b.Locale.t("player.component.element.Cursor.direction.right","Left > Right"),left:b.Locale.t("player.component.element.Cursor.direction.left","Right > Left"),bottom:b.Locale.t("player.component.element.Cursor.direction.bottom","Top > Bottom"),top:b.Locale.t("player.component.element.Cursor.direction.top","Bottom > Top")}},getter:function(a){return this.data("direction")},setter:function(a){this.data("direction",a)}},acceleration:{type:"Number",configs:{label:b.Locale.t("player.component.element.Cursor.acceleration","Acceleration")},getter:function(a){return this.data("accel")},setter:function(a){this.data("accel",a)}},"cursor-width":{type:"Number",configs:{label:b.Locale.t("player.component.element.Cursor.cursor-width","Cursor width")},getter:function(a){var b=this.cursor.css("width",void 0,a);return null!==b?parseInt(b,10):null},setter:function(a){this.cursor.css("width",a+"px")}},"cursor-color":{type:"Color",configs:{label:b.Locale.t("player.component.element.Cursor.cursor-color","Cursor color")},getter:function(a){return this.cursor.css("background-color",void 0,a)},setter:function(a){var c=b.Color.parse(a);this.cursor.css("background-color","rgba("+c.r+","+c.g+","+c.b+","+c.a+")")}}})},a.prototype.setupDOM=function(){a.parent.prototype.setupDOM.call(this),this.data("type","cursor"),this.cursor=new b.Dom("<div/>",{"class":"cursor"}).appendTo(this.contents),this.addListener("click",b.Function.proxy(this.onClick,this)).addListener("dblclick",b.Function.proxy(this.onClick,this))},a.prototype.onClick=function(a){var c,d,e,f,g,h,i;if(!b.editing||"dblclick"===a.type){switch(e=this.getProperty("start-time"),f=this.getProperty("end-time"),g=this.getProperty("direction"),h=this.getProperty("acceleration"),i=a.target.getBoundingClientRect(),g){case"left":c=(i.right-a.clientX)/this.getProperty("width");break;case"bottom":c=(a.clientY-i.top)/this.getProperty("height");break;case"top":c=(i.bottom-a.clientY)/this.getProperty("height");break;default:c=(a.clientX-i.left)/this.getProperty("width")}d=h&&1!==h?e+(f-e)*Math.pow(c,1/h):e+(f-e)*c,this.triggerEvent("time",{element:this,value:d})}},a.prototype.onCuePointUpdate=function(a,b){var c,d,e,f,g,h=this.getProperty("direction"),i=this.getProperty("acceleration");switch(e=this.getProperty("start-time"),f=this.getProperty("end-time"),g=i&&1!==i?Math.pow((b-e)/(f-e),i):(b-e)/(f-e),h){case"left":c=this.getProperty("width"),g=Math.min(c*g,c),this.cursor.css("right",g+"px");break;case"bottom":d=this.getProperty("height"),g=Math.min(d*g,d),this.cursor.css("top",g+"px");break;case"top":d=this.getProperty("height"),g=Math.min(d*g,d),this.cursor.css("bottom",g+"px");break;default:c=this.getProperty("width"),g=Math.min(c*g,c),this.cursor.css("left",g+"px")}},a}(),b.namespace("player.component.element").Image=function(){function a(b){a.parent.call(this,b)}return b.player.component.Element.extend(a),a.prototype.setupDOM=function(){a.parent.prototype.setupDOM.call(this),this.data("type","image")},a}(),b.namespace("player.component.element").Text=function(){function a(c){a.parent.call(this,c),this.addDelegate("a","click",b.Function.proxy(this.onLinkClick,this))}return b.player.component.Element.extend(a),a.defaults={properties:b.Object.extend({},b.player.component.Element.defaults.properties,{text:{editable:!1,getter:function(){return this.contents.text()},setter:function(a){this.contents.text(a)}}})},a.prototype.setupDOM=function(){a.parent.prototype.setupDOM.call(this),this.data("type","text")},a.prototype.onLinkClick=function(a){var c,d=a.target;b.Dom.is(d,"a")||(d=b.Dom.closest(d,"a")),d&&((c=d.hash.match(/^#page=([^,]*),(\d+)$/))?(this.triggerEvent("page",{element:this,block:c[1],index:parseInt(c[2])-1}),a.preventDefault()):(c=d.hash.match(/^#play=(\d*\.?\d+),(\d*\.?\d+),(\d+)$/))?this.triggerEvent("play",{element:this,inTime:parseFloat(c[1]),outTime:parseFloat(c[2])-1,rIndex:parseInt(c[3])}):window.open(d.href,"_blank"),a.preventDefault())},a}()}(this);
//# sourceMappingURL=metaScore.player.min.js.map