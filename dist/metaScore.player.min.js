/*! metaScore - v0.0.2 - 2015-07-17 - Oussama Mubarak */
(function(t){"use strict";var e=t.metaScore;Element&&!Element.prototype.matches&&(Element.prototype.matches=Element.prototype.matchesSelector=Element.prototype.matchesSelector||Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||function(t){for(var e=this,n=(e.document||e.ownerDocument).querySelectorAll(t),i=0;n[i]&&n[i]!==e;)i++;return n[i]?!0:!1}),Element&&!Element.prototype.closest&&(Element.prototype.closest=function(t){for(var e=this;e;){if(e.matches(t))return e;e=e.parentElement}return null}),window.CustomEvent&&"function"==typeof window.CustomEvent||(window.CustomEvent=function(t,e){var n;return e=e||{bubbles:!1,cancelable:!1,detail:void 0},n=document.createEvent("CustomEvent"),n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n},window.CustomEvent.prototype=window.Event.prototype),function(){for(var t=0,e=["ms","moz","webkit","o"],n=0;e.length>n&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[e[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[n]+"CancelAnimationFrame"]||window[e[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var n=(new Date).getTime(),i=Math.max(0,16-(n-t)),o=window.setTimeout(function(){e(n+i)},i);return t=n+i,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}(),e=t.metaScore={getVersion:function(){return"0.0.2"},getRevision:function(){return"b7a483"},namespace:function(t){for(var e,n=this,i=t.split("."),o=0,r=i.length;r>o;o++)e=i[o],n[e]=n[e]||{},n=n[e];return n}},e.Class=function(){function t(){}return t.defaults={},t.extend=function(t){t.prototype=Object.create(this.prototype,{constructor:{value:t}}),t.parent=this,t.extend=this.extend,"defaults"in t||(t.defaults={});for(var e in this.defaults)e in t.defaults||(t.defaults[e]=this.defaults[e])},t.prototype.getConfigs=function(t){t=t||{};for(var e in this.constructor.defaults)e in t||(t[e]=this.constructor.defaults[e]);return t},t}(),e.Evented=function(){function t(){t.parent.call(this),this.listeners={}}return e.Class.extend(t),t.prototype.addListener=function(t,e){return this.listeners[t]===void 0&&(this.listeners[t]=[]),this.listeners[t].push(e),this},t.prototype.removeListener=function(t,e){if(this.listeners[t]instanceof Array)for(var n=this.listeners[t],i=0,o=n.length;o>i;i++)if(n[i]===e){n.splice(i,1);break}return this},t.prototype.triggerEvent=function(t,n,i,o){var r,s;return this.listeners[t]instanceof Array&&(r=this.listeners[t],s={target:this,type:t,detail:n,bubbles:i!==!1,cancelable:o!==!1},e.Object.each(r,function(t,e){e.call(this,s)},this)),this},t}(),e.Ajax=function(){function t(){}return e.Class.extend(t),t.send=function(t,n){var i=new XMLHttpRequest,o={method:"GET",headers:{},async:!0,data:{},dataType:"json",complete:null,success:null,error:null,scope:this};return n=e.Object.extend({},o,n),i.open(n.method,t,n.async),e.Object.each(n.headers,function(t,e){i.setRequestHeader(t,e)}),i.onreadystatechange=function(){4===i.readyState&&(e.Var.is(n.complete,"function")&&n.complete.call(n.scope,i),i.status>=200&&300>i.status||304===i.status?e.Var.is(n.success,"function")&&n.success.call(n.scope,i):e.Var.is(n.error,"function")&&n.error.call(n.scope,i))},i.send(n.data),i},t.get=function(n,i){return e.Object.extend(i,{method:"GET"}),t.send(n,i)},t.post=function(n,i){return e.Object.extend(i,{method:"POST"}),t.send(n,i)},t.put=function(n,i){return e.Object.extend(i,{method:"PUT"}),t.send(n,i)},t}(),e.Array=function(){function t(){}return e.Class.extend(t),t.inArray=function(t,e){var n,i=0;if(e){if(e.indexOf)return e.indexOf(t);for(n=e.length;n>i;i++)if(i in e&&e[i]===t)return i}return-1},t.copy=function(t){return[].concat(t)},t.shuffle=function(e){var n=t.copy(e);return n.sort(function(){return(0|3*Math.random())-1}),n},t.unique=function(t){for(var e=[],n=t.length,i=0;n>i;i++){for(var o=i+1;n>o;o++)t[i]===t[o]&&(o=++i);e.push(t[i])}return e},t.each=function(t,e,n){for(var i,o=0,r=t.length,s=void 0!==n;r>o&&(i=e.call(s?n:t[o],o,t[o]),i!==!1);o++);return t},t.remove=function(e,n){for(var i=t.inArray(n,e);i>-1;)e.splice(i,1),i=t.inArray(n,e);return e},t}(),e.Color=function(){function t(){}return e.Class.extend(t),t.rgb2hsv=function(t){var e,n,i,o=t.r,r=t.g,s=t.b,a=Math.max(o,r,s),c=Math.min(o,r,s),l=a-c;if(n=0===a?0:l/a,i=a,a===c)e=0;else{switch(a){case o:e=(r-s)/l+(s>r?6:0);break;case r:e=(s-o)/l+2;break;case s:e=(o-r)/l+4}e/=6}return{h:e,s:n,v:i}},t.parse=function(t){var n,i;return n={r:0,g:0,b:0,a:0},e.Var.is(t,"object")?(n.r="r"in t?t.r:0,n.g="g"in t?t.g:0,n.b="b"in t?t.b:0,n.a="a"in t?t.a:1):e.Var.is(t,"string")&&(t=t.replace(/\s\s*/g,""),(i=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})/.exec(t))?(n.r=parseInt(i[1],16),n.g=parseInt(i[2],16),n.b=parseInt(i[3],16),n.a=1):(i=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])/.exec(t))?(n.r=17*parseInt(i[1],16),n.g=17*parseInt(i[2],16),n.b=17*parseInt(i[3],16),n.a=1):(i=/^rgba\(([\d]+),([\d]+),([\d]+),([\d]+|[\d]*.[\d]+)\)/.exec(t))?(n.r=+i[1],n.g=+i[2],n.b=+i[3],n.a=+i[4]):(i=/^rgb\(([\d]+),([\d]+),([\d]+)\)/.exec(t))&&(n.r=+i[1],n.g=+i[2],n.b=+i[3],n.a=1)),n},t}(),e.Dom=function(){function t(){var t;this.elements=[],arguments.length>0&&((t=e.Dom.elementsFromString.apply(this,arguments))?(this.add(t),arguments.length>1&&this.attr(arguments[1])):(t=e.Dom.selectElements.apply(this,arguments))&&(this.add(t),arguments.length>2&&this.attr(arguments[2])))}return e.Class.extend(t),t.stringRe=/^<(.)+>$/,t.camelRe=/-([\da-z])/gi,t.camelReplaceFn=function(t,e){return e.toUpperCase()},t.camel=function(e){return e.replace(t.camelRe,t.camelReplaceFn)},t.bubbleEvents={click:!0,submit:!0,mousedown:!0,mousemove:!0,mouseup:!0,mouseover:!0,mouseout:!0,transitionend:!0},t.selectElement=function(t,n){var i;return n||(n=document),i=e.Var.is(t,"string")?n.querySelector(t):t.length?t[0]:t},t.selectElements=function(n,i){var o;return void 0!==n&&(i?i instanceof t&&(i=i.get(0)):i=document,o=e.Var.is(n,"string")?i.querySelectorAll(n):"length"in n?n:[n]),o},t.elementsFromString=function(t){var e,n,i,o={option:[1,"<select multiple='multiple'>","</select>"],optgroup:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tbody:[1,"<table>","</table>"],tfoot:[1,"<table>","</table>"],colgroup:[1,"<table>","</table>"],caption:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],th:[3,"<table><tbody><tr>","</tr></tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[1,"<div>","</div>"]},r=document.createElement("div"),s=/<\s*\w.*?>/g.exec(t);if(null!=s){for(e=s[0].replace(/</g,"").replace(/\/?>/g,""),n=o[e]||o._default,t=n[1]+t+n[2],r.innerHTML=t,i=n[0];i--;)r=r.lastChild;return r.childNodes}return null},t.hasClass=function(t,e){return t.classList.contains(e)},t.addClass=function(t,e){for(var n=e.split(" "),i=0,o=n.length;o>i;i++)t.classList.add(n[i])},t.removeClass=function(t,e){for(var n=e.split(" "),i=0,o=n.length;o>i;i++)t.classList.remove(n[i])},t.toggleClass=function(t,e,n){var i=e.split(" "),o=0,r=i.length;if(void 0===n)for(;r>o;o++)t.classList.toggle(i[o]);else for(;r>o;o++)t.classList.toggle(i[o],n)},t.addListener=function(e,n,i,o){return void 0===o&&(o="type"in t.bubbleEvents?t.bubbleEvents[n]:!1),e.addEventListener(n,i,o)},t.removeListener=function(e,n,i,o){return void 0===o&&(o="type"in t.bubbleEvents?t.bubbleEvents[n]:!1),e.removeEventListener(n,i,o)},t.triggerEvent=function(t,e,n,i,o){var r=new CustomEvent(e,{detail:n,bubbles:i!==!1,cancelable:o!==!1});return t.dispatchEvent(r)},t.text=function(t,e){return void 0!==e&&(t.innerHTML=e),t.innerHTML},t.val=function(t,e){return void 0!==e&&(t.value=e),t.value},t.attr=function(n,i,o){if(e.Var.is(i,"object"))e.Object.each(i,function(e,i){t.attr(n,e,i)},this);else switch(i){case"class":this.addClass(n,o);break;case"text":this.text(n,o);break;default:if(null!==o)return void 0!==o&&n.setAttribute(i,o),n.getAttribute(i);n.removeAttribute(i)}},t.css=function(t,e,n,i){var o,r;return o=this.camel(e),void 0!==n&&(t.style[o]=n),r=i===!0?t.style:window.getComputedStyle(t),r.getPropertyValue(e)},t.data=function(t,e,n){return e=this.camel(e),null===n?delete t.dataset[e]:void 0!==n&&(t.dataset[e]=n),t.dataset[e]},t.append=function(t,n){e.Var.is(n,"array")||(n=[n]),e.Array.each(n,function(e,n){t.appendChild(n)},this)},t.before=function(t,n){e.Var.is(n,"array")||(n=[n]),e.Array.each(n,function(e,n){t.parentElement.insertBefore(n,t)},this)},t.after=function(t,n){e.Var.is(n,"array")||(n=[n]),e.Array.each(n,function(e,n){t.parentElement.insertBefore(n,t.nextSibling)},this)},t.empty=function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},t.remove=function(t){t.parentElement&&t.parentElement.removeChild(t)},t.is=function(t,e){var n,i;return t instanceof Element?Element.prototype.matches.call(t,e):(n=t.ownerDocument)&&(i=n.defaultView||n.parentWindow)?t instanceof i.Element&&Element.prototype.matches.call(t,e):!1},t.closest=function(t,e){var n,i;return t instanceof Element?Element.prototype.closest.call(t,e):(n=t.ownerDocument)&&(i=n.defaultView||n.parentWindow)&&t instanceof i.Element?Element.prototype.closest.call(t,e):null},t.prototype.add=function(t){if("length"in t)for(var e=0;t.length>e;e++)this.elements.push(t[e]);else this.elements.push(t)},t.prototype.count=function(){return this.elements.length},t.prototype.get=function(t){return this.elements[t]},t.prototype.filter=function(e){var n=new t;return this.each(function(i,o){t.is(o,e)&&n.add(o)},this),n},t.prototype.index=function(e){var n=-1;return this.each(function(i,o){return t.is(o,e)?(n=i,!1):void 0},this),n},t.prototype.find=function(e){var n=new t;return this.each(function(i,o){n.add(t.selectElements.call(this,e,o))},this),n},t.prototype.children=function(e){var n=new t;return this.each(function(t,e){n.add(e.children)},this),e&&(n=n.filter(e)),n},t.prototype.child=function(e){return new t(this.children(e).get(0))},t.prototype.parents=function(e){var n=new t;return this.each(function(t,e){n.add(e.parentElement)},this),e&&(n=n.filter(e)),n},t.prototype.each=function(t,n){n=n||this,e.Array.each(this.elements,t,n)},t.prototype.hasClass=function(e){var n;return this.each(function(i,o){return n=t.hasClass(o,e),!n},this),n},t.prototype.addClass=function(e){return this.each(function(n,i){t.addClass(i,e)},this),this},t.prototype.removeClass=function(e){return this.each(function(n,i){t.removeClass(i,e)},this),this},t.prototype.toggleClass=function(e,n){return this.each(function(i,o){t.toggleClass(o,e,n)},this),this},t.prototype.addListener=function(e,n,i){return this.each(function(o,r){t.addListener(r,e,n,i)},this),this},t.prototype.addDelegate=function(e,n,i,o,r){return o=o||this,this.addListener(n,function(n){for(var r,s=n.target;s;){if(t.is(s,e)){r=s;break}s=s.parentElement}r&&i.call(o,n,r)},r)},t.prototype.removeListener=function(e,n,i){return this.each(function(o,r){t.removeListener(r,e,n,i)},this),this},t.prototype.triggerEvent=function(e,n,i,o){var r=!0;return this.each(function(s,a){r=t.triggerEvent(a,e,n,i,o)&&r},this),r},t.prototype.text=function(e){return void 0===e?t.text(this.get(0)):(this.each(function(n,i){t.text(i,e)},this),void 0)},t.prototype.val=function(e){return void 0!==e?(this.each(function(n,i){t.val(i,e)},this),this):t.val(this.get(0))},t.prototype.attr=function(n,i){return void 0!==i||e.Var.is(n,"object")?(this.each(function(e,o){t.attr(o,n,i)},this),this):t.attr(this.get(0),n)},t.prototype.css=function(e,n,i){return void 0!==n?(this.each(function(o,r){t.css(r,e,n,i)},this),this):t.css(this.get(0),e,n,i)},t.prototype.data=function(e,n){return void 0!==n?(this.each(function(i,o){t.data(o,e,n)},this),this):t.data(this.get(0),e)},t.prototype.append=function(e){return e instanceof t&&(e=e.elements),t.append(this.get(0),e),this},t.prototype.appendTo=function(e){return e instanceof t||(e=new t(e)),e=e.get(0),this.each(function(n,i){t.append(e,i)},this),this},t.prototype.insertAt=function(e,n){var i;return e instanceof t||(e=new t(e)),i=e.children().get(n),i?t.before(i,this.elements):this.appendTo(e),this},t.prototype.empty=function(){return this.each(function(e,n){t.empty(n)},this),this},t.prototype.show=function(){return this.css("display",""),this},t.prototype.hide=function(){return this.css("display","none"),this},t.prototype.focus=function(){return this.get(0).focus(),this},t.prototype.blur=function(){return this.get(0).blur(),this},t.prototype.remove=function(){return this.triggerEvent("beforeremove")!==!1&&this.each(function(e,n){var i=n.parentElement;t.remove(n),t.triggerEvent(i,"childremove",{child:n})},this),this},t.prototype.is=function(e){var n;return this.each(function(i,o){return n=t.is(o,e)},this),n},t.prototype.closest=function(e){var n;return this.each(function(i,o){return n=t.closest(o,e),null!==n},this),n},t}(),e.Draggable=function(){function t(t){this.configs=this.getConfigs(t),this.configs.container=this.configs.container||new e.Dom("body"),this.doc=new e.Dom(this.configs.container.get(0).ownerDocument),this.onMouseDown=e.Function.proxy(this.onMouseDown,this),this.onMouseMove=e.Function.proxy(this.onMouseMove,this),this.onMouseUp=e.Function.proxy(this.onMouseUp,this),this.configs.handle.addListener("mousedown",this.onMouseDown),this.enable()}return t.defaults={limits:{top:null,left:null}},e.Class.extend(t),t.prototype.onMouseDown=function(t){this.enabled&&(this.start_state={left:parseInt(this.configs.target.css("left"),10)-t.clientX,top:parseInt(this.configs.target.css("top"),10)-t.clientY},this.doc.addListener("mouseup",this.onMouseUp).addListener("mousemove",this.onMouseMove),this.configs.target.addClass("dragging").triggerEvent("dragstart",null,!1,!0),t.stopPropagation())},t.prototype.onMouseMove=function(t){var e=t.clientX+this.start_state.left,n=t.clientY+this.start_state.top;isNaN(this.configs.limits.top)||(n=Math.max(n,this.configs.limits.top)),isNaN(this.configs.limits.left)||(e=Math.max(e,this.configs.limits.left)),this.configs.target.css("left",e+"px").css("top",n+"px").triggerEvent("drag",null,!1,!0),t.stopPropagation()},t.prototype.onMouseUp=function(t){this.doc.removeListener("mousemove",this.onMouseMove).removeListener("mouseup",this.onMouseUp),this.configs.target.removeClass("dragging").triggerEvent("dragend",null,!1,!0),t.stopPropagation()},t.prototype.enable=function(){return this.configs.target.addClass("draggable"),this.configs.handle.addClass("drag-handle"),this.enabled=!0,this},t.prototype.disable=function(){return this.configs.target.removeClass("draggable"),this.configs.handle.removeClass("drag-handle"),this.enabled=!1,this},t.prototype.destroy=function(){return this.disable(),this.configs.handle.removeListener("mousedown",this.onMouseDown),this},t}(),e.Function=function(){function t(){}return e.Class.extend(t),t.proxy=function(t,n,i){return e.Var.type(t,"function")?function(){var e;return i?(e=Array.prototype.slice.call(i),e=e.concat(Array.prototype.slice.call(arguments))):e=arguments,t.apply(n||this,e)}:void 0},t.emptyFn=function(){},t}(),e.Object=function(){function t(){}return e.Class.extend(t),t.extend=function(){for(var t,e,n,i,o=arguments[0]||{},r=1,s=arguments.length;s>r;r++)if(null!=(t=arguments[r]))for(e in t)n=o[e],i=t[e],n!==i&&void 0!==i&&(o[e]=i);return o},t.copy=function(e){return t.extend({},e)},t.each=function(t,e,n){var i,o,r=void 0!==n;for(i in t)if(o=e.call(r?n:t[i],i,t[i]),o===!1)break;return t},t}(),e.Resizable=function(){function t(t){this.configs=this.getConfigs(t),this.configs.container=this.configs.container||new e.Dom("body"),this.doc=new e.Dom(this.configs.container.get(0).ownerDocument),this.handles={},this.onMouseDown=e.Function.proxy(this.onMouseDown,this),this.onMouseMove=e.Function.proxy(this.onMouseMove,this),this.onMouseUp=e.Function.proxy(this.onMouseUp,this),e.Array.each(this.configs.directions,function(t,n){this.handles[n]=new e.Dom("<div/>",{"class":"resize-handle"}).data("direction",n).addListener("mousedown",this.onMouseDown).appendTo(this.configs.target)},this),this.enable()}return t.defaults={directions:["top","right","bottom","left","top-left","top-right","bottom-left","bottom-right"]},e.Class.extend(t),t.prototype.onMouseDown=function(t){this.enabled&&(this.start_state={handle:t.target,x:t.clientX,y:t.clientY,left:parseInt(this.configs.target.css("left"),10),top:parseInt(this.configs.target.css("top"),10),w:parseInt(this.configs.target.css("width"),10),h:parseInt(this.configs.target.css("height"),10)},this.doc.addListener("mousemove",this.onMouseMove,this).addListener("mouseup",this.onMouseUp,this),this.configs.target.addClass("resizing").triggerEvent("resizestart",null,!1,!0),t.stopPropagation())},t.prototype.onMouseMove=function(t){var n,i,o,r,s=new e.Dom(this.start_state.handle);switch(s.data("direction")){case"top":i=this.start_state.h-t.clientY+this.start_state.y,o=this.start_state.top+t.clientY-this.start_state.y;break;case"right":n=this.start_state.w+t.clientX-this.start_state.x;break;case"bottom":i=this.start_state.h+t.clientY-this.start_state.y;break;case"left":n=this.start_state.w-t.clientX+this.start_state.x,r=this.start_state.left+t.clientX-this.start_state.x;break;case"top-left":n=this.start_state.w-t.clientX+this.start_state.x,i=this.start_state.h-t.clientY+this.start_state.y,o=this.start_state.top+t.clientY-this.start_state.y,r=this.start_state.left+t.clientX-this.start_state.x;break;case"top-right":n=this.start_state.w+t.clientX-this.start_state.x,i=this.start_state.h-t.clientY+this.start_state.y,o=this.start_state.top+t.clientY-this.start_state.y;break;case"bottom-left":n=this.start_state.w-t.clientX+this.start_state.x,i=this.start_state.h+t.clientY-this.start_state.y,r=this.start_state.left+t.clientX-this.start_state.x;break;case"bottom-right":n=this.start_state.w+t.clientX-this.start_state.x,i=this.start_state.h+t.clientY-this.start_state.y}void 0!==o&&this.configs.target.css("top",o+"px"),void 0!==r&&this.configs.target.css("left",r+"px"),this.configs.target.css("width",n+"px").css("height",i+"px").triggerEvent("resize",null,!1,!0),t.stopPropagation()},t.prototype.onMouseUp=function(t){this.doc.removeListener("mousemove",this.onMouseMove,this).removeListener("mouseup",this.onMouseUp,this),this.configs.target.removeClass("resizing").triggerEvent("resizeend",null,!1,!0),t.stopPropagation()},t.prototype.enable=function(){return this.configs.target.addClass("resizable"),this.enabled=!0,this},t.prototype.disable=function(){return this.configs.target.removeClass("resizable"),this.enabled=!1,this},t.prototype.destroy=function(){return this.disable(),e.Object.each(this.handles,function(t,e){e.remove()},this),this},t}(),e.String=function(){function t(){}return e.Class.extend(t),t.capitalize=function(t){return t.replace(/(?:^|\s)\S/g,function(t){return t.toUpperCase()})},t.uuid=function(t,e){var n,i=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],o=[];if(e=e||i.length,t)for(n=0;t>n;n++)o[n]=i[0|Math.random()*e];else{var r;for(o[8]=o[13]=o[18]=o[23]="-",o[14]="4",n=0;36>n;n++)o[n]||(r=0|16*Math.random(),o[n]=i[19===n?8|3&r:r])}return o.join("")},t.pad=function(t,e,n,i){var o,r,s;if(e===void 0&&(e=0),n===void 0&&(n=" "),i===void 0&&(i="right"),t+="",e+1>=t.length)switch(i){case"left":t=Array(e+1-t.length).join(n)+t;break;case"both":s=e-t.length,o=Math.ceil(s/2),r=s-o,t=Array(r+1).join(n)+t+Array(o+1).join(n);break;default:t+=Array(e+1-t.length).join(n)}return t},t}(),e.StyleSheet=function(){function t(t){this.configs=this.getConfigs(t),e.Dom.call(this,"<style/>",{type:"text/css"}),this.el=this.get(0),this.setInternalValue("")}return e.Dom.extend(t),t.prototype.addRule=function(t,e,n){var i=this.el.sheet;return void 0===n&&(n=i.cssRules.length),"insertRule"in i?i.insertRule(t+"{"+e+"}",n):"addRule"in i?i.addRule(t,e,n):void 0},t.prototype.removeRule=function(t){var e=this.el.sheet;return"deleteRule"in e?e.deleteRule(t):"removeRule"in e&&e.removeRule(t),this},t.prototype.removeRulesBySelector=function(t){var e=this.el.sheet,n=e.cssRules||e.rules;t=t.toLowerCase();for(var i=0;n.length>i;i++)if(n[i].selectorText.toLowerCase()===t){this.removeRule(i);break}return this},t.prototype.removeRules=function(){for(var t=this.el.sheet,e=t.cssRules||t.rules;e.length>0;)this.removeRule(0);return this},t.prototype.setInternalValue=function(t){return this.el.styleSheet?this.el.styleSheet.cssText=t:this.text(t),this},t}(),e.Var=function(){function t(){}var n={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"};return e.Class.extend(t),t.type=function(t){return null==t?t+"":n[Object.prototype.toString.call(t)]||"object"},t.is=function(e,n){return t.type(e)===n.toLowerCase()},t.isEmpty=function(t){return void 0===t||null==t?!0:t.hasOwnProperty("length")?0>=t.length:e.Var.is(t,"object")?0>=Object.keys(t).length:!1},t}(),e.Locale=function(){function t(){}return e.Class.extend(t),t.t=function(e,n,i){return"undefined"!=typeof metaScoreLocale&&metaScoreLocale.hasOwnProperty(e)&&(n=metaScoreLocale[e]),t.formatString(n,i)},t.formatString=function(t,n){return e.Object.each(n,function(e){t=t.replace(e,n[e])},this),t},t}(),e.Player=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this,"<div></div>",{"class":"metaScore-player"}),this.configs.keyboard&&this.attr("tabindex",0).addListener("keydown",e.Function.proxy(this.onKey,this)).addListener("keyup",e.Function.proxy(this.onKey,this)),this.configs.api&&e.Dom.addListener(window,"message",e.Function.proxy(this.onAPIMessage,this)),this.appendTo(this.configs.container),this.load()}return t.defaults={url:"",container:"body",ajax:{},keyboard:!1,api:!1},e.Dom.extend(t),t.prototype.onKey=function(t){var e="keydown"===t.type;switch(t.keyCode){case 32:e||this.togglePlay(),t.preventDefault();break;case 37:e||this.find('.metaScore-component.block:hover .pager .button[data-action="previous"]').triggerEvent("click"),t.preventDefault();break;case 39:e||this.find('.metaScore-component.block:hover .pager .button[data-action="next"]').triggerEvent("click"),t.preventDefault()}},t.prototype.onAPIMessage=function(t){var e,n,i,o,r;try{e=JSON.parse(t.data)}catch(s){return!1}if(!("method"in e))return!1;switch(n=t.source,i=event.origin,o=e.method,r="params"in e?e.params:null,o){case"play":this.getMedia().play();break;case"pause":this.getMedia().pause();break;case"paused":n.postMessage(JSON.stringify({callback:r,params:!this.getMedia().isPlaying()}),i);break;case"seek":this.getMedia().setTime(100*parseFloat(r,10));break;case"time":n.postMessage(JSON.stringify({callback:r,params:this.getMedia().getTime()/100}),i);break;case"addEventListener":switch(r.type){case"ready":this.addListener("loadsuccess",function(){n.postMessage(JSON.stringify({callback:r.callback}),i)});break;case"timeupdate":this.addListener(r.type,function(t){n.postMessage(JSON.stringify({callback:r.callback,params:t.detail.media.getTime()/100}),i)});break;case"rindex":this.addListener(r.type,function(t){n.postMessage(JSON.stringify({callback:r.callback,params:t.detail.value}),i)})}break;case"removeEventListener":}},t.prototype.onControllerButtonClick=function(t){var n=e.Dom.data(t.target,"action");switch(n){case"rewind":this.getMedia().reset();break;case"play":this.togglePlay()}t.stopPropagation()},t.prototype.onMediaSourcesSet=function(){this.getMedia().addMediaListener("loadedmetadata",e.Function.proxy(this.onMediaLoadedMetadata,this)).addMediaListener("play",e.Function.proxy(this.onMediaPlay,this)).addMediaListener("pause",e.Function.proxy(this.onMediaPause,this)).addMediaListener("timeupdate",e.Function.proxy(this.onMediaTimeUpdate,this))},t.prototype.onMediaLoadedMetadata=function(){this.getMedia().reset()},t.prototype.onMediaPlay=function(){this.controller.addClass("playing")},t.prototype.onMediaPause=function(){this.controller.removeClass("playing")},t.prototype.onMediaTimeUpdate=function(t){var e=t.detail.media.getTime();this.controller.updateTime(e)},t.prototype.onPageActivate=function(t){var e=t.target._metaScore,n=t.detail.page,i=t.detail.basis;e.getProperty("synched")&&"pagecuepoint"!==i&&this.getMedia().setTime(n.getProperty("start-time"))},t.prototype.onCursorElementTime=function(t){this.getMedia().setTime(t.detail.value)},t.prototype.onTextElementTime=function(t){var n=this;this.linkcuepoint&&this.linkcuepoint.destroy(),this.linkcuepoint=new e.player.CuePoint({media:this.getMedia(),inTime:t.detail.inTime,outTime:t.detail.outTime,onStart:function(){n.setReadingIndex(t.detail.rIndex)},onEnd:function(t){t.getMedia().pause()},onSeekOut:function(t){t.destroy(),delete n.linkcuepoint,n.setReadingIndex(0)},considerError:!0}),this.getMedia().setTime(t.detail.inTime).play()},t.prototype.onComponenetPropChange=function(t){var e=t.detail.component;switch(t.detail.property){case"start-time":case"end-time":e.setCuePoint({media:this.getMedia()})}},t.prototype.onLoadSuccess=function(t){this.json=JSON.parse(t.response),this.setId(this.json.id).setRevision(this.json.vid),this.json.base_url&&new e.Dom("<base/>",{href:this.json.base_url,target:"_blank"}).appendTo(document.head),new e.Dom("<link/>",{rel:"stylesheet",type:"text/css",href:this.json.library_css}).appendTo(document.head),this.css=(new e.StyleSheet).setInternalValue(this.json.css).appendTo(document.head),this.rindex_css=(new e.StyleSheet).appendTo(document.head),e.Array.each(this.json.blocks,function(t,n){switch(n.type){case"media":this.addMedia(e.Object.extend({},n,{type:this.json.type})),this.getMedia().setSources([this.json.media]);break;case"controller":this.addController(n);break;default:this.addBlock(n)}},this),this.removeClass("loading"),this.triggerEvent("loadsuccess",{player:this,data:this.json},!0,!1)},t.prototype.onLoadError=function(){this.removeClass("loading"),this.triggerEvent("loaderror",{player:this},!0,!1)},t.prototype.load=function(){var t;this.addClass("loading"),t=e.Object.extend({},{success:e.Function.proxy(this.onLoadSuccess,this),error:e.Function.proxy(this.onLoadError,this)},this.configs.ajax),e.Ajax.get(this.configs.url,t)},t.prototype.getId=function(){return this.data("id")},t.prototype.setId=function(t,e){return this.data("id",t),e!==!0&&this.triggerEvent("idset",{player:this,id:t},!0,!1),this},t.prototype.getRevision=function(){return this.data("vid")},t.prototype.setRevision=function(t,e){return this.data("vid",t),e!==!0&&this.triggerEvent("revisionset",{player:this,vid:t},!0,!1),this},t.prototype.getData=function(){return this.json},t.prototype.getMedia=function(){return this.media},t.prototype.updateData=function(t){e.Object.extend(this.json,t),"css"in t&&this.updateCSS(t.css),"media"in t&&this.getMedia().setSources([t.media]),"vid"in t&&this.setRevision(t.vid)},t.prototype.getComponent=function(t){return this.getComponents(t).get(0)},t.prototype.getComponents=function(t){var e;return e=this.find(".metaScore-component"),t&&(e=e.filter(t)),e},t.prototype.addMedia=function(t,n){return this.media=new e.player.component.Media(t).addListener("sourcesset",e.Function.proxy(this.onMediaSourcesSet,this)).appendTo(this),n!==!0&&this.triggerEvent("mediaadd",{player:this,media:this.media},!0,!1),this},t.prototype.addController=function(t,n){return this.controller=new e.player.component.Controller(t).addDelegate(".buttons button","click",e.Function.proxy(this.onControllerButtonClick,this)).appendTo(this),n!==!0&&this.triggerEvent("controlleradd",{player:this,controller:this.controller},!0,!1),this},t.prototype.addBlock=function(t,n){var i;return t instanceof e.player.component.Block?(i=t,i.appendTo(this)):i=new e.player.component.Block(e.Object.extend({},t,{container:this,listeners:{propchange:e.Function.proxy(this.onComponenetPropChange,this)}})).addListener("pageactivate",e.Function.proxy(this.onPageActivate,this)).addDelegate('.element[data-type="Cursor"]',"time",e.Function.proxy(this.onCursorElementTime,this)).addDelegate('.element[data-type="Text"]',"time",e.Function.proxy(this.onTextElementTime,this)),n!==!0&&this.triggerEvent("blockadd",{player:this,block:i},!0,!1),i},t.prototype.updateCSS=function(t){this.css.setInternalValue(t)},t.prototype.togglePlay=function(){var t=this.getMedia();t.isPlaying()?t.pause():t.play()},t.prototype.setReadingIndex=function(t,e){return this.rindex_css.removeRules(),0!==t&&(this.rindex_css.addRule('.metaScore-component.element[data-r-index="'+t+'"]',"display: block;"),this.rindex_css.addRule('.metaScore-component.element[data-r-index="'+t+'"]:not([data-start-time]) .contents',"display: block;"),this.rindex_css.addRule('.metaScore-component.element[data-r-index="'+t+'"].active .contents',"display: block;")),e!==!0&&this.triggerEvent("rindex",{player:this,value:t},!0,!1),this},t}(),e.namespace("player").Component=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this,"<div/>",{"class":"metaScore-component",id:"component-"+e.String.uuid(5)}),this.get(0)._metaScore=this,this.configs.container&&(e.Var.is(this.configs.index,"number")?this.insertAt(this.configs.container,this.configs.index):this.appendTo(this.configs.container)),e.Object.each(this.configs.listeners,function(t,e){this.addListener(t,e)},this),this.setupDOM(),this.setProperties(this.configs)}return e.Dom.extend(t),t.defaults={container:null,index:null,properties:{}},t.prototype.setupDOM=function(){},t.prototype.getId=function(){return this.attr("id")},t.prototype.getName=function(){return this.getProperty("name")},t.prototype.instanceOf=function(t){return t in e.player.component&&this instanceof e.player.component[t]},t.prototype.hasProperty=function(t){return t in this.configs.properties},t.prototype.getProperty=function(t){return this.hasProperty(t)&&"getter"in this.configs.properties[t]?this.configs.properties[t].getter.call(this):void 0},t.prototype.getProperties=function(t){var n,i={};return e.Object.each(this.configs.properties,function(e,o){"getter"in o&&(n=o.getter.call(this,t),null!==n&&(i[e]=n))},this),i},t.prototype.setProperty=function(t,e,n){return t in this.configs.properties&&"setter"in this.configs.properties[t]&&(this.configs.properties[t].setter.call(this,e),n!==!0&&this.triggerEvent("propchange",{component:this,property:t,value:e})),this},t.prototype.setProperties=function(t,n){return e.Object.each(t,function(t,e){this.setProperty(t,e,n)},this),this},t.prototype.setCuePoint=function(t){var n=this.getProperty("start-time"),i=this.getProperty("end-time");return this.cuepoint&&this.cuepoint.destroy(),(null!=n||null!=i)&&(this.cuepoint=new e.player.CuePoint(e.Object.extend({},t,{inTime:n,outTime:i,onStart:this.onCuePointStart?e.Function.proxy(this.onCuePointStart,this):null,onUpdate:this.onCuePointUpdate?e.Function.proxy(this.onCuePointUpdate,this):null,onEnd:this.onCuePointEnd?e.Function.proxy(this.onCuePointEnd,this):null}))),this.cuepoint},t.prototype.setDraggable=function(){return!1},t.prototype.setResizable=function(){return!1},t}(),e.namespace("player").CuePoint=function(){function t(t){this.configs=this.getConfigs(t),this.id=e.String.uuid(),this.running=!1,this.launch=e.Function.proxy(this.launch,this),this.stop=e.Function.proxy(this.stop,this),this.onMediaTimeUpdate=e.Function.proxy(this.onMediaTimeUpdate,this),this.onMediaSeeked=e.Function.proxy(this.onMediaSeeked,this),this.configs.media.addMediaListener("timeupdate",this.onMediaTimeUpdate),this.max_error=0}return e.Evented.extend(t),t.defaults={media:null,inTime:null,outTime:null,onStart:null,onUpdate:null,onEnd:null,onSeekOut:null,considerError:!1},t.prototype.onMediaTimeUpdate=function(){var t=this.configs.media.getTime();
this.running?(this.configs.considerError&&("previous_time"in this&&(this.max_error=Math.max(this.max_error,Math.abs(t-this.previous_time))),this.previous_time=t),(Math.ceil(t)<this.configs.inTime||null!==this.configs.outTime&&Math.floor(t+this.max_error)>=this.configs.outTime)&&this.stop(),this.configs.onUpdate&&this.configs.onUpdate(this,t)):Math.floor(t)>=this.configs.inTime&&(null===this.configs.outTime||Math.ceil(t)<this.configs.outTime)&&this.launch(),this.configs.onSeekOut&&this.configs.media.addMediaListener("seeking",this.onMediaSeeked)},t.prototype.onMediaSeeked=function(){var t;this.configs.media.removeMediaListener("play",this.onMediaSeeked),this.configs.onSeekOut&&(t=this.configs.media.getTime(),(Math.ceil(t)<this.configs.inTime||Math.floor(t)>this.configs.outTime)&&this.configs.onSeekOut(this))},t.prototype.getMedia=function(){return this.configs.media},t.prototype.getInTime=function(){return this.configs.inTime},t.prototype.getOutTime=function(){return this.configs.outTime},t.prototype.launch=function(){this.running||(this.configs.onStart&&this.configs.onStart(this),null===this.configs.outTime||!this.configs.onUpdate&&!this.configs.onEnd?this.stop():this.running=!0)},t.prototype.stop=function(t){t!==!1&&this.configs.onEnd&&(this.configs.onEnd(this),this.configs.onSeekOut&&this.configs.media.addMediaListener("play",this.onMediaSeeked)),this.configs.considerError&&(this.max_error=0,delete this.previous_time),this.running=!1},t.prototype.destroy=function(){this.stop(!1),this.configs.media.removeMediaListener("timeupdate",this.onMediaTimeUpdate).removeMediaListener("seeking",this.onMediaSeeked).removeMediaListener("play",this.onMediaSeeked)},t}(),e.namespace("player").Pager=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this,"<div/>",{"class":"pager"}),this.count=new e.Dom("<div/>",{"class":"count"}).appendTo(this),this.buttons=new e.Dom("<div/>",{"class":"buttons"}).addListener("mousedown",function(t){t.stopPropagation()}).appendTo(this),this.buttons.first=new e.Dom("<div/>",{"class":"button","data-action":"first"}).appendTo(this.buttons),this.buttons.previous=new e.Dom("<div/>",{"class":"button","data-action":"previous"}).appendTo(this.buttons),this.buttons.next=new e.Dom("<div/>",{"class":"button","data-action":"next"}).appendTo(this.buttons)}return e.Dom.extend(t),t.prototype.updateCount=function(t,n){this.count.text(e.Locale.t("player.Pager.count","page !current/!count",{"!current":t+1,"!count":n})),this.buttons.first.toggleClass("inactive",1>t),this.buttons.previous.toggleClass("inactive",1>t),this.buttons.next.toggleClass("inactive",t>=n-1)},t}(),e.namespace("player.component").Block=function(){function t(e){t.parent.call(this,e)}return e.player.Component.extend(t),t.defaults={container:null,properties:{name:{type:"Text",configs:{label:e.Locale.t("player.component.Block.name","Name")},getter:function(){return this.data("name")},setter:function(t){this.data("name",t)}},locked:{type:"Boolean",configs:{label:e.Locale.t("player.component.Block.locked","Locked ?")},getter:function(){return"true"===this.data("locked")},setter:function(t){this.data("locked",t?"true":null)}},x:{type:"Number",configs:{label:e.Locale.t("player.component.Block.x","X")},getter:function(){return parseInt(this.css("left"),10)},setter:function(t){this.css("left",t+"px")}},y:{type:"Number",configs:{label:e.Locale.t("player.component.Block.y","Y")},getter:function(){return parseInt(this.css("top"),10)},setter:function(t){this.css("top",t+"px")}},width:{type:"Number",configs:{label:e.Locale.t("player.component.Block.width","Width")},getter:function(){return parseInt(this.css("width"),10)},setter:function(t){this.css("width",t+"px")}},height:{type:"Number",configs:{label:e.Locale.t("player.component.Block.height","Height")},getter:function(){return parseInt(this.css("height"),10)},setter:function(t){this.css("height",t+"px")}},"background-color":{type:"Color",configs:{label:e.Locale.t("player.component.Block.background-color","Background color")},getter:function(t){return this.css("background-color",void 0,t)},setter:function(t){var n=e.Color.parse(t);this.css("background-color","rgba("+n.r+","+n.g+","+n.b+","+n.a+")")}},"background-image":{type:"Image",configs:{label:e.Locale.t("player.component.Block.background-image","Background image")},getter:function(t){var n=this.css("background-image",void 0,t);return"none"!==n&&e.Var.is(n,"string")?n.replace(/^url\(["']?/,"").replace(/["']?\)$/,""):null},setter:function(t){t="none"!==t&&e.Var.is(t,"string")&&t.length>0?"url("+t+")":null,this.css("background-image",t)}},"border-width":{type:"Number",configs:{label:e.Locale.t("player.component.Block.border-width","Border width")},getter:function(t){var e=this.css("border-width",void 0,t);return null!==e?parseInt(e,10):null},setter:function(t){this.css("border-width",t+"px")}},"border-color":{type:"Color",configs:{label:e.Locale.t("player.component.Block.border-color","Border color")},getter:function(t){return this.css("border-color",void 0,t)},setter:function(t){var n=e.Color.parse(t);this.css("border-color","rgba("+n.r+","+n.g+","+n.b+","+n.a+")")}},"border-radius":{type:"BorderRadius",configs:{label:e.Locale.t("player.component.Block.border-radius","Border radius")},getter:function(t){return this.css("border-radius",void 0,t)},setter:function(t){this.css("border-radius",t)}},synched:{type:"Boolean",configs:{label:e.Locale.t("player.component.Block.synched","Synchronized pages ?"),readonly:!0},getter:function(){return"true"===this.data("synched")},setter:function(t){this.data("synched",t)}},pages:{editable:!1,getter:function(t){var e=[];return this.getPages().each(function(n,i){e.push(i._metaScore.getProperties(t))},this),e},setter:function(t){this.getPages().remove(),e.Array.each(t,function(t,e){this.addPage(e)},this),this.setActivePage(0)}}}},t.prototype.setupDOM=function(){t.parent.prototype.setupDOM.call(this),this.addClass("block"),this.page_wrapper=new e.Dom("<div/>",{"class":"pages"}).addDelegate(".page","cuepointstart",e.Function.proxy(this.onPageCuePointStart,this)).addDelegate(".element","page",e.Function.proxy(this.onElementPage,this)).appendTo(this),this.pager=(new e.player.Pager).addDelegate(".button","click",e.Function.proxy(this.onPagerClick,this)).appendTo(this)},t.prototype.onPageCuePointStart=function(t){this.setActivePage(t.target._metaScore,"pagecuepoint")},t.prototype.onElementPage=function(t){this.setActivePage(t.detail.value)},t.prototype.onPagerClick=function(t){var n,i=!e.Dom.hasClass(t.target,"inactive");if(i)switch(n=e.Dom.data(t.target,"action")){case"first":this.setActivePage(0);break;case"previous":this.setActivePage(this.getActivePageIndex()-1);break;case"next":this.setActivePage(this.getActivePageIndex()+1)}t.stopPropagation()},t.prototype.getPages=function(){return this.page_wrapper.children(".page")},t.prototype.addPage=function(t,n,i){var o;return t instanceof e.player.component.Page?(o=t,e.Var.is(n,"number")?o.insertAt(this.page_wrapper,n):o.appendTo(this.page_wrapper)):o=new e.player.component.Page(e.Object.extend({},t,{container:this.page_wrapper,index:n})),this.setActivePage(o),i!==!0&&this.triggerEvent("pageadd",{block:this,page:o}),o},t.prototype.removePage=function(t,e){return t.remove(),e!==!0&&this.triggerEvent("pageremove",{block:this,page:t}),t},t.prototype.getPage=function(t){var e=this.getPages(),n=e.get(t);return n?n._metaScore:null},t.prototype.getActivePage=function(){return this.getPage(this.getActivePageIndex())},t.prototype.getActivePageIndex=function(){var t=this.getPages(),e=t.index(".active");return e},t.prototype.getPageCount=function(){return this.getPages().count()},t.prototype.setActivePage=function(t,n,i){var o=this.getPages();e.Var.is(t,"number")&&(t=o.get(parseInt(t,10)),t=t?t._metaScore:null),t instanceof e.player.component.Page&&(o.removeClass("active"),t.addClass("active"),this.updatePager(),i!==!0&&this.triggerEvent("pageactivate",{block:this,page:t,basis:n}))},t.prototype.updatePager=function(){var t=this.getActivePageIndex(),e=this.getPageCount();this.pager.updateCount(t,e),this.data("page-count",e)},t.prototype.setDraggable=function(t){return t=t!==!1,this.getProperty("locked")&&t?!1:(t&&!this._draggable?this._draggable=new e.Draggable({target:this,handle:this.child(".pager"),container:this.parents(),limits:{top:0,left:0}}):!t&&this._draggable&&(this._draggable.destroy(),delete this._draggable),this._draggable)},t.prototype.setResizable=function(t){return t=t!==!1,this.getProperty("locked")&&t?!1:(t&&!this._resizable?this._resizable=new e.Resizable({target:this,container:this.parents()}):!t&&this._resizable&&(this._resizable.destroy(),delete this._resizable),this._resizable)},t}(),e.namespace("player.component").Controller=function(){function t(e){t.parent.call(this,e)}return e.player.Component.extend(t),t.defaults={properties:{locked:{type:"Boolean",configs:{label:e.Locale.t("player.component.Controller.locked","Locked ?")},getter:function(){return"true"===this.data("locked")},setter:function(t){this.data("locked",t?"true":null)}},x:{type:"Number",configs:{label:e.Locale.t("player.component.Controller.x","X")},getter:function(){return parseInt(this.css("left"),10)},setter:function(t){this.css("left",t+"px")}},y:{type:"Number",configs:{label:e.Locale.t("player.component.Controller.y","Y")},getter:function(){return parseInt(this.css("top"),10)},setter:function(t){this.css("top",t+"px")}},"border-radius":{type:"BorderRadius",configs:{label:e.Locale.t("player.component.Controller.border-radius","Border radius")},getter:function(t){return this.css("border-radius",void 0,t)},setter:function(t){this.css("border-radius",t)}}}},t.prototype.setupDOM=function(){t.parent.prototype.setupDOM.call(this),this.addClass("controller"),this.timer=new e.Dom("<div/>",{"class":"timer",text:"00:00.00"}).appendTo(this),this.rewind_btn=new e.Dom("<button/>").data("action","rewind"),this.play_btn=new e.Dom("<button/>").data("action","play"),new e.Dom("<div/>",{"class":"buttons"}).append(this.rewind_btn).append(this.play_btn).appendTo(this)},t.prototype.getName=function(){return"[controller]"},t.prototype.updateTime=function(t){var n=e.String.pad(parseInt(t%100,10),2,"0","left"),i=e.String.pad(parseInt(t/100%60,10),2,"0","left"),o=e.String.pad(parseInt(t/6e3,10),2,"0","left");this.timer.text(o+":"+i+"."+n)},t.prototype.setDraggable=function(t){return t=t!==!1,this.getProperty("locked")&&t?!1:(t&&!this._draggable?this._draggable=new e.Draggable({target:this,handle:this.child(".timer"),container:this.parents(),limits:{top:0,left:0}}):!t&&this._draggable&&(this._draggable.destroy(),delete this._draggable),this._draggable)},t.prototype.setResizable=function(){return!1},t}(),e.namespace("player.component").Element=function(){function t(e){t.parent.call(this,e)}return e.player.Component.extend(t),t.defaults={properties:{name:{type:"Text",configs:{label:e.Locale.t("player.component.Element.name","Name")},getter:function(){return this.data("name")},setter:function(t){this.data("name",t)}},type:{editable:!1,getter:function(){return this.data("type")},setter:function(t){this.data("type",t)}},locked:{type:"Boolean",configs:{label:e.Locale.t("player.component.Element.locked","Locked ?")},getter:function(){return"true"===this.data("locked")},setter:function(t){this.data("locked",t?"true":null)}},x:{type:"Number",configs:{label:e.Locale.t("player.component.Element.x","X")},getter:function(){return parseInt(this.css("left"),10)},setter:function(t){this.css("left",t+"px")}},y:{type:"Number",configs:{label:e.Locale.t("player.component.Element.y","Y")},getter:function(){return parseInt(this.css("top"),10)},setter:function(t){this.css("top",t+"px")}},width:{type:"Number",configs:{label:e.Locale.t("player.component.Element.width","Width"),min:10},getter:function(){return parseInt(this.css("width"),10)},setter:function(t){this.css("width",t+"px")}},height:{type:"Number",configs:{label:e.Locale.t("player.component.Element.height","Height"),min:10},getter:function(){return parseInt(this.css("height"),10)},setter:function(t){this.css("height",t+"px")}},"r-index":{type:"Number",configs:{label:e.Locale.t("player.component.Element.r-index","Reading index"),min:0},getter:function(){var t=this.data("r-index");return null!==t?parseInt(t,10):null},setter:function(t){this.data("r-index",t)}},"z-index":{type:"Number",configs:{label:e.Locale.t("player.component.Element.z-index","Display index")},getter:function(t){var e=this.css("z-index",void 0,t);return null!==e?parseInt(e,10):null},setter:function(t){this.css("z-index",t)}},"background-color":{type:"Color",configs:{label:e.Locale.t("player.component.Element.background-color","Background color")},getter:function(t){return this.contents.css("background-color",void 0,t)},setter:function(t){var n=e.Color.parse(t);this.contents.css("background-color","rgba("+n.r+","+n.g+","+n.b+","+n.a+")")}},"background-image":{type:"Image",configs:{label:e.Locale.t("player.component.Element.background-image","Background image")},getter:function(t){var n=this.contents.css("background-image",void 0,t);return"none"!==n&&e.Var.is(n,"string")?n.replace(/^url\(["']?/,"").replace(/["']?\)$/,""):null},setter:function(t){t="none"!==t&&e.Var.is(t,"string")&&t.length>0?"url("+t+")":null,this.contents.css("background-image",t)}},"border-width":{type:"Number",configs:{label:e.Locale.t("player.component.Element.border-width","Border width")},getter:function(t){var e=this.contents.css("border-width",void 0,t);return null!==e?parseInt(e,10):null},setter:function(t){this.contents.css("border-width",t+"px")}},"border-color":{type:"Color",configs:{label:e.Locale.t("player.component.Element.border-color","Border color")},getter:function(t){return this.contents.css("border-color",void 0,t)},setter:function(t){var n=e.Color.parse(t);this.contents.css("border-color","rgba("+n.r+","+n.g+","+n.b+","+n.a+")")}},"border-radius":{type:"BorderRadius",configs:{label:e.Locale.t("player.component.Element.border-radius","Border radius")},getter:function(t){return this.contents.css("border-radius",void 0,t)},setter:function(t){this.contents.css("border-radius",t)}},opacity:{type:"Number",configs:{label:e.Locale.t("player.component.Element.opacity","Opacity"),min:0,max:1,step:.1},getter:function(t){return this.contents.css("opacity",void 0,t)},setter:function(t){this.contents.css("opacity",t)}},"start-time":{type:"Time",configs:{label:e.Locale.t("player.component.Element.start-time","Start time"),checkbox:!0,inButton:!0,outButton:!0},getter:function(){var t=parseFloat(this.data("start-time"));return isNaN(t)?null:t},setter:function(t){this.data("start-time",isNaN(t)?null:t)}},"end-time":{type:"Time",configs:{label:e.Locale.t("player.component.Element.end-time","End time"),checkbox:!0,inButton:!0,outButton:!0},getter:function(){var t=parseFloat(this.data("end-time"));return isNaN(t)?null:t},setter:function(t){this.data("end-time",isNaN(t)?null:t)}}}},t.prototype.setupDOM=function(){t.parent.prototype.setupDOM.call(this),this.addClass("element"),this.contents=new e.Dom("<div/>",{"class":"contents"}).appendTo(this)},t.prototype.getPage=function(){var t,e=this.parents().get(0);return e&&(t=e._metaScore),t},t.prototype.onCuePointStart=function(){this.addClass("active")},t.prototype.onCuePointEnd=function(){this.removeClass("active")},t.prototype.setDraggable=function(t){return t=t!==!1,this.getProperty("locked")&&t?!1:(t&&!this._draggable?this._draggable=new e.Draggable({target:this,handle:this,container:this.parents()}):!t&&this._draggable&&(this._draggable.destroy(),delete this._draggable),this._draggable)},t.prototype.setResizable=function(t){return t=t!==!1,this.getProperty("locked")&&t?!1:(t&&!this._resizable?this._resizable=new e.Resizable({target:this,container:this.parents()}):!t&&this._resizable&&(this._resizable.destroy(),delete this._resizable),this._resizable)},t}(),e.namespace("player.component").Media=function(){function t(e){t.parent.call(this,e),this.addClass("media").addClass(this.configs.type),this.playing=!1}return e.player.Component.extend(t),t.defaults={type:"audio",useFrameAnimation:!0,properties:{locked:{type:"Boolean",configs:{label:e.Locale.t("player.component.Media.locked","Locked ?")},getter:function(){return"true"===this.data("locked")},setter:function(t){this.data("locked",t?"true":null)}},x:{type:"Number",configs:{label:e.Locale.t("player.component.Media.x","X")},getter:function(){return parseInt(this.css("left"),10)},setter:function(t){this.css("left",t+"px")}},y:{type:"Number",configs:{label:e.Locale.t("player.component.Media.y","Y")},getter:function(){return parseInt(this.css("top"),10)},setter:function(t){this.css("top",t+"px")}},width:{type:"Number",configs:{label:e.Locale.t("player.component.Media.width","Width")},getter:function(){return parseInt(this.css("width"),10)},setter:function(t){this.css("width",t+"px")}},height:{type:"Number",configs:{label:e.Locale.t("player.component.Media.height","Height")},getter:function(){return parseInt(this.css("height"),10)},setter:function(t){this.css("height",t+"px")}},"border-radius":{type:"BorderRadius",configs:{label:e.Locale.t("player.component.Media.border-radius","Border radius")},getter:function(t){return this.css("border-radius",void 0,t)},setter:function(t){this.css("border-radius",t)}}}},t.prototype.setSources=function(t,n){var i="";return this.el&&this.el.remove(),e.Array.each(t,function(t,e){i+='<source src="'+e.url+'" type="'+e.mime+'"></source>'},this),this.el=new e.Dom("<"+this.configs.type+">"+i+"</"+this.configs.type+">",{preload:"auto"}).appendTo(this),this.dom=this.el.get(0),this.addMediaListener("play",e.Function.proxy(this.onPlay,this)).addMediaListener("pause",e.Function.proxy(this.onPause,this)).addMediaListener("timeupdate",e.Function.proxy(this.onTimeUpdate,this)),n!==!0&&this.triggerEvent("sourcesset",{media:this}),this},t.prototype.getName=function(){return"[media]"},t.prototype.onPlay=function(){this.playing=!0,this.configs.useFrameAnimation&&this.triggerTimeUpdate()},t.prototype.onPause=function(){this.playing=!1},t.prototype.onTimeUpdate=function(t){t instanceof CustomEvent||t.stopImmediatePropagation(),this.configs.useFrameAnimation||this.triggerTimeUpdate(!1)},t.prototype.isPlaying=function(){return this.playing},t.prototype.reset=function(){return this.setTime(0),this},t.prototype.play=function(){return this.dom.play(),this},t.prototype.pause=function(){return this.dom.pause(),this},t.prototype.triggerTimeUpdate=function(t){t!==!1&&this.isPlaying()&&window.requestAnimationFrame(e.Function.proxy(this.triggerTimeUpdate,this)),this.el.triggerEvent("timeupdate",{media:this})},t.prototype.setTime=function(t){return this.dom.currentTime=parseFloat(t)/100,this.triggerTimeUpdate(!1),this},t.prototype.getTime=function(){return 100*parseFloat(this.dom.currentTime)},t.prototype.getDuration=function(){return 100*parseFloat(this.dom.duration)},t.prototype.addMediaListener=function(t,e,n){return this.el.addListener(t,e,n),this},t.prototype.removeMediaListener=function(t,e,n){return this.el.removeListener(t,e,n),this},t.prototype.setDraggable=function(t){return t=t!==!1,this.getProperty("locked")&&t?!1:(t&&!this._draggable?this._draggable=new e.Draggable({target:this,handle:this.child("video"),container:this.parents(),limits:{top:0,left:0}}):!t&&this._draggable&&(this._draggable.destroy(),delete this._draggable),this._draggable)},t}(),e.namespace("player.component").Page=function(){function t(e){t.parent.call(this,e)}return e.player.Component.extend(t),t.defaults={properties:{"background-color":{type:"Color",configs:{label:e.Locale.t("player.component.Page.background-color","Background color")},getter:function(t){return this.css("background-color",void 0,t)},setter:function(t){var n=e.Color.parse(t);this.css("background-color","rgba("+n.r+","+n.g+","+n.b+","+n.a+")")}},"background-image":{type:"Image",configs:{label:e.Locale.t("player.component.Page.background-image","Background image")},getter:function(t){var n=this.css("background-image",void 0,t);return"none"!==n&&e.Var.is(n,"string")?n.replace(/^url\(["']?/,"").replace(/["']?\)$/,""):null},setter:function(t){t="none"!==t&&e.Var.is(t,"string")&&t.length>0?"url("+t+")":null,this.css("background-image",t)}},"start-time":{type:"Time",configs:{label:e.Locale.t("player.component.Page.start-time","Start time"),checkbox:!1,inButton:!0,outButton:!0},getter:function(){var t=parseFloat(this.data("start-time"));return isNaN(t)?null:t},setter:function(t){this.data("start-time",isNaN(t)?null:t)}},"end-time":{type:"Time",configs:{label:e.Locale.t("player.component.Page.end-time","End time"),checkbox:!1,inButton:!0,outButton:!0},getter:function(){var t=parseFloat(this.data("end-time"));return isNaN(t)?null:t},setter:function(t){this.data("end-time",isNaN(t)?null:t)}},elements:{editable:!1,getter:function(t){var e=[];return this.getElements().each(function(n,i){e.push(i._metaScore.getProperties(t))},this),e},setter:function(t){e.Array.each(t,function(t,e){this.addElement(e)},this)}}}},t.prototype.setupDOM=function(){t.parent.prototype.setupDOM.call(this),this.addClass("page")},t.prototype.addElement=function(t,n){var i;return t instanceof e.player.component.Element?(i=t,i.appendTo(this)):i=new e.player.component.element[t.type](e.Object.extend({},t,{container:this})),n!==!0&&this.triggerEvent("elementadd",{page:this,element:i}),i},t.prototype.getBlock=function(){var t,e=this.parents().parents().get(0);return e&&(t=e._metaScore),t},t.prototype.getElements=function(){return this.children(".element")},t.prototype.onCuePointStart=function(){this.triggerEvent("cuepointstart")},t.prototype.onCuePointEnd=function(){this.triggerEvent("cuepointend")},t}(),e.namespace("player.component.element").Cursor=function(){function t(e){t.parent.call(this,e)}return e.player.component.Element.extend(t),t.defaults={properties:e.Object.extend({},e.player.component.Element.defaults.properties,{direction:{type:"Select",configs:{label:e.Locale.t("player.component.element.Cursor.direction","Direction"),options:{right:e.Locale.t("player.component.element.Cursor.direction.right","Left > Right"),left:e.Locale.t("player.component.element.Cursor.direction.left","Right > Left"),bottom:e.Locale.t("player.component.element.Cursor.direction.bottom","Top > Bottom"),top:e.Locale.t("player.component.element.Cursor.direction.top","Bottom > Top")}},getter:function(){return this.data("direction")},setter:function(t){this.data("direction",t)}},acceleration:{type:"Number",configs:{label:e.Locale.t("player.component.element.Cursor.acceleration","Acceleration")},getter:function(){return this.data("accel")},setter:function(t){this.data("accel",t)}},"cursor-width":{type:"Number",configs:{label:e.Locale.t("player.component.element.Cursor.cursor-width","Cursor width")},getter:function(t){var e=this.cursor.css("width",void 0,t);return null!==e?parseInt(e,10):null},setter:function(t){this.cursor.css("width",t+"px")}},"cursor-color":{type:"Color",configs:{label:e.Locale.t("player.component.element.Cursor.cursor-color","Cursor color")},getter:function(t){return this.cursor.css("background-color",void 0,t)},setter:function(t){var n=e.Color.parse(t);this.cursor.css("background-color","rgba("+n.r+","+n.g+","+n.b+","+n.a+")")}}})},t.prototype.setupDOM=function(){t.parent.prototype.setupDOM.call(this),this.data("type","cursor"),this.cursor=new e.Dom("<div/>",{"class":"cursor"}).appendTo(this.contents),this.addListener("click",e.Function.proxy(this.onClick,this)).addListener("dblclick",e.Function.proxy(this.onClick,this))},t.prototype.onClick=function(t){var n,i,o,r,s,a,c;if(!e.editing||"dblclick"===t.type){switch(o=this.getProperty("start-time"),r=this.getProperty("end-time"),s=this.getProperty("direction"),a=this.getProperty("acceleration"),c=t.target.getBoundingClientRect(),s){case"left":n=(c.right-t.clientX)/this.getProperty("width");break;case"bottom":n=(t.clientY-c.top)/this.getProperty("height");break;case"top":n=(c.bottom-t.clientY)/this.getProperty("height");break;default:n=(t.clientX-c.left)/this.getProperty("width")}i=a&&1!==a?o+(r-o)*Math.pow(n,1/a):o+(r-o)*n,this.triggerEvent("time",{element:this,value:i})}},t.prototype.onCuePointUpdate=function(t,e){var n,i,o,r,s,a=this.getProperty("direction"),c=this.getProperty("acceleration");switch(o=this.getProperty("start-time"),r=this.getProperty("end-time"),s=c&&1!==c?Math.pow((e-o)/(r-o),c):(e-o)/(r-o),a){case"left":n=this.getProperty("width"),s=Math.min(n*s,n),this.cursor.css("right",s+"px");break;case"bottom":i=this.getProperty("height"),s=Math.min(i*s,i),this.cursor.css("top",s+"px");break;case"top":i=this.getProperty("height"),s=Math.min(i*s,i),this.cursor.css("bottom",s+"px");break;default:n=this.getProperty("width"),s=Math.min(n*s,n),this.cursor.css("left",s+"px")}},t}(),e.namespace("player.component.element").Image=function(){function t(e){t.parent.call(this,e)}return e.player.component.Element.extend(t),t.prototype.setupDOM=function(){t.parent.prototype.setupDOM.call(this),this.data("type","image")},t}(),e.namespace("player.component.element").Text=function(){function t(n){t.parent.call(this,n),this.addDelegate("a","click",e.Function.proxy(this.onLinkClick,this))}return e.player.component.Element.extend(t),t.defaults={properties:e.Object.extend({},e.player.component.Element.defaults.properties,{text:{editable:!1,getter:function(){return this.contents.text()},setter:function(t){this.contents.text(t)}}})},t.prototype.setupDOM=function(){t.parent.prototype.setupDOM.call(this),this.data("type","text")},t.prototype.onLinkClick=function(t){var n,i=t.target;e.Dom.is(i,"a")||(i=e.Dom.closest(i,"a")),i&&((n=i.hash.match(/^#p=(\d+)/))?(this.triggerEvent("page",{element:this,value:parseInt(n[1])-1}),t.preventDefault()):(n=i.hash.match(/^#t=(\d*\.?\d+),(\d*\.?\d+)&r=(\d+)/))?this.triggerEvent("time",{element:this,inTime:parseFloat(n[1]),outTime:parseFloat(n[2])-1,rIndex:parseInt(n[3])}):window.open(i.href,"_blank"),t.preventDefault())},t}()})(this);