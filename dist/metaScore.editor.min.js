/*! metaScore - v0.0.1 - 2015-01-13 - Oussama Mubarak */
(function(t){"use strict";Element&&function(t){t.matches=t.matchesSelector=t.matchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector||function(t){for(var e=(this.parentNode||this.document).querySelectorAll(t),n=-1;e[++n]&&e[n]!==this;);return!!e[n]}}(Element.prototype),function(){for(var t=0,e=["ms","moz","webkit","o"],n=0;e.length>n&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[e[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[n]+"CancelAnimationFrame"]||window[e[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var n=(new Date).getTime(),i=Math.max(0,16-(n-t)),o=window.setTimeout(function(){e(n+i)},i);return t=n+i,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var e={version:"0.0.1",revision:"831c97",getVersion:function(){return this.version},getRevision:function(){return this.revision},namespace:function(t){for(var e,n=this,i=t.split("."),o=0,s=i.length;s>o;o++)e=i[o],n[e]=n[e]||{},n=n[e];return n}};e.Class=function(){function t(){}return t.defaults={},t.extend=function(t){t.prototype=Object.create(this.prototype,{constructor:{value:t}}),t.parent=this,t.extend=this.extend,"defaults"in t||(t.defaults={});for(var e in this.defaults)e in t.defaults||(t.defaults[e]=this.defaults[e])},t.prototype.getConfigs=function(t){t=t||{};for(var e in this.constructor.defaults)e in t||(t[e]=this.constructor.defaults[e]);return t},t}(),e.Evented=function(){function t(){t.parent.call(this),this.listeners={}}return e.Class.extend(t),t.prototype.addListener=function(t,e){return this.listeners[t]===void 0&&(this.listeners[t]=[]),this.listeners[t].push(e),this},t.prototype.removeListener=function(t,e){if(this.listeners[t]instanceof Array)for(var n=this.listeners[t],i=0,o=n.length;o>i;i++)if(n[i]===e){n.splice(i,1);break}return this},t.prototype.triggerEvent=function(t,n,i,o){var s,a;return this.listeners[t]instanceof Array&&(s=this.listeners[t],a={target:this,type:t,detail:n,bubbles:i!==!1,cancelable:o!==!1},e.Object.each(s,function(t,e){e.call(this,a)},this)),this},t}(),e.Ajax=function(){function t(){}return e.Class.extend(t),t.createXHR=function(){var t,e,n,i=["MSXML2.XMLHttp.5.0","MSXML2.XMLHttp.4.0","MSXML2.XMLHttp.3.0","MSXML2.XMLHttp","Microsoft.XMLHttp"];if("undefined"!=typeof XMLHttpRequest)return t=new XMLHttpRequest;if(window.ActiveXObject)for(e=0,n=i.length;n>e;e++)try{return t=new ActiveXObject(i[e])}catch(o){}throw Error("XMLHttp object could be created.")},t.send=function(n,i){var o=t.createXHR(),s={method:"GET",headers:{},async:!0,data:{},dataType:"json",complete:null,success:null,error:null,scope:this};if(i=e.Object.extend({},s,i),!("POST"!==i.method&&"PUT"!==i.method||"Content-type"in i.headers))switch(i.dataType){case"json":i.headers["Content-type"]="application/json;charset=UTF-8";break;default:i.headers["Content-type"]="application/x-www-form-urlencoded"}return o.open(i.method,n,i.async),e.Object.each(i.headers,function(t,e){o.setRequestHeader(t,e)}),o.onreadystatechange=function(){4===o.readyState&&(e.Var.is(i.complete,"function")&&i.complete.call(i.scope,o),o.status>=200&&300>o.status||304===o.status?e.Var.is(i.success,"function")&&i.success.call(i.scope,o):e.Var.is(i.error,"function")&&i.error.call(i.scope,o))},o.send(i.data),o},t.get=function(n,i){return e.Object.extend(i,{method:"GET"}),t.send(n,i)},t.post=function(n,i){return e.Object.extend(i,{method:"POST"}),t.send(n,i)},t.put=function(n,i){return e.Object.extend(i,{method:"PUT"}),t.send(n,i)},t}(),e.Array=function(){function t(){}return e.Class.extend(t),t.inArray=function(t,e){var n,i=0;if(e){if(e.indexOf)return e.indexOf(t);for(n=e.length;n>i;i++)if(i in e&&e[i]===t)return i}return-1},t.copy=function(t){return[].concat(t)},t.shuffle=function(e){var n=t.copy(e);return n.sort(function(){return(0|3*Math.random())-1}),n},t.unique=function(t){for(var e=[],n=t.length,i=0;n>i;i++){for(var o=i+1;n>o;o++)t[i]===t[o]&&(o=++i);e.push(t[i])}return e},t.each=function(t,e,n){for(var i,o=0,s=t.length,a=void 0!==n;s>o&&(i=e.call(a?n:t[o],o,t[o]),i!==!1);o++);return t},t.remove=function(e,n){for(var i=t.inArray(n,e);i>-1;)e.splice(i,1),i=t.inArray(n,e);return e},t}(),e.Color=function(){function t(){}return e.Class.extend(t),t.rgb2hsv=function(t){var e,n,i,o=t.r,s=t.g,a=t.b,r=Math.max(o,s,a),l=Math.min(o,s,a),c=r-l;if(n=0===r?0:c/r,i=r,r===l)e=0;else{switch(r){case o:e=(s-a)/c+(a>s?6:0);break;case s:e=(a-o)/c+2;break;case a:e=(o-s)/c+4}e/=6}return{h:e,s:n,v:i}},t.parse=function(t){var n,i={};return e.Var.is(t,"object")?(i.r="r"in t?t.r:0,i.g="g"in t?t.g:0,i.b="b"in t?t.b:0,i.a="a"in t?t.a:1):e.Var.is(t,"string")&&(t=t.replace(/\s\s*/g,""),(n=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})/.exec(t))?(i.r=parseInt(n[1],16),i.g=parseInt(n[2],16),i.b=parseInt(n[3],16),i.a=1):(n=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])/.exec(t))?(i.r=17*parseInt(n[1],16),i.g=17*parseInt(n[2],16),i.b=17*parseInt(n[3],16),i.a=1):(n=/^rgba\(([\d]+),([\d]+),([\d]+),([\d]+|[\d]*.[\d]+)\)/.exec(t))?(i.r=+n[1],i.g=+n[2],i.b=+n[3],i.a=+n[4]):(n=/^rgb\(([\d]+),([\d]+),([\d]+)\)/.exec(t))&&(i.r=+n[1],i.g=+n[2],i.b=+n[3],i.a=1)),i},t}(),e.Dom=function(){function t(){var t;this.elements=[],arguments.length>0&&((t=e.Dom.elementsFromString.apply(this,arguments))?(this.add(t),arguments.length>1&&this.attr(arguments[1])):(t=e.Dom.selectElements.apply(this,arguments))&&(this.add(t),arguments.length>2&&this.attr(arguments[2])))}return e.Class.extend(t),t.stringRe=/^<(.)+>$/,t.camelRe=/-([\da-z])/gi,t.camelReplaceFn=function(t,e){return e.toUpperCase()},t.camel=function(e){return e.replace(t.camelRe,t.camelReplaceFn)},t.bubbleEvents={click:!0,submit:!0,mousedown:!0,mousemove:!0,mouseup:!0,mouseover:!0,mouseout:!0,transitionend:!0},t.selectElement=function(t,n){var i;return n||(n=document),i=e.Var.is(t,"string")?n.querySelector(t):t.length?t[0]:t},t.selectElements=function(n,i){var o;return i?i instanceof t&&(i=i.get(0)):i=document,o=e.Var.is(n,"string")?i.querySelectorAll(n):n.length?n:[n]},t.elementsFromString=function(t){var e,n,i,o={option:[1,"<select multiple='multiple'>","</select>"],optgroup:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tbody:[1,"<table>","</table>"],tfoot:[1,"<table>","</table>"],colgroup:[1,"<table>","</table>"],caption:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],th:[3,"<table><tbody><tr>","</tr></tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[1,"<div>","</div>"]},s=document.createElement("div"),a=/<\s*\w.*?>/g.exec(t);if(null!=a){for(e=a[0].replace(/</g,"").replace(/\/?>/g,""),n=o[e]||o._default,t=n[1]+t+n[2],s.innerHTML=t,i=n[0];i--;)s=s.lastChild;return s.childNodes}return null},t.hasClass=function(t,e){return t.classList.contains(e)},t.addClass=function(t,e){for(var n=e.split(" "),i=0,o=n.length;o>i;i++)t.classList.add(n[i])},t.removeClass=function(t,e){for(var n=e.split(" "),i=0,o=n.length;o>i;i++)t.classList.remove(n[i])},t.toggleClass=function(t,e,n){var i=e.split(" "),o=0,s=i.length;if(void 0===n)for(;s>o;o++)t.classList.toggle(i[o]);else for(;s>o;o++)t.classList.toggle(i[o],n)},t.addListener=function(e,n,i,o){return void 0===o&&(o="type"in t.bubbleEvents?t.bubbleEvents[n]:!1),e.addEventListener(n,i,o)},t.removeListener=function(e,n,i,o){return void 0===o&&(o="type"in t.bubbleEvents?t.bubbleEvents[n]:!1),e.removeEventListener(n,i,o)},t.triggerEvent=function(t,e,n,i,o){var s=new CustomEvent(e,{detail:n,bubbles:i!==!1,cancelable:o!==!1});return t.dispatchEvent(s)},t.text=function(t,e){return void 0!==e&&(t.innerHTML=e),t.innerHTML},t.val=function(t,e){return void 0!==e&&(t.value=e),t.value},t.attr=function(n,i,o){if(e.Var.is(i,"object"))e.Object.each(i,function(e,i){t.attr(n,e,i)},this);else switch(i){case"class":this.addClass(n,o);break;case"text":this.text(n,o);break;default:if(null!==o)return void 0!==o&&n.setAttribute(i,o),n.getAttribute(i);n.removeAttribute(i)}},t.css=function(t,e,n,i){var o,s;return o=this.camel(e),void 0!==n&&(t.style[o]=n),s=i===!0?t.style:window.getComputedStyle(t),s.getPropertyValue(e)},t.data=function(t,e,n){return e=this.camel(e),null===n?delete t.dataset[e]:void 0!==n&&(t.dataset[e]=n),t.dataset[e]},t.append=function(t,n){e.Var.is(n,"array")||(n=[n]),e.Array.each(n,function(e,n){t.appendChild(n)},this)},t.empty=function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},t.remove=function(t){t.parentElement&&t.parentElement.removeChild(t)},t.is=function(t,e){return t.matches&&t.matches(e)},t.prototype.add=function(t){if("length"in t)for(var e=0;t.length>e;e++)this.elements.push(t[e]);else this.elements.push(t)},t.prototype.count=function(){return this.elements.length},t.prototype.get=function(t){return this.elements[t]},t.prototype.filter=function(e){var n=[];return this.each(function(i,o){t.is(o,e)&&n.push(o)},this),this.elements=n,this},t.prototype.index=function(e){var n=-1;return this.each(function(i,o){return t.is(o,e)?(n=i,!1):void 0},this),n},t.prototype.child=function(e){var n,i=new t;return this.each(function(o,s){return(n=t.selectElement.call(this,e,s))?(i.add(n),!1):void 0},this),i},t.prototype.children=function(e){var n=new t;return this.each(function(i,o){n.add(t.selectElements.call(this,e,o))},this),n},t.prototype.parents=function(e){var n=new t;return this.each(function(t,e){n.add(e.parentElement)},this),e&&n.filter(e),n},t.prototype.each=function(t,n){n=n||this,e.Array.each(this.elements,t,n)},t.prototype.hasClass=function(e){var n;return this.each(function(i,o){return n=t.hasClass(o,e),!n},this),n},t.prototype.addClass=function(e){return this.each(function(n,i){t.addClass(i,e)},this),this},t.prototype.removeClass=function(e){return this.each(function(n,i){t.removeClass(i,e)},this),this},t.prototype.toggleClass=function(e,n){return this.each(function(i,o){t.toggleClass(o,e,n)},this),this},t.prototype.addListener=function(e,n,i){return this.each(function(o,s){t.addListener(s,e,n,i)},this),this},t.prototype.addDelegate=function(e,n,i,o,s){return o=o||this,this.addListener(n,function(n){for(var s,a=n.target;a;){if(t.is(a,e)){s=a;break}a=a.parentNode}s&&i.call(o,n,s)},s)},t.prototype.removeListener=function(e,n,i){return this.each(function(o,s){t.removeListener(s,e,n,i)},this),this},t.prototype.triggerEvent=function(e,n,i,o){var s=!0;return this.each(function(a,r){s=t.triggerEvent(r,e,n,i,o)&&s},this),s},t.prototype.text=function(e){return void 0===e?t.text(this.get(0)):(this.each(function(n,i){t.text(i,e)},this),void 0)},t.prototype.val=function(e){return void 0!==e?(this.each(function(n,i){t.val(i,e)},this),this):t.val(this.get(0))},t.prototype.attr=function(n,i){return void 0!==i||e.Var.is(n,"object")?(this.each(function(e,o){t.attr(o,n,i)},this),this):t.attr(this.get(0),n)},t.prototype.css=function(e,n,i){return void 0!==n?(this.each(function(o,s){t.css(s,e,n,i)},this),this):t.css(this.get(0),e,n,i)},t.prototype.data=function(e,n){return void 0!==n?(this.each(function(i,o){t.data(o,e,n)},this),this):t.data(this.get(0),e)},t.prototype.append=function(e){return e instanceof t&&(e=e.elements),t.append(this.get(0),e),this},t.prototype.appendTo=function(e){return e instanceof t||(e=new t(e)),e=e.get(0),this.each(function(n,i){t.append(e,i)},this),this},t.prototype.empty=function(){return this.each(function(e,n){t.empty(n)},this),this},t.prototype.show=function(){return this.each(function(){this.css("display","")},this),this},t.prototype.hide=function(){return this.each(function(){this.css("display","none")},this),this},t.prototype.remove=function(){return this.triggerEvent("beforeremove")!==!1&&this.each(function(e,n){var i=n.parentElement;t.remove(n),t.triggerEvent(i,"childremoved",{child:n})},this),this},t.prototype.is=function(e){var n;return this.each(function(i,o){return n=t.is(o,e)},this),n},t}(),e.Draggable=function(){function t(t){this.configs=this.getConfigs(t),this.configs.container=this.configs.container||new e.Dom("body"),this.onMouseDown=e.Function.proxy(this.onMouseDown,this),this.onMouseMove=e.Function.proxy(this.onMouseMove,this),this.onMouseUp=e.Function.proxy(this.onMouseUp,this),this.configs.handle.addListener("mousedown",this.onMouseDown),this.enable()}return t.defaults={limits:{top:null,left:null}},e.Class.extend(t),t.prototype.onMouseDown=function(t){this.enabled&&(this.start_state={left:parseInt(this.configs.target.css("left"),10)-t.clientX,top:parseInt(this.configs.target.css("top"),10)-t.clientY},this.configs.container.addListener("mouseup",this.onMouseUp).addListener("mousemove",this.onMouseMove),this.configs.target.addClass("dragging").triggerEvent("dragstart",null,!1,!0),t.stopPropagation())},t.prototype.onMouseMove=function(t){var e=t.clientX+this.start_state.left,n=t.clientY+this.start_state.top;isNaN(this.configs.limits.top)||(n=Math.max(n,this.configs.limits.top)),isNaN(this.configs.limits.left)||(e=Math.max(e,this.configs.limits.left)),this.configs.target.css("left",e+"px").css("top",n+"px").triggerEvent("drag",null,!1,!0),t.stopPropagation()},t.prototype.onMouseUp=function(t){this.configs.container.removeListener("mousemove",this.onMouseMove).removeListener("mouseup",this.onMouseUp),this.configs.target.removeClass("dragging").triggerEvent("dragend",null,!1,!0),t.stopPropagation()},t.prototype.enable=function(){return this.configs.target.addClass("draggable"),this.configs.handle.addClass("drag-handle"),this.enabled=!0,this},t.prototype.disable=function(){return this.configs.target.removeClass("draggable"),this.configs.handle.removeClass("drag-handle"),this.enabled=!1,this},t.prototype.destroy=function(){return this.disable(),this.configs.handle.removeListener("mousedown",this.onMouseDown),this},t}(),e.Function=function(){function t(){}return e.Class.extend(t),t.proxy=function(t,n,i){return e.Var.type(t,"function")?function(){return t.apply(n||this,i||arguments)}:void 0},t.emptyFn=function(){},t}(),e.Object=function(){function t(){}return e.Class.extend(t),t.extend=function(){for(var t,e,n,i,o=arguments[0]||{},s=1,a=arguments.length;a>s;s++)if(null!=(t=arguments[s]))for(e in t)n=o[e],i=t[e],n!==i&&void 0!==i&&(o[e]=i);return o},t.copy=function(e){return t.extend({},e)},t.each=function(t,e,n){var i,o,s=void 0!==n;for(i in t)if(o=e.call(s?n:t[i],i,t[i]),o===!1)break;return t},t}(),e.Resizable=function(){function t(t){this.configs=this.getConfigs(t),this.configs.container=this.configs.container||new e.Dom("body"),this.handles={},this.onMouseDown=e.Function.proxy(this.onMouseDown,this),this.onMouseMove=e.Function.proxy(this.onMouseMove,this),this.onMouseUp=e.Function.proxy(this.onMouseUp,this),e.Array.each(this.configs.directions,function(t,n){this.handles[n]=new e.Dom("<div/>",{"class":"resize-handle"}).data("direction",n).addListener("mousedown",this.onMouseDown).appendTo(this.configs.target)},this),this.enable()}return t.defaults={directions:["top","right","bottom","left","top-left","top-right","bottom-left","bottom-right"]},e.Class.extend(t),t.prototype.onMouseDown=function(t){this.enabled&&(this.start_state={handle:t.target,x:t.clientX,y:t.clientY,left:parseInt(this.configs.target.css("left"),10),top:parseInt(this.configs.target.css("top"),10),w:parseInt(this.configs.target.css("width"),10),h:parseInt(this.configs.target.css("height"),10)},this.configs.container.addListener("mousemove",this.onMouseMove,this).addListener("mouseup",this.onMouseUp,this),this.configs.target.addClass("resizing").triggerEvent("resizestart",null,!1,!0),t.stopPropagation())},t.prototype.onMouseMove=function(t){var n,i,o,s,a=new e.Dom(this.start_state.handle);switch(a.data("direction")){case"top":i=this.start_state.h-t.clientY+this.start_state.y,o=this.start_state.top+t.clientY-this.start_state.y;break;case"right":n=this.start_state.w+t.clientX-this.start_state.x;break;case"bottom":i=this.start_state.h+t.clientY-this.start_state.y;break;case"left":n=this.start_state.w-t.clientX+this.start_state.x,s=this.start_state.left+t.clientX-this.start_state.x;break;case"top-left":n=this.start_state.w-t.clientX+this.start_state.x,i=this.start_state.h-t.clientY+this.start_state.y,o=this.start_state.top+t.clientY-this.start_state.y,s=this.start_state.left+t.clientX-this.start_state.x;break;case"top-right":n=this.start_state.w+t.clientX-this.start_state.x,i=this.start_state.h-t.clientY+this.start_state.y,o=this.start_state.top+t.clientY-this.start_state.y;break;case"bottom-left":n=this.start_state.w-t.clientX+this.start_state.x,i=this.start_state.h+t.clientY-this.start_state.y,s=this.start_state.left+t.clientX-this.start_state.x;break;case"bottom-right":n=this.start_state.w+t.clientX-this.start_state.x,i=this.start_state.h+t.clientY-this.start_state.y}void 0!==o&&this.configs.target.css("top",o+"px"),void 0!==s&&this.configs.target.css("left",s+"px"),this.configs.target.css("width",n+"px").css("height",i+"px").triggerEvent("resize",null,!1,!0),t.stopPropagation()},t.prototype.onMouseUp=function(t){this.configs.container.removeListener("mousemove",this.onMouseMove,this).removeListener("mouseup",this.onMouseUp,this),this.configs.target.removeClass("resizing").triggerEvent("resizeend",null,!1,!0),t.stopPropagation()},t.prototype.enable=function(){return this.configs.target.addClass("resizable"),this.enabled=!0,this},t.prototype.disable=function(){return this.configs.target.removeClass("resizable"),this.enabled=!1,this},t.prototype.destroy=function(){return this.disable(),e.Object.each(this.handles,function(t,e){e.remove()},this),this},t}(),e.String=function(){function t(){}return e.Class.extend(t),t.capitalize=function(t){return t.replace(/(?:^|\s)\S/g,function(t){return t.toUpperCase()})},t.t=function(e,n){return t.formatString(e,n)},t.formatString=function(t,n){return e.Object.each(n,function(e){t=t.replace(e,n[e])},this),t},t.uuid=function(t,e){var n,i=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],o=[];if(e=e||i.length,t)for(n=0;t>n;n++)o[n]=i[0|Math.random()*e];else{var s;for(o[8]=o[13]=o[18]=o[23]="-",o[14]="4",n=0;36>n;n++)o[n]||(s=0|16*Math.random(),o[n]=i[19===n?8|3&s:s])}return o.join("")},t.pad=function(t,e,n,i){var o,s,a;if(e===void 0&&(e=0),n===void 0&&(n=" "),i===void 0&&(i="right"),t+="",e+1>=t.length)switch(i){case"left":t=Array(e+1-t.length).join(n)+t;break;case"both":a=e-t.length,o=Math.ceil(a/2),s=a-o,t=Array(s+1).join(n)+t+Array(o+1).join(n);break;default:t+=Array(e+1-t.length).join(n)}return t},t}(),e.StyleSheet=function(){function t(t){this.configs=this.getConfigs(t),e.Dom.call(this,"<style/>",this.configs.attributes),this.text(""),this.appendTo(this.configs.container),this.sheet=this.get(0).sheet}return e.Dom.extend(t),t.defaults={container:window.document.head,attributes:{}},t.prototype.addRule=function(t,e,n){return void 0===n&&(n=this.sheet.cssRules.length),"insertRule"in this.sheet?this.sheet.insertRule(t+"{"+e+"}",n):"addRule"in this.sheet?this.sheet.addRule(t,e,n):void 0},t.prototype.removeRule=function(t){return"deleteRule"in this.sheet?this.sheet.deleteRule(t):"removeRule"in this.sheet&&this.sheet.removeRule(t),this},t.prototype.removeRulesBySelector=function(t){var e=this.sheet.cssRules||this.sheet.rules;t=t.toLowerCase();for(var n=0;e.length>n;n++)if(e[n].selectorText.toLowerCase()===t){this.removeRule(n);break}return this},t.prototype.removeRules=function(){for(var t=this.sheet.cssRules||this.sheet.rules;t.length>0;)this.removeRule(0);return this},t}(),e.Var=function(){function t(){}var n={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"};return e.Class.extend(t),t.type=function(t){return null==t?t+"":n[Object.prototype.toString.call(t)]||"object"},t.is=function(e,n){return t.type(e)===n.toLowerCase()},t}(),e.Editor=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this,"<div/>",{"class":"metaScore-editor"}),this.configs.container&&this.appendTo(this.configs.container),this.h_ruler=new e.Dom("<div/>",{"class":"ruler horizontal"}).appendTo(this),this.v_ruler=new e.Dom("<div/>",{"class":"ruler vertical"}).appendTo(this),this.workspace=new e.Dom("<div/>",{"class":"workspace"}).appendTo(this),this.mainmenu=(new e.editor.MainMenu).appendTo(this),this.sidebar=new e.Dom("<div/>",{"class":"sidebar"}).appendTo(this),this.panels={},this.panels.block=(new e.editor.panel.Block).appendTo(this.sidebar),this.panels.page=(new e.editor.panel.Page).appendTo(this.sidebar),this.panels.element=(new e.editor.panel.Element).appendTo(this.sidebar),this.panels.text=(new e.editor.panel.Text).appendTo(this.sidebar),this.grid=new e.Dom("<div/>",{"class":"grid"}).appendTo(this.workspace),this.version=new e.Dom("<div/>",{"class":"version",text:"metaScore v."+e.getVersion()+" r."+e.getRevision()}).appendTo(this.workspace),this.history=new e.editor.History,this.addDelegate(".timefield","valuein",e.Function.proxy(this.onTimeFieldIn,this)).addDelegate(".timefield","valueout",e.Function.proxy(this.onTimeFieldOut,this)),this.mainmenu.addDelegate("button[data-action]:not(.disabled)","click",e.Function.proxy(this.onMainmenuClick,this)).addDelegate(".time","valuechange",e.Function.proxy(this.onMainmenuTimeFieldChange,this)).addDelegate(".r-index","valuechange",e.Function.proxy(this.onMainmenuRindexFieldChange,this)),this.panels.block.addListener("componentset",e.Function.proxy(this.onBlockSet,this)).addListener("componentunset",e.Function.proxy(this.onBlockUnset,this)).addListener("valueschange",e.Function.proxy(this.onBlockPanelValueChange,this)).getToolbar().addDelegate(".buttons [data-action]","click",e.Function.proxy(this.onBlockPanelToolbarClick,this)),this.panels.page.addListener("componentset",e.Function.proxy(this.onPageSet,this)).addListener("componentunset",e.Function.proxy(this.onPageUnset,this)).getToolbar().addDelegate(".buttons [data-action]","click",e.Function.proxy(this.onPagePanelToolbarClick,this)),this.panels.element.addListener("componentset",e.Function.proxy(this.onElementSet,this)).addListener("componentunset",e.Function.proxy(this.onElementUnset,this)).getToolbar().addDelegate(".buttons [data-action]","click",e.Function.proxy(this.onElementPanelToolbarClick,this)),this.history.addListener("add",e.Function.proxy(this.onHistoryAdd,this)).addListener("undo",e.Function.proxy(this.onHistoryUndo,this)).addListener("redo",e.Function.proxy(this.onHistoryRedo,this)),new e.Dom("body").addListener("keydown",e.Function.proxy(this.onKeydown,this)).addListener("keyup",e.Function.proxy(this.onKeyup,this)),this.setEditing(!1)}return e.Dom.extend(t),t.defaults={ajax:{}},t.prototype.setEditing=function(t,n){n!==!1&&(e.editing=t),e.Object.each(this.panels,function(e,n){t?n.enable():n.disable()}),this.toggleClass("editing",t),this.player&&this.player.getBody().toggleClass("editing",t)},t.prototype.onGuideSaveSuccess=function(){this.loadmask.hide(),delete this.loadmask},t.prototype.onGuideSaveError=function(){},t.prototype.onPlayerKeydown=t.prototype.onKeydown=function(t){switch(t.keyCode){case 18:t.repeat||(this.setEditing(!e.editing,!1),t.preventDefault());break;case 90:t.ctrlKey&&(this.history.undo(),t.preventDefault());break;case 89:t.ctrlKey&&(this.history.redo(),t.preventDefault())}},t.prototype.onPlayerKeyup=t.prototype.onKeyup=function(t){switch(t.keyCode){case 18:this.setEditing(e.editing,!1),t.preventDefault()}},t.prototype.onMainmenuClick=function(t){switch(e.Dom.data(t.target,"action")){case"new":break;case"open":new e.editor.overlay.GuideSelector({url:this.configs.api_url+"guide.json",selectCallback:e.Function.proxy(this.openGuide,this),autoShow:!0});break;case"edit":break;case"save":this.saveGuide();break;case"download":break;case"delete":break;case"revert":break;case"undo":this.history.undo();break;case"redo":this.history.redo();break;case"edit-toggle":this.setEditing(!e.editing);break;case"settings":break;case"help":}},t.prototype.onMainmenuTimeFieldChange=function(t){var e=t.target._metaScore,n=e.getValue();this.player.media.setTime(n)},t.prototype.onMainmenuRindexFieldChange=function(t){var e=t.target._metaScore,n=e.getValue();this.player.setReadingIndex(n,!0)},t.prototype.onTimeFieldIn=function(t){var e=t.target._metaScore,n=this.player.media.getTime();e.setValue(n)},t.prototype.onTimeFieldOut=function(t){var e=t.target._metaScore,n=e.getValue();this.player.media.setTime(n)},t.prototype.onBlockSet=function(t){var n=t.detail.component;n instanceof e.player.component.Block&&(this.panels.page.setComponent(n.getActivePage(),!0),this.panels.page.toggleMenuItems('[data-action="new"]',!0),this.panels.element.toggleMenuItems('[data-action="new"]',!0)),t.stopPropagation()},t.prototype.onBlockUnset=function(){this.panels.page.unsetComponent(),this.panels.page.toggleMenuItems('[data-action="new"]',!1)},t.prototype.onBlockPanelValueChange=function(t){var n=t.detail.component,i=t.detail.old_values,o=t.detail.new_values;this.history.add({undo:e.Function.proxy(this.panels.block.updateProperties,this.panels.block,[n,i]),redo:e.Function.proxy(this.panels.block.updateProperties,this.panels.block,[n,o])})},t.prototype.onBlockPanelToolbarClick=function(t){var n,i,o,s;switch(e.Dom.data(t.target,"action")){case"new":i=this.player.addBlock(),this.history.add({undo:e.Function.proxy(i.remove,this),redo:e.Function.proxy(this.addBlock,this,[i])});break;case"delete":i=this.panels.block.getComponent(),i&&(i.remove(),this.panels.block.unsetComponent(),this.history.add({undo:e.Function.proxy(this.addBlock,this,[i]),redo:e.Function.proxy(i.remove,this)}));break;case"previous":n=this.player.getComponents("block"),o=n.count(),o>0&&(s=n.index(".selected")-1,0>s&&(s=o-1),i=n.get(s)._metaScore,this.panels.block.setComponent(i));break;case"next":n=this.player.getComponents("block"),o=n.count(),o>0&&(s=n.index(".selected")+1,s>=o&&(s=0),i=n.get(s)._metaScore,this.panels.block.setComponent(i))}t.stopPropagation()},t.prototype.onPageSet=function(t){var e=t.detail.component,n=e.parents().parents().get(0)._metaScore;this.panels.block.setComponent(n,!0),this.panels.page.toggleMenuItems('[data-action="new"]',!0),this.panels.element.toggleMenuItems('[data-action="new"]',!0),t.stopPropagation()},t.prototype.onPageUnset=function(){this.panels.element.unsetComponent(),this.panels.element.toggleMenuItems('[data-action="new"]',!1)},t.prototype.onPagePanelToolbarClick=function(t){var n,i,o,s,a;switch(e.Dom.data(t.target,"action")){case"new":n=this.panels.block.getComponent(),i=this.addPage(n),this.history.add({undo:e.Function.proxy(i.remove,this),redo:e.Function.proxy(this.addPage,this,[n,i])});break;case"delete":n=this.panels.block.getComponent(),i=this.panels.page.getComponent(),i&&(n.removePage(i).remove(),this.panels.page.unsetComponent(),this.history.add({undo:e.Function.proxy(this.addPage,this,[n,i]),redo:e.Function.proxy(i.remove,this)}));break;case"previous":n=this.panels.block.getComponent(),n&&(o=new e.Dom(".page",n),s=o.count(),s>0&&(a=o.index(".selected")-1,0>a&&(a=s-1),i=o.get(a)._metaScore,n.setActivePage(i)));break;case"next":n=this.panels.block.getComponent(),n&&(o=new e.Dom(".page",n),s=o.count(),s>0&&(a=o.index(".selected")+1,a>=s&&(a=0),i=o.get(a)._metaScore,n.setActivePage(i)))}t.stopPropagation()},t.prototype.onElementSet=function(t){var e=t.detail.component,n=e.parents().get(0)._metaScore,i=n.parents().parents().get(0)._metaScore;this.panels.page.setComponent(n,!0),this.panels.block.setComponent(i,!0),"Text"===e.getProperty("type")&&this.panels.text.setComponent(e),t.stopPropagation()},t.prototype.onElementUnset=function(t){this.panels.text.unsetComponent(),t.stopPropagation()},t.prototype.onElementPanelToolbarClick=function(t){var n,i,o,s,a;switch(e.Dom.data(t.target,"action")){case"new":n=this.panels.page.getComponent(),i=this.addElement(n,{type:e.Dom.data(t.target,"type")}),this.history.add({undo:e.Function.proxy(i.remove,this),redo:e.Function.proxy(this.addElement,this,[n,i])});break;case"delete":n=this.panels.page.getComponent(),i=this.panels.element.getComponent(),i&&(i.remove(),this.panels.element.unsetComponent(),this.history.add({undo:e.Function.proxy(this.addElement,this,[n,i]),redo:e.Function.proxy(i.remove,this)}));break;case"previous":n=this.panels.page.getComponent(),n&&(o=new e.Dom(".element",n),s=o.count(),s>0&&(a=o.index(".selected")-1,0>a&&(a=s-1),i=o.get(a)._metaScore,this.panels.element.setComponent(i)));break;case"next":n=this.panels.page.getComponent(),n&&(o=new e.Dom(".element",n),s=o.count(),s>0&&(a=o.index(".selected")+1,a>=s&&(a=0),i=o.get(a)._metaScore,this.panels.element.setComponent(i)))}},t.prototype.onPlayerTimeUpdate=function(t){var e=t.detail.media.getTime();this.mainmenu.timefield.setValue(e,!0)},t.prototype.onPlayerReadingIndex=function(t){var e=t.detail.value;this.mainmenu.rindexfield.setValue(e,!0)},t.prototype.onPlayerLoadSuccess=function(){this.setEditing(!0),this.loadmask.hide(),delete this.loadmask},t.prototype.onPlayerLoadError=function(){this.loadmask.hide(),delete this.loadmask},t.prototype.onComponentClick=function(t,n){var i;e.editing===!0&&(i=n._metaScore,i instanceof e.player.component.Block?this.panels.block.setComponent(i):i instanceof e.player.component.Controller?this.panels.block.setComponent(i):i instanceof e.player.component.Media?this.panels.block.setComponent(i):i instanceof e.player.component.Page?this.panels.page.setComponent(i):i instanceof e.player.component.Element&&this.panels.element.setComponent(i))},t.prototype.onPlayerClick=function(t){e.editing===!0&&(this.panels.block.unsetComponent(),t.stopPropagation())},t.prototype.onBlockPageActivated=function(t){e.editing===!0&&this.panels.page.setComponent(t.detail.page)},t.prototype.onHistoryAdd=function(){this.mainmenu.enableItems('[data-action="undo"]'),this.mainmenu.disableItems('[data-action="redo"]')},t.prototype.onHistoryUndo=function(){this.history.hasUndo()?this.mainmenu.enableItems('[data-action="undo"]'):this.mainmenu.disableItems('[data-action="undo"]'),this.mainmenu.enableItems('[data-action="redo"]')},t.prototype.onHistoryRedo=function(){this.history.hasRedo()?this.mainmenu.enableItems('[data-action="redo"]'):this.mainmenu.disableItems('[data-action="redo"]'),this.mainmenu.enableItems('[data-action="undo"]')},t.prototype.addPlayer=function(t){this.loadmask=new e.editor.overlay.LoadMask({autoShow:!0}),this.player=new e.Player(e.Object.extend({},t,{container:this.workspace})).addListener("rindex",e.Function.proxy(this.onPlayerReadingIndex,this)).addListener("loadsuccess",e.Function.proxy(this.onPlayerLoadSuccess,this)).addListener("loaderror",e.Function.proxy(this.onPlayerLoadError,this)),this.player.getBody().addClass("in-editor").addListener("click",e.Function.proxy(this.onPlayerClick,this)).addListener("keydown",e.Function.proxy(this.onPlayerKeydown,this)).addListener("keyup",e.Function.proxy(this.onPlayerKeyup,this)).addListener("timeupdate",e.Function.proxy(this.onPlayerTimeUpdate,this)).addListener("rindex",e.Function.proxy(this.onPlayerReadingIndex,this)).addDelegate(".metaScore-component","click",e.Function.proxy(this.onComponentClick,this)).addDelegate(".metaScore-component.block","pageactivate",e.Function.proxy(this.onBlockPageActivated,this))},t.prototype.removePlayer=function(){this.player&&(this.player.remove(),delete this.player)},t.prototype.addBlock=function(t){return t instanceof e.player.component.Block||(t=this.player.addBlock(t)),this.panels.block.setComponent(t),t},t.prototype.addPage=function(t,n){return n instanceof e.player.component.Page||(n=t.addPage(n)),this.panels.page.setComponent(n),n},t.prototype.addElement=function(t,n){return n instanceof e.player.component.Element||(n=t.addElement(n)),this.panels.element.setComponent(n),n
},t.prototype.openGuide=function(t){this.removePlayer(),this.addPlayer({url:this.configs.api_url+"guide/"+t.id+".json"})},t.prototype.saveGuide=function(){var t,n,i=this.player.getComponents(),o=this.player.getId(),s={};i.each(function(n,i){t=i._metaScore,t instanceof e.player.component.Media?s.media=t.getProperties():t instanceof e.player.component.Controller?s.controller=t.getProperties():t instanceof e.player.component.Block&&("blocks"in s||(s.blocks=[]),s.blocks.push(t.getProperties()))},this),n=e.Object.extend({},{data:JSON.stringify(s),dataType:"json",success:e.Function.proxy(this.onGuideSaveSuccess,this),error:e.Function.proxy(this.onGuideSaveError,this)},this.configs.ajax),this.loadmask=new e.editor.overlay.LoadMask({autoShow:!0}),e.Ajax.put(this.configs.api_url+"guide/"+o+".json",n)},t}(),e.namespace("editor").Button=function(){function t(t){this.configs=this.getConfigs(t),e.Dom.call(this,"<button/>"),this.disabled=!1,this.configs.label&&this.setLabel(this.configs.label),this.addListener("click",e.Function.proxy(this.onClick,this))}return t.defaults={label:null},e.Dom.extend(t),t.prototype.onClick=function(t){this.disabled&&t.stopPropagation()},t.prototype.setLabel=function(t){void 0===this.label&&(this.label=new e.Dom("<span/>",{"class":"label"}).appendTo(this)),this.label.text(t)},t.prototype.disable=function(){return this.disabled=!0,this.addClass("disabled"),this},t.prototype.enable=function(){return this.disabled=!1,this.removeClass("disabled"),this},t}(),e.namespace("editor").DropDownMenu=function(){function t(t){this.configs=this.getConfigs(t),e.Dom.call(this,"<ul/>",{"class":"dropdown-menu"})}return e.Dom.extend(t),t.prototype.addItem=function(t){var n=new e.Dom("<li/>",t).appendTo(this);return n},t.prototype.enableItems=function(t){var e=this.children(t);return e.removeClass("disabled"),e},t.prototype.disableItems=function(t){var e=this.children(t);return e.addClass("disabled"),e},t}(),e.namespace("editor").Field=function(){function t(t){this.configs=this.getConfigs(t),e.Dom.call(this,"<div/>",{"class":"field"}),this.setupUI(),this.get(0)._metaScore=this,this.disabled=!1,null!==this.configs.value&&this.setValue(this.configs.value),this.configs.disabled&&this.disable()}return t.defaults={value:null,disabled:!1},e.Dom.extend(t),t.prototype.setupUI=function(){this.input=new e.Dom("<input/>",{type:"text"}).addListener("change",e.Function.proxy(this.onChange,this)).appendTo(this)},t.prototype.onChange=function(){this.value=this.input.val(),this.triggerEvent("valuechange",{field:this,value:this.value},!0,!1)},t.prototype.setValue=function(t,e){this.input.val(t),this.value=t,e!==!0&&this.input.triggerEvent("change")},t.prototype.getValue=function(){return this.value},t.prototype.disable=function(){return this.disabled=!0,this.addClass("disabled"),this.input.attr("disabled","disabled"),this},t.prototype.enable=function(){return this.disabled=!1,this.removeClass("disabled"),this.input.attr("disabled",null),this},t}(),e.namespace("editor").History=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this),this.commands=[],this.index=-1,this.executing=!1}return t.defaults={max_commands:30},e.Evented.extend(t),t.prototype.execute=function(t,e){return t&&e in t&&(this.executing=!0,t[e](t),this.executing=!1),this},t.prototype.add=function(t){return this.executing?this:(this.commands.splice(this.index+1,this.commands.length-this.index),this.commands.push(t),this.commands.length>this.configs.max_commands&&(this.commands=this.commands.slice(-1*this.configs.max_commands)),this.index=this.commands.length-1,this.triggerEvent("add",{command:t}),this)},t.prototype.undo=function(){var t=this.commands[this.index];return t?(this.execute(t,"undo"),this.index-=1,this.triggerEvent("undo",{command:t}),this):this},t.prototype.redo=function(){var t=this.commands[this.index+1];return t?(this.execute(t,"redo"),this.index+=1,this.triggerEvent("redo",{command:t}),this):this},t.prototype.clear=function(){var t=this.commands.length;this.commands=[],this.index=-1,t>0&&this.triggerEvent("clear")},t.prototype.hasUndo=function(){return-1!==this.index},t.prototype.hasRedo=function(){return this.index<this.commands.length-1},t}(),e.namespace("editor").MainMenu=function(){function t(){t.parent.call(this,"<div/>",{"class":"main-menu clearfix"}),this.setupUI()}return e.Dom.extend(t),t.prototype.setupUI=function(){var t,n;t=new e.Dom("<div/>",{"class":"left"}).appendTo(this),n=new e.Dom("<div/>",{"class":"right"}).appendTo(this),new e.Dom("<div/>",{"class":"logo-philharmonie"}).appendTo(t),(new e.editor.Button).attr({title:e.String.t("New")}).data("action","new").appendTo(t),(new e.editor.Button).attr({title:e.String.t("Open")}).data("action","open").appendTo(t),(new e.editor.Button).attr({title:e.String.t("edit")}).data("action","edit").appendTo(t),(new e.editor.Button).attr({title:e.String.t("save")}).data("action","save").appendTo(t),(new e.editor.Button).attr({title:e.String.t("delete")}).data("action","delete").appendTo(t),(new e.editor.Button).attr({title:e.String.t("download")}).data("action","download").appendTo(t),this.timefield=(new e.editor.field.Time).attr({title:e.String.t("time")}).addClass("time").appendTo(t),this.rindexfield=new e.editor.field.Number({min:0}).attr({title:e.String.t("reading index")}).addClass("r-index").appendTo(t),(new e.editor.Button).attr({title:e.String.t("edit toggle")}).data("action","edit-toggle").appendTo(t),(new e.editor.Button).attr({title:e.String.t("revert")}).data("action","revert").appendTo(t),(new e.editor.Button).attr({title:e.String.t("undo")}).data("action","undo").appendTo(t),(new e.editor.Button).attr({title:e.String.t("redo")}).data("action","redo").appendTo(t),(new e.editor.Button).attr({title:e.String.t("settings")}).data("action","settings").appendTo(n),(new e.editor.Button).attr({title:e.String.t("help")}).data("action","help").appendTo(n)},t.prototype.enableItems=function(t){var e=this.children(t);return e.removeClass("disabled"),e},t.prototype.disableItems=function(t){var e=this.children(t);return e.addClass("disabled"),e},t}(),e.namespace("editor").Overlay=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this,"<div/>",{"class":"overlay clearfix"}),this.configs.modal&&(this.mask=new e.Dom("<div/>",{"class":"overlay-mask"})),this.configs.autoShow&&this.show(),this.configs.toolbar&&(this.toolbar=new e.editor.overlay.Toolbar({title:this.configs.title}).appendTo(this),this.toolbar.addButton("close").addListener("click",e.Function.proxy(this.onCloseClick,this))),this.contents=new e.Dom("<div/>",{"class":"contents"}).appendTo(this),this.configs.draggable&&(this.draggable=new e.Draggable({target:this,handle:this.configs.toolbar?this.toolbar:this}))}return t.defaults={parent:".metaScore-editor",modal:!0,draggable:!0,autoShow:!1,toolbar:!1,title:""},e.Dom.extend(t),t.prototype.show=function(){return this.configs.modal&&this.mask.appendTo(this.configs.parent),this.appendTo(this.configs.parent),this},t.prototype.hide=function(){return this.configs.modal&&this.mask.remove(),this.remove(),this},t.prototype.getToolbar=function(){return this.toolbar},t.prototype.getContents=function(){return this.contents},t.prototype.onCloseClick=function(){this.hide()},t}(),e.namespace("editor").Panel=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this,"<div/>",{"class":"panel"}),this.onComponentDragStart=e.Function.proxy(this.onComponentDragStart,this),this.onComponentDrag=e.Function.proxy(this.onComponentDrag,this),this.onComponentDragEnd=e.Function.proxy(this.onComponentDragEnd,this),this.onComponentResizeStart=e.Function.proxy(this.onComponentResizeStart,this),this.onComponentResize=e.Function.proxy(this.onComponentResize,this),this.onComponentResizeEnd=e.Function.proxy(this.onComponentResizeEnd,this),this.toolbar=new e.editor.panel.Toolbar({title:this.configs.title}).appendTo(this),this.toolbar.getTitle().addListener("click",e.Function.proxy(this.toggleState,this)),e.Array.each(this.configs.toolbarButtons,function(t,e){this.toolbar.addButton(e)},this),this.configs.menuItems.length>0&&(this.menu=new e.editor.DropDownMenu,e.Array.each(this.configs.menuItems,function(t,e){this.menu.addItem(e)},this),this.toolbar.addButton("menu").append(this.menu)),this.contents=new e.Dom("<table/>",{"class":"fields"}).appendTo(this),this.addDelegate(".field","valuechange",e.Function.proxy(this.onFieldValueChange,this)).unsetComponent()}return t.defaults={title:"",toolbarButtons:["previous","next"],menuItems:[]},e.Dom.extend(t),t.prototype.setupFields=function(t){var n,i,o,s;return this.fields={},this.contents.empty(),e.Object.each(t,function(t,a){a.editable!==!1&&(n=new e.Dom("<tr/>",{"class":"field-wrapper "+t}).appendTo(this.contents),i="field-"+e.String.uuid(5),o=a.configs||{},s=new e.editor.field[a.type](o).attr("id",i).data("name",t),new e.Dom("<td/>").appendTo(n).append(new e.Dom("<label/>",{text:a.label,"for":i})),new e.Dom("<td/>").appendTo(n).append(s),this.fields[t]=s)},this),this},t.prototype.getToolbar=function(){return this.toolbar},t.prototype.getField=function(t){return void 0===t?this.fields:this.fields[t]},t.prototype.enableFields=function(){e.Object.each(this.fields,function(t,e){e.enable()},this)},t.prototype.showField=function(t){this.contents.children("tr.field-wrapper."+t).show()},t.prototype.hideField=function(t){this.contents.children("tr.field-wrapper."+t).hide()},t.prototype.toggleState=function(){this.toggleClass("collapsed")},t.prototype.disable=function(){this.addClass("disabled")},t.prototype.enable=function(){this.removeClass("disabled")},t.prototype.getMenu=function(){return this.menu},t.prototype.getComponent=function(){return this.component},t.prototype.getDraggable=function(){return!1},t.prototype.getResizable=function(){return!1},t.prototype.setComponent=function(t,n){var i,o;return t!==this.getComponent()&&(this.unsetComponent(!0),this.component=t,this.setupFields(this.component.configs.properties).updateFieldValues(this.getValues(Object.keys(this.getField())),!0).addClass("has-component"),t instanceof e.player.component.Controller||this.toggleMenuItems('[data-action="delete"]',!0),i=this.getDraggable(),i&&(t._draggable=new e.Draggable(i),t.addListener("dragstart",this.onComponentDragStart).addListener("drag",this.onComponentDrag).addListener("dragend",this.onComponentDragEnd)),o=this.getResizable(),o&&(t._resizable=new e.Resizable(o),t.addListener("resizestart",this.onComponentResizeStart).addListener("resize",this.onComponentResize).addListener("resizeend",this.onComponentResizeEnd)),t.addClass("selected")),n!==!0&&this.triggerEvent("componentset",{component:t},!1),this},t.prototype.unsetComponent=function(t){var e=this.getComponent();return this.toggleMenuItems('[data-action="delete"]',!1).removeClass("has-component"),e&&(e._draggable&&(e._draggable.destroy(),delete e._draggable,e.removeListener("dragstart",this.onComponentDragStart).removeListener("drag",this.onComponentDrag).removeListener("dragend",this.onComponentDragEnd)),e._resizable&&(e._resizable.destroy(),delete e._resizable,e.removeListener("resizestart",this.onComponentResizeStart).removeListener("resize",this.onComponentResize).removeListener("resizeend",this.onComponentResizeEnd)),e.removeClass("selected"),this.component=null),t!==!0&&this.triggerEvent("componentunset",{component:e},!1),this},t.prototype.toggleMenuItems=function(t,e){var n=this.getMenu();return n&&(e?n.enableItems(t):n.disableItems(t)),this},t.prototype.onComponentDragStart=function(){var t=["x","y"];this._beforeDragValues=this.getValues(t)},t.prototype.onComponentDrag=function(){var t=["x","y"];this.updateFieldValues(t,!0)},t.prototype.onComponentDragEnd=function(){var t=this.getComponent(),e=["x","y"];this.updateFieldValues(e,!0),this.triggerEvent("valueschange",{component:t,old_values:this._beforeDragValues,new_values:this.getValues(e)},!1),delete this._beforeDragValues},t.prototype.onComponentResizeStart=function(){var t=["x","y","width","height"];this._beforeResizeValues=this.getValues(t)},t.prototype.onComponentResize=function(){var t=["x","y","width","height"];this.updateFieldValues(t,!0)},t.prototype.onComponentResizeEnd=function(){var t=this.getComponent(),e=["x","y","width","height"];this.updateFieldValues(e,!0),this.triggerEvent("valueschange",{component:t,old_values:this._beforeResizeValues,new_values:this.getValues(e)},!1),delete this._beforeResizeValues},t.prototype.onFieldValueChange=function(t){var e,n,i,o=this.getComponent();o&&(e=t.detail.field.data("name"),n=t.detail.value,i=this.getValues([e]),o.setProperty(e,n),this.triggerEvent("valueschange",{component:o,old_values:i,new_values:this.getValues([e])},!1))},t.prototype.updateFieldValue=function(t,e,n){this.getField(t).setValue(e,n)},t.prototype.updateFieldValues=function(t,n){return e.Var.is(t,"array")?e.Array.each(t,function(t,e){this.updateFieldValue(e,this.getValue(e),n)},this):e.Object.each(t,function(t,e){this.updateFieldValue(t,e,n)},this),this},t.prototype.updateProperties=function(t,n){return e.Object.each(n,function(e,n){this.getField(e).disabled||t.setProperty(e,n)},this),this.updateFieldValues(n,!0),this},t.prototype.getValue=function(t){return this.getComponent().getProperty(t)},t.prototype.getValues=function(t){var n={};return t=t||Object.keys(this.getField()),e.Array.each(t,function(t,e){this.getField(e).disabled||(n[e]=this.getValue(e))},this),n},t}(),e.namespace("editor.field").Boolean=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this,this.configs),this.addClass("booleanfield"),this.configs.checked&&this.input.attr("checked","checked")}return t.defaults={value:!0,checked_value:!0,unchecked_value:!1,checked:!1},e.editor.Field.extend(t),t.prototype.setupUI=function(){this.input=new e.Dom("<input/>",{type:"checkbox"}).addListener("change",e.Function.proxy(this.onChange,this)).appendTo(this)},t.prototype.onChange=function(){this.value=this.input.is(":checked")?this.input.val():this.configs.unchecked_value,this.triggerEvent("valuechange",{field:this,value:this.value?this.configs.checked_value:this.configs.unchecked_value},!0,!1)},t.prototype.setValue=function(t,e){this.input.attr("checked",t?"checked":""),e!==!0&&this.input.triggerEvent("change")},t}(),e.namespace("editor.field").BorderRadius=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this,this.configs),this.addClass("borderradiusrfield")}return e.editor.Field.extend(t),t}(),e.namespace("editor.field").Buttons=function(){function t(n){this.configs=this.getConfigs(n),this.onClick=e.Function.proxy(this.onClick,this),t.parent.call(this,this.configs),this.addClass("buttonsfield")}return t.defaults={buttons:{}},e.editor.Field.extend(t),t.prototype.setValue=function(){},t.prototype.setupUI=function(){var t=this;e.Object.each(this.configs.buttons,function(n,i){new e.Dom("<button/>",i).addListener("click",function(){t.triggerEvent("valuechange",{field:t,value:n},!0,!1)}).appendTo(this)},this)},t}(),e.namespace("editor.field").Color=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this,this.configs),this.addClass("colorfield")}return t.defaults={value:{r:255,g:255,b:255,a:1}},e.editor.Field.extend(t),t.prototype.setupUI=function(){this.onColorSelect=e.Function.proxy(this.onColorSelect,this),this.button=(new e.editor.Button).addListener("click",e.Function.proxy(this.onClick,this)),this.overlay=new e.editor.overlay.ColorSelector({selectCallback:this.onColorSelect}),this.button.appendTo(this)},t.prototype.setValue=function(t,n){this.value=e.Color.parse(t),this.button.css("background-color","rgba("+this.value.r+","+this.value.g+","+this.value.b+","+this.value.a+")"),n!==!0&&this.triggerEvent("valuechange",{field:this,value:this.value},!0,!1)},t.prototype.onClick=function(){this.disabled||this.overlay.setValue(e.Object.copy(this.value)).show()},t.prototype.onColorSelect=function(t,e){this.setValue(t),e.hide()},t}(),e.namespace("editor.field").Image=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this,this.configs),this.addClass("imagefield"),this.input.attr("readonly","readonly").addListener("click",e.Function.proxy(this.onClick,this))}return e.editor.Field.extend(t),t.prototype.setupUI=function(){t.parent.prototype.setupUI.call(this),this.clear=new e.Dom("<button/>",{text:".","data-action":"clear"}).addListener("click",e.Function.proxy(this.onClearClick,this)).appendTo(this)},t.prototype.setValue=function(e,n){t.parent.prototype.setValue.call(this,e,n),this.input.attr("title",e)},t.prototype.onClick=function(){Drupal.media.popups.mediaBrowser(e.Function.proxy(this.onFileSelect,this))},t.prototype.onClearClick=function(){this.setValue(null)},t.prototype.onFileSelect=function(t){t.length>0&&this.setValue(t[0].url+"?fid="+t[0].fid)},t}(),e.namespace("editor.field").Number=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this,this.configs),this.addClass("numberfield")}return t.defaults={value:0,min:null,max:null},e.editor.Field.extend(t),t.prototype.setupUI=function(){this.input=new e.Dom("<input/>",{type:"number",min:this.configs.min,max:this.configs.max,step:this.configs.step}).addListener("change",e.Function.proxy(this.onChange,this)).appendTo(this)},t}(),e.namespace("editor.field").Select=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this,this.configs),this.addClass("selectfield")}return t.defaults={options:{}},e.editor.Field.extend(t),t.prototype.setupUI=function(){this.input=new e.Dom("<select/>").addListener("change",e.Function.proxy(this.onChange,this)).appendTo(this),e.Object.each(this.configs.options,function(t,n){this.input.append(new e.Dom("<option/>",{text:n,value:t}))},this)},t}(),e.namespace("editor.field").Text=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this,this.configs),this.addClass("textfield")}return t.defaults={value:""},e.editor.Field.extend(t),t}(),e.namespace("editor.field").Time=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this,this.configs),this.addClass("timefield")}return t.defaults={value:0,min:0,max:null,checkbox:!1,inButton:!1,outButton:!1},e.editor.Field.extend(t),t.prototype.setupUI=function(){var t;this.configs.checkbox&&(this.checkbox=new e.Dom("<input/>",{type:"checkbox"}).addListener("change",e.Function.proxy(this.onInput,this)).appendTo(this)),this.hours=new e.Dom("<input/>",{type:"number","class":"hours"}).addListener("input",e.Function.proxy(this.onInput,this)).appendTo(this),new e.Dom("<span/>",{text:":","class":"separator"}).appendTo(this),this.minutes=new e.Dom("<input/>",{type:"number","class":"minutes"}).addListener("input",e.Function.proxy(this.onInput,this)).appendTo(this),new e.Dom("<span/>",{text:":","class":"separator"}).appendTo(this),this.seconds=new e.Dom("<input/>",{type:"number","class":"seconds"}).addListener("input",e.Function.proxy(this.onInput,this)).appendTo(this),new e.Dom("<span/>",{text:".","class":"separator"}).appendTo(this),this.centiseconds=new e.Dom("<input/>",{type:"number","class":"centiseconds"}).addListener("input",e.Function.proxy(this.onInput,this)).appendTo(this),(this.configs.inButton||this.configs.outButton)&&(t=new e.Dom("<div/>",{"class":"buttons"}).appendTo(this),this.configs.inButton&&(this.in=new e.Dom("<button/>",{text:".","data-action":"in"}).addListener("click",e.Function.proxy(this.onInClick,this)).appendTo(t)),this.configs.outButton&&(this.out=new e.Dom("<button/>",{text:".","data-action":"out"}).addListener("click",e.Function.proxy(this.onOutClick,this)).appendTo(t))),this.addListener("change",e.Function.proxy(this.onChange,this))},t.prototype.onChange=function(){this.triggerEvent("valuechange",{field:this,value:this.value},!0,!1)},t.prototype.onInput=function(t){var e,n,i,o,s=this.isActive();s?(e=parseInt(this.centiseconds.val(),10),n=parseInt(this.seconds.val(),10),i=parseInt(this.minutes.val(),10),o=parseInt(this.hours.val(),10),this.setValue(10*e+1e3*n+6e4*i+36e5*o)):this.setValue(null),t.stopPropagation()},t.prototype.onInClick=function(){this.triggerEvent("valuein")},t.prototype.onOutClick=function(){this.triggerEvent("valueout")},t.prototype.setValue=function(t,e){var n,i,o,s;t=parseFloat(t),isNaN(t)?(this.value=null,this.centiseconds.val(0),this.seconds.val(0),this.minutes.val(0),this.hours.val(0),this.disabled||(this.hours.attr("disabled","disabled"),this.minutes.attr("disabled","disabled"),this.seconds.attr("disabled","disabled"),this.centiseconds.attr("disabled","disabled"),this.in&&this.in.attr("disabled","disabled"),this.out&&this.out.attr("disabled","disabled")),this.checkbox&&this.checkbox.attr("checked",null)):(this.value=t,null!==this.configs.min&&(this.value=Math.max(this.value,this.configs.min)),null!==this.configs.max&&(this.value=Math.min(this.value,this.configs.max)),n=parseInt(this.value/10%100,10),i=parseInt(this.value/1e3%60,10),o=parseInt(this.value/6e4%60,10),s=parseInt(this.value/36e5,10),this.disabled||(this.hours.attr("disabled",null),this.minutes.attr("disabled",null),this.seconds.attr("disabled",null),this.centiseconds.attr("disabled",null),this.in&&this.in.attr("disabled",null),this.out&&this.out.attr("disabled",null)),this.centiseconds.val(n),this.seconds.val(i),this.minutes.val(o),this.hours.val(s),this.checkbox&&this.checkbox.attr("checked","checked")),e!==!0&&this.triggerEvent("change")},t.prototype.isActive=function(){return!this.checkbox||this.checkbox.is(":checked")},t.prototype.disable=function(){return this.disabled=!0,this.checkbox&&this.checkbox.attr("disabled","disabled"),this.hours.attr("disabled","disabled"),this.minutes.attr("disabled","disabled"),this.seconds.attr("disabled","disabled"),this.centiseconds.attr("disabled","disabled"),this.in&&this.in.attr("disabled","disabled"),this.out&&this.out.attr("disabled","disabled"),this.addClass("disabled"),this},t.prototype.enable=function(){var t=this.isActive();return this.disabled=!1,this.checkbox&&this.checkbox.attr("disabled",null),this.hours.attr("disabled",t?null:"disabled"),this.minutes.attr("disabled",t?null:"disabled"),this.seconds.attr("disabled",t?null:"disabled"),this.centiseconds.attr("disabled",t?null:"disabled"),this.in&&this.in.attr("disabled",t?null:"disabled"),this.out&&this.out.attr("disabled",t?null:"disabled"),this.removeClass("disabled"),this},t}(),e.namespace("editor.panel").Block=function(){function t(e){t.parent.call(this,e)}return t.defaults={title:e.String.t("Block"),menuItems:[{text:e.String.t("Add a new block"),"data-action":"new"},{text:e.String.t("Delete the active block"),"data-action":"delete"}]},e.editor.Panel.extend(t),t.prototype.getDraggable=function(){var t=this.getComponent();return t instanceof e.player.component.Controller?{target:t,handle:t.child(".timer"),container:t.parents(),limits:{top:0,left:0}}:t instanceof e.player.component.Media?{target:t,handle:t.child("video"),container:t.parents(),limits:{top:0,left:0}}:t instanceof e.player.component.Block?{target:t,handle:t.child(".pager"),container:t.parents(),limits:{top:0,left:0}}:!1},t.prototype.getResizable=function(){var t=this.getComponent();return t instanceof e.player.component.Controller?!1:{target:t,container:t.parents()}},t}(),e.namespace("editor.panel").Element=function(){function t(e){t.parent.call(this,e)}return t.defaults={title:e.String.t("Element"),menuItems:[{text:e.String.t("Add a new cursor"),"data-action":"new","data-type":"Cursor"},{text:e.String.t("Add a new image"),"data-action":"new","data-type":"Image"},{text:e.String.t("Add a new text element"),"data-action":"new","data-type":"Text"},{text:e.String.t("Delete the active element"),"data-action":"delete"}]},e.editor.Panel.extend(t),t.prototype.getDraggable=function(){var t=this.getComponent();return{target:t,handle:t,container:t.parents()}},t.prototype.getResizable=function(){var t=this.getComponent();return{target:t,container:t.parents()}},t}(),e.namespace("editor.panel").Page=function(){function t(e){t.parent.call(this,e)}return t.defaults={title:e.String.t("Page"),menuItems:[{text:e.String.t("Add a new page"),"data-action":"new"},{text:e.String.t("Delete the active page"),"data-action":"delete"}]},e.editor.Panel.extend(t),t}(),e.namespace("editor.panel").Text=function(){function t(n){t.parent.call(this,n),this.onComponentContentsClick=e.Function.proxy(this.onComponentContentsClick,this),this.onComponentContentsDblClick=e.Function.proxy(this.onComponentContentsDblClick,this)}return t.defaults={title:e.String.t("Text"),toolbarButtons:[],properties:{"fore-color":{type:"Color",label:e.String.t("Font color"),setter:function(t){var n=e.Color.parse(t);this.execCommand("foreColor","rgba("+n.r+","+n.g+","+n.b+","+n.a+")")}},"back-color":{type:"Color",label:e.String.t("Background color"),setter:function(t){var n=e.Color.parse(t);this.execCommand("backColor","rgba("+n.r+","+n.g+","+n.b+","+n.a+")")}},font:{type:"Select",label:e.String.t("Font"),configs:{options:{"Georgia, serif":"Georgia",'"Times New Roman", Times, serif':"Times New Roman","Arial, Helvetica, sans-serif":"Arial",'"Comic Sans MS", cursive, sans-serif':"Comic Sans MS","Impact, Charcoal, sans-serif":"Impact",'"Lucida Sans Unicode", "Lucida Grande", sans-serif':"Lucida Sans Unicode","Tahoma, Geneva, sans-serif":"Tahoma","Verdana, Geneva, sans-serif":"Verdana",'"Courier New", Courier, monospace':"Courier New",'"Lucida Console", Monaco, monospace':"Lucida Console"}},setter:function(t){this.execCommand("fontName",t)}},"font-style":{type:"Buttons",label:e.String.t("Font style"),configs:{buttons:{bold:{"data-action":"bold",title:e.String.t("Bold")},italic:{"data-action":"italic",title:e.String.t("Italic")}}},setter:function(t){this.execCommand(t)}},"font-style2":{type:"Buttons",label:"&nbsp;",configs:{buttons:{strikeThrough:{"data-action":"strikethrough",title:e.String.t("Strikethrough")},underline:{"data-action":"underline",title:e.String.t("Underline")},subscript:{"data-action":"subscript",title:e.String.t("Subscript")},superscript:{"data-action":"superscript",title:e.String.t("Superscript")}}},setter:function(t){this.execCommand(t)}},link:{type:"Buttons",label:e.String.t("Link"),configs:{buttons:{link:{"data-action":"link",title:e.String.t("Link")},unlink:{"data-action":"unlink",title:e.String.t("Unlink")}}},setter:function(t){if("link"===t){var n=this.getSelectedElement();new e.editor.overlay.LinkEditor({sumbitCallback:e.Function.proxy(this.onLinkOverlaySubmit,this),link:e.Dom.is(n,"a")?n:null,autoShow:!0})}else this.execCommand(t)}}}},e.editor.Panel.extend(t),t.prototype.onFieldValueChange=function(t){var e,n,i,o=this.getComponent();o&&(e=t.detail.field.data("name"),n=t.detail.value,i=this.getValues([e]),e in this.configs.properties&&"setter"in this.configs.properties[e]&&this.configs.properties[e].setter.call(this,n),this.triggerEvent("valueschange",{component:o,old_values:i,new_values:this.getValues([e])},!1))},t.prototype.setComponent=function(t,e){return t!==this.getComponent()&&(this.unsetComponent(!0),this.component=t,this.addClass("has-component"),t.contents.addListener("dblclick",this.onComponentContentsDblClick)),e!==!0&&this.triggerEvent("componentset",{component:t},!1),this},t.prototype.unsetComponent=function(t){var e=this.getComponent();return this.removeClass("has-component"),e&&(e.contents.attr("contenteditable","null").removeListener("dblclick",this.onComponentContentsDblClick).removeListener("click",this.onComponentContentsClick),this.component=null,t!==!0&&this.triggerEvent("componentunset",{component:e},!1)),this},t.prototype.onComponentContentsDblClick=function(){var t=this.getComponent();t._draggable&&t._draggable.disable(),t.contents.attr("contenteditable","true").removeListener("dblclick",this.onComponentContentsDblClick).addListener("click",this.onComponentContentsClick),this.execCommand("styleWithCSS",!0),this.setupFields(this.configs.properties),this.enable(),this.updateFieldValues(this.getValues(Object.keys(this.getField())),!0)},t.prototype.onComponentContentsClick=function(t){t.stopPropagation()},t.prototype.onLinkOverlaySubmit=function(t){this.execCommand("createLink",t)},t.prototype.getSelectedElement=function(){var t,e,n=this.getComponent(),i=n.contents.get(0),o=i.ownerDocument;return o.selection?(t=o.selection,e=t.createRange().parentElement()):(t=o.getSelection(),t.rangeCount>0&&(e=t.getRangeAt(0).startContainer.parentNode)),e},t.prototype.execCommand=function(t,e){var n=this.getComponent(),i=n.contents.get(0),o=i.ownerDocument;return i.focus(),o.execCommand(t,!1,e)},t}(),e.namespace("editor.panel").Toolbar=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this,"<div/>",{"class":"toolbar clearfix"}),this.title=new e.Dom("<div/>",{"class":"title"}).appendTo(this),this.buttons=new e.Dom("<div/>",{"class":"buttons"}).appendTo(this),this.configs.title&&this.title.text(this.configs.title)}return t.defaults={title:null},e.Dom.extend(t),t.prototype.getTitle=function(){return this.title},t.prototype.addButton=function(t){var n=(new e.editor.Button).data("action",t).appendTo(this.buttons);return n},t.prototype.getButton=function(t){return this.buttons.children('[data-action="'+t+'"]')},t}(),e.namespace("editor.overlay").Alert=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this,this.configs),this.addClass("alert"),this.text=new e.Dom("<div/>",{"class":"text"}).appendTo(this.contents),this.configs.text&&this.setText(this.configs.text),this.buttons=new e.Dom("<div/>",{"class":"buttons"}).appendTo(this.contents),this.configs.buttons}return t.defaults={draggable:!1,text:"",buttons:[]},e.editor.Overlay.extend(t),t.prototype.setText=function(t){this.text.text(t)},t.prototype.setButtons=function(){},t}(),e.namespace("editor.overlay").ColorSelector=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this,this.configs),this.addClass("color-selector"),this.onGradientMousemove=e.Function.proxy(this.onGradientMousemove,this),this.onAlphaMousemove=e.Function.proxy(this.onAlphaMousemove,this),this.setupUI()}return t.defaults={parent:".metaScore-editor",draggable:!1,selectCallback:e.Function.emptyFn,cancelCallback:e.Function.emptyFn},e.editor.Overlay.extend(t),t.prototype.setupUI=function(){this.gradient=new e.Dom("<div/>",{"class":"gradient"}).appendTo(this.contents),this.gradient.canvas=new e.Dom("<canvas/>",{width:"255",height:"255"}).addListener("click",e.Function.proxy(this.onGradientClick,this)).addListener("mousedown",e.Function.proxy(this.onGradientMousedown,this)).addListener("mouseup",e.Function.proxy(this.onGradientMouseup,this)).appendTo(this.gradient),this.gradient.position=new e.Dom("<div/>",{"class":"position"}).appendTo(this.gradient),this.alpha=new e.Dom("<div/>",{"class":"alpha"}).appendTo(this.contents),this.alpha.canvas=new e.Dom("<canvas/>",{width:"20",height:"255"}).addListener("click",e.Function.proxy(this.onAlphaClick,this)).addListener("mousedown",e.Function.proxy(this.onAlphaMousedown,this)).addListener("mouseup",e.Function.proxy(this.onAlphaMouseup,this)).appendTo(this.alpha),this.alpha.position=new e.Dom("<div/>",{"class":"position"}).appendTo(this.alpha),this.controls=new e.Dom("<div/>",{"class":"controls"}).appendTo(this.contents),this.controls.r=new e.Dom("<input/>",{type:"number",min:"0",max:"255",name:"r"}).addListener("input",e.Function.proxy(this.onControlInput,this)),new e.Dom("<div/>",{"class":"control-wrapper"}).append(new e.Dom("<label/>",{text:"R","for":"r"})).append(this.controls.r).appendTo(this.controls),this.controls.g=new e.Dom("<input/>",{type:"number",min:"0",max:"255",name:"g"}).addListener("input",e.Function.proxy(this.onControlInput,this)),new e.Dom("<div/>",{"class":"control-wrapper"}).append(new e.Dom("<label/>",{text:"G","for":"g"})).append(this.controls.g).appendTo(this.controls),this.controls.b=new e.Dom("<input/>",{type:"number",min:"0",max:"255",name:"b"}).addListener("input",e.Function.proxy(this.onControlInput,this)),new e.Dom("<div/>",{"class":"control-wrapper"}).append(new e.Dom("<label/>",{text:"B","for":"b"})).append(this.controls.b).appendTo(this.controls),this.controls.a=new e.Dom("<input/>",{type:"number",min:"0",max:"1",step:"0.01",name:"a"}).addListener("input",e.Function.proxy(this.onControlInput,this)),new e.Dom("<div/>",{"class":"control-wrapper"}).append(new e.Dom("<label/>",{text:"A","for":"a"})).append(this.controls.a).appendTo(this.controls),this.controls.current=new e.Dom("<canvas/>"),new e.Dom("<div/>",{"class":"canvas-wrapper current"}).append(this.controls.current).appendTo(this.controls),this.controls.previous=new e.Dom("<canvas/>"),new e.Dom("<div/>",{"class":"canvas-wrapper previous"}).append(this.controls.previous).appendTo(this.controls),this.controls.cancel=new e.editor.Button({label:"Cancel"}).addClass("cancel").addListener("click",e.Function.proxy(this.onCancelClick,this)).appendTo(this.controls),this.controls.apply=new e.editor.Button({label:"Apply"}).addClass("apply").addListener("click",e.Function.proxy(this.onApplyClick,this)).appendTo(this.controls),this.fillGradient()
},t.prototype.setValue=function(t){return this.previous_value=t,this.fillPrevious(),this.updateValue(t),this},t.prototype.updateValue=function(t,n,i,o){var s;this.value=this.value||{},e.Var.is(t,"object")||(t=e.Color.parse(t)),"r"in t&&(this.value.r=parseInt(t.r,10)),"g"in t&&(this.value.g=parseInt(t.g,10)),"b"in t&&(this.value.b=parseInt(t.b,10)),"a"in t&&(this.value.a=parseFloat(t.a)),n!==!1&&this.fillAlpha(),o!==!1&&(this.controls.r.val(this.value.r),this.controls.g.val(this.value.g),this.controls.b.val(this.value.b),this.controls.a.val(this.value.a)),i!==!1&&(s=e.Color.rgb2hsv(this.value),this.gradient.position.css("left",255*(1-s.h)+"px"),this.gradient.position.css("top",127.5*s.s+127.5*(1-s.v/255)+"px"),this.alpha.position.css("top",255*(1-this.value.a)+"px")),this.fillCurrent()},t.prototype.fillPrevious=function(){var t=this.controls.previous.get(0).getContext("2d");t.fillStyle="rgba("+this.previous_value.r+","+this.previous_value.g+","+this.previous_value.b+","+this.previous_value.a+")",t.clearRect(0,0,t.canvas.width,t.canvas.height),t.fillRect(0,0,t.canvas.width,t.canvas.height)},t.prototype.fillCurrent=function(){var t=this.controls.current.get(0).getContext("2d");t.fillStyle="rgba("+this.value.r+","+this.value.g+","+this.value.b+","+this.value.a+")",t.clearRect(0,0,t.canvas.width,t.canvas.height),t.fillRect(0,0,t.canvas.width,t.canvas.height)},t.prototype.fillGradient=function(){var t,e=this.gradient.canvas.get(0).getContext("2d");t=e.createLinearGradient(0,0,e.canvas.width,0),t.addColorStop(0,"rgb(255, 0, 0)"),t.addColorStop(.15,"rgb(255, 0, 255)"),t.addColorStop(.33,"rgb(0, 0, 255)"),t.addColorStop(.49,"rgb(0, 255, 255)"),t.addColorStop(.67,"rgb(0, 255, 0)"),t.addColorStop(.84,"rgb(255, 255, 0)"),t.addColorStop(1,"rgb(255, 0, 0)"),e.fillStyle=t,e.fillRect(0,0,e.canvas.width,e.canvas.height),t=e.createLinearGradient(0,0,0,e.canvas.height),t.addColorStop(0,"rgba(255, 255, 255, 1)"),t.addColorStop(.5,"rgba(255, 255, 255, 0)"),t.addColorStop(.5,"rgba(0, 0, 0, 0)"),t.addColorStop(1,"rgba(0, 0, 0, 1)"),e.fillStyle=t,e.fillRect(0,0,e.canvas.width,e.canvas.height)},t.prototype.fillAlpha=function(){var t,e=this.alpha.canvas.get(0).getContext("2d");t=e.createLinearGradient(0,0,0,e.canvas.height),t.addColorStop(0,"rgb("+this.value.r+","+this.value.g+","+this.value.b+")"),t.addColorStop(1,"transparent"),e.fillStyle=t,e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillRect(0,0,e.canvas.width,e.canvas.height)},t.prototype.onControlInput=function(){this.updateValue({r:this.controls.r.val(),g:this.controls.g.val(),b:this.controls.b.val(),a:this.controls.a.val()},!0,!0,!1)},t.prototype.onGradientMousedown=function(t){this.gradient.canvas.addListener("mousemove",this.onGradientMousemove),t.stopPropagation()},t.prototype.onGradientMouseup=function(t){this.gradient.canvas.removeListener("mousemove",this.onGradientMousemove),t.stopPropagation()},t.prototype.onGradientClick=function(t){var e=t.target.getBoundingClientRect(),n=t.pageX-e.left,i=t.pageY-e.top,o=this.gradient.canvas.get(0).getContext("2d"),s=o.getImageData(n,i,1,1),a=this.value;this.gradient.position.css("left",n+"px"),this.gradient.position.css("top",i+"px"),a.r=s.data[0],a.g=s.data[1],a.b=s.data[2],this.updateValue(a,!0,!1),t.stopPropagation()},t.prototype.onGradientMousemove=t.prototype.onGradientClick,t.prototype.onAlphaMousedown=function(t){this.alpha.canvas.addListener("mousemove",this.onAlphaMousemove),t.stopPropagation()},t.prototype.onAlphaMouseup=function(t){this.alpha.canvas.removeListener("mousemove",this.onAlphaMousemove),t.stopPropagation()},t.prototype.onAlphaClick=function(t){var e=t.target.getBoundingClientRect(),n=t.pageY-e.top,i=this.alpha.canvas.get(0).getContext("2d"),o=i.getImageData(0,n,1,1),s=this.value;this.alpha.position.css("top",n+"px"),s.a=Math.round(100*(o.data[3]/255))/100,this.updateValue(s,!1,!1),t.stopPropagation()},t.prototype.onAlphaMousemove=t.prototype.onAlphaClick,t.prototype.onApplyClick=function(t){this.configs.selectCallback(this.value,this),t.stopPropagation()},t.prototype.onCancelClick=function(t){this.hide(),t.stopPropagation()},t}(),e.namespace("editor.overlay").GuideSelector=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this,this.configs),this.addClass("guide-selector")}return t.defaults={toolbar:!0,title:e.String.t("Select a guide"),url:null,selectCallback:e.Function.emptyFn,hideOnSelect:!0},e.editor.Overlay.extend(t),t.prototype.show=function(){this.loadmask=new e.editor.overlay.LoadMask({autoShow:!0}),e.Ajax.get(this.configs.url,{success:e.Function.proxy(this.onLoadSuccess,this),error:e.Function.proxy(this.onLoadError,this)})},t.prototype.onLoadSuccess=function(t){var n,i,o=this.getContents(),s=JSON.parse(t.response);n=new e.Dom("<table/>",{"class":"guides"}).appendTo(o),e.Object.each(s,function(t,o){i=new e.Dom("<tr/>",{"class":"guide guide-"+o.id}).addListener("click",e.Function.proxy(this.onGuideClick,this,[o])).appendTo(n),new e.Dom("<td/>",{"class":"thumbnail"}).append(new e.Dom("<img/>",{src:o.thumbnail})).appendTo(i),new e.Dom("<td/>",{"class":"details"}).append(new e.Dom("<h1/>",{"class":"title",text:o.title})).append(new e.Dom("<p/>",{"class":"description",text:o.description})).append(new e.Dom("<h2/>",{"class":"author",text:o.author.name})).appendTo(i)},this),this.loadmask.hide(),delete this.loadmask,this.configs.modal&&this.mask.appendTo(this.configs.parent),this.appendTo(this.configs.parent)},t.prototype.onLoadError=function(){},t.prototype.onGuideClick=function(t){this.configs.selectCallback(t),this.configs.hideOnSelect&&this.hide()},t}(),e.namespace("editor.overlay").LinkEditor=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this,this.configs),this.addClass("link-editor"),this.setupUI(),this.updateFields(),this.configs.link&&this.setValuesFromLink(this.configs.link)}return t.defaults={toolbar:!0,title:e.String.t("Link editor"),link:null,sumbitCallback:e.Function.emptyFn},e.editor.Overlay.extend(t),t.prototype.setupUI=function(){var t=this.getContents();this.fields=new e.Dom("<div/>",{"class":"fields"}).appendTo(t),this.type=new e.Dom("<div/>",{"class":"field-wrapper type"}).appendTo(this.fields),this.type.label=new e.Dom("<label/>",{"for":"type",text:e.String.t("Type")}).appendTo(this.type),this.type.field=new e.editor.field.Select({options:{url:e.String.t("URL"),page:e.String.t("Page"),time:e.String.t("Time")}}).attr("id","type").addListener("valuechange",e.Function.proxy(this.onTypeChange,this)).appendTo(this.type),this.urlwrapper=new e.Dom("<div/>",{"class":"url-wrapper"}).appendTo(this.fields),this.url=new e.Dom("<div/>",{"class":"field-wrapper url"}).appendTo(this.urlwrapper),this.url.label=new e.Dom("<label/>",{"for":"url",text:e.String.t("URL")}).appendTo(this.url),this.url.field=(new e.editor.field.Text).attr("id","url").appendTo(this.url),this.pagewrapper=new e.Dom("<div/>",{"class":"page-wrapper"}).appendTo(this.fields),this.page=new e.Dom("<div/>",{"class":"field-wrapper page"}).appendTo(this.pagewrapper),this.page.label=new e.Dom("<label/>",{"for":"page",text:e.String.t("Page")}).appendTo(this.page),this.page.field=(new e.editor.field.Number).attr("id","page").appendTo(this.page),this.timewrapper=new e.Dom("<div/>",{"class":"page-wrapper"}).appendTo(this.fields),this.inTime=new e.Dom("<div/>",{"class":"field-wrapper inTime"}).appendTo(this.timewrapper),this.inTime.label=new e.Dom("<label/>",{"for":"inTime",text:e.String.t("Start time")}).appendTo(this.inTime),this.inTime.field=new e.editor.field.Time({inButton:!0}).attr("id","inTime").appendTo(this.inTime),this.outTime=new e.Dom("<div/>",{"class":"field-wrapper outTime"}).appendTo(this.timewrapper),this.outTime.label=new e.Dom("<label/>",{"for":"outTime",text:e.String.t("End time")}).appendTo(this.outTime),this.outTime.field=new e.editor.field.Time({inButton:!0}).attr("id","outTime").appendTo(this.outTime),this.rIndex=new e.Dom("<div/>",{"class":"field-wrapper rIndex"}).appendTo(this.timewrapper),this.rIndex.label=new e.Dom("<label/>",{"for":"rIndex",text:e.String.t("Reading index")}).appendTo(this.rIndex),this.rIndex.field=(new e.editor.field.Number).attr("id","rIndex").appendTo(this.rIndex),this.apply=new e.editor.Button({label:"Apply"}).addClass("apply").addListener("click",e.Function.proxy(this.onApplyClick,this)).appendTo(t),this.cancel=new e.editor.Button({label:"Cancel"}).addClass("cancel").addListener("click",e.Function.proxy(this.onCancelClick,this)).appendTo(t)},t.prototype.setValuesFromLink=function(t){var e;(e=t.hash.match(/^#p=(\d+)/))?(this.type.field.setValue("page"),this.page.field.setValue(e[1])):(e=t.hash.match(/^#t=(\d+),(\d+)&r=(\d+)/))?(this.type.field.setValue("time"),this.inTime.field.setValue(e[1]),this.outTime.field.setValue(e[2]),this.rIndex.field.setValue(e[3])):(this.type.field.setValue("url"),this.url.field.setValue(t.href))},t.prototype.updateFields=function(){var t=this.type.field.getValue();switch(t){case"page":this.urlwrapper.hide(),this.pagewrapper.show(),this.timewrapper.hide();break;case"time":this.urlwrapper.hide(),this.pagewrapper.hide(),this.timewrapper.show();break;default:this.urlwrapper.show(),this.pagewrapper.hide(),this.timewrapper.hide()}},t.prototype.onTypeChange=function(){this.updateFields()},t.prototype.onApplyClick=function(){var t,e=this.type.field.getValue();switch(e){case"page":t="#p="+this.page.field.getValue();break;case"time":t="#t="+this.inTime.field.getValue()+","+this.outTime.field.getValue(),t+="&r="+this.rIndex.field.getValue();break;default:t=this.url.field.getValue()}this.configs.sumbitCallback(t,this),this.hide()},t.prototype.onCancelClick=function(){this.hide()},t}(),e.namespace("editor.overlay").LoadMask=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this,this.configs),this.addClass("loadmask"),this.text=new e.Dom("<div/>",{"class":"text",text:this.configs.text}).appendTo(this.contents)}return t.defaults={draggable:!1,text:e.String.t("Loading...")},e.editor.Overlay.extend(t),t}(),e.namespace("editor.overlay").Toolbar=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this,"<div/>",{"class":"toolbar clearfix"}),this.title=new e.Dom("<div/>",{"class":"title"}).appendTo(this),this.buttons=new e.Dom("<div/>",{"class":"buttons"}).appendTo(this),this.configs.title&&this.title.text(this.configs.title)}return t.defaults={title:null},e.Dom.extend(t),t.prototype.getTitle=function(){return this.title},t.prototype.addButton=function(t){var n=(new e.editor.Button).data("action",t).appendTo(this.buttons);return n},t.prototype.getButton=function(t){return this.buttons.children('[data-action="'+t+'"]')},t}(),e.Player=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this,"<iframe></iframe>",{"class":"metaScore-player"}),this.appendTo(this.configs.container),this.head=new e.Dom(this.get(0).contentDocument.head),this.body=new e.Dom(this.get(0).contentDocument.body),this.configs.url&&this.load()}return t.defaults={url:"",ajax:{},keyboard:!0},e.Dom.extend(t),t.prototype.onControllerButtonClick=function(t){var n=e.Dom.data(t.target,"action");switch(n){case"rewind":this.media.reset();break;case"play":this.media.isPlaying()?this.media.pause():this.media.play()}t.stopPropagation()},t.prototype.onMediaPlay=function(){this.controller.addClass("playing")},t.prototype.onMediaPause=function(){this.controller.removeClass("playing")},t.prototype.onMediaTimeUpdate=function(t){var e=t.detail.media.getTime();this.controller.updateTime(e)},t.prototype.onPageActivate=function(t){var e=t.target._metaScore,n=t.detail.page;e.getProperty("synched")&&this.media.setTime(n.getProperty("start-time"))},t.prototype.onElementTime=function(t){this.linkcuepoint&&this.linkcuepoint.destroy(),this.media.setTime(t.detail.value),t.detail.forcePlay&&this.media.play(),t.detail.stop&&(this.linkcuepoint=new e.player.CuePoint({media:this.media,inTime:t.detail.stop,onStart:e.Function.proxy(this.onLinkCuePointStart,this)}))},t.prototype.onLinkCuePointStart=function(t){t.destroy(),this.setReadingIndex(0),this.media.pause()},t.prototype.onElementReadingIndex=function(t){this.setReadingIndex(t.detail.value),t.stopPropagation()},t.prototype.onComponenetPropChange=function(t){switch(t.detail.property){case"start-time":case"end-time":t.detail.component.setCuePoint({media:this.media})}},t.prototype.load=function(){var t;this.getBody().addClass("loading"),t=e.Object.extend({},{success:e.Function.proxy(this.onLoadSuccess,this),error:e.Function.proxy(this.onLoadError,this)},this.configs.ajax),e.Ajax.get(this.configs.url,t)},t.prototype.onLoadSuccess=function(t){var n=JSON.parse(t.response);this.getBody().data("id",n.id),n.css&&e.Array.each(n.css,function(t,e){this.addCSS(e)},this),this.media=new e.player.component.Media(n.media).addListener("play",e.Function.proxy(this.onMediaPlay,this)).addListener("pause",e.Function.proxy(this.onMediaPause,this)).addListener("timeupdate",e.Function.proxy(this.onMediaTimeUpdate,this)).appendTo(this.getBody()),this.controller=new e.player.component.Controller(n.controller).addDelegate(".buttons button","click",e.Function.proxy(this.onControllerButtonClick,this)).appendTo(this.getBody()),this.rindex_css=new e.StyleSheet({container:this.getBody()}),e.Array.each(n.blocks,function(t,e){this.addBlock(e)},this),this.media.reset(),this.getBody().removeClass("loading"),this.triggerEvent("loadsuccess",{player:this},!0,!1)},t.prototype.onLoadError=function(){this.getBody().removeClass("loading"),this.triggerEvent("loaderror",{player:this},!0,!1)},t.prototype.getId=function(){return this.getBody().data("id")},t.prototype.getHead=function(){return this.head},t.prototype.getBody=function(){return this.body},t.prototype.getComponents=function(t){var e=".metaScore-component";return t&&(e+="."+t),this.getBody().children(e)},t.prototype.addBlock=function(t){var n;return n=t instanceof e.player.component.Block?t:new e.player.component.Block(e.Object.extend({},t,{container:this.getBody(),listeners:{propchange:e.Function.proxy(this.onComponenetPropChange,this)}})).addListener("pageactivate",e.Function.proxy(this.onPageActivate,this)).addDelegate(".element","time",e.Function.proxy(this.onElementTime,this)).addDelegate(".element","rindex",e.Function.proxy(this.onElementReadingIndex,this)),this.triggerEvent("blockadd",{player:this,block:n},!0,!1),n},t.prototype.addCSS=function(t){new e.Dom("<link/>",e.Object.extend({},t,{rel:"stylesheet",type:"text/css"})).appendTo(this.getHead())},t.prototype.setReadingIndex=function(t,e){this.rindex_css.removeRules(),0!==t&&(this.rindex_css.addRule('.metaScore-component.element[data-r-index="'+t+'"]:not([data-start-time]) .contents',"display: block;"),this.rindex_css.addRule('.metaScore-component.element[data-r-index="'+t+'"].active .contents',"display: block;")),e!==!0&&this.triggerEvent("rindex",{player:this,value:t},!0,!1)},t}(),e.namespace("player").Component=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this,"<div/>",{"class":"metaScore-component"}),this.get(0)._metaScore=this,this.configs.container&&this.appendTo(this.configs.container),e.Object.each(this.configs.listeners,function(t,e){this.addListener(t,e)},this),this.setupDOM(),e.Object.each(this.configs,function(t,e){this.setProperty(t,e)},this)}return e.Dom.extend(t),t.defaults={properties:{}},t.prototype.setupDOM=function(){},t.prototype.getProperty=function(t){return t in this.configs.properties&&"getter"in this.configs.properties[t]?this.configs.properties[t].getter.call(this):void 0},t.prototype.getProperties=function(t){var n,i={};return e.Object.each(this.configs.properties,function(e,o){"getter"in o&&(n=o.getter.call(this,t),null!==n&&(i[e]=n))},this),i},t.prototype.setProperty=function(t,e){t in this.configs.properties&&"setter"in this.configs.properties[t]&&(this.configs.properties[t].setter.call(this,e),this.triggerEvent("propchange",{component:this,property:t,value:e}))},Element.prototype.setCuePoint=function(){},t}(),e.namespace("player").CuePoint=function(){function t(t){this.configs=this.getConfigs(t),this.id=e.String.uuid(),this.running=!1,this.inTimer=null,this.outTimer=null,this.launch=e.Function.proxy(this.launch,this),this.stop=e.Function.proxy(this.stop,this),this.onMediaTimeUpdate=e.Function.proxy(this.onMediaTimeUpdate,this),this.configs.media.addListener("timeupdate",this.onMediaTimeUpdate)}return e.Evented.extend(t),t.defaults={media:null,inTime:null,outTime:null,onStart:null,onUpdate:null,onEnd:null},t.prototype.onMediaTimeUpdate=function(){var t=this.configs.media.getTime();this.running?(!this.outTimer&&null!==this.configs.outTime&&t>=this.configs.outTime-.5&&(this.outTimer=setTimeout(this.stop,Math.max(0,this.configs.outTime-t))),e.Var.is(this.configs.onUpdate,"function")&&this.configs.onUpdate(this,t)):!this.inTimer&&t>=this.configs.inTime-.5&&(null===this.configs.outTime||this.configs.outTime>=t)&&(this.inTimer=setTimeout(this.launch,Math.max(0,this.configs.inTime-t)))},t.prototype.launch=function(){this.running||(this.inTimer&&(clearTimeout(this.inTimer),this.inTimer=null),e.Var.is(this.configs.onStart,"function")&&this.configs.onStart(this),null===this.configs.outTime||!this.configs.onUpdate&&!this.configs.onEnd?this.stop():this.running=!0)},t.prototype.stop=function(t){this.inTimer&&(clearTimeout(this.inTimer),this.inTimer=null),this.outTimer&&(clearTimeout(this.outTimer),this.outTimer=null),t!==!1&&e.Var.is(this.configs.onEnd,"function")&&this.configs.onEnd(this),this.running=!1},t.prototype.destroy=function(){this.stop(!1),this.configs.media.removeListener("timeupdate",this.onMediaTimeUpdate)},t}(),e.namespace("player").Pager=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this,"<div/>",{"class":"pager"}),this.count=new e.Dom("<div/>",{"class":"count"}).appendTo(this),this.buttons=new e.Dom("<div/>",{"class":"buttons"}).addListener("mousedown",function(t){t.stopPropagation()}).appendTo(this),this.buttons.first=new e.Dom("<div/>",{"class":"button","data-action":"first"}).appendTo(this.buttons),this.buttons.previous=new e.Dom("<div/>",{"class":"button","data-action":"previous"}).appendTo(this.buttons),this.buttons.next=new e.Dom("<div/>",{"class":"button","data-action":"next"}).appendTo(this.buttons)}return e.Dom.extend(t),t.prototype.updateCount=function(t,n){this.count.text(e.String.t("page !current/!count",{"!current":t+1,"!count":n})),this.buttons.first.toggleClass("inactive",0===t),this.buttons.previous.toggleClass("inactive",0===t),this.buttons.next.toggleClass("inactive",t>=n-1)},t}(),e.namespace("player.component").Block=function(){function t(e){t.parent.call(this,e)}return e.player.Component.extend(t),t.defaults={container:null,properties:{name:{type:"Text",label:e.String.t("Name"),getter:function(){return this.data("name")},setter:function(t){this.data("name",t)}},x:{type:"Number",label:e.String.t("X"),getter:function(){return parseInt(this.css("left"),10)},setter:function(t){this.css("left",t+"px")}},y:{type:"Number",label:e.String.t("Y"),getter:function(){return parseInt(this.css("top"),10)},setter:function(t){this.css("top",t+"px")}},width:{type:"Number",label:e.String.t("Width"),getter:function(){return parseInt(this.css("width"),10)},setter:function(t){this.css("width",t+"px")}},height:{type:"Number",label:e.String.t("Height"),getter:function(){return parseInt(this.css("height"),10)},setter:function(t){this.css("height",t+"px")}},"background-color":{type:"Color",label:e.String.t("Background color"),getter:function(t){return this.css("background-color",void 0,t)},setter:function(t){var n=e.Color.parse(t);this.css("background-color","rgba("+n.r+","+n.g+","+n.b+","+n.a+")")}},"background-image":{type:"Image",label:e.String.t("Background image"),getter:function(t){var n=this.css("background-image",void 0,t);return"none"!==n&&e.Var.is(n,"string")?n.replace(/^url\(["']?/,"").replace(/["']?\)$/,""):null},setter:function(t){t="none"!==t&&e.Var.is(t,"string")&&t.length>0?"url("+t+")":null,this.css("background-image",t)}},"border-width":{type:"Number",label:e.String.t("Border width"),getter:function(t){var e=this.css("border-width",void 0,t);return null!==e?parseInt(e,10):null},setter:function(t){this.css("border-width",t+"px")}},"border-color":{type:"Color",label:e.String.t("Border color"),getter:function(t){return this.css("border-color",void 0,t)},setter:function(t){var n=e.Color.parse(t);this.css("border-color","rgba("+n.r+","+n.g+","+n.b+","+n.a+")")}},synched:{type:"Boolean",label:e.String.t("Synchronized pages ?"),getter:function(){return"true"===this.data("synched")},setter:function(t){this.data("synched",t)}},pages:{editable:!1,getter:function(t){var e=[];return this.getPages().each(function(n,i){e.push(i._metaScore.getProperties(t))},this),e},setter:function(t){e.Array.each(t,function(t,e){this.addPage(e)},this),this.setActivePage(0)}}}},t.prototype.setupDOM=function(){t.parent.prototype.setupDOM.call(this),this.addClass("block"),this.pages=new e.Dom("<div/>",{"class":"pages"}).addDelegate(".page","cuepointstart",e.Function.proxy(this.onPageCuePointStart,this)).addDelegate(".element","page",e.Function.proxy(this.onElementPage,this)).appendTo(this),this.pager=(new e.player.Pager).addDelegate(".button","click",e.Function.proxy(this.onPagerClick,this)).appendTo(this)},t.prototype.onPageCuePointStart=function(t){this.setActivePage(t.target._metaScore,!0)},t.prototype.onElementPage=function(t){this.setActivePage(t.detail.value)},t.prototype.onPagerClick=function(t){var n,i=!e.Dom.hasClass(t.target,"inactive");if(i)switch(n=e.Dom.data(t.target,"action")){case"first":this.setActivePage(0);break;case"previous":this.setActivePage(this.getActivePageIndex()-1);break;case"next":this.setActivePage(this.getActivePageIndex()+1)}t.stopPropagation()},t.prototype.getPages=function(){return this.pages.children(".page")},t.prototype.addPage=function(t){var n;return t instanceof e.player.component.Page?(n=t,n.appendTo(this.pages)):n=new e.player.component.Page(e.Object.extend({},t,{container:this.pages})),this.setActivePage(n),n},t.prototype.removePage=function(t){var e;return t.remove(),0>=this.getPageCount()?this.addPage():t.hasClass("active")&&(e=Math.max(0,this.getActivePageIndex()-1),this.setActivePage(e)),t},t.prototype.getActivePage=function(){var t=(this.getPages(),this.getActivePageIndex());return 0>t?null:this.getPages().get(t)._metaScore},t.prototype.getActivePageIndex=function(){var t=this.getPages(),e=t.index(".active");return e},t.prototype.getPageCount=function(){return this.getPages().count()},t.prototype.setActivePage=function(t,n){var i=this.getPages();t instanceof e.player.component.Page||(t=i.get(parseInt(t,10))._metaScore),t&&(i.removeClass("active"),t.addClass("active"),this.updatePager(),n!==!0&&this.triggerEvent("pageactivate",{page:t}))},t.prototype.updatePager=function(){var t=this.getActivePageIndex(),e=this.getPageCount();this.pager.updateCount(t,e)},t}(),e.namespace("player.component").Controller=function(){function t(e){t.parent.call(this,e)}return e.player.Component.extend(t),t.defaults={properties:{x:{type:"Number",label:e.String.t("X"),getter:function(){return parseInt(this.css("left"),10)},setter:function(t){this.css("left",t+"px")}},y:{type:"Number",label:e.String.t("Y"),getter:function(){return parseInt(this.css("top"),10)},setter:function(t){this.css("top",t+"px")}}}},t.prototype.setupDOM=function(){t.parent.prototype.setupDOM.call(this),this.addClass("controller"),this.timer=new e.Dom("<div/>",{"class":"timer",text:"00:00:00.00"}).appendTo(this),this.rewind_btn=new e.Dom("<button/>").data("action","rewind"),this.play_btn=new e.Dom("<button/>").data("action","play"),new e.Dom("<div/>",{"class":"buttons"}).append(this.rewind_btn).append(this.play_btn).appendTo(this)},t.prototype.updateTime=function(t){var n=e.String.pad(parseInt(t/10%100,10),2,"0","left"),i=e.String.pad(parseInt(t/1e3%60,10),2,"0","left"),o=e.String.pad(parseInt(t/6e4%60,10),2,"0","left"),s=e.String.pad(parseInt(t/36e5,10),2,"0","left");this.timer.text(s+":"+o+":"+i+"."+n)},t}(),e.namespace("player.component").Element=function(){function t(e){t.parent.call(this,e)}return e.player.Component.extend(t),t.defaults={properties:{name:{type:"Text",label:e.String.t("Name"),getter:function(){return this.data("name")},setter:function(t){this.data("name",t)}},type:{editable:!1,getter:function(){return this.data("type")},setter:function(t){this.data("type",t)}},x:{type:"Number",label:e.String.t("X"),getter:function(){return parseInt(this.css("left"),10)},setter:function(t){this.css("left",t+"px")}},y:{type:"Number",label:e.String.t("Y"),getter:function(){return parseInt(this.css("top"),10)},setter:function(t){this.css("top",t+"px")}},width:{type:"Number",label:e.String.t("Width"),getter:function(){return parseInt(this.css("width"),10)},setter:function(t){this.css("width",t+"px")}},height:{type:"Number",label:e.String.t("Height"),getter:function(){return parseInt(this.css("height"),10)},setter:function(t){this.css("height",t+"px")}},"r-index":{type:"Number",label:e.String.t("Reading index"),configs:{min:0},getter:function(){var t=this.data("r-index");return null!==t?parseInt(t,10):null},setter:function(t){this.data("r-index",t)}},"z-index":{type:"Number",label:e.String.t("Display index"),getter:function(t){var e=this.css("z-index",void 0,t);return null!==e?parseInt(e,10):null},setter:function(t){this.css("z-index",t)}},"background-color":{type:"Color",label:e.String.t("Background color"),getter:function(t){return this.contents.css("background-color",void 0,t)},setter:function(t){var n=e.Color.parse(t);this.contents.css("background-color","rgba("+n.r+","+n.g+","+n.b+","+n.a+")")}},"background-image":{type:"Image",label:e.String.t("Background image"),getter:function(t){var n=this.contents.css("background-image",void 0,t);return"none"!==n&&e.Var.is(n,"string")?n.replace(/^url\(["']?/,"").replace(/["']?\)$/,""):null},setter:function(t){t="none"!==t&&e.Var.is(t,"string")&&t.length>0?"url("+t+")":null,this.contents.css("background-image",t)}},"border-width":{type:"Number",label:e.String.t("Border width"),getter:function(t){var e=this.contents.css("border-width",void 0,t);return null!==e?parseInt(e,10):null},setter:function(t){this.contents.css("border-width",t+"px")}},"border-color":{type:"Color",label:e.String.t("Border color"),getter:function(t){return this.contents.css("border-color",void 0,t)},setter:function(t){var n=e.Color.parse(t);this.contents.css("border-color","rgba("+n.r+","+n.g+","+n.b+","+n.a+")")}},"border-radius":{type:"BorderRadius",label:e.String.t("Border radius"),getter:function(t){return this.contents.css("border-radius",void 0,t)},setter:function(t){this.contents.css("border-radius",t)}},opacity:{type:"Number",label:e.String.t("Opacity"),configs:{min:0,max:1,step:.1},getter:function(t){return this.contents.css("opacity",void 0,t)},setter:function(t){this.contents.css("opacity",t)}},"start-time":{type:"Time",label:e.String.t("Start time"),configs:{checkbox:!0,inButton:!0,outButton:!0},getter:function(){var t=parseFloat(this.data("start-time"));return isNaN(t)?null:t},setter:function(t){this.data("start-time",isNaN(t)?null:t)}},"end-time":{type:"Time",label:e.String.t("End time"),configs:{checkbox:!0,inButton:!0,outButton:!0},getter:function(){var t=parseFloat(this.data("end-time"));return isNaN(t)?null:t},setter:function(t){this.data("end-time",isNaN(t)?null:t)}}}},t.prototype.setupDOM=function(){t.parent.prototype.setupDOM.call(this),this.addClass("element"),this.contents=new e.Dom("<div/>",{"class":"contents"}).appendTo(this)},t.prototype.setCuePoint=function(t){return this.cuepoint&&this.cuepoint.destroy(),this.cuepoint=new e.player.CuePoint(e.Object.extend({},t,{inTime:this.getProperty("start-time"),outTime:this.getProperty("end-time"),onStart:e.Function.proxy(this.onCuePointStart,this),onEnd:e.Function.proxy(this.onCuePointEnd,this)})),this.cuepoint},t.prototype.onCuePointStart=function(){this.addClass("active")},t.prototype.onCuePointEnd=function(){this.removeClass("active")},t}(),e.namespace("player.component").Media=function(){function t(e){t.parent.call(this,e),this.playing=!1}return e.player.Component.extend(t),t.defaults={type:"audio",sources:[],useFrameAnimation:!0,properties:{x:{type:"Number",label:e.String.t("X"),getter:function(){return parseInt(this.css("left"),10)},setter:function(t){this.css("left",t+"px")}},y:{type:"Number",label:e.String.t("Y"),getter:function(){return parseInt(this.css("top"),10)},setter:function(t){this.css("top",t+"px")}},width:{type:"Number",label:e.String.t("Width"),getter:function(){return parseInt(this.css("width"),10)},setter:function(t){this.css("width",t+"px")}},height:{type:"Number",label:e.String.t("Height"),getter:function(){return parseInt(this.css("height"),10)},setter:function(t){this.css("height",t+"px")}}}},t.prototype.setupDOM=function(){var n="";t.parent.prototype.setupDOM.call(this),this.addClass("media "+this.configs.type),e.Array.each(this.configs.sources,function(t,e){n+='<source src="'+e.url+'" type="'+e.mime+'"></source>'}),this.el=new e.Dom("<"+this.configs.type+">"+n+"</"+this.configs.type+">",{preload:"auto"}).appendTo(this),this.dom=this.el.get(0),this.el.addListener("canplay",e.Function.proxy(this.onCanPlay,this)).addListener("play",e.Function.proxy(this.onPlay,this)).addListener("pause",e.Function.proxy(this.onPause,this)).addListener("timeupdate",e.Function.proxy(this.onTimeUpdate,this)).addListener("volumechange",e.Function.proxy(this.onVolumeChange,this)).addListener("ended",e.Function.proxy(this.onEnded,this)),this.configs.useFrameAnimation&&this.el.addListener("play",e.Function.proxy(this.triggerTimeUpdate,this))},t.prototype.onCanPlay=function(){this.triggerEvent("canplay")},t.prototype.onPlay=function(){this.playing=!0,this.triggerEvent("play")},t.prototype.onPause=function(){this.playing=!1,this.triggerEvent("pause")},t.prototype.onTimeUpdate=function(t){t instanceof CustomEvent||t.stopPropagation(),this.configs.useFrameAnimation||this.triggerTimeUpdate(!1)},t.prototype.onVolumeChange=function(){this.triggerEvent("volumechange")},t.prototype.onEnded=function(){this.triggerEvent("ended")},t.prototype.isPlaying=function(){return this.playing},t.prototype.reset=function(t){this.setTime(0),t!==!0&&this.triggerEvent("reset")},t.prototype.play=function(t){this.dom.play(),t!==!0&&this.triggerEvent("play")},t.prototype.pause=function(t){this.dom.pause(),t!==!0&&this.triggerEvent("pause")},t.prototype.stop=function(t){this.setTime(0),this.pause(!0),this.triggerTimeUpdate(!1),t!==!0&&this.triggerEvent("stop")},t.prototype.triggerTimeUpdate=function(t){t!==!1&&this.isPlaying()&&window.requestAnimationFrame(e.Function.proxy(this.triggerTimeUpdate,this)),this.triggerEvent("timeupdate",{media:this})},t.prototype.setTime=function(t){var e=this.isPlaying();e&&this.pause(!0),this.dom.currentTime=parseFloat(t)/1e3,e&&this.play(!0),this.triggerTimeUpdate(!1)},t.prototype.getTime=function(){return 1e3*parseFloat(this.dom.currentTime)},t.prototype.getDuration=function(){return 1e3*parseFloat(this.dom.duration)},t}(),e.namespace("player.component").Page=function(){function t(e){t.parent.call(this,e)}return e.player.Component.extend(t),t.defaults={properties:{"background-color":{type:"Color",label:e.String.t("Background color"),getter:function(t){return this.css("background-color",void 0,t)},setter:function(t){var n=e.Color.parse(t);this.css("background-color","rgba("+n.r+","+n.g+","+n.b+","+n.a+")")}},"background-image":{type:"Image",label:e.String.t("Background image"),getter:function(t){var n=this.css("background-image",void 0,t);return"none"!==n&&e.Var.is(n,"string")?n.replace(/^url\(["']?/,"").replace(/["']?\)$/,""):null},setter:function(t){t="none"!==t&&e.Var.is(t,"string")&&t.length>0?"url("+t+")":null,this.css("background-image",t)}},"start-time":{type:"Time",label:e.String.t("Start time"),configs:{checkbox:!0,inButton:!0,outButton:!0},getter:function(){var t=parseFloat(this.data("start-time"));return isNaN(t)?null:t},setter:function(t){this.data("start-time",isNaN(t)?null:t)
}},"end-time":{type:"Time",label:e.String.t("End time"),configs:{checkbox:!0,inButton:!0,outButton:!0},getter:function(){var t=parseFloat(this.data("end-time"));return isNaN(t)?null:t},setter:function(t){this.data("end-time",isNaN(t)?null:t)}},elements:{editable:!1,getter:function(t){var e=[];return this.getElements().each(function(n,i){e.push(i._metaScore.getProperties(t))},this),e},setter:function(t){e.Array.each(t,function(t,e){this.addElement(e)},this)}}}},t.prototype.setupDOM=function(){t.parent.prototype.setupDOM.call(this),this.addClass("page")},t.prototype.addElement=function(t){var n;return t instanceof e.player.component.Element?(n=t,n.appendTo(this)):n=new e.player.component.element[t.type](e.Object.extend({},t,{container:this})),n},t.prototype.getElements=function(){return this.children(".element")},t.prototype.setCuePoint=function(t){return this.cuepoint&&this.cuepoint.destroy(),this.cuepoint=new e.player.CuePoint(e.Object.extend({},t,{inTime:this.getProperty("start-time"),outTime:this.getProperty("end-time"),onStart:e.Function.proxy(this.onCuePointStart,this),onEnd:e.Function.proxy(this.onCuePointEnd,this)})),this.cuepoint},t.prototype.onCuePointStart=function(){this.triggerEvent("cuepointstart")},t.prototype.onCuePointEnd=function(){this.triggerEvent("cuepointend")},t}(),e.namespace("player.component.element").Cursor=function(){function t(e){t.parent.call(this,e)}return e.player.component.Element.extend(t),t.defaults={properties:e.Object.extend({},e.player.component.Element.defaults.properties,{direction:{type:"Select",label:e.String.t("Direction"),configs:{options:{right:e.String.t("Left > Right"),left:e.String.t("Right > Left"),bottom:e.String.t("Top > Bottom"),top:e.String.t("Bottom > Top")}},getter:function(){return this.data("direction")},setter:function(t){this.data("direction",t)}},acceleration:{type:"Number",label:e.String.t("Acceleration"),getter:function(){return this.data("accel")},setter:function(t){this.data("accel",t)}},"cursor-width":{type:"Number",label:e.String.t("Cursor width"),getter:function(t){var e=this.cursor.css("width",void 0,t);return null!==e?parseInt(e,10):null},setter:function(t){this.cursor.css("width",t+"px")}},"cursor-color":{type:"Color",label:e.String.t("Cursor color"),getter:function(t){return this.cursor.css("background-color",void 0,t)},setter:function(t){var n=e.Color.parse(t);this.cursor.css("background-color","rgba("+n.r+","+n.g+","+n.b+","+n.a+")")}}})},t.prototype.setupDOM=function(){t.parent.prototype.setupDOM.call(this),this.data("type","cursor"),this.cursor=new e.Dom("<div/>",{"class":"cursor"}).appendTo(this.contents),this.addListener("click",e.Function.proxy(this.onClick,this)).addListener("dblclick",e.Function.proxy(this.onClick,this))},t.prototype.onClick=function(t){var n,i,o,s,a,r,l;if(e.editing!==!0||"dblclick"===t.type){switch(o=this.getProperty("start-time"),s=this.getProperty("end-time"),a=this.getProperty("direction"),r=this.getProperty("acceleration"),l=t.target.getBoundingClientRect(),a){case"left":n=(l.right-t.clientX)/this.getProperty("width");break;case"bottom":n=(t.clientY-l.top)/this.getProperty("height");break;case"top":n=(l.bottom-t.clientY)/this.getProperty("height");break;default:n=(t.clientX-l.left)/this.getProperty("width")}i=r&&1!==r?o+(s-o)*Math.pow(n,1/r):o+(s-o)*n,this.triggerEvent("time",{element:this,value:i})}},t.prototype.setCuePoint=function(t){return this.cuepoint&&this.cuepoint.destroy(),this.cuepoint=new e.player.CuePoint(e.Object.extend({},t,{inTime:this.getProperty("start-time"),outTime:this.getProperty("end-time"),onStart:e.Function.proxy(this.onCuePointStart,this),onUpdate:e.Function.proxy(this.onCuePointUpdate,this),onEnd:e.Function.proxy(this.onCuePointEnd,this)})),this.cuepoint},t.prototype.onCuePointUpdate=function(t,e){var n,i,o,s,a,r=this.getProperty("direction"),l=this.getProperty("acceleration");switch(o=this.getProperty("start-time"),s=this.getProperty("end-time"),a=l&&1!==l?Math.pow((e-o)/(s-o),l):(e-o)/(s-o),r){case"left":n=this.getProperty("width"),a=Math.min(n*a,n),this.cursor.css("right",a+"px");break;case"bottom":i=this.getProperty("height"),a=Math.min(i*a,i),this.cursor.css("top",a+"px");break;case"top":i=this.getProperty("height"),a=Math.min(i*a,i),this.cursor.css("bottom",a+"px");break;default:n=this.getProperty("width"),a=Math.min(n*a,n),this.cursor.css("left",a+"px")}},t}(),e.namespace("player.component.element").Image=function(){function t(e){t.parent.call(this,e)}return e.player.component.Element.extend(t),t.prototype.setupDOM=function(){t.parent.prototype.setupDOM.call(this),this.data("type","image")},t}(),e.namespace("player.component.element").Text=function(){function t(n){t.parent.call(this,n),this.addDelegate("a","click",e.Function.proxy(this.onLinkClick,this))}return e.player.component.Element.extend(t),t.defaults={properties:e.Object.extend({},e.player.component.Element.defaults.properties,{text:{editable:!1,getter:function(){return this.contents.text()},setter:function(t){this.contents.text(t)}}})},t.prototype.setupDOM=function(){t.parent.prototype.setupDOM.call(this),this.data("type","text")},t.prototype.onLinkClick=function(t){var e,n=t.target;(e=n.hash.match(/^#p=(\d+)/))?(this.triggerEvent("page",{element:this,value:e[1]}),t.preventDefault()):(e=n.hash.match(/^#t=(\d+),(\d+)&r=(\d+)/))?(this.triggerEvent("time",{element:this,value:e[1],stop:e[2],forcePlay:!0}),this.triggerEvent("rindex",{element:this,value:e[3]})):window.open(n.href,"_blank"),t.preventDefault()},t}(),t.metaScore=e})(this);