/*! metaScore - v0.0.1 - 2014-09-15 - Oussama Mubarak */
(function(t){"use strict";Element&&function(t){t.matches=t.matchesSelector=t.matchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector||function(t){for(var e=(this.parentNode||this.document).querySelectorAll(t),n=-1;e[++n]&&e[n]!==this;);return!!e[n]}}(Element.prototype);var e={version:"0.0.1",namespace:function(t){for(var e,n=this,o=t.split("."),i=0,s=o.length;s>i;i++)e=o[i],n[e]=n[e]||{},n=n[e];return n}};e.Class=function(){function t(){}return t.defaults={},t.extend=function(t){t.prototype=Object.create(this.prototype,{constructor:{value:t}}),t.parent=this,t.extend=this.extend,t.hasOwnProperty("defaults")||(t.defaults={});for(var e in this.defaults)t.defaults.hasOwnProperty(e)||(t.defaults[e]=this.defaults[e])},t.prototype.getConfigs=function(t){t=t||{};for(var e in this.constructor.defaults)t.hasOwnProperty(e)||(t[e]=this.constructor.defaults[e]);return t},t}(),e.Evented=function(){function t(){t.parent.call(this),this.listeners={}}return e.Class.extend(t),t.prototype.addListener=function(t,e){return this.listeners[t]===void 0&&(this.listeners[t]=[]),this.listeners[t].push(e),this},t.prototype.removeListener=function(t,e){if(this.listeners[t]instanceof Array)for(var n=this.listeners[t],o=0,i=n.length;i>o;o++)if(n[o]===e){n.splice(o,1);break}return this},t.prototype.triggerEvent=function(t,n,o,i){var s,a;return this.listeners[t]instanceof Array&&(s=this.listeners[t],a={target:this,type:t,detail:n,bubbles:o!==!1,cancelable:i!==!1},e.Object.each(s,function(t,e){e.call(this,a)},this)),this},t}(),e.Ajax=function(){function t(){}return e.Class.extend(t),t.createXHR=function(){var t,e,n,o=["MSXML2.XMLHttp.5.0","MSXML2.XMLHttp.4.0","MSXML2.XMLHttp.3.0","MSXML2.XMLHttp","Microsoft.XMLHttp"];if("undefined"!=typeof XMLHttpRequest)return t=new XMLHttpRequest;if(window.ActiveXObject)for(e=0,n=o.length;n>e;e++)try{return t=new ActiveXObject(o[e])}catch(i){}throw Error("XMLHttp object could be created.")},t.send=function(n,o){var i,s=t.createXHR(),a=[],r={method:"GET",headers:[],async:!0,data:{},complete:null,success:null,error:null,scope:this};return o=e.Object.extend(function(){},r,o),e.Object.each(o.data,function(t,e){a.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}),a.length>0&&("POST"===o.method?(i=a.join("&"),o.headers["Content-type"]="application/x-www-form-urlencoded"):n+="?"+a.join("&")),s.open(o.method,n,o.async),e.Object.each(o.headers,function(t,e){s.setRequestHeader(t,e)}),s.onreadystatechange=function(){4===s.readyState&&(e.Var.is(o.complete,"function")&&o.complete.call(o.scope,s),s.status>=200&&300>s.status||304===s.status?e.Var.is(o.success,"function")&&o.success.call(o.scope,s):e.Var.is(o.error,"function")&&o.error.call(o.scope,s))},s.send(i),s},t.get=function(n,o){return e.Object.extend(o,{method:"GET"}),t.send(n,o)},t.post=function(n,o){return e.Object.extend(o,{method:"POST"}),t.send(n,o)},t}(),e.Array=function(){function t(){}return e.Class.extend(t),t.inArray=function(t,e){var n,o=0;if(e){if(e.indexOf)return e.indexOf(t);for(n=e.length;n>o;o++)if(o in e&&e[o]===t)return o}return-1},t.copy=function(t){return[].concat(t)},t.shuffle=function(e){var n=t.copy(e);return n.sort(function(){return(0|3*Math.random())-1}),n},t.unique=function(t){for(var e=[],n=t.length,o=0;n>o;o++){for(var i=o+1;n>i;i++)t[o]===t[i]&&(i=++o);e.push(t[o])}return e},t.each=function(t,e,n){for(var o,i=0,s=t.length,a=void 0!==n;s>i&&(o=e.call(a?n:t[i],i,t[i]),o!==!1);i++);return t},t.remove=function(e,n){for(var o=t.inArray(n,e);o>-1;)e.splice(o,1),o=t.inArray(n,e);return e},t}(),e.Dom=function(){function t(){var t;this.elements=[],arguments.length>0&&((t=e.Dom.elementsFromString.apply(this,arguments))?(this.add(t),arguments.length>1&&this.attr(arguments[1])):(t=e.Dom.selectElements.apply(this,arguments))&&(this.add(t),arguments.length>2&&this.attr(arguments[2])))}return e.Class.extend(t),t.stringRe=/^<(.)+>$/,t.camelRe=/-([\da-z])/gi,t.camelReplaceFn=function(t,e){return e.toUpperCase()},t.camel=function(e){return e.replace(t.camelRe,t.camelReplaceFn)},t.bubbleEvents={click:!0,submit:!0,mousedown:!0,mousemove:!0,mouseup:!0,mouseover:!0,mouseout:!0,transitionend:!0},t.selectElement=function(t,n){var o;return n||(n=document),o=e.Var.is(t,"string")?n.querySelector(t):t.length?t[0]:t},t.selectElements=function(n,o){var i;return o?o instanceof t&&(o=o.get(0)):o=document,i=e.Var.is(n,"string")?o.querySelectorAll(n):n.length?n:[n]},t.elementsFromString=function(t){var e,n,o,i={option:[1,"<select multiple='multiple'>","</select>"],optgroup:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tbody:[1,"<table>","</table>"],tfoot:[1,"<table>","</table>"],colgroup:[1,"<table>","</table>"],caption:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],th:[3,"<table><tbody><tr>","</tr></tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[1,"<div>","</div>"]},s=document.createElement("div"),a=/<\s*\w.*?>/g.exec(t);if(null!=a){for(e=a[0].replace(/</g,"").replace(/\/?>/g,""),n=i[e]||i._default,t=n[1]+t+n[2],s.innerHTML=t,o=n[0];o--;)s=s.lastChild;return s.childNodes}return null},t.hasClass=function(t,e){return t.classList.contains(e)},t.addClass=function(t,e){for(var n=e.split(" "),o=0,i=n.length;i>o;o++)t.classList.add(n[o])},t.removeClass=function(t,e){for(var n=e.split(" "),o=0,i=n.length;i>o;o++)t.classList.remove(n[o])},t.toggleClass=function(t,e,n){var o=e.split(" "),i=0,s=o.length;if(void 0===n)for(;s>i;i++)t.classList.toggle(o[i]);else for(;s>i;i++)t.classList.toggle(o[i],n)},t.addListener=function(e,n,o,i){return void 0===i&&(i=t.bubbleEvents.hasOwnProperty("type")?t.bubbleEvents[n]:!1),e.addEventListener(n,o,i)},t.removeListener=function(e,n,o,i){return void 0===i&&(i=t.bubbleEvents.hasOwnProperty("type")?t.bubbleEvents[n]:!1),e.removeEventListener(n,o,i)},t.triggerEvent=function(t,e,n,o,i){var s=new CustomEvent(e,{detail:n,bubbles:o!==!1,cancelable:i!==!1});return t.dispatchEvent(s)},t.text=function(t,e){return void 0!==e&&(t.innerHTML=e),t.innerHTML},t.val=function(t,e){return void 0!==e&&(t.value=e),t.value},t.attr=function(n,o,i){if(e.Var.is(o,"object"))e.Object.each(o,function(e,o){t.attr(n,e,o)},this);else switch(o){case"class":this.addClass(n,i);break;case"text":this.text(n,i);break;default:if(null!==i)return void 0!==i&&n.setAttribute(o,i),n.getAttribute(o);n.removeAttribute(o)}},t.css=function(t,e,n){var o,i;return o=this.camel(e),void 0!==n&&(t.style[o]=n),i=window.getComputedStyle(t),i.getPropertyValue(e)},t.data=function(t,e,n){return e=this.camel(e),null===n?delete t.dataset[e]:void 0!==n&&(t.dataset[e]=n),t.dataset[e]},t.append=function(t,n){e.Var.is(n,"array")||(n=[n]),e.Array.each(n,function(e,n){t.appendChild(n)},this)},t.empty=function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},t.remove=function(t){t.parentElement.removeChild(t)},t.is=function(t,e){return t.matches(e)},t.prototype.add=function(t){if(t.hasOwnProperty("length"))for(var e=0;t.length>e;e++)this.elements.push(t[e]);else this.elements.push(t)},t.prototype.count=function(){return this.elements.length},t.prototype.get=function(t){return this.elements[t]},t.prototype.filter=function(n){var o=[];return e.Array.each(this.elements,function(e,i){t.is(i,n)&&o.push(i)},this),this.elements=o,this},t.prototype.index=function(n){var o=-1;return e.Array.each(this.elements,function(e,i){return t.is(i,n)?(o=e,!1):void 0},this),o},t.prototype.child=function(n){var o,i=new t;return e.Array.each(this.elements,function(e,s){return(o=t.selectElement.call(this,n,s))?(i.add(o),!1):void 0},this),i},t.prototype.children=function(n){var o=new t;return e.Array.each(this.elements,function(e,i){o.add(t.selectElements.call(this,n,i))},this),o},t.prototype.parents=function(n){var o=new t;return e.Array.each(this.elements,function(t,e){o.add(e.parentElement)},this),n&&o.filter(n),o},t.prototype.addClass=function(n){return e.Array.each(this.elements,function(e,o){t.addClass(o,n)},this),this},t.prototype.removeClass=function(n){return e.Array.each(this.elements,function(e,o){t.removeClass(o,n)},this),this},t.prototype.toggleClass=function(n,o){return e.Array.each(this.elements,function(e,i){t.toggleClass(i,n,o)},this),this},t.prototype.addListener=function(n,o,i){return e.Array.each(this.elements,function(e,s){t.addListener(s,n,o,i)},this),this},t.prototype.addDelegate=function(e,n,o,i,s){return i=i||this,this.addListener(n,function(n){t.is(n.target,e)&&o.call(i,n)},s)},t.prototype.removeListener=function(n,o,i){return e.Array.each(this.elements,function(e,s){t.removeListener(s,n,o,i)},this),this},t.prototype.triggerEvent=function(n,o,i,s){var a=!0;return e.Array.each(this.elements,function(e,r){a=t.triggerEvent(r,n,o,i,s)&&a},this),a},t.prototype.text=function(n){return void 0===n?t.text(this.get(0)):(e.Array.each(this.elements,function(e,o){t.text(o,n)},this),void 0)},t.prototype.val=function(n){return void 0!==n?(e.Array.each(this.elements,function(e,o){t.val(o,n)},this),this):t.val(this.get(0))},t.prototype.attr=function(n,o){return void 0!==o||e.Var.is(n,"object")?(e.Array.each(this.elements,function(e,i){t.attr(i,n,o)},this),this):t.attr(this.get(0),n)},t.prototype.css=function(n,o){return void 0!==o?(e.Array.each(this.elements,function(e,i){t.css(i,n,o)},this),this):t.css(this.get(0),n)},t.prototype.data=function(n,o){return void 0!==o?(e.Array.each(this.elements,function(e,i){t.data(i,n,o)},this),this):t.data(this.get(0),n)},t.prototype.append=function(e){return e instanceof t&&(e=e.elements),t.append(this.get(0),e),this},t.prototype.appendTo=function(n){return n instanceof t||(n=new t(n)),n=n.get(0),e.Array.each(this.elements,function(e,o){t.append(n,o)},this),this},t.prototype.empty=function(){return e.Array.each(this.elements,function(e,n){t.empty(n)},this),this},t.prototype.show=function(){return e.Array.each(this.elements,function(){this.css("display","")},this),this},t.prototype.hide=function(){return e.Array.each(this.elements,function(){this.css("display","none")},this),this},t.prototype.remove=function(){return this.triggerEvent("beforeremove")!==!1&&e.Array.each(this.elements,function(e,n){var o=n.parentElement;t.remove(n),t.triggerEvent(o,"childremoved",{child:n})},this),this},t.prototype.is=function(n){var o;return e.Array.each(this.elements,function(e,i){return o=t.is(i,n)},this),o},t}(),e.Draggable=function(){function t(t){this.configs=this.getConfigs(t),this.configs.container=this.configs.container||new e.Dom("body"),this.onMouseDown=e.Function.proxy(this.onMouseDown,this),this.onMouseMove=e.Function.proxy(this.onMouseMove,this),this.onMouseUp=e.Function.proxy(this.onMouseUp,this),this.configs.handle.addListener("mousedown",this.onMouseDown),this.enable()}return e.Class.extend(t),t.prototype.onMouseDown=function(t){this.start_state={left:parseInt(this.configs.target.css("left"),10)-t.clientX,top:parseInt(this.configs.target.css("top"),10)-t.clientY},this.configs.container.addListener("mouseup",this.onMouseUp).addListener("mousemove",this.onMouseMove),this.configs.target.addClass("dragging").triggerEvent("dragstart",null,!1,!0),t.stopPropagation()},t.prototype.onMouseMove=function(t){var e=t.clientX+this.start_state.left,n=t.clientY+this.start_state.top;this.configs.target.css("left",e+"px").css("top",n+"px").triggerEvent("drag",null,!1,!0),t.stopPropagation()},t.prototype.onMouseUp=function(t){this.configs.container.removeListener("mousemove",this.onMouseMove).removeListener("mouseup",this.onMouseUp),this.configs.target.removeClass("dragging").triggerEvent("dragend",null,!1,!0),t.stopPropagation()},t.prototype.enable=function(){return this.configs.target.addClass("draggable"),this},t.prototype.disable=function(){return this.configs.target.removeClass("draggable"),this},t.prototype.destroy=function(){return this.disable(),this.configs.handle.removeListener("mousedown",this.onMouseDown),this},t}(),e.Function=function(){function t(){}return e.Class.extend(t),t.proxy=function(t,n,o){return e.Var.type(t,"function")?function(){return t.apply(n||this,o||arguments)}:void 0},t.emptyFn=function(){},t}(),e.Object=function(){function t(){}return e.Class.extend(t),t.extend=function(){for(var t,e,n,o,i=arguments[0]||{},s=1,a=arguments.length;a>s;s++)if(null!=(t=arguments[s]))for(e in t)n=i[e],o=t[e],n!==o&&void 0!==o&&(i[e]=o);return i},t.copy=function(e){return t.extend({},e)},t.each=function(t,e,n){var o,i,s=void 0!==n;for(o in t)if(t.hasOwnProperty(o)&&(i=e.call(s?n:t[o],o,t[o]),i===!1))break;return t},t}(),e.Resizable=function(){function t(t){this.configs=this.getConfigs(t),this.configs.container=this.configs.container||new e.Dom("body"),this.handles={},this.onMouseDown=e.Function.proxy(this.onMouseDown,this),this.onMouseMove=e.Function.proxy(this.onMouseMove,this),this.onMouseUp=e.Function.proxy(this.onMouseUp,this),e.Array.each(this.configs.directions,function(t,n){this.handles[n]=new e.Dom("<div/>",{"class":"resize-handle"}).data("direction",n).addListener("mousedown",this.onMouseDown).appendTo(this.configs.target)},this),this.enable()}return t.defaults={directions:["top","right","bottom","left","top-left","top-right","bottom-left","bottom-right"]},e.Class.extend(t),t.prototype.onMouseDown=function(t){this.start_state={handle:t.target,x:t.clientX,y:t.clientY,left:parseInt(this.configs.target.css("left"),10),top:parseInt(this.configs.target.css("top"),10),w:parseInt(this.configs.target.css("width"),10),h:parseInt(this.configs.target.css("height"),10)},this.configs.container.addListener("mousemove",this.onMouseMove,this).addListener("mouseup",this.onMouseUp,this),this.configs.target.addClass("resizing").triggerEvent("resizestart",null,!1,!0),t.stopPropagation()},t.prototype.onMouseMove=function(t){var n,o,i,s,a=new e.Dom(this.start_state.handle);switch(a.data("direction")){case"top":o=this.start_state.h-t.clientY+this.start_state.y,i=this.start_state.top+t.clientY-this.start_state.y;break;case"right":n=this.start_state.w+t.clientX-this.start_state.x;break;case"bottom":o=this.start_state.h+t.clientY-this.start_state.y;break;case"left":n=this.start_state.w-t.clientX+this.start_state.x,s=this.start_state.left+t.clientX-this.start_state.x;break;case"top-left":n=this.start_state.w-t.clientX+this.start_state.x,o=this.start_state.h-t.clientY+this.start_state.y,i=this.start_state.top+t.clientY-this.start_state.y,s=this.start_state.left+t.clientX-this.start_state.x;break;case"top-right":n=this.start_state.w+t.clientX-this.start_state.x,o=this.start_state.h-t.clientY+this.start_state.y,i=this.start_state.top+t.clientY-this.start_state.y;break;case"bottom-left":n=this.start_state.w-t.clientX+this.start_state.x,o=this.start_state.h+t.clientY-this.start_state.y,s=this.start_state.left+t.clientX-this.start_state.x;break;case"bottom-right":n=this.start_state.w+t.clientX-this.start_state.x,o=this.start_state.h+t.clientY-this.start_state.y}void 0!==i&&this.configs.target.css("top",i+"px"),void 0!==s&&this.configs.target.css("left",s+"px"),this.configs.target.css("width",n+"px").css("height",o+"px").triggerEvent("resize",null,!1,!0),t.stopPropagation()},t.prototype.onMouseUp=function(t){this.configs.container.removeListener("mousemove",this.onMouseMove,this).removeListener("mouseup",this.onMouseUp,this),this.configs.target.removeClass("resizing").triggerEvent("resizeend",null,!1,!0),t.stopPropagation()},t.prototype.enable=function(){return this.configs.target.addClass("resizable"),this},t.prototype.disable=function(){return this.configs.target.removeClass("resizable"),this},t.prototype.destroy=function(){return this.disable(),e.Object.each(this.handles,function(t,e){e.remove()},this),this},t}(),e.String=function(){function t(){}return e.Class.extend(t),t.capitalize=function(t){return t.replace(/(?:^|\s)\S/g,function(t){return t.toUpperCase()})},t.t=function(e,n){return t.formatString(e,n)},t.formatString=function(t,n){return e.Object.each(n,function(e){t=t.replace(e,n[e])},this),t},t.uuid=function(t,e){var n,o=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],i=[];if(e=e||o.length,t)for(n=0;t>n;n++)i[n]=o[0|Math.random()*e];else{var s;for(i[8]=i[13]=i[18]=i[23]="-",i[14]="4",n=0;36>n;n++)i[n]||(s=0|16*Math.random(),i[n]=o[19===n?8|3&s:s])}return i.join("")},t}(),e.Var=function(){function t(){}var n={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"};return e.Class.extend(t),t.type=function(t){return null==t?t+"":n[Object.prototype.toString.call(t)]||"object"},t.is=function(e,n){return t.type(e)===n.toLowerCase()},t}(),e.Editor=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this,"<div/>",{"class":"metaScore-editor"}),this.configs.container&&this.appendTo(this.configs.container),this.workspace=new e.Dom("<div/>",{"class":"workspace"}).appendTo(this),this.mainmenu=(new e.editor.MainMenu).appendTo(this),this.sidebar=new e.Dom("<div/>",{"class":"sidebar"}).appendTo(this),this.block_panel=(new e.editor.panel.Block).appendTo(this.sidebar),this.page_panel=(new e.editor.panel.Page).appendTo(this.sidebar),this.element_panel=(new e.editor.panel.Element).appendTo(this.sidebar),this.player_wrapper=new e.Dom("<iframe/>",{"class":"player-wrapper"}).appendTo(this.workspace),this.player_head=new e.Dom(this.player_wrapper.get(0).contentDocument.head),this.player_body=new e.Dom(this.player_wrapper.get(0).contentDocument.body).addClass("metaScore-player-wrapper"),this.grid=new e.Dom("<div/>",{"class":"grid"}).appendTo(this.workspace),this.history=new e.editor.History,this.configs.palyer_css&&e.Array.each(this.configs.palyer_css,function(t,e){this.addPlayerCSS(e)},this),this.mainmenu.addDelegate("button[data-action]:not(.disabled)","click",e.Function.proxy(this.onMainmenuClick,this)),this.block_panel.addListener("componentset",e.Function.proxy(this.onBlockSet,this)).addListener("componentunset",e.Function.proxy(this.onBlockUnset,this)).addListener("valueschange",e.Function.proxy(this.onBlockPanelValueChange,this)).getToolbar().addDelegate(".buttons [data-action]","click",e.Function.proxy(this.onBlockPanelToolbarClick,this)),this.page_panel.addListener("componentset",e.Function.proxy(this.onPageSet,this)).addListener("componentunset",e.Function.proxy(this.onPageUnset,this)).getToolbar().addDelegate(".buttons [data-action]","click",e.Function.proxy(this.onPagePanelToolbarClick,this)),this.element_panel.addListener("componentset",e.Function.proxy(this.onElementSet,this)).getToolbar().addDelegate(".buttons [data-action]","click",e.Function.proxy(this.onElementPanelToolbarClick,this)),this.player_body.addListener("click",e.Function.proxy(this.onPlayerClick,this)).addListener("keydown",e.Function.proxy(this.onKeydown,this)).addListener("keyup",e.Function.proxy(this.onKeyup,this)),this.history.addListener("add",e.Function.proxy(this.onHistoryAdd,this)).addListener("undo",e.Function.proxy(this.onHistoryUndo,this)).addListener("redo",e.Function.proxy(this.onHistoryRedo,this)),new e.Dom("body").addListener("keydown",e.Function.proxy(this.onKeydown,this)).addListener("keyup",e.Function.proxy(this.onKeyup,this)),this.addPlayer({container:this.player_body}),this.block_panel.unsetComponent()}return e.Dom.extend(t),t.prototype.addPlayerCSS=function(t){new e.Dom("<link/>",{rel:"stylesheet",type:"text/css",href:t}).appendTo(this.player_head)},t.prototype.addPlayer=function(t){t.container=this.player_body,this.player=new e.Player(t).addListener("blockclick",e.Function.proxy(this.onBlockClick,this)).addListener("pageclick",e.Function.proxy(this.onPageClick,this)).addListener("elementclick",e.Function.proxy(this.onElementClick,this)).addListener("blockpageactivate",e.Function.proxy(this.onBlockPageActivated,this))},t.prototype.removePlayer=function(){this.player&&this.player.destroy(this.player_body),delete this.player},t.prototype.addBlock=function(t){return t instanceof e.player.Block||(t=this.player.addBlock(t)),this.block_panel.setComponent(t),t},t.prototype.addPage=function(t,n){return n instanceof e.player.Page||(n=t.addPage(n)),this.page_panel.setComponent(n),n},t.prototype.addElement=function(t,n){return n instanceof e.player.Element||(n=t.addElement(n)),this.element_panel.setComponent(n),n},t.prototype.openGuide=function(t){this.alert=new e.editor.overlay.Alert({text:e.String.t("Loading..."),autoShow:!0}),e.Ajax.get(this.configs.api_url+"guide/"+t.id+".json",{success:e.Function.proxy(this.onGuideLoadSuccess,this),error:e.Function.proxy(this.onGuideLoadError,this)})},t.prototype.onGuideLoadSuccess=function(t){var e=JSON.parse(t.response);this.removePlayer(),this.addPlayer(e),this.alert.hide(),delete this.alert},t.prototype.onGuideLoadError=function(){},t.prototype.onKeydown=function(t){switch(t.keyCode){case 18:this.player_body.addClass("alt-down");break;case 90:t.ctrlKey&&this.history.undo();break;case 89:t.ctrlKey&&this.history.redo()}},t.prototype.onKeyup=function(t){switch(t.keyCode){case 18:this.player_body.removeClass("alt-down")}},t.prototype.onMainmenuClick=function(t){switch(e.Dom.data(t.target,"action")){case"new":break;case"open":new e.editor.overlay.popup.GuideSelector({url:this.configs.api_url+"guide.json",selectCallback:e.Function.proxy(this.openGuide,this),autoShow:!0}).show();break;case"save":break;case"download":break;case"delete":break;case"revert":break;case"undo":this.history.undo();break;case"redo":this.history.redo();break;case"edit":break;case"settings":break;case"help":}},t.prototype.onBlockSet=function(t){var n=t.detail.component;n instanceof e.player.Controller||(this.page_panel.setComponent(n.getActivePage(),!0),this.page_panel.getMenu().enableItems('[data-action="new"]'),this.element_panel.getMenu().enableItems('[data-action="new"]')),t.stopPropagation()},t.prototype.onBlockUnset=function(){this.page_panel.unsetComponent(),this.page_panel.getMenu().disableItems('[data-action="new"]')},t.prototype.onBlockPanelValueChange=function(t){var n=t.detail.component,o=t.detail.old_values,i=t.detail.new_values;this.history.add({undo:e.Function.proxy(this.block_panel.updateProperties,this.block_panel,[n,o]),redo:e.Function.proxy(this.block_panel.updateProperties,this.block_panel,[n,i])})},t.prototype.onBlockPanelToolbarClick=function(t){var n,o,i,s;switch(e.Dom.data(t.target,"action")){case"new":n=this.addBlock({container:this.player_body}),this.history.add({undo:e.Function.proxy(n.destroy,this),redo:e.Function.proxy(this.addBlock,this,[n])});break;case"delete":n=this.block_panel.getComponent(),n&&(n.destroy(),this.block_panel.unsetComponent(),this.history.add({undo:e.Function.proxy(this.addBlock,this,[n]),redo:e.Function.proxy(n.destroy,this)}));break;case"previous":o=new e.Dom(".metaScore-block",this.player_body),i=o.count(),i>0&&(s=o.index(".selected")-1,0>s&&(s=i-1),n=o.get(s)._metaScore,this.block_panel.setComponent(n));break;case"next":o=new e.Dom(".metaScore-block",this.player_body),i=o.count(),i>0&&(s=o.index(".selected")+1,s>=i&&(s=0),n=o.get(s)._metaScore,this.block_panel.setComponent(n))}t.stopPropagation()},t.prototype.onPageSet=function(t){var e=t.detail.component,n=e.dom.parents().parents().get(0)._metaScore;this.block_panel.setComponent(n,!0),this.page_panel.getMenu().enableItems('[data-action="new"]'),this.element_panel.getMenu().enableItems('[data-action="new"]'),t.stopPropagation()},t.prototype.onPageUnset=function(){this.element_panel.unsetComponent(),this.element_panel.getMenu().disableItems('[data-action="new"]')},t.prototype.onPagePanelToolbarClick=function(t){var n,o,i,s,a;switch(e.Dom.data(t.target,"action")){case"new":n=this.block_panel.getComponent(),o=this.addPage(n),this.history.add({undo:e.Function.proxy(o.destroy,this),redo:e.Function.proxy(this.addPage,this,[n,o])});break;case"delete":n=this.block_panel.getComponent(),o=this.page_panel.getComponent(),o&&(o.destroy(),this.page_panel.unsetComponent(),this.history.add({undo:e.Function.proxy(this.addPage,this,[n,o]),redo:e.Function.proxy(o.destroy,this)}));break;case"previous":n=this.block_panel.getComponent(),n&&(i=new e.Dom(".page",n.dom),s=i.count(),s>0&&(a=i.index(".selected")-1,0>a&&(a=s-1),o=i.get(a)._metaScore,n.setActivePage(o)));break;case"next":n=this.block_panel.getComponent(),n&&(i=new e.Dom(".page",n.dom),s=i.count(),s>0&&(a=i.index(".selected")+1,a>=s&&(a=0),o=i.get(a)._metaScore,n.setActivePage(o)))}t.stopPropagation()},t.prototype.onElementSet=function(t){var e=t.detail.component,n=e.dom.parents().get(0)._metaScore,o=n.dom.parents().parents().get(0)._metaScore;this.page_panel.setComponent(n,!0),this.block_panel.setComponent(o,!0),t.stopPropagation()},t.prototype.onElementPanelToolbarClick=function(t){var n,o,i,s,a;switch(e.Dom.data(t.target,"action")){case"new":n=this.page_panel.getComponent(),o=this.addElement(n,{type:e.Dom.data(t.target,"type")}),this.element_panel.setComponent(o),this.history.add({undo:e.Function.proxy(o.destroy,this),redo:e.Function.proxy(this.addElement,this,[n,o])});break;case"delete":n=this.page_panel.getComponent(),o=this.element_panel.getComponent(),o&&(o.destroy(),this.element_panel.unsetComponent(),this.history.add({undo:e.Function.proxy(this.addElement,this,[n,o]),redo:e.Function.proxy(o.destroy,this)}));break;case"previous":n=this.page_panel.getComponent(),n&&(i=new e.Dom(".element",n.dom),s=i.count(),s>0&&(a=i.index(".selected")-1,0>a&&(a=s-1),o=i.get(a)._metaScore,this.element_panel.setComponent(o)));break;case"next":n=this.page_panel.getComponent(),n&&(i=new e.Dom(".element",n.dom),s=i.count(),s>0&&(a=i.index(".selected")+1,a>=s&&(a=0),o=i.get(a)._metaScore,this.element_panel.setComponent(o)))}t.stopPropagation()},t.prototype.onBlockClick=function(t){this.block_panel.setComponent(t.detail.block)},t.prototype.onPageClick=function(t){this.page_panel.setComponent(t.detail.page)},t.prototype.onElementClick=function(t){this.element_panel.setComponent(t.detail.element)},t.prototype.onPlayerClick=function(t){this.block_panel.unsetComponent(),t.stopPropagation()},t.prototype.onBlockPageActivated=function(t){var e=t.detail.page;this.page_panel.setComponent(e)},t.prototype.onHistoryAdd=function(){this.mainmenu.enableItems('[data-action="undo"]'),this.mainmenu.disableItems('[data-action="redo"]')},t.prototype.onHistoryUndo=function(){this.history.hasUndo()?this.mainmenu.enableItems('[data-action="undo"]'):this.mainmenu.disableItems('[data-action="undo"]'),this.mainmenu.enableItems('[data-action="redo"]')},t.prototype.onHistoryRedo=function(){this.history.hasRedo()?this.mainmenu.enableItems('[data-action="redo"]'):this.mainmenu.disableItems('[data-action="redo"]'),this.mainmenu.enableItems('[data-action="undo"]')},t}(),e.namespace("editor"),e.editor.Button=function(){function t(t){this.configs=this.getConfigs(t),e.Dom.call(this,"<button/>"),this.disabled=!1,this.configs.label&&this.setLabel(this.configs.label),this.addListener("click",e.Function.proxy(this.onClick,this))}return t.defaults={label:null},e.Dom.extend(t),t.prototype.onClick=function(t){this.disabled&&t.stopPropagation()},t.prototype.setLabel=function(t){void 0===this.label&&(this.label=new e.Dom("<span/>",{"class":"label"}).appendTo(this)),this.label.text(t)},t.prototype.disable=function(){return this.disabled=!0,this.addClass("disabled"),this},t.prototype.enable=function(){return this.disabled=!1,this.removeClass("disabled"),this},t}(),e.namespace("editor"),e.editor.DropDownMenu=function(){function t(t){this.configs=this.getConfigs(t),e.Dom.call(this,"<ul/>",{"class":"dropdown-menu"})}return e.Dom.extend(t),t.prototype.addItem=function(t){var n=new e.Dom("<li/>",t).appendTo(this);return n},t.prototype.enableItems=function(t){var e=this.children(t);return e.removeClass("disabled"),e},t.prototype.disableItems=function(t){var e=this.children(t);return e.addClass("disabled"),e},t}(),e.namespace("editor"),e.editor.Field=function(){function t(t){this.configs=this.getConfigs(t),e.Dom.call(this,this.configs.tag,this.configs.attributes),this.disabled=!1,null!==this.configs.value&&this.setValue(this.configs.value),this.configs.disabled&&this.disable(),this.addListener("change",e.Function.proxy(this.onChange,this))}return t.defaults={value:null,disabled:!1,tag:"<input/>"},e.Dom.extend(t),t.prototype.attributes={type:"text","class":"field"},t.prototype.onChange=function(){this.value=this.val(),this.triggerEvent("valuechange",{field:this,value:this.value},!0,!1)},t.prototype.setValue=function(t){this.val(t),this.value=t},t.prototype.getValue=function(){return this.value},t.prototype.disable=function(){return this.disabled=!0,this.addClass("disabled"),this.attr("disabled","disabled"),this},t.prototype.enable=function(){return this.disabled=!1,this.removeClass("disabled"),this.attr("disabled",null),this},t}(),e.editor.History=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this),this.commands=[],this.index=-1,this.executing=!1}return t.defaults={max_commands:30},e.Evented.extend(t),t.prototype.execute=function(t,e){return t&&t.hasOwnProperty(e)&&(this.executing=!0,t[e](t),this.executing=!1),this},t.prototype.add=function(t){return this.executing?this:(this.commands.splice(this.index+1,this.commands.length-this.index),this.commands.push(t),this.commands.length>this.configs.max_commands&&(this.commands=this.commands.slice(-1*this.configs.max_commands)),this.index=this.commands.length-1,this.triggerEvent("add",{command:t}),this)},t.prototype.undo=function(){var t=this.commands[this.index];return t?(this.execute(t,"undo"),this.index-=1,this.triggerEvent("undo",{command:t}),this):this},t.prototype.redo=function(){var t=this.commands[this.index+1];return t?(this.execute(t,"redo"),this.index+=1,this.triggerEvent("redo",{command:t}),this):this},t.prototype.clear=function(){var t=this.commands.length;this.commands=[],this.index=-1,t>0&&this.triggerEvent("clear")},t.prototype.hasUndo=function(){return-1!==this.index},t.prototype.hasRedo=function(){return this.index<this.commands.length-1},t}(),e.editor.MainMenu=function(){function t(){t.parent.call(this,"<div/>",{"class":"main-menu clearfix"}),this.setupUI()}return e.Dom.extend(t),t.prototype.setupUI=function(){var t,n;t=new e.Dom("<div/>",{"class":"left"}).appendTo(this),n=new e.Dom("<div/>",{"class":"right"}).appendTo(this),(new e.editor.Button).attr({title:e.String.t("New")}).data("action","new").appendTo(t),(new e.editor.Button).attr({title:e.String.t("Open")}).data("action","open").appendTo(t),(new e.editor.Button).attr({title:e.String.t("edit")}).data("action","edit").appendTo(t),(new e.editor.Button).attr({title:e.String.t("save")}).data("action","save").appendTo(t),(new e.editor.Button).attr({title:e.String.t("download")}).data("action","download").appendTo(t),(new e.editor.Button).attr({title:e.String.t("delete")}).data("action","delete").appendTo(t),(new e.editor.field.Time).attr({title:e.String.t("time")}).data("action","time").appendTo(t),(new e.editor.Button).attr({title:e.String.t("revert")}).data("action","revert").appendTo(t),(new e.editor.Button).attr({title:e.String.t("undo")}).data("action","undo").appendTo(t),(new e.editor.Button).attr({title:e.String.t("redo")}).data("action","redo").appendTo(t),(new e.editor.Button).attr({title:e.String.t("settings")}).data("action","settings").appendTo(n),(new e.editor.Button).attr({title:e.String.t("help")}).data("action","help").appendTo(n)},t.prototype.enableItems=function(t){var e=this.children(t);return e.removeClass("disabled"),e},t.prototype.disableItems=function(t){var e=this.children(t);return e.addClass("disabled"),e},t}(),e.editor.Overlay=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this,"<div/>",{"class":"overlay clearfix"}),this.configs.modal&&(this.mask=new e.Dom("<div/>",{"class":"overlay-mask"})),this.configs.draggable&&(this.draggable=new e.Draggable({target:this,handle:this})),this.configs.autoShow&&this.show()
}return t.defaults={parent:".metaScore-editor",modal:!0,draggable:!0,autoShow:!1},e.Dom.extend(t),t.prototype.show=function(){return this.configs.modal&&this.mask.appendTo(this.configs.parent),this.appendTo(this.configs.parent),this},t.prototype.hide=function(){return this.configs.modal&&this.mask.remove(),this.remove(),this},t}(),e.editor.Panel=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this,"<div/>",{"class":"panel"}),this.onComponentDragStart=e.Function.proxy(this.onComponentDragStart,this),this.onComponentDragEnd=e.Function.proxy(this.onComponentDragEnd,this),this.onComponentResizeStart=e.Function.proxy(this.onComponentResizeStart,this),this.onComponentResizeEnd=e.Function.proxy(this.onComponentResizeEnd,this),this.fields={},this.menu=new e.editor.DropDownMenu,e.Array.each(this.configs.menuItems,function(t,e){this.menu.addItem(e)},this),this.toolbar=new e.editor.Toolbar({title:this.configs.title}).appendTo(this),this.toolbar.getTitle().addListener("click",e.Function.proxy(this.toggleState,this)),e.Array.each(this.configs.toolbarButtons,function(t,e){this.toolbar.addButton(e)},this),this.toolbar.addButton("menu").append(this.menu),this.contents=new e.Dom("<table/>",{"class":"fields"}).appendTo(this),this.addDelegate(".field","valuechange",e.Function.proxy(this.onFieldValueChange,this)),this.setupFields()}return t.defaults={title:"",toolbarButtons:["previous","next"],menuItems:[],fields:{}},e.Dom.extend(t),t.prototype.setupFields=function(){var t,n,o,i;e.Object.each(this.configs.fields,function(s,a){t=new e.Dom("<tr/>",{"class":"field-wrapper "+s}).appendTo(this.contents),n="field-"+e.String.uuid(5),o=a.configs||{},this.fields[s]=i=new a.type(o).attr("id",n),i.data("name",s),new e.Dom("<td/>").appendTo(t).append(new e.Dom("<label/>",{text:a.label,"for":n})),new e.Dom("<td/>").appendTo(t).append(i)},this)},t.prototype.getToolbar=function(){return this.toolbar},t.prototype.getField=function(t){return void 0===t?this.fields:this.fields[t]},t.prototype.enableFields=function(){e.Object.each(this.fields,function(t,e){e.enable()},this)},t.prototype.toggleFields=function(t){var n=this.getComponent();e.Object.each(this.fields,function(e,o){n&&this.configs.fields[e].hasOwnProperty("filter")&&this.configs.fields[e].filter(n)===!1?(this.hideField(e),o.disable()):(this.showField(e),t===!0?o.enable():o.disable())},this)},t.prototype.showField=function(t){this.contents.children("tr.field-wrapper."+t).show()},t.prototype.hideField=function(t){this.contents.children("tr.field-wrapper."+t).hide()},t.prototype.toggleState=function(){this.toggleClass("collapsed")},t.prototype.disable=function(){this.addClass("disabled"),this.getToolbar().getButton("previous").addClass("disabled"),this.getToolbar().getButton("next").addClass("disabled")},t.prototype.enable=function(){this.removeClass("disabled"),this.getToolbar().getButton("previous").removeClass("disabled"),this.getToolbar().getButton("next").removeClass("disabled")},t.prototype.getMenu=function(){return this.menu},t.prototype.getComponent=function(){return this.component},t.prototype.getDraggable=function(){return!1},t.prototype.getResizable=function(){return!1},t.prototype.setComponent=function(t,n){var o,i;if(t!==this.getComponent())return this.unsetComponent(n),this.component=t,this.toggleFields(!0),this.enable(),this.updateFieldValues(this.getValues(Object.keys(this.getField())),!0),t instanceof e.player.Controller||this.getMenu().enableItems('[data-action="delete"]'),o=this.getDraggable(),o&&(t._draggable=new e.Draggable(o).enable(),t.dom.addListener("dragstart",this.onComponentDragStart).addListener("dragend",this.onComponentDragEnd)),i=this.getResizable(),i&&(t._resizable=new e.Resizable(i).enable(),t.dom.addListener("resizestart",this.onComponentResizeStart).addListener("resizeend",this.onComponentResizeEnd)),t.dom.addClass("selected"),n!==!0&&this.triggerEvent("componentset",{component:t}),this},t.prototype.unsetComponent=function(t){var e=this.getComponent();return this.toggleFields(!1),this.disable(),this.getMenu().disableItems('[data-action="delete"]'),e&&(e._draggable&&(e._draggable.destroy(),delete e._draggable,e.dom.removeListener("dragstart",this.onComponentDragStart).removeListener("dragend",this.onComponentDragEnd)),e._resizable&&(e._resizable.destroy(),delete e._resizable,e.dom.removeListener("resizestart",this.onComponentResizeStart).removeListener("resizeend",this.onComponentResizeEnd)),e.dom.removeClass("selected"),this.component=null),t!==!0&&this.triggerEvent("componentunset",{component:e}),this},t.prototype.onComponentDragStart=function(){var t=(this.getComponent(),["x","y"]);this.beforeDragValues=this.getValues(t)},t.prototype.onComponentDragEnd=function(){var t=this.getComponent(),e=["x","y"];this.updateFieldValues(e,!0),this.triggerEvent("valueschange",{component:t,old_values:this.beforeDragValues,new_values:this.getValues(e)}),delete this.beforeDragValues},t.prototype.onComponentResizeStart=function(){var t=(this.getComponent(),["x","y","width","height"]);this.beforeResizeValues=this.getValues(t)},t.prototype.onComponentResizeEnd=function(){var t=this.getComponent(),e=["x","y","width","height"];this.updateFieldValues(e,!0),this.triggerEvent("valueschange",{component:t,old_values:this.beforeResizeValues,new_values:this.getValues(e)}),delete this.beforeResizeValues},t.prototype.onFieldValueChange=function(t){var e,n,o,i=this.getComponent();i&&(e=t.detail.field.data("name"),n=t.detail.value,o=this.getValues([e]),this.updateProperty(i,e,n),this.triggerEvent("valueschange",{component:i,old_values:o,new_values:this.getValues([e])}))},t.prototype.updateFieldValue=function(t,n,o){var i=this.getField(t);i instanceof e.editor.field.Boolean?i.setChecked(n):i.setValue(n),o!==!0&&i.triggerEvent("change")},t.prototype.updateFieldValues=function(t,n){e.Var.is(t,"array")?e.Array.each(t,function(t,e){this.updateFieldValue(e,this.getValue(e),n)},this):e.Object.each(t,function(t,e){this.updateFieldValue(t,e,n)},this)},t.prototype.updateProperty=function(t,e,n){this.configs.fields[e].setter(t,n)},t.prototype.updateProperties=function(t,n){e.Object.each(n,function(e,n){this.getField(e).disabled||this.updateProperty(t,e,n)},this),this.updateFieldValues(n,!0)},t.prototype.getValue=function(t){var e=this.getComponent();return this.configs.fields[t].getter(e)},t.prototype.getValues=function(t){var n={};return t=t||Object.keys(this.getField()),e.Array.each(t,function(t,e){this.getField(e).disabled||(n[e]=this.getValue(e))},this),n},t}(),e.editor.Toolbar=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this,"<div/>",{"class":"toolbar clearfix"}),this.title=new e.Dom("<div/>",{"class":"title"}).appendTo(this),this.buttons=new e.Dom("<div/>",{"class":"buttons"}).appendTo(this),this.configs.title&&this.title.text(this.configs.title)}return t.defaults={title:null},e.Dom.extend(t),t.prototype.getTitle=function(){return this.title},t.prototype.addButton=function(t){var n=(new e.editor.Button).data("action",t).appendTo(this.buttons);return n},t.prototype.getButton=function(t){return this.buttons.children('[data-action="'+t+'"]')},t}(),e.namespace("editor.field"),e.editor.field.Boolean=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this,this.configs),this.configs.checked&&this.attr("checked","checked")}return t.defaults={value:!0,unchecked_value:!1,checked:!1,disabled:!1,attributes:{type:"checkbox","class":"field booleanfield"}},e.editor.Field.extend(t),t.prototype.onChange=function(){this.value=this.is(":checked")?this.val():this.configs.unchecked_value,this.triggerEvent("valuechange",{field:this,value:this.value},!0,!1)},t.prototype.setChecked=function(t){this.attr("checked",t?"checked":"")},t}(),e.namespace("editor.field"),e.editor.field.Button=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this,this.configs)}return e.editor.Field.extend(t),t}(),e.namespace("editor.field"),e.editor.field.Color=function(){function t(n){this.configs=this.getConfigs(n),this.onGradientMousemove=e.Function.proxy(this.onGradientMousemove,this),this.onAlphaMousemove=e.Function.proxy(this.onAlphaMousemove,this),this.button=(new e.editor.Button).addListener("click",e.Function.proxy(this.onClick,this)),this.overlay=(new e.editor.Overlay).addClass("colorfield-overlay"),this.overlay.gradient=new e.Dom("<div/>",{"class":"gradient"}).appendTo(this.overlay),this.overlay.gradient.canvas=new e.Dom("<canvas/>",{width:"255",height:"255"}).addListener("click",e.Function.proxy(this.onGradientClick,this)).addListener("mousedown",e.Function.proxy(this.onGradientMousedown,this)).addListener("mouseup",e.Function.proxy(this.onGradientMouseup,this)).appendTo(this.overlay.gradient),this.overlay.gradient.position=new e.Dom("<div/>",{"class":"position"}).appendTo(this.overlay.gradient),this.overlay.alpha=new e.Dom("<div/>",{"class":"alpha"}).appendTo(this.overlay),this.overlay.alpha.canvas=new e.Dom("<canvas/>",{width:"20",height:"255"}).addListener("click",e.Function.proxy(this.onAlphaClick,this)).addListener("mousedown",e.Function.proxy(this.onAlphaMousedown,this)).addListener("mouseup",e.Function.proxy(this.onAlphaMouseup,this)).appendTo(this.overlay.alpha),this.overlay.alpha.position=new e.Dom("<div/>",{"class":"position"}).appendTo(this.overlay.alpha),this.overlay.controls=new e.Dom("<div/>",{"class":"controls"}).appendTo(this.overlay),this.overlay.controls.r=new e.Dom("<input/>",{type:"number",min:"0",max:"255",name:"r"}).addListener("input",e.Function.proxy(this.onControlInput,this)),new e.Dom("<div/>",{"class":"control-wrapper"}).append(new e.Dom("<label/>",{text:"R","for":"r"})).append(this.overlay.controls.r).appendTo(this.overlay.controls),this.overlay.controls.g=new e.Dom("<input/>",{type:"number",min:"0",max:"255",name:"g"}).addListener("input",e.Function.proxy(this.onControlInput,this)),new e.Dom("<div/>",{"class":"control-wrapper"}).append(new e.Dom("<label/>",{text:"G","for":"g"})).append(this.overlay.controls.g).appendTo(this.overlay.controls),this.overlay.controls.b=new e.Dom("<input/>",{type:"number",min:"0",max:"255",name:"b"}).addListener("input",e.Function.proxy(this.onControlInput,this)),new e.Dom("<div/>",{"class":"control-wrapper"}).append(new e.Dom("<label/>",{text:"B","for":"b"})).append(this.overlay.controls.b).appendTo(this.overlay.controls),this.overlay.controls.a=new e.Dom("<input/>",{type:"number",min:"0",max:"1",step:"0.01",name:"a"}).addListener("input",e.Function.proxy(this.onControlInput,this)),new e.Dom("<div/>",{"class":"control-wrapper"}).append(new e.Dom("<label/>",{text:"A","for":"a"})).append(this.overlay.controls.a).appendTo(this.overlay.controls),this.overlay.controls.current=new e.Dom("<canvas/>"),new e.Dom("<div/>",{"class":"canvas-wrapper current"}).append(this.overlay.controls.current).appendTo(this.overlay.controls),this.overlay.controls.previous=new e.Dom("<canvas/>"),new e.Dom("<div/>",{"class":"canvas-wrapper previous"}).append(this.overlay.controls.previous).appendTo(this.overlay.controls),this.overlay.controls.cancel=new e.editor.Button({label:"Cancel"}).addClass("cancel").addListener("click",e.Function.proxy(this.onCancelClick,this)).appendTo(this.overlay.controls),this.overlay.controls.apply=new e.editor.Button({label:"Apply"}).addClass("apply").addListener("click",e.Function.proxy(this.onApplyClick,this)).appendTo(this.overlay.controls),this.overlay.mask.addListener("click",e.Function.proxy(this.onApplyClick,this)),t.parent.call(this,this.configs),new e.Dom("<div/>",{"class":"icon"}).appendTo(this),this.button.appendTo(this),this.fillGradient()}return t.defaults={value:{r:255,g:255,b:255,a:1},disabled:!1,tag:"<div/>",attributes:{"class":"field colorfield"}},e.editor.Field.extend(t),t.prototype.setValue=function(t,n,o,i){var s;this.value=this.value||{},e.Var.is(t,"object")||(t=this.parseColor(t)),t.hasOwnProperty("r")&&(this.value.r=parseInt(t.r,10)),t.hasOwnProperty("g")&&(this.value.g=parseInt(t.g,10)),t.hasOwnProperty("b")&&(this.value.b=parseInt(t.b,10)),t.hasOwnProperty("a")&&(this.value.a=parseFloat(t.a)),n!==!1&&this.fillAlpha(),i!==!1&&(this.overlay.controls.r.val(this.value.r),this.overlay.controls.g.val(this.value.g),this.overlay.controls.b.val(this.value.b),this.overlay.controls.a.val(this.value.a)),o!==!1&&(s=this.rgb2hsv(this.value),this.overlay.gradient.position.css("left",255*(1-s.h)+"px"),this.overlay.gradient.position.css("top",127.5*s.s+127.5*(1-s.v/255)+"px"),this.overlay.alpha.position.css("top",255*(1-this.value.a)+"px")),this.fillCurrent(),this.button.css("background-color","rgba("+this.value.r+","+this.value.g+","+this.value.b+","+this.value.a+")")},t.prototype.onClick=function(){this.disabled||(this.previous_value=e.Object.copy(this.value),this.fillPrevious(),this.overlay.show())},t.prototype.onControlInput=function(){this.setValue({r:this.overlay.controls.r.val(),g:this.overlay.controls.g.val(),b:this.overlay.controls.b.val(),a:this.overlay.controls.a.val()},!0,!0,!1)},t.prototype.onCancelClick=function(t){this.setValue(this.previous_value),this.overlay.hide(),t.stopPropagation()},t.prototype.onApplyClick=function(t){this.overlay.hide(),this.triggerEvent("valuechange",{field:this,value:this.value},!0,!1),t.stopPropagation()},t.prototype.fillPrevious=function(){var t=this.overlay.controls.previous.get(0).getContext("2d");t.fillStyle="rgba("+this.previous_value.r+","+this.previous_value.g+","+this.previous_value.b+","+this.previous_value.a+")",t.clearRect(0,0,t.canvas.width,t.canvas.height),t.fillRect(0,0,t.canvas.width,t.canvas.height)},t.prototype.fillCurrent=function(){var t=this.overlay.controls.current.get(0).getContext("2d");t.fillStyle="rgba("+this.value.r+","+this.value.g+","+this.value.b+","+this.value.a+")",t.clearRect(0,0,t.canvas.width,t.canvas.height),t.fillRect(0,0,t.canvas.width,t.canvas.height)},t.prototype.fillGradient=function(){var t,e=this.overlay.gradient.canvas.get(0).getContext("2d");t=e.createLinearGradient(0,0,e.canvas.width,0),t.addColorStop(0,"rgb(255, 0, 0)"),t.addColorStop(.15,"rgb(255, 0, 255)"),t.addColorStop(.33,"rgb(0, 0, 255)"),t.addColorStop(.49,"rgb(0, 255, 255)"),t.addColorStop(.67,"rgb(0, 255, 0)"),t.addColorStop(.84,"rgb(255, 255, 0)"),t.addColorStop(1,"rgb(255, 0, 0)"),e.fillStyle=t,e.fillRect(0,0,e.canvas.width,e.canvas.height),t=e.createLinearGradient(0,0,0,e.canvas.height),t.addColorStop(0,"rgba(255, 255, 255, 1)"),t.addColorStop(.5,"rgba(255, 255, 255, 0)"),t.addColorStop(.5,"rgba(0, 0, 0, 0)"),t.addColorStop(1,"rgba(0, 0, 0, 1)"),e.fillStyle=t,e.fillRect(0,0,e.canvas.width,e.canvas.height)},t.prototype.fillAlpha=function(){var t,e=this.overlay.alpha.canvas.get(0).getContext("2d");t=e.createLinearGradient(0,0,0,e.canvas.height),t.addColorStop(0,"rgb("+this.value.r+","+this.value.g+","+this.value.b+")"),t.addColorStop(1,"transparent"),e.fillStyle=t,e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillRect(0,0,e.canvas.width,e.canvas.height)},t.prototype.onGradientMousedown=function(t){this.overlay.gradient.canvas.addListener("mousemove",this.onGradientMousemove),t.stopPropagation()},t.prototype.onGradientMouseup=function(t){this.overlay.gradient.canvas.removeListener("mousemove",this.onGradientMousemove),t.stopPropagation()},t.prototype.onGradientClick=function(t){var e=t.target.getBoundingClientRect(),n=t.pageX-e.left,o=t.pageY-e.top,i=this.overlay.gradient.canvas.get(0).getContext("2d"),s=i.getImageData(n,o,1,1),a=this.value;this.overlay.gradient.position.css("left",n+"px"),this.overlay.gradient.position.css("top",o+"px"),a.r=s.data[0],a.g=s.data[1],a.b=s.data[2],this.setValue(a,!0,!1),t.stopPropagation()},t.prototype.onGradientMousemove=t.prototype.onGradientClick,t.prototype.onAlphaMousedown=function(t){this.overlay.alpha.canvas.addListener("mousemove",this.onAlphaMousemove),t.stopPropagation()},t.prototype.onAlphaMouseup=function(t){this.overlay.alpha.canvas.removeListener("mousemove",this.onAlphaMousemove),t.stopPropagation()},t.prototype.onAlphaClick=function(t){var e=t.target.getBoundingClientRect(),n=t.pageY-e.top,o=this.overlay.alpha.canvas.get(0).getContext("2d"),i=o.getImageData(0,n,1,1),s=this.value;this.overlay.alpha.position.css("top",n+"px"),s.a=Math.round(100*(i.data[3]/255))/100,this.setValue(s,!1,!1),t.stopPropagation()},t.prototype.onAlphaMousemove=t.prototype.onAlphaClick,t.prototype.rgb2hsv=function(t){var e,n,o,i=t.r,s=t.g,a=t.b,r=Math.max(i,s,a),l=Math.min(i,s,a),c=r-l;if(n=0===r?0:c/r,o=r,r===l)e=0;else{switch(r){case i:e=(s-a)/c+(a>s?6:0);break;case s:e=(a-i)/c+2;break;case a:e=(i-s)/c+4}e/=6}return{h:e,s:n,v:o}},t.prototype.parseColor=function(t){var e,n={};return t=t.replace(/\s\s*/g,""),(e=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})/.exec(t))?(n.r=parseInt(e[1],16),n.g=parseInt(e[2],16),n.b=parseInt(e[3],16),n.a=1):(e=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])/.exec(t))?(n.r=17*parseInt(e[1],16),n.g=17*parseInt(e[2],16),n.b=17*parseInt(e[3],16),n.a=1):(e=/^rgba\(([\d]+),([\d]+),([\d]+),([\d]+|[\d]*.[\d]+)\)/.exec(t))?(n.r=+e[1],n.g=+e[2],n.b=+e[3],n.a=+e[4]):(e=/^rgb\(([\d]+),([\d]+),([\d]+)\)/.exec(t))&&(n.r=+e[1],n.g=+e[2],n.b=+e[3],n.a=1),n},t}(),e.namespace("editor.field"),e.editor.field.Corner=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this,this.configs)}return t.defaults={value:null,disabled:!1},e.editor.Field.extend(t),t}(),e.namespace("editor.field"),e.editor.field.Image=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this,this.configs),this.attr("readonly","readonly"),this.addListener("click",e.Function.proxy(this.onClick,this))}return t.defaults={value:null,disabled:!1,attributes:{"class":"field imagefield"}},e.editor.Field.extend(t),t.prototype.onClick=function(){Drupal.media.popups.mediaBrowser(e.Function.proxy(this.onFileSelect,this))},t.prototype.onFileSelect=function(t){t.length>0&&(this.setValue(t[0].url),this.triggerEvent("change"))},t}(),e.namespace("editor.field"),e.editor.field.Integer=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this,this.configs)}return t.defaults={value:0,disabled:!1,min:null,max:null,attributes:{type:"number","class":"field integerfield"}},e.editor.Field.extend(t),t}(),e.namespace("editor.field"),e.editor.field.Select=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this,this.configs),this.setOptions(this.configs.options)}return t.defaults={value:null,disabled:!1,options:{},tag:"<select/>",attributes:{"class":"field selectfield"}},e.editor.Field.extend(t),t.prototype.setOptions=function(t){e.Object.each(t,function(t,n){this.append(new e.Dom("<option/>",{text:n,value:t}))},this)},t.prototype.disable=function(){return this.disabled=!0,this.attr("disabled","disabled").addClass("disabled"),this},t.prototype.enable=function(){return this.disabled=!1,this.attr("disabled",null).removeClass("disabled"),this},t}(),e.namespace("editor.field"),e.editor.field.Text=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this,this.configs)}return t.defaults={value:"",disabled:!1,attributes:{"class":"field textfield"}},e.editor.Field.extend(t),t}(),e.namespace("editor.field"),e.editor.field.Time=function(){function t(n){this.configs=this.getConfigs(n),this.hours=new e.Dom("<input/>",{type:"number","class":"hours"}),this.minutes=new e.Dom("<input/>",{type:"number","class":"minutes"}),this.seconds=new e.Dom("<input/>",{type:"number","class":"seconds"}),this.centiseconds=new e.Dom("<input/>",{type:"number","class":"centiseconds"}),t.parent.call(this,this.configs),this.hours.addListener("input",e.Function.proxy(this.onInput,this)).appendTo(this),new e.Dom("<span/>",{text:":","class":"separator"}).appendTo(this),this.minutes.addListener("input",e.Function.proxy(this.onInput,this)).appendTo(this),new e.Dom("<span/>",{text:":","class":"separator"}).appendTo(this),this.seconds.addListener("input",e.Function.proxy(this.onInput,this)).appendTo(this),new e.Dom("<span/>",{text:".","class":"separator"}).appendTo(this),this.centiseconds.addListener("input",e.Function.proxy(this.onInput,this)).appendTo(this)}return t.defaults={value:0,disabled:!1,min:0,max:null,tag:"<div/>",attributes:{"class":"field timefield"}},e.editor.Field.extend(t),t.prototype.onInput=function(t){var e=parseInt(this.centiseconds.val(),10),n=parseInt(this.seconds.val(),10),o=parseInt(this.minutes.val(),10),i=parseInt(this.hours.val(),10);t.stopPropagation(),this.setValue(10*e+1e3*n+6e4*o+36e5*i)},t.prototype.setValue=function(t){var e,n,o,i;this.value=t,null!==this.configs.min&&(this.value=Math.max(this.value,this.configs.min)),null!==this.configs.max&&(this.value=Math.min(this.value,this.configs.max)),e=parseInt(this.value/10%100,10),n=parseInt(this.value/1e3%60,10),o=parseInt(this.value/6e4%60,10),i=parseInt(this.value/36e5,10),this.centiseconds.val(e),this.seconds.val(n),this.minutes.val(o),this.hours.val(i),this.triggerEvent("valuechange",{field:this,value:this.value},!0,!1)},t.prototype.disable=function(){return this.disabled=!0,this.hours.attr("disabled","disabled"),this.minutes.attr("disabled","disabled"),this.seconds.attr("disabled","disabled"),this.centiseconds.attr("disabled","disabled"),this.addClass("disabled"),this},t.prototype.enable=function(){return this.disabled=!1,this.hours.attr("disabled",null),this.minutes.attr("disabled",null),this.seconds.attr("disabled",null),this.centiseconds.attr("disabled",null),this.removeClass("disabled"),this},t}(),e.namespace("editor.panel"),e.editor.panel.Block=function(){function t(e){t.parent.call(this,e)}return t.defaults={title:e.String.t("Block"),menuItems:[{text:e.String.t("Add a new block"),"data-action":"new"},{text:e.String.t("Delete the active block"),"data-action":"delete"}],fields:{name:{type:e.editor.field.Text,label:e.String.t("Name"),getter:function(t){return t.dom.data("name")},setter:function(t,e){t.dom.data("name",e)},filter:function(t){return!(t instanceof e.player.Controller)}},x:{type:e.editor.field.Integer,label:e.String.t("X"),getter:function(t){return parseInt(t.dom.css("left"),10)},setter:function(t,e){t.dom.css("left",e+"px")}},y:{type:e.editor.field.Integer,label:e.String.t("Y"),getter:function(t){return parseInt(t.dom.css("top"),10)},setter:function(t,e){t.dom.css("top",e+"px")}},width:{type:e.editor.field.Integer,label:e.String.t("Width"),getter:function(t){return parseInt(t.dom.css("width"),10)},setter:function(t,e){t.dom.css("width",e+"px")},filter:function(t){return!(t instanceof e.player.Controller)}},height:{type:e.editor.field.Integer,label:e.String.t("Height"),getter:function(t){return parseInt(t.dom.css("height"),10)},setter:function(t,e){t.dom.css("height",e+"px")},filter:function(t){return!(t instanceof e.player.Controller)}},"bg-color":{type:e.editor.field.Color,label:e.String.t("Background color"),getter:function(t){return t.dom.css("background-color")},setter:function(t,e){t.dom.css("background-color","rgba("+e.r+","+e.g+","+e.b+","+e.a+")")},filter:function(t){return!(t instanceof e.player.Controller)}},"bg-image":{type:e.editor.field.Image,label:e.String.t("Background image"),getter:function(t){return t.dom.css("background-image").replace(/^url\(["']?/,"").replace(/["']?\)$/,"")},setter:function(t,e){t.dom.css("background-image","url("+e+")")},filter:function(t){return!(t instanceof e.player.Controller)}},synched:{type:e.editor.field.Boolean,label:e.String.t("Synchronized pages ?"),getter:function(t){return"true"===t.dom.data("synched")},setter:function(t,e){t.dom.data("synched",e)},filter:function(t){return!(t instanceof e.player.Controller)}}}},e.editor.Panel.extend(t),t.prototype.getDraggable=function(){var t=this.getComponent();return t instanceof e.player.Controller?{target:t.dom,handle:t.dom.child(".timer"),container:t.dom.parents()}:{target:t.dom,handle:t.dom.child(".pager"),container:t.dom.parents()}},t.prototype.getResizable=function(){var t=this.getComponent();return t instanceof e.player.Controller?!1:{target:t.dom,container:t.dom.parents()}},t}(),e.namespace("editor.panel"),e.editor.panel.Element=function(){function t(e){t.parent.call(this,e)}return t.defaults={title:e.String.t("Element"),menuItems:[{text:e.String.t("Add a new cursor"),"data-action":"new","data-type":"Cursor"},{text:e.String.t("Add a new image"),"data-action":"new","data-type":"Image"},{text:e.String.t("Add a new text element"),"data-action":"new","data-type":"Text"},{text:e.String.t("Delete the active element"),"data-action":"delete"}],fields:{name:{type:e.editor.field.Text,label:e.String.t("Name"),getter:function(t){return t.dom.data("name")},setter:function(t,e){t.dom.data("name",e)}},x:{type:e.editor.field.Integer,label:e.String.t("X"),getter:function(t){return parseInt(t.dom.css("left"),10)},setter:function(t,e){t.dom.css("left",e+"px")}},y:{type:e.editor.field.Integer,label:e.String.t("Y"),getter:function(t){return parseInt(t.dom.css("top"),10)},setter:function(t,e){t.dom.css("top",e+"px")}},width:{type:e.editor.field.Integer,label:e.String.t("Width"),getter:function(t){return parseInt(t.dom.css("width"),10)},setter:function(t,e){t.dom.css("width",e+"px")}},height:{type:e.editor.field.Integer,label:e.String.t("Height"),getter:function(t){return parseInt(t.dom.css("height"),10)},setter:function(t,e){t.dom.css("height",e+"px")}},"r-index":{type:e.editor.field.Integer,label:e.String.t("Reading index"),getter:function(t){return parseInt(t.dom.data("r-index"),10)},setter:function(t,e){t.dom.data("r-index",e)},configs:{min:0}},"z-index":{type:e.editor.field.Integer,label:e.String.t("Display index"),getter:function(t){return parseInt(t.dom.css("z-index"),10)},setter:function(t,e){t.dom.css("z-index",e)}},"bg-color":{type:e.editor.field.Color,label:e.String.t("Background color"),getter:function(t){return t.dom.css("background-color")},setter:function(t,e){t.dom.css("background-color","rgba("+e.r+","+e.g+","+e.b+","+e.a+")")}},"bg-image":{type:e.editor.field.Image,label:e.String.t("Background image"),getter:function(t){return t.dom.css("background-image").replace(/^url\(["']?/,"").replace(/["']?\)$/,"")},setter:function(t,e){t.dom.css("background-image","url("+e+")")}},"border-width":{type:e.editor.field.Integer,label:e.String.t("Border width"),getter:function(t){return parseInt(t.dom.css("border-width"),10)},setter:function(t,e){t.dom.css("border-width",e+"px")}},"border-color":{type:e.editor.field.Color,label:e.String.t("Border color"),getter:function(t){return t.dom.css("border-color")},setter:function(t,e){t.dom.css("border-color","rgba("+e.r+","+e.g+","+e.b+","+e.a+")")}},"rounded-conrners":{type:e.editor.field.Corner,label:e.String.t("Rounded conrners"),getter:function(){return null},setter:function(){}},"start-time":{type:e.editor.field.Time,label:e.String.t("Start time"),getter:function(t){return t.dom.data("start-time")},setter:function(t,e){t.dom.data("start-time",e)}},"end-time":{type:e.editor.field.Time,label:e.String.t("End time"),getter:function(t){return t.dom.data("end-time")},setter:function(t,e){t.dom.data("end-time",e)}},direction:{type:e.editor.field.Select,label:e.String.t("Direction"),getter:function(t){return t.dom.data("direction")},setter:function(t,e){t.dom.data("direction",e)},filter:function(t){return"cursor"===t.dom.data("type")},configs:{options:{right:e.String.t("Left > Right"),left:e.String.t("Right > Left"),bottom:e.String.t("Top > Bottom"),top:e.String.t("Bottom > Top")}}},"cursor-width":{type:e.editor.field.Integer,label:e.String.t("Cursor width"),getter:function(t){return t.cursor.css("width")},setter:function(t,e){t.cursor.css("width",e+"px")},filter:function(t){return"cursor"===t.dom.data("type")}},"cursor-color":{type:e.editor.field.Color,label:e.String.t("Cursor color"),getter:function(t){return t.cursor.css("background-color")},setter:function(t,e){t.cursor.css("background-color","rgba("+e.r+","+e.g+","+e.b+","+e.a+")")},filter:function(t){return"cursor"===t.dom.data("type")}},"font-family":{type:e.editor.field.Select,label:e.String.t("Font"),getter:function(t){return t.dom.css("font-family")},setter:function(t,e){t.dom.css("font-family",e)},filter:function(t){return"text"===t.dom.data("type")},configs:{options:{"Georgia, serif":"Georgia",'"Times New Roman", Times, serif':"Times New Roman","Arial, Helvetica, sans-serif":"Arial",'"Comic Sans MS", cursive, sans-serif':"Comic Sans MS","Impact, Charcoal, sans-serif":"Impact",'"Lucida Sans Unicode", "Lucida Grande", sans-serif':"Lucida Sans Unicode","Tahoma, Geneva, sans-serif":"Tahoma","Verdana, Geneva, sans-serif":"Verdana",'"Courier New", Courier, monospace':"Courier New",'"Lucida Console", Monaco, monospace':"Lucida Console"}}},"text-color":{type:e.editor.field.Color,label:e.String.t("Text color"),getter:function(t){return t.dom.css("color")},setter:function(t,e){t.dom.css("color",e)},filter:function(t){return"text"===t.dom.data("type")}}}},e.editor.Panel.extend(t),t.prototype.getDraggable=function(){var t=this.getComponent();return{target:t.dom,handle:t.dom,container:t.dom.parents()}},t.prototype.getResizable=function(){var t=this.getComponent();return{target:t.dom,container:t.dom.parents()}},t.prototype.setComponent=function(e,n){return t.parent.prototype.setComponent.call(this,e,n),"text"===e.dom.data("type")&&e.setEditable(!0),this},t}(),e.namespace("editor.panel"),e.editor.panel.Page=function(){function t(e){t.parent.call(this,e)}return t.defaults={title:e.String.t("Page"),menuItems:[{text:e.String.t("Add a new page"),"data-action":"new"},{text:e.String.t("Delete the active page"),"data-action":"delete"}],fields:{"bg-color":{type:e.editor.field.Color,label:e.String.t("Background color"),getter:function(t){return t.dom.css("background-color")},setter:function(t,e){t.dom.css("background-color","rgba("+e.r+","+e.g+","+e.b+","+e.a+")")}},"bg-image":{type:e.editor.field.Image,label:e.String.t("Background image"),getter:function(t){return t.dom.css("background-image").replace(/^url\(["']?/,"").replace(/["']?\)$/,"")},setter:function(t,e){t.dom.css("background-image","url("+e+")")}},"start-time":{type:e.editor.field.Time,label:e.String.t("Start time"),getter:function(t){return t.dom.data("start-time")||0},setter:function(t,e){t.dom.data("start-time",e)}},"end-time":{type:e.editor.field.Time,label:e.String.t("End time"),getter:function(t){return t.dom.data("end-time")||0},setter:function(t,e){t.dom.data("end-time",e)}}}},e.editor.Panel.extend(t),t}(),e.namespace("editor.overlay"),e.editor.overlay.Alert=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this,this.configs),this.addClass("alert"),this.buttons=new e.Dom("<div/>",{"class":"buttons"}).appendTo(this),this.configs.buttons,this.text=new e.Dom("<div/>",{"class":"text"}).appendTo(this),this.configs.text&&this.setText(this.configs.text)}return t.defaults={title:"",parent:".metaScore-editor",modal:!0,draggable:!1,text:"",buttons:[]},e.editor.Overlay.extend(t),t.prototype.setText=function(t){this.text.text(t)},t.prototype.setButtons=function(){},t}(),e.namespace("editor.overlay"),e.editor.overlay.Popup=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this,this.configs),this.addClass("popup"),this.toolbar=new e.editor.Toolbar({title:this.configs.title}).appendTo(this),this.toolbar.addButton("close").addListener("click",e.Function.proxy(this.onCloseClick,this)),this.contents=new e.Dom("<div/>",{"class":"contents"}).appendTo(this)}return t.defaults={title:"",parent:".metaScore-editor",modal:!0,draggable:!1},e.editor.Overlay.extend(t),t.prototype.getToolbar=function(){return this.toolbar},t.prototype.getContents=function(){return this.contents},t.prototype.onCloseClick=function(){this.hide()},t}(),e.namespace("editor.overlay.popup"),e.editor.overlay.popup.GuideSelector=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this,this.configs),this.addClass("guide-selector loading"),new e.Dom("<div/>",{"class":"loading",text:e.String.t("Loading...")}).appendTo(this.getContents()),e.Ajax.get(this.configs.url,{success:e.Function.proxy(this.onLoadSuccess,this),error:e.Function.proxy(this.onLoadError,this)})
}return t.defaults={title:e.String.t("Select a guide"),parent:".metaScore-editor",modal:!0,draggable:!1,url:null,selectCallback:e.Function.emptyFn,hideOnSelect:!0},e.editor.overlay.Popup.extend(t),t.prototype.onLoadSuccess=function(t){var n,o,i=this.getContents(),s=JSON.parse(t.response);this.removeClass("loading"),i.empty(),n=new e.Dom("<table/>",{"class":"guides"}).appendTo(i),e.Object.each(s,function(t,i){o=new e.Dom("<tr/>",{"class":"guide guide-"+i.id}).addListener("click",e.Function.proxy(this.onGuideClick,this,[i])).appendTo(n),new e.Dom("<td/>",{"class":"thumbnail"}).append(new e.Dom("<img/>",{src:i.thumbnail.url})).appendTo(o),new e.Dom("<td/>",{"class":"details"}).append(new e.Dom("<h1/>",{"class":"title",text:i.title})).append(new e.Dom("<p/>",{"class":"description",text:i.description})).append(new e.Dom("<h2/>",{"class":"author",text:i.author.name})).appendTo(o)},this)},t.prototype.onLoadError=function(){},t.prototype.onGuideClick=function(t){this.configs.selectCallback(t),this.configs.hideOnSelect&&this.hide()},t}(),e.Player=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this),this.configs.hasOwnProperty("id")||(this.configs.id=e.String.uuid()),this.media=new e.player.Media,this.controller=new e.player.Controller({container:this.configs.container}).addListener("click",e.Function.proxy(this.onBlockClick,this)),this.controller.dom.data("player-id",this.configs.id),e.Array.each(this.configs.blocks,function(t,e){this.addBlock(e)},this)}return t.defaults={container:"body",blocks:[],keyboard:!0},e.Evented.extend(t),t.prototype.addBlock=function(t){var n;return n=t instanceof e.player.Block?t:new e.player.Block(e.Object.extend({},t,{container:this.configs.container})),n.dom.data("player-id",this.configs.id),1>n.getPageCount()&&n.addPage(),n.addListener("click",e.Function.proxy(this.onBlockClick,this)).addListener("pageclick",e.Function.proxy(this.onPageClick,this)).addListener("elementclick",e.Function.proxy(this.onElementClick,this)).addListener("pageactivate",e.Function.proxy(this.onBlockPageActivated,this)),this.triggerEvent("blockadd",{player:this,block:n},!0,!1),n},t.prototype.destroy=function(t){var n=e.Dom.selectElements('.metaScore-block[data-player-id="'+this.configs.id+'"]',t);e.Array.each(n,function(t,e){e._metaScore.destroy()},this)},t.prototype.onBlockClick=function(t){this.triggerEvent("blockclick",{block:t.target})},t.prototype.onPageClick=function(t){this.triggerEvent("pageclick",{page:t.detail.page})},t.prototype.onElementClick=function(t){this.triggerEvent("elementclick",{element:t.detail.element})},t.prototype.onBlockPageActivated=function(t){this.triggerEvent("blockpageactivate",{block:t.target,page:t.detail.page})},t}(),e.namespace("player"),e.player.Block=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this),this.dom=new e.Dom("<div/>",{"class":"metaScore-block"}),this.dom.get(0)._metaScore=this,this.configs.container&&this.dom.appendTo(this.configs.container),this.pages=new e.Dom("<div/>",{"class":"pages"}).appendTo(this.dom),this.pager=(new e.player.Pager).appendTo(this.dom),this.pager.addDelegate(".button","click",e.Function.proxy(this.onPagerClick,this)),this.dom.addListener("click",e.Function.proxy(this.onClick,this)),e.Array.each(this.configs.pages,function(t,e){this.addPage(e)},this)}return t.defaults={container:null,pages:[]},e.Evented.extend(t),t.prototype.getPages=function(){return this.pages.children(".page")},t.prototype.addPage=function(t){var n;return n=t instanceof e.player.Page?t:new e.player.Page(t),n.dom.appendTo(this.pages),n.addListener("click",e.Function.proxy(this.onPageClick,this)).addListener("elementclick",e.Function.proxy(this.onElementClick,this)),this.setActivePage(this.getPages().count()-1),n},t.prototype.getActivePage=function(){var t=(this.getPages(),this.getActivePageIndex());return 0>t?null:this.getPages().get(t)._metaScore},t.prototype.getActivePageIndex=function(){var t=this.getPages(),e=t.index(".active");return e},t.prototype.getPageCount=function(){return this.getPages().count()},t.prototype.setActivePage=function(t){var n=this.getPages();e.Var.is(t,"number")&&(t=n.get(t)._metaScore),n.removeClass("active"),t.dom.addClass("active"),this.updatePager(),this.triggerEvent("pageactivate",{page:t})},t.prototype.updatePager=function(){var t=this.getActivePageIndex(),e=this.getPageCount();this.pager.updateCount(t,e)},t.prototype.isSynched=function(){return"true"===this.dom.data("synched")},t.prototype.onClick=function(t){this.triggerEvent("click"),t.stopPropagation()},t.prototype.onPageClick=function(t){this.triggerEvent("pageclick",{page:t.target})},t.prototype.onElementClick=function(t){this.triggerEvent("elementclick",{element:t.detail.element})},t.prototype.onPagerClick=function(t){var n,o=!e.Dom.hasClass(t.target,"inactive");if(o)switch(n=e.Dom.data(t.target,"action")){case"first":this.setActivePage(0);break;case"previous":this.setActivePage(this.getActivePageIndex()-1);break;case"next":this.setActivePage(this.getActivePageIndex()+1)}t.stopPropagation()},t.prototype.destroy=function(){this.dom.remove(),this.triggerEvent("destroy")},t}(),e.namespace("player"),e.player.Controller=function(){function t(n){var o;this.configs=this.getConfigs(n),t.parent.call(this),this.dom=new e.Dom("<div/>",{"class":"metaScore-block controller"}),this.dom.get(0)._metaScore=this,this.configs.container&&this.dom.appendTo(this.configs.container),this.timer=new e.Dom("<div/>",{"class":"timer",text:"00:00.00"}).appendTo(this.dom),o=new e.Dom("<div/>",{"class":"buttons"}).appendTo(this.dom),this.rewind_btn=new e.Dom("<button/>",{"data-action":"rewind"}).appendTo(o),this.play_btn=new e.Dom("<button/>",{"data-action":"play"}).appendTo(o),this.dom.addListener("click",e.Function.proxy(this.onClick,this))}return t.defaults={container:null},e.Evented.extend(t),t.prototype.onClick=function(t){this.triggerEvent("click"),t.stopPropagation()},t.prototype.destroy=function(){this.dom.remove(),this.triggerEvent("destroy")},t}(),e.namespace("player"),e.player.CuePoints=function(){function t(t){this.media=t,this.cuepoints=[],this.media.addEventListener("timeupdate",this.onMediaTimeUpdate)}return e.Class.extend(t),t.prototype.onMediaTimeUpdate=function(){var t;t=parseFloat(this.media.currentTime),e.Object.each(this.cuepoints,function(e,n){!n.timer&&t>=n.inTime-.5&&n.inTime>t&&this.setupTimer(n,1e3*(n.inTime-t))})},t.prototype.add=function(t){return this.cuepoints.push(t)-1},t.prototype.remove=function(t){var e=this.cuepoints[t];this.stop(e,!1),this.cuepoints.splice(t,1)},t.prototype.setupTimer=function(t,n){t.timer=setTimeout(e.Function.proxy(this.launch,this,t),n)},t.prototype.launch=function(t){t.hasOwnProperty("onStart")&&e.Var.is(t.onStart,"function")&&t.onStart(this.media)},t.prototype.stop=function(t,n){t.hasOwnProperty("timer")&&(clearTimeout(t.timer),delete t.timer),t.hasOwnProperty("interval")&&(clearInterval(t.interval),delete t.interval),n!==!1&&t.hasOwnProperty("onEnd")&&e.Var.is(t.onEnd,"function")&&t.onEnd(this.media)},t}(),e.namespace("player"),e.player.Element=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this),this.dom=new e.Dom("<div/>",{"class":"element"}),this.dom.get(0)._metaScore=this,this.contents=new e.Dom("<div/>",{"class":"contents"}).appendTo(this.dom),this.dom.addListener("click",e.Function.proxy(this.onClick,this))}return e.Evented.extend(t),t.prototype.onClick=function(t){this.triggerEvent("click"),t.stopPropagation()},t.prototype.destroy=function(){this.dom.remove(),this.triggerEvent("destroy")},t}(),e.namespace("player"),e.player.Media=function(){function t(t){this.configs=this.getConfigs(t)}return t.defaults={type:"video",sources:[]},e.Dom.extend(t),t.prototype.play=function(){},t.prototype.pause=function(){},t.prototype.stop=function(){},t.prototype.setCurrentTime=function(){},t.prototype.getCurrentTime=function(){},t}(),e.namespace("player"),e.player.Page=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this),this.dom=new e.Dom("<div/>",{"class":"page"}),this.dom.get(0)._metaScore=this,this.dom.addListener("click",e.Function.proxy(this.onClick,this)),e.Array.each(this.configs.elements,function(t,e){this.addElement(e)},this)}return t.defaults={elements:[]},e.Evented.extend(t),t.prototype.addElement=function(t){var n;return n=t instanceof e.player.Element?t:new e.player.element[t.type](t),n.dom.appendTo(this.dom),n.addListener("click",e.Function.proxy(this.onElementClick,this)),n},t.prototype.onClick=function(t){this.triggerEvent("click"),t.stopPropagation()},t.prototype.onElementClick=function(t){this.triggerEvent("elementclick",{element:t.target})},t.prototype.destroy=function(){this.dom.remove(),this.triggerEvent("destroy")},t}(),e.namespace("player"),e.player.Pager=function(){function t(n){n?(t.parent.call(this,n),this.count=this.child(".count"),this.buttons=this.child(".buttons"),this.buttons.first=this.buttons.child('[data-action="first"]'),this.buttons.previous=this.buttons.child('[data-action="previous"]'),this.buttons.next=this.buttons.child('[data-action="next"]')):(t.parent.call(this,"<div/>",{"class":"pager"}),this.count=new e.Dom("<div/>",{"class":"count"}).appendTo(this),this.buttons=new e.Dom("<div/>",{"class":"buttons"}).addListener("mousedown",function(t){t.stopPropagation()}).appendTo(this),this.buttons.first=new e.Dom("<div/>",{"class":"button","data-action":"first"}).appendTo(this.buttons),this.buttons.previous=new e.Dom("<div/>",{"class":"button","data-action":"previous"}).appendTo(this.buttons),this.buttons.next=new e.Dom("<div/>",{"class":"button","data-action":"next"}).appendTo(this.buttons))}return e.Dom.extend(t),t.prototype.updateCount=function(t,n){this.count.text(e.String.t("page !current/!count",{"!current":t+1,"!count":n})),this.buttons.first.toggleClass("inactive",0===t),this.buttons.previous.toggleClass("inactive",0===t),this.buttons.next.toggleClass("inactive",t>=n-1)},t}(),e.namespace("player.element"),e.player.element.Cursor=function(){function t(n){t.parent.call(this,n),this.dom.data("type","cursor"),this.cursor=new e.Dom("<div/>",{"class":"cursor"}).appendTo(this.contents)}return e.player.Element.extend(t),t}(),e.namespace("player.element"),e.player.element.Image=function(){function t(e){t.parent.call(this,e),this.dom.data("type","image")}return e.player.Element.extend(t),t}(),e.namespace("player.element"),e.player.element.Text=function(){function t(n){t.parent.call(this,n),this.dom.data("type","text"),this.text=new e.Dom("<div/>",{"class":"text"}).appendTo(this.contents)}return e.player.Element.extend(t),t.prototype.setEditable=function(t){this.text.attr("contenteditable",t?"true":"null")},t}(),t.metaScore=e})(this);