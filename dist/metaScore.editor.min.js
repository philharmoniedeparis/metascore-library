/*! metaScore - v0.0.2 - 2015-06-16 - Oussama Mubarak */
(function(t){"use strict";var e=t.metaScore;Element&&!Element.prototype.matches&&(Element.prototype.matches=Element.prototype.matchesSelector=Element.prototype.matchesSelector||Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||function(t){for(var e=this,n=(e.document||e.ownerDocument).querySelectorAll(t),i=0;n[i]&&n[i]!==e;)i++;return n[i]?!0:!1}),Element&&!Element.prototype.closest&&(Element.prototype.closest=function(t){for(var e=this;e;){if(e.matches(t))return e;e=e.parentElement}return null}),window.CustomEvent&&"function"==typeof window.CustomEvent||(window.CustomEvent=function(t,e){var n;return e=e||{bubbles:!1,cancelable:!1,detail:void 0},n=document.createEvent("CustomEvent"),n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n},window.CustomEvent.prototype=window.Event.prototype),function(){for(var t=0,e=["ms","moz","webkit","o"],n=0;e.length>n&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[e[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[n]+"CancelAnimationFrame"]||window[e[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var n=(new Date).getTime(),i=Math.max(0,16-(n-t)),o=window.setTimeout(function(){e(n+i)},i);return t=n+i,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}(),e=t.metaScore={getVersion:function(){return"0.0.2"},getRevision:function(){return"bd4a39"},namespace:function(t){for(var e,n=this,i=t.split("."),o=0,s=i.length;s>o;o++)e=i[o],n[e]=n[e]||{},n=n[e];return n}},e.Class=function(){function t(){}return t.defaults={},t.extend=function(t){t.prototype=Object.create(this.prototype,{constructor:{value:t}}),t.parent=this,t.extend=this.extend,"defaults"in t||(t.defaults={});for(var e in this.defaults)e in t.defaults||(t.defaults[e]=this.defaults[e])},t.prototype.getConfigs=function(t){t=t||{};for(var e in this.constructor.defaults)e in t||(t[e]=this.constructor.defaults[e]);return t},t}(),e.Evented=function(){function t(){t.parent.call(this),this.listeners={}}return e.Class.extend(t),t.prototype.addListener=function(t,e){return this.listeners[t]===void 0&&(this.listeners[t]=[]),this.listeners[t].push(e),this},t.prototype.removeListener=function(t,e){if(this.listeners[t]instanceof Array)for(var n=this.listeners[t],i=0,o=n.length;o>i;i++)if(n[i]===e){n.splice(i,1);break}return this},t.prototype.triggerEvent=function(t,n,i,o){var s,a;return this.listeners[t]instanceof Array&&(s=this.listeners[t],a={target:this,type:t,detail:n,bubbles:i!==!1,cancelable:o!==!1},e.Object.each(s,function(t,e){e.call(this,a)},this)),this},t}(),e.Ajax=function(){function t(){}return e.Class.extend(t),t.createXHR=function(){var t,e,n,i=["MSXML2.XMLHttp.5.0","MSXML2.XMLHttp.4.0","MSXML2.XMLHttp.3.0","MSXML2.XMLHttp","Microsoft.XMLHttp"];if("undefined"!=typeof XMLHttpRequest)return t=new XMLHttpRequest;if(window.ActiveXObject)for(e=0,n=i.length;n>e;e++)try{return t=new ActiveXObject(i[e])}catch(o){}throw Error("XMLHttp object could be created.")},t.send=function(n,i){var o=t.createXHR(),s={method:"GET",headers:{},async:!0,data:{},dataType:"json",complete:null,success:null,error:null,scope:this};if(i=e.Object.extend({},s,i),!("POST"!==i.method&&"PUT"!==i.method||"Content-type"in i.headers))switch(i.dataType){case"json":i.headers["Content-type"]="application/json;charset=UTF-8";break;default:i.headers["Content-type"]="application/x-www-form-urlencoded"}return o.open(i.method,n,i.async),e.Object.each(i.headers,function(t,e){o.setRequestHeader(t,e)}),o.onreadystatechange=function(){4===o.readyState&&(e.Var.is(i.complete,"function")&&i.complete.call(i.scope,o),o.status>=200&&300>o.status||304===o.status?e.Var.is(i.success,"function")&&i.success.call(i.scope,o):e.Var.is(i.error,"function")&&i.error.call(i.scope,o))},o.send(i.data),o},t.get=function(n,i){return e.Object.extend(i,{method:"GET"}),t.send(n,i)},t.post=function(n,i){return e.Object.extend(i,{method:"POST"}),t.send(n,i)},t.put=function(n,i){return e.Object.extend(i,{method:"PUT"}),t.send(n,i)},t}(),e.Array=function(){function t(){}return e.Class.extend(t),t.inArray=function(t,e){var n,i=0;if(e){if(e.indexOf)return e.indexOf(t);for(n=e.length;n>i;i++)if(i in e&&e[i]===t)return i}return-1},t.copy=function(t){return[].concat(t)},t.shuffle=function(e){var n=t.copy(e);return n.sort(function(){return(0|3*Math.random())-1}),n},t.unique=function(t){for(var e=[],n=t.length,i=0;n>i;i++){for(var o=i+1;n>o;o++)t[i]===t[o]&&(o=++i);e.push(t[i])}return e},t.each=function(t,e,n){for(var i,o=0,s=t.length,a=void 0!==n;s>o&&(i=e.call(a?n:t[o],o,t[o]),i!==!1);o++);return t},t.remove=function(e,n){for(var i=t.inArray(n,e);i>-1;)e.splice(i,1),i=t.inArray(n,e);return e},t}(),e.Color=function(){function t(){}return e.Class.extend(t),t.rgb2hsv=function(t){var e,n,i,o=t.r,s=t.g,a=t.b,r=Math.max(o,s,a),l=Math.min(o,s,a),c=r-l;if(n=0===r?0:c/r,i=r,r===l)e=0;else{switch(r){case o:e=(s-a)/c+(a>s?6:0);break;case s:e=(a-o)/c+2;break;case a:e=(o-s)/c+4}e/=6}return{h:e,s:n,v:i}},t.parse=function(t){var n,i;return n={r:0,g:0,b:0,a:0},e.Var.is(t,"object")?(n.r="r"in t?t.r:0,n.g="g"in t?t.g:0,n.b="b"in t?t.b:0,n.a="a"in t?t.a:1):e.Var.is(t,"string")&&(t=t.replace(/\s\s*/g,""),(i=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})/.exec(t))?(n.r=parseInt(i[1],16),n.g=parseInt(i[2],16),n.b=parseInt(i[3],16),n.a=1):(i=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])/.exec(t))?(n.r=17*parseInt(i[1],16),n.g=17*parseInt(i[2],16),n.b=17*parseInt(i[3],16),n.a=1):(i=/^rgba\(([\d]+),([\d]+),([\d]+),([\d]+|[\d]*.[\d]+)\)/.exec(t))?(n.r=+i[1],n.g=+i[2],n.b=+i[3],n.a=+i[4]):(i=/^rgb\(([\d]+),([\d]+),([\d]+)\)/.exec(t))&&(n.r=+i[1],n.g=+i[2],n.b=+i[3],n.a=1)),n},t}(),e.Dom=function(){function t(){var t;this.elements=[],arguments.length>0&&((t=e.Dom.elementsFromString.apply(this,arguments))?(this.add(t),arguments.length>1&&this.attr(arguments[1])):(t=e.Dom.selectElements.apply(this,arguments))&&(this.add(t),arguments.length>2&&this.attr(arguments[2])))}return e.Class.extend(t),t.stringRe=/^<(.)+>$/,t.camelRe=/-([\da-z])/gi,t.camelReplaceFn=function(t,e){return e.toUpperCase()},t.camel=function(e){return e.replace(t.camelRe,t.camelReplaceFn)},t.bubbleEvents={click:!0,submit:!0,mousedown:!0,mousemove:!0,mouseup:!0,mouseover:!0,mouseout:!0,transitionend:!0},t.selectElement=function(t,n){var i;return n||(n=document),i=e.Var.is(t,"string")?n.querySelector(t):t.length?t[0]:t},t.selectElements=function(n,i){var o;return i?i instanceof t&&(i=i.get(0)):i=document,o=e.Var.is(n,"string")?i.querySelectorAll(n):n.length?n:[n]},t.elementsFromString=function(t){var e,n,i,o={option:[1,"<select multiple='multiple'>","</select>"],optgroup:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tbody:[1,"<table>","</table>"],tfoot:[1,"<table>","</table>"],colgroup:[1,"<table>","</table>"],caption:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],th:[3,"<table><tbody><tr>","</tr></tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[1,"<div>","</div>"]},s=document.createElement("div"),a=/<\s*\w.*?>/g.exec(t);if(null!=a){for(e=a[0].replace(/</g,"").replace(/\/?>/g,""),n=o[e]||o._default,t=n[1]+t+n[2],s.innerHTML=t,i=n[0];i--;)s=s.lastChild;return s.childNodes}return null},t.hasClass=function(t,e){return t.classList.contains(e)},t.addClass=function(t,e){for(var n=e.split(" "),i=0,o=n.length;o>i;i++)t.classList.add(n[i])},t.removeClass=function(t,e){for(var n=e.split(" "),i=0,o=n.length;o>i;i++)t.classList.remove(n[i])},t.toggleClass=function(t,e,n){var i=e.split(" "),o=0,s=i.length;if(void 0===n)for(;s>o;o++)t.classList.toggle(i[o]);else for(;s>o;o++)t.classList.toggle(i[o],n)},t.addListener=function(e,n,i,o){return void 0===o&&(o="type"in t.bubbleEvents?t.bubbleEvents[n]:!1),e.addEventListener(n,i,o)},t.removeListener=function(e,n,i,o){return void 0===o&&(o="type"in t.bubbleEvents?t.bubbleEvents[n]:!1),e.removeEventListener(n,i,o)},t.triggerEvent=function(t,e,n,i,o){var s=new CustomEvent(e,{detail:n,bubbles:i!==!1,cancelable:o!==!1});return t.dispatchEvent(s)},t.text=function(t,e){return void 0!==e&&(t.innerHTML=e),t.innerHTML},t.val=function(t,e){return void 0!==e&&(t.value=e),t.value},t.attr=function(n,i,o){if(e.Var.is(i,"object"))e.Object.each(i,function(e,i){t.attr(n,e,i)},this);else switch(i){case"class":this.addClass(n,o);break;case"text":this.text(n,o);break;default:if(null!==o)return void 0!==o&&n.setAttribute(i,o),n.getAttribute(i);n.removeAttribute(i)}},t.css=function(t,e,n,i){var o,s;return o=this.camel(e),void 0!==n&&(t.style[o]=n),s=i===!0?t.style:window.getComputedStyle(t),s.getPropertyValue(e)},t.data=function(t,e,n){return e=this.camel(e),null===n?delete t.dataset[e]:void 0!==n&&(t.dataset[e]=n),t.dataset[e]},t.append=function(t,n){e.Var.is(n,"array")||(n=[n]),e.Array.each(n,function(e,n){t.appendChild(n)},this)},t.before=function(t,n){e.Var.is(n,"array")||(n=[n]),e.Array.each(n,function(e,n){t.parentElement.insertBefore(n,t)},this)},t.after=function(t,n){e.Var.is(n,"array")||(n=[n]),e.Array.each(n,function(e,n){t.parentElement.insertBefore(n,t.nextSibling)},this)},t.empty=function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},t.remove=function(t){t.parentElement&&t.parentElement.removeChild(t)},t.is=function(t,e){var n,i;return t instanceof Element?Element.prototype.matches.call(t,e):(n=t.ownerDocument)&&(i=n.defaultView||n.parentWindow)?t instanceof i.Element&&Element.prototype.matches.call(t,e):!1},t.closest=function(t,e){var n,i;return t instanceof Element?Element.prototype.closest.call(t,e):(n=t.ownerDocument)&&(i=n.defaultView||n.parentWindow)&&t instanceof i.Element?Element.prototype.closest.call(t,e):null},t.prototype.add=function(t){if("length"in t)for(var e=0;t.length>e;e++)this.elements.push(t[e]);else this.elements.push(t)},t.prototype.count=function(){return this.elements.length},t.prototype.get=function(t){return this.elements[t]},t.prototype.filter=function(e){var n=new t;return this.each(function(i,o){t.is(o,e)&&n.add(o)},this),n},t.prototype.index=function(e){var n=-1;return this.each(function(i,o){return t.is(o,e)?(n=i,!1):void 0},this),n},t.prototype.find=function(e){var n=new t;return this.each(function(i,o){n.add(t.selectElements.call(this,e,o))},this),n},t.prototype.children=function(e){var n=new t;return this.each(function(t,e){n.add(e.children)},this),e&&(n=n.filter(e)),n},t.prototype.child=function(e){return new t(this.children(e).get(0))},t.prototype.parents=function(e){var n=new t;return this.each(function(t,e){n.add(e.parentElement)},this),e&&(n=n.filter(e)),n},t.prototype.each=function(t,n){n=n||this,e.Array.each(this.elements,t,n)},t.prototype.hasClass=function(e){var n;return this.each(function(i,o){return n=t.hasClass(o,e),!n},this),n},t.prototype.addClass=function(e){return this.each(function(n,i){t.addClass(i,e)},this),this},t.prototype.removeClass=function(e){return this.each(function(n,i){t.removeClass(i,e)},this),this},t.prototype.toggleClass=function(e,n){return this.each(function(i,o){t.toggleClass(o,e,n)},this),this},t.prototype.addListener=function(e,n,i){return this.each(function(o,s){t.addListener(s,e,n,i)},this),this},t.prototype.addDelegate=function(e,n,i,o,s){return o=o||this,this.addListener(n,function(n){for(var s,a=n.target;a;){if(t.is(a,e)){s=a;break}a=a.parentElement}s&&i.call(o,n,s)},s)},t.prototype.removeListener=function(e,n,i){return this.each(function(o,s){t.removeListener(s,e,n,i)},this),this},t.prototype.triggerEvent=function(e,n,i,o){var s=!0;return this.each(function(a,r){s=t.triggerEvent(r,e,n,i,o)&&s},this),s},t.prototype.text=function(e){return void 0===e?t.text(this.get(0)):(this.each(function(n,i){t.text(i,e)},this),void 0)},t.prototype.val=function(e){return void 0!==e?(this.each(function(n,i){t.val(i,e)},this),this):t.val(this.get(0))},t.prototype.attr=function(n,i){return void 0!==i||e.Var.is(n,"object")?(this.each(function(e,o){t.attr(o,n,i)},this),this):t.attr(this.get(0),n)},t.prototype.css=function(e,n,i){return void 0!==n?(this.each(function(o,s){t.css(s,e,n,i)},this),this):t.css(this.get(0),e,n,i)},t.prototype.data=function(e,n){return void 0!==n?(this.each(function(i,o){t.data(o,e,n)},this),this):t.data(this.get(0),e)},t.prototype.append=function(e){return e instanceof t&&(e=e.elements),t.append(this.get(0),e),this},t.prototype.appendTo=function(e){return e instanceof t||(e=new t(e)),e=e.get(0),this.each(function(n,i){t.append(e,i)},this),this},t.prototype.insertAt=function(e,n){var i;return e instanceof t||(e=new t(e)),i=e.children().get(n),i?t.before(i,this.elements):this.appendTo(e),this},t.prototype.empty=function(){return this.each(function(e,n){t.empty(n)},this),this},t.prototype.show=function(){return this.css("display",""),this},t.prototype.hide=function(){return this.css("display","none"),this},t.prototype.focus=function(){return this.get(0).focus(),this},t.prototype.blur=function(){return this.get(0).blur(),this},t.prototype.remove=function(){return this.triggerEvent("beforeremove")!==!1&&this.each(function(e,n){var i=n.parentElement;t.remove(n),t.triggerEvent(i,"childremove",{child:n})},this),this},t.prototype.is=function(e){var n;return this.each(function(i,o){return n=t.is(o,e)},this),n},t.prototype.closest=function(e){var n;return this.each(function(i,o){return n=t.closest(o,e),null!==n},this),n},t}(),e.Draggable=function(){function t(t){this.configs=this.getConfigs(t),this.configs.container=this.configs.container||new e.Dom("body"),this.onMouseDown=e.Function.proxy(this.onMouseDown,this),this.onMouseMove=e.Function.proxy(this.onMouseMove,this),this.onMouseUp=e.Function.proxy(this.onMouseUp,this),this.configs.handle.addListener("mousedown",this.onMouseDown),this.enable()}return t.defaults={limits:{top:null,left:null}},e.Class.extend(t),t.prototype.onMouseDown=function(t){this.enabled&&(this.start_state={left:parseInt(this.configs.target.css("left"),10)-t.clientX,top:parseInt(this.configs.target.css("top"),10)-t.clientY},this.configs.container.addListener("mouseup",this.onMouseUp).addListener("mousemove",this.onMouseMove),this.configs.target.addClass("dragging").triggerEvent("dragstart",null,!1,!0),t.stopPropagation())},t.prototype.onMouseMove=function(t){var e=t.clientX+this.start_state.left,n=t.clientY+this.start_state.top;isNaN(this.configs.limits.top)||(n=Math.max(n,this.configs.limits.top)),isNaN(this.configs.limits.left)||(e=Math.max(e,this.configs.limits.left)),this.configs.target.css("left",e+"px").css("top",n+"px").triggerEvent("drag",null,!1,!0),t.stopPropagation()},t.prototype.onMouseUp=function(t){this.configs.container.removeListener("mousemove",this.onMouseMove).removeListener("mouseup",this.onMouseUp),this.configs.target.removeClass("dragging").triggerEvent("dragend",null,!1,!0),t.stopPropagation()},t.prototype.enable=function(){return this.configs.target.addClass("draggable"),this.configs.handle.addClass("drag-handle"),this.enabled=!0,this},t.prototype.disable=function(){return this.configs.target.removeClass("draggable"),this.configs.handle.removeClass("drag-handle"),this.enabled=!1,this},t.prototype.destroy=function(){return this.disable(),this.configs.handle.removeListener("mousedown",this.onMouseDown),this},t}(),e.Function=function(){function t(){}return e.Class.extend(t),t.proxy=function(t,n,i){return e.Var.type(t,"function")?function(){return t.apply(n||this,i||arguments)}:void 0},t.emptyFn=function(){},t}(),e.Object=function(){function t(){}return e.Class.extend(t),t.extend=function(){for(var t,e,n,i,o=arguments[0]||{},s=1,a=arguments.length;a>s;s++)if(null!=(t=arguments[s]))for(e in t)n=o[e],i=t[e],n!==i&&void 0!==i&&(o[e]=i);return o},t.copy=function(e){return t.extend({},e)},t.each=function(t,e,n){var i,o,s=void 0!==n;for(i in t)if(o=e.call(s?n:t[i],i,t[i]),o===!1)break;return t},t}(),e.Resizable=function(){function t(t){this.configs=this.getConfigs(t),this.configs.container=this.configs.container||new e.Dom("body"),this.handles={},this.onMouseDown=e.Function.proxy(this.onMouseDown,this),this.onMouseMove=e.Function.proxy(this.onMouseMove,this),this.onMouseUp=e.Function.proxy(this.onMouseUp,this),e.Array.each(this.configs.directions,function(t,n){this.handles[n]=new e.Dom("<div/>",{"class":"resize-handle"}).data("direction",n).addListener("mousedown",this.onMouseDown).appendTo(this.configs.target)},this),this.enable()}return t.defaults={directions:["top","right","bottom","left","top-left","top-right","bottom-left","bottom-right"]},e.Class.extend(t),t.prototype.onMouseDown=function(t){this.enabled&&(this.start_state={handle:t.target,x:t.clientX,y:t.clientY,left:parseInt(this.configs.target.css("left"),10),top:parseInt(this.configs.target.css("top"),10),w:parseInt(this.configs.target.css("width"),10),h:parseInt(this.configs.target.css("height"),10)},this.configs.container.addListener("mousemove",this.onMouseMove,this).addListener("mouseup",this.onMouseUp,this),this.configs.target.addClass("resizing").triggerEvent("resizestart",null,!1,!0),t.stopPropagation())},t.prototype.onMouseMove=function(t){var n,i,o,s,a=new e.Dom(this.start_state.handle);switch(a.data("direction")){case"top":i=this.start_state.h-t.clientY+this.start_state.y,o=this.start_state.top+t.clientY-this.start_state.y;break;case"right":n=this.start_state.w+t.clientX-this.start_state.x;break;case"bottom":i=this.start_state.h+t.clientY-this.start_state.y;break;case"left":n=this.start_state.w-t.clientX+this.start_state.x,s=this.start_state.left+t.clientX-this.start_state.x;break;case"top-left":n=this.start_state.w-t.clientX+this.start_state.x,i=this.start_state.h-t.clientY+this.start_state.y,o=this.start_state.top+t.clientY-this.start_state.y,s=this.start_state.left+t.clientX-this.start_state.x;break;case"top-right":n=this.start_state.w+t.clientX-this.start_state.x,i=this.start_state.h-t.clientY+this.start_state.y,o=this.start_state.top+t.clientY-this.start_state.y;break;case"bottom-left":n=this.start_state.w-t.clientX+this.start_state.x,i=this.start_state.h+t.clientY-this.start_state.y,s=this.start_state.left+t.clientX-this.start_state.x;break;case"bottom-right":n=this.start_state.w+t.clientX-this.start_state.x,i=this.start_state.h+t.clientY-this.start_state.y}void 0!==o&&this.configs.target.css("top",o+"px"),void 0!==s&&this.configs.target.css("left",s+"px"),this.configs.target.css("width",n+"px").css("height",i+"px").triggerEvent("resize",null,!1,!0),t.stopPropagation()},t.prototype.onMouseUp=function(t){this.configs.container.removeListener("mousemove",this.onMouseMove,this).removeListener("mouseup",this.onMouseUp,this),this.configs.target.removeClass("resizing").triggerEvent("resizeend",null,!1,!0),t.stopPropagation()},t.prototype.enable=function(){return this.configs.target.addClass("resizable"),this.enabled=!0,this},t.prototype.disable=function(){return this.configs.target.removeClass("resizable"),this.enabled=!1,this},t.prototype.destroy=function(){return this.disable(),e.Object.each(this.handles,function(t,e){e.remove()},this),this},t}(),e.String=function(){function t(){}return e.Class.extend(t),t.capitalize=function(t){return t.replace(/(?:^|\s)\S/g,function(t){return t.toUpperCase()})},t.uuid=function(t,e){var n,i=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],o=[];if(e=e||i.length,t)for(n=0;t>n;n++)o[n]=i[0|Math.random()*e];else{var s;for(o[8]=o[13]=o[18]=o[23]="-",o[14]="4",n=0;36>n;n++)o[n]||(s=0|16*Math.random(),o[n]=i[19===n?8|3&s:s])}return o.join("")},t.pad=function(t,e,n,i){var o,s,a;if(e===void 0&&(e=0),n===void 0&&(n=" "),i===void 0&&(i="right"),t+="",e+1>=t.length)switch(i){case"left":t=Array(e+1-t.length).join(n)+t;break;case"both":a=e-t.length,o=Math.ceil(a/2),s=a-o,t=Array(s+1).join(n)+t+Array(o+1).join(n);break;default:t+=Array(e+1-t.length).join(n)}return t},t}(),e.StyleSheet=function(){function t(t){this.configs=this.getConfigs(t),e.Dom.call(this,"<style/>",{type:"text/css"}),this.el=this.get(0),this.setInternalValue("")}return e.Dom.extend(t),t.prototype.addRule=function(t,e,n){var i=this.el.sheet;return void 0===n&&(n=i.cssRules.length),"insertRule"in i?i.insertRule(t+"{"+e+"}",n):"addRule"in i?i.addRule(t,e,n):void 0},t.prototype.removeRule=function(t){var e=this.el.sheet;return"deleteRule"in e?e.deleteRule(t):"removeRule"in e&&e.removeRule(t),this},t.prototype.removeRulesBySelector=function(t){var e=this.el.sheet,n=e.cssRules||e.rules;t=t.toLowerCase();for(var i=0;n.length>i;i++)if(n[i].selectorText.toLowerCase()===t){this.removeRule(i);break}return this},t.prototype.removeRules=function(){for(var t=this.el.sheet,e=t.cssRules||t.rules;e.length>0;)this.removeRule(0);return this},t.prototype.setInternalValue=function(t){return this.el.styleSheet?this.el.styleSheet.cssText=t:this.text(t),this},t}(),e.Var=function(){function t(){}var n={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"};return e.Class.extend(t),t.type=function(t){return null==t?t+"":n[Object.prototype.toString.call(t)]||"object"},t.is=function(e,n){return t.type(e)===n.toLowerCase()},t.isEmpty=function(t){return void 0===t||null==t?!0:t.hasOwnProperty("length")?0>=t.length:e.Var.is(t,"object")?0>=Object.keys(t).length:!1},t}(),e.Locale=function(){function t(){}return e.Class.extend(t),t.t=function(e,n,i){return"undefined"!=typeof metaScoreLocale&&metaScoreLocale.hasOwnProperty(e)&&(n=metaScoreLocale[e]),t.formatString(n,i)},t.formatString=function(t,n){return e.Object.each(n,function(e){t=t.replace(e,n[e])},this),t},t}(),e.Editor=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this,"<div/>",{"class":"metaScore-editor"}),this.configs.container&&this.appendTo(this.configs.container),this.h_ruler=new e.Dom("<div/>",{"class":"ruler horizontal"}).appendTo(this),this.v_ruler=new e.Dom("<div/>",{"class":"ruler vertical"}).appendTo(this),this.workspace=new e.Dom("<div/>",{"class":"workspace"}).appendTo(this),this.mainmenu=(new e.editor.MainMenu).appendTo(this).addDelegate("button[data-action]:not(.disabled)","click",e.Function.proxy(this.onMainmenuClick,this)).addDelegate(".time","valuechange",e.Function.proxy(this.onMainmenuTimeFieldChange,this)).addDelegate(".r-index","valuechange",e.Function.proxy(this.onMainmenuRindexFieldChange,this)),this.sidebar_wrapper=new e.Dom("<div/>",{"class":"sidebar-wrapper"}).appendTo(this).addListener("resizestart",e.Function.proxy(this.onSidebarResizeStart,this)).addListener("resize",e.Function.proxy(this.onSidebarResize,this)).addListener("resizeend",e.Function.proxy(this.onSidebarResizeEnd,this)),new e.Resizable({target:this.sidebar_wrapper,directions:["left"]}),this.sidebar=new e.Dom("<div/>",{"class":"sidebar"}).appendTo(this.sidebar_wrapper),this.panels={},this.panels.block=(new e.editor.panel.Block).appendTo(this.sidebar).addListener("componentbeforeset",e.Function.proxy(this.onBlockBeforeSet,this)).addListener("componentset",e.Function.proxy(this.onBlockSet,this)).addListener("componentunset",e.Function.proxy(this.onBlockUnset,this)).addListener("valueschange",e.Function.proxy(this.onBlockPanelValueChange,this)),this.panels.block.getToolbar().addDelegate(".selector","valuechange",e.Function.proxy(this.onBlockPanelSelectorChange,this)).addDelegate(".buttons [data-action]","click",e.Function.proxy(this.onBlockPanelToolbarClick,this)),this.panels.page=(new e.editor.panel.Page).appendTo(this.sidebar).addListener("componentbeforeset",e.Function.proxy(this.onPageBeforeSet,this)).addListener("componentset",e.Function.proxy(this.onPageSet,this)).addListener("componentunset",e.Function.proxy(this.onPageUnset,this)).addListener("valueschange",e.Function.proxy(this.onPagePanelValueChange,this)),this.panels.page.getToolbar().addDelegate(".selector","valuechange",e.Function.proxy(this.onPagePanelSelectorChange,this)).addDelegate(".buttons [data-action]","click",e.Function.proxy(this.onPagePanelToolbarClick,this)),this.panels.element=(new e.editor.panel.Element).appendTo(this.sidebar).addListener("componentbeforeset",e.Function.proxy(this.onElementBeforeSet,this)).addListener("componentset",e.Function.proxy(this.onElementSet,this)).addListener("componentunset",e.Function.proxy(this.onElementUnset,this)).addListener("valueschange",e.Function.proxy(this.onElementPanelValueChange,this)),this.panels.element.getToolbar().addDelegate(".selector","valuechange",e.Function.proxy(this.onElementPanelSelectorChange,this)).addDelegate(".buttons [data-action]","click",e.Function.proxy(this.onElementPanelToolbarClick,this)),this.panels.text=(new e.editor.panel.Text).appendTo(this.sidebar),this.grid=new e.Dom("<div/>",{"class":"grid"}).appendTo(this.workspace),this.version=new e.Dom("<div/>",{"class":"version",text:"metaScore v."+e.getVersion()+" r."+e.getRevision()}).appendTo(this.workspace),this.player_frame=new e.Dom("<iframe/>",{"class":"player-frame"}).appendTo(this.workspace).addListener("load",e.Function.proxy(this.onPlayerFrameLoadSuccess,this)).addListener("error",e.Function.proxy(this.onPlayerFrameLoadError,this)),this.history=(new e.editor.History).addListener("add",e.Function.proxy(this.onHistoryAdd,this)).addListener("undo",e.Function.proxy(this.onHistoryUndo,this)).addListener("redo",e.Function.proxy(this.onHistoryRedo,this)),this.detailsOverlay=(new e.editor.overlay.GuideInfo).addListener("submit",e.Function.proxy(this.onDetailsOverlaySubmit,this)),new e.Dom("body").addListener("keydown",e.Function.proxy(this.onKeydown,this)).addListener("keyup",e.Function.proxy(this.onKeyup,this)),new e.Dom(window).addListener("beforeunload",e.Function.proxy(this.onBeforeUnload,this)),this.addDelegate(".timefield","valuein",e.Function.proxy(this.onTimeFieldIn,this)).addDelegate(".timefield","valueout",e.Function.proxy(this.onTimeFieldOut,this)).updateMainmenu().setEditing(!1).loadPlayerFromHash()}return e.Dom.extend(t),t.defaults={container:"body",api_url:"",ajax:{}},t.prototype.onGuideSaveSuccess=function(){this.loadmask.hide(),delete this.loadmask},t.prototype.onGuideSaveError=function(){this.loadmask.hide(),delete this.loadmask,new e.editor.overlay.Alert({text:e.Locale.t("editor.onGuideSaveError.msg","An error occured while trying to save the guide. Please try again."),buttons:{ok:e.Locale.t("editor.onGuideSaveError.ok","OK")},autoShow:!0})},t.prototype.onGuideDeleteConfirm=function(){var t,n=this.getPlayer().getId();t=e.Object.extend({},{dataType:"json",method:"DELETE",success:e.Function.proxy(this.onGuideDeleteSuccess,this),error:e.Function.proxy(this.onGuideDeleteError,this)},this.configs.ajax),this.loadmask=new e.editor.overlay.LoadMask({autoShow:!0}),e.Ajax.send(this.configs.api_url+"guide/"+n+".json",t)},t.prototype.onGuideDeleteSuccess=function(){this.removePlayer(),this.loadmask.hide(),delete this.loadmask},t.prototype.onGuideDeleteError=function(){this.loadmask.hide(),delete this.loadmask,new e.editor.overlay.Alert({text:e.Locale.t("editor.onGuideDeleteError.msg","An error occured while trying to delete the guide. Please try again."),buttons:{ok:e.Locale.t("editor.onGuideSaveError.ok","OK")},autoShow:!0})},t.prototype.onGuideRevertConfirm=function(){this.addPlayer(this.getPlayer().getId())},t.prototype.onGuideSelectorSelect=function(t){this.addPlayer(t.detail.guide.id)},t.prototype.onKeydown=function(t){switch(t.keyCode){case 18:t.repeat||(this.setEditing(!this.persistentEditing,!1),t.preventDefault());break;case 90:t.ctrlKey&&(this.history.undo(),t.preventDefault());break;case 89:t.ctrlKey&&(this.history.redo(),t.preventDefault())}},t.prototype.onKeyup=function(t){switch(t.keyCode){case 18:this.setEditing(this.persistentEditing,!1),t.preventDefault()}},t.prototype.onMainmenuClick=function(t){switch(e.Dom.data(t.target,"action")){case"open":this.hasOwnProperty("player")?new e.editor.overlay.Alert({text:e.Locale.t("editor.onMainmenuClick.open.msg","Are you sure you want to open another guide ?<br/><strong>Any unsaved data will be lost.</strong>"),buttons:{confirm:e.Locale.t("editor.onMainmenuClick.open.yes","Yes"),cancel:e.Locale.t("editor.onMainmenuClick.open.no","No")},autoShow:!0}).addListener("confirmclick",e.Function.proxy(this.openGuideSelector,this)):this.openGuideSelector();break;case"edit":this.detailsOverlay.show();break;case"save":this.saveGuide();break;case"download":break;case"delete":new e.editor.overlay.Alert({text:e.Locale.t("editor.onMainmenuClick.delete.msg","Are you sure you want to delete this guide ?"),buttons:{confirm:e.Locale.t("editor.onMainmenuClick.delete.yes","Yes"),cancel:e.Locale.t("editor.onMainmenuClick.delete.no","No")},autoShow:!0}).addListener("confirmclick",e.Function.proxy(this.onGuideDeleteConfirm,this));break;case"revert":new e.editor.overlay.Alert({text:e.Locale.t("editor.onMainmenuClick.revert.msg","Are you sure you want to revert back to the last saved version ?<br/><strong>Any unsaved data will be lost.</strong>"),buttons:{confirm:e.Locale.t("editor.onMainmenuClick.revert.yes","Yes"),cancel:e.Locale.t("editor.onMainmenuClick.revert.no","No")},autoShow:!0}).addListener("confirmclick",e.Function.proxy(this.onGuideRevertConfirm,this));break;case"undo":this.history.undo();break;case"redo":this.history.redo();break;case"edit-toggle":this.setEditing(!e.editing);break;case"settings":}},t.prototype.onMainmenuTimeFieldChange=function(t){var e=t.target._metaScore,n=e.getValue();this.getPlayer().media.setTime(n)},t.prototype.onMainmenuRindexFieldChange=function(t){var e=t.target._metaScore,n=e.getValue();this.getPlayer().setReadingIndex(n,!0)},t.prototype.onTimeFieldIn=function(t){var e=t.target._metaScore,n=this.getPlayer().media.getTime();e.setValue(n)},t.prototype.onTimeFieldOut=function(t){var e=t.target._metaScore,n=e.getValue();this.getPlayer().media.setTime(n)},t.prototype.onSidebarResizeStart=function(){this.addClass("sidebar-resizing")},t.prototype.onSidebarResize=function(){var t=parseInt(this.sidebar_wrapper.css("width"),10);this.workspace.css("right",t+"px")},t.prototype.onSidebarResizeEnd=function(){this.removeClass("sidebar-resizing")},t.prototype.onBlockBeforeSet=function(t){t.detail.component,this.panels.element.unsetComponent(),this.panels.page.unsetComponent()},t.prototype.onBlockSet=function(t){var e=t.detail.component;e.instanceOf("Block")&&(this.panels.page.getToolbar().toggleMenuItem("new",!0),this.panels.page.setComponent(e.getActivePage()),this.panels.element.getToolbar().toggleMenuItem("Cursor",!0).toggleMenuItem("Image",!0).toggleMenuItem("Text",!0)),this.updatePageSelector(),t.stopPropagation()},t.prototype.onBlockUnset=function(){this.panels.page.unsetComponent(),this.panels.page.getToolbar().toggleMenuItem("new",!1)},t.prototype.onBlockPanelValueChange=function(t){var e=this.panels.block,n=t.detail.component,i=t.detail.old_values,o=t.detail.new_values;this.history.add({undo:function(){e.updateProperties(n,i)},redo:function(){e.updateProperties(n,o)}})},t.prototype.onBlockPanelToolbarClick=function(t){var n,i,o,s,a,r,l,c=e.Dom.data(t.target,"action");switch(c){case"synched":case"non-synched":n=this.getPlayer(),i=this.panels.block,s=n.addBlock({name:e.Locale.t("editor.onBlockPanelToolbarClick.defaultBlockName","untitled"),synched:"synched"===c}),l={},"synched"===c&&(l["start-time"]=0,l["end-time"]=this.getPlayer().getMedia().getDuration()),s.addPage(l),i.setComponent(s),this.history.add({undo:function(){i.unsetComponent(),s.remove()},redo:function(){n.addBlock(s),i.setComponent(s)}});break;case"delete":n=this.getPlayer(),i=this.panels.block,s=this.panels.block.getComponent(),s&&(i.unsetComponent(),s.remove(),this.history.add({undo:function(){n.addBlock(s),i.setComponent(s)
},redo:function(){i.unsetComponent(),s.remove()}}));break;case"previous":o=this.getPlayer().getComponents(".media.video, .controller, .block"),a=o.count(),a>0&&(r=o.index(".selected")-1,0>r&&(r=a-1),s=o.get(r)._metaScore,this.panels.block.setComponent(s));break;case"next":o=this.getPlayer().getComponents(".media.video, .controller, .block"),a=o.count(),a>0&&(r=o.index(".selected")+1,r>=a&&(r=0),s=o.get(r)._metaScore,this.panels.block.setComponent(s))}t.stopPropagation()},t.prototype.onBlockPanelSelectorChange=function(t){var e,n=t.detail.value;n?(e=this.getPlayer().getComponent(".media#"+n+", .controller#"+n+", .block#"+n),e&&e._metaScore&&this.panels.block.setComponent(e._metaScore)):this.panels.block.unsetComponent()},t.prototype.onPageBeforeSet=function(t){var e=t.detail.component,n=e.getBlock();this.panels.element.unsetComponent(),this.panels.block.setComponent(n)},t.prototype.onPageSet=function(t){var e,n,i,o=(t.detail.component,this.panels.block.getComponent()),s=this.panels.page.getField("start-time"),a=this.panels.page.getField("end-time");this.panels.page.getToolbar().toggleMenuItem("new",!0),this.panels.element.unsetComponent().getToolbar().toggleMenuItem("Cursor",!0).toggleMenuItem("Image",!0).toggleMenuItem("Text",!0),o.getProperty("synched")?(e=o.getActivePageIndex(),n=o.getPage(e-1),i=o.getPage(e+1),n?s.readonly(!1).enable().setMin(n.getProperty("start-time")):s.readonly(!0).enable(),i?a.readonly(!1).enable().setMax(i.getProperty("end-time")):a.readonly(!0).enable()):(s.disable(),a.disable()),this.updateElementSelector(),t.stopPropagation()},t.prototype.onPageUnset=function(){this.panels.element.unsetComponent().getToolbar().toggleMenuItem("Cursor",!1).toggleMenuItem("Image",!1).toggleMenuItem("Text",!1)},t.prototype.onPagePanelValueChange=function(t){var e,n,i,o,s=this,a=this.panels.page,r=t.detail.component,l=t.detail.old_values,c=t.detail.new_values;("start-time"in c||"end-time"in c)&&((e=r.getBlock())&&e.getProperty("synched")&&(n=e.getActivePageIndex(),i=e.getPage(n-1),o=e.getPage(n+1),"start-time"in c&&i&&i.setProperty("end-time",c["start-time"]),"end-time"in c&&o&&o.setProperty("start-time",c["end-time"])),s.updateElementSelector()),this.history.add({undo:function(){a.updateProperties(r,l),("start-time"in c||"end-time"in c)&&("start-time"in c&&i&&i.setProperty("end-time",l["start-time"]),"end-time"in c&&o&&o.setProperty("start-time",l["end-time"]),s.updateElementSelector())},redo:function(){a.updateProperties(r,c),("start-time"in c||"end-time"in c)&&("start-time"in c&&i&&i.setProperty("end-time",c["start-time"]),"end-time"in c&&o&&o.setProperty("start-time",c["end-time"]),s.updateElementSelector())}})},t.prototype.onPagePanelToolbarClick=function(t){var n,i,o,s,a,r,l,c,d,p,h,u=e.Dom.data(t.target,"action");switch(u){case"new":n=this.panels.page,i=this.panels.block.getComponent(),r={},i.getProperty("synched")&&(h=i.getActivePageIndex(),l=i.getPage(h),s=this.getPlayer().media.getTime(),a=l.getProperty("end-time"),r["start-time"]=s,r["end-time"]=a,l.setProperty("end-time",s)),o=i.addPage(r,h+1),n.setComponent(o),this.history.add({undo:function(){n.unsetComponent(),i.removePage(o),i.getProperty("synched")&&l.setProperty("end-time",a),i.setActivePage(h)},redo:function(){i.getProperty("synched")&&l.setProperty("end-time",s),i.addPage(o,h+1),n.setComponent(o)}});break;case"delete":n=this.panels.page,i=this.panels.block.getComponent(),o=n.getComponent(),h=i.getActivePageIndex(),o&&(n.unsetComponent(),i.removePage(o),1>i.getPageCount()&&(r={},i.getProperty("synched")&&(r["start-time"]=0,r["end-time"]=this.getPlayer().getMedia().getDuration()),c=i.addPage(r),n.setComponent(c)),i.setActivePage(h),this.history.add({undo:function(){c&&i.removePage(c,!0),i.addPage(o),n.setComponent(o)},redo:function(){n.unsetComponent(),i.removePage(o,!0),c&&(i.addPage(c),n.setComponent(c)),i.setActivePage(h)}}));break;case"previous":i=this.panels.block.getComponent(),i&&(d=new e.Dom(".page",i),p=d.count(),p>0&&(h=d.index(".selected")-1,0>h&&(h=p-1),o=d.get(h)._metaScore,i.setActivePage(o)));break;case"next":i=this.panels.block.getComponent(),i&&(d=new e.Dom(".page",i),p=d.count(),p>0&&(h=d.index(".selected")+1,h>=p&&(h=0),o=d.get(h)._metaScore,i.setActivePage(o)))}t.stopPropagation()},t.prototype.onPagePanelSelectorChange=function(t){var e,n,i=this.panels.block.getComponent();i&&(e=t.detail.value,n=this.getPlayer().getComponent(".page#"+e),n&&n._metaScore&&i.setActivePage(n._metaScore))},t.prototype.onElementBeforeSet=function(t){var e=t.detail.component,n=e.parents().get(0)._metaScore;this.panels.page.setComponent(n)},t.prototype.onElementSet=function(t){var e=t.detail.component;"Text"===e.getProperty("type")&&this.panels.text.setComponent(e),t.stopPropagation()},t.prototype.onElementUnset=function(t){this.panels.text.unsetComponent(),t.stopPropagation()},t.prototype.onElementPanelValueChange=function(t){var e=this,n=this.panels.element,i=t.detail.component,o=t.detail.old_values,s=t.detail.new_values;("start-time"in s||"end-time"in s)&&e.updateElementSelector(),this.history.add({undo:function(){n.updateProperties(i,o),("start-time"in s||"end-time"in s)&&e.updateElementSelector()},redo:function(){n.updateProperties(i,s),("start-time"in s||"end-time"in s)&&e.updateElementSelector()}})},t.prototype.onElementPanelToolbarClick=function(t){var n,i,o,s,a,r,l=e.Dom.data(t.target,"action");switch(l){case"Cursor":case"Image":case"Text":n=this.panels.element,i=this.panels.page.getComponent(),o=i.addElement({type:l,name:e.Locale.t("editor.onElementPanelToolbarClick.defaultElementName","untitled")}),n.setComponent(o),this.history.add({undo:function(){n.unsetComponent(),o.remove()},redo:function(){i.addElement(o),n.setComponent(o)}});break;case"delete":n=this.panels.element,i=this.panels.page.getComponent(),o=this.panels.element.getComponent(),o&&(n.unsetComponent(),o.remove(),this.history.add({undo:function(){i.addElement(o),n.setComponent(o)},redo:function(){n.unsetComponent(),o.remove()}}));break;case"previous":i=this.panels.page.getComponent(),i&&(s=new e.Dom(".element",i),a=s.count(),a>0&&(r=s.index(".selected")-1,0>r&&(r=a-1),o=s.get(r)._metaScore,this.panels.element.setComponent(o)));break;case"next":i=this.panels.page.getComponent(),i&&(s=new e.Dom(".element",i),a=s.count(),a>0&&(r=s.index(".selected")+1,r>=a&&(r=0),o=s.get(r)._metaScore,this.panels.element.setComponent(o)))}},t.prototype.onElementPanelSelectorChange=function(t){var e,n=t.detail.value;n?(e=this.getPlayer().getComponent(".element#"+n),e&&e._metaScore&&this.panels.element.setComponent(e._metaScore)):this.panels.element.unsetComponent()},t.prototype.onPlayerTimeUpdate=function(t){var e=t.detail.media.getTime();this.mainmenu.timefield.setValue(e,!0)},t.prototype.onPlayerReadingIndex=function(t){var e=t.detail.value;this.mainmenu.rindexfield.setValue(e,!0)},t.prototype.onPlayerBlockAdd=function(){this.updateBlockSelector()},t.prototype.onPlayerChildRemove=function(t){var e=t.detail.child,n=e._metaScore;n&&(n.instanceOf("Block")?this.updateBlockSelector():n.instanceOf("Page")?this.updatePageSelector():n.instanceOf("Element")&&this.updateElementSelector())},t.prototype.onPlayerFrameLoadSuccess=function(){this.player_frame.get(0).contentWindow.player.addListener("loadsuccess",e.Function.proxy(this.onPlayerLoadSuccess,this)).addListener("loaderror",e.Function.proxy(this.onPlayerLoadError,this))},t.prototype.onPlayerFrameLoadError=function(){this.loadmask.hide(),delete this.loadmask,new e.editor.overlay.Alert({text:e.Locale.t("editor.onPlayerLoadError.msg","An error occured while trying to load the guide. Please try again."),buttons:{ok:e.Locale.t("editor.onPlayerLoadError.ok","OK")},autoShow:!0})},t.prototype.onPlayerLoadSuccess=function(t){this.player=t.detail.player.addClass("in-editor").addDelegate(".metaScore-component","click",e.Function.proxy(this.onComponentClick,this)).addDelegate(".metaScore-component.block","pageadd",e.Function.proxy(this.onBlockPageAdd,this)).addDelegate(".metaScore-component.block","pageactivate",e.Function.proxy(this.onBlockPageActivate,this)).addDelegate(".metaScore-component.page","elementadd",e.Function.proxy(this.onPageElementAdd,this)).addListener("blockadd",e.Function.proxy(this.onPlayerBlockAdd,this)).addListener("keydown",e.Function.proxy(this.onKeydown,this)).addListener("keyup",e.Function.proxy(this.onKeyup,this)).addListener("click",e.Function.proxy(this.onPlayerClick,this)).addListener("timeupdate",e.Function.proxy(this.onPlayerTimeUpdate,this)).addListener("rindex",e.Function.proxy(this.onPlayerReadingIndex,this)).addListener("childremove",e.Function.proxy(this.onPlayerChildRemove,this)),this.setEditing(!0).updateMainmenu().updateBlockSelector(),this.mainmenu.rindexfield.setValue(0,!0),window.history.replaceState(null,null,"#guide="+this.player.getId()),this.loadmask.hide(),delete this.loadmask},t.prototype.onPlayerLoadError=function(){this.loadmask.hide(),delete this.loadmask,new e.editor.overlay.Alert({text:e.Locale.t("editor.onPlayerLoadError.msg","An error occured while trying to load the guide. Please try again."),buttons:{ok:e.Locale.t("editor.onPlayerLoadError.ok","OK")},autoShow:!0})},t.prototype.onComponentClick=function(t,n){var i;e.editing===!0&&(i=n._metaScore,i.instanceOf("Element")?this.panels.element.setComponent(i):i.instanceOf("Page")?this.panels.page.setComponent(i):this.panels.block.setComponent(i),t.stopImmediatePropagation())},t.prototype.onPlayerClick=function(t){e.editing===!0&&(this.panels.block.unsetComponent(),t.stopPropagation())},t.prototype.onBlockPageAdd=function(t){var e=t.detail.block;e===this.panels.block.getComponent()&&this.updatePageSelector(),t.stopPropagation()},t.prototype.onBlockPageActivate=function(t){var n,i;e.editing===!0&&(n=t.detail.page,i=t.detail.basis,("pagecuepoint"!==i||n.getBlock()===this.panels.block.getComponent())&&this.panels.page.setComponent(n))},t.prototype.onPageElementAdd=function(t){var e=t.detail.page;e===this.panels.page.getComponent()&&this.updateElementSelector(),t.stopPropagation()},t.prototype.onHistoryAdd=function(){this.updateMainmenu()},t.prototype.onHistoryUndo=function(){this.updateMainmenu()},t.prototype.onHistoryRedo=function(){this.updateMainmenu()},t.prototype.onDetailsOverlaySubmit=function(t){var e=t.detail.values;this.getPlayer().updateCSS(e.css)},t.prototype.onBeforeUnload=function(t){this.hasOwnProperty("player")&&(t.returnValue=e.Locale.t("editor.onBeforeUnload.msg","Any unsaved data will be lost."))},t.prototype.setEditing=function(t,n){var i=this.getPlayer();return e.editing=t!==!1,n!==!1&&(this.persistentEditing=e.editing),e.Object.each(this.panels,function(t,n){e.editing?n.enable():n.disable()}),this.toggleClass("editing",e.editing),i&&i.toggleClass("editing",e.editing),this},t.prototype.loadPlayerFromHash=function(){var t;return(t=window.location.hash.match(/(#|&)guide=(\d+)/))&&this.addPlayer(t[2]),this},t.prototype.updateMainmenu=function(){var t=this.hasOwnProperty("player");return this.mainmenu.toggleButton("edit",t),this.mainmenu.toggleButton("save",t),this.mainmenu.toggleButton("delete",t),this.mainmenu.toggleButton("download",t),this.mainmenu.toggleButton("undo",this.history.hasUndo()),this.mainmenu.toggleButton("redo",this.history.hasRedo()),this.mainmenu.toggleButton("revert",t),this},t.prototype.updateBlockSelector=function(){var t=this.panels.block.getComponent(),e=this.panels.block.getToolbar();return e.emptySelector().addSelectorOption(null,""),this.getPlayer().getComponents(".media.video, .controller, .block").each(function(t,n){n._metaScore&&e.addSelectorOption(n._metaScore.getId(),n._metaScore.getName())},this),e.setSelectorValue(t?t.getId():null,!0),this},t.prototype.updatePageSelector=function(){var t=this.panels.block.getComponent(),e=this.panels.page.getComponent(),n=this.panels.page.getToolbar();return n.emptySelector(),t.instanceOf("Block")&&this.panels.block.getComponent().getPages().each(function(t,e){n.addSelectorOption(e._metaScore.getId(),t+1)},this),n.setSelectorValue(e?e.getId():null,!0),this},t.prototype.updateElementSelector=function(){var t,e,n,i,o,s,a=this.panels.block.getComponent(),r=this.panels.page.getComponent(),l=this.panels.element.getToolbar(),c=a.getProperty("synched");return l.emptySelector().addSelectorOption(null,""),c&&(n=r.getProperty("start-time"),i=r.getProperty("end-time")),r.instanceOf("Page")&&r.getElements().each(function(a,r){t=r._metaScore,e=!1,c&&(o=t.getProperty("start-time"),s=t.getProperty("end-time"),e=null!==o&&n>o||null!==s&&s>i),l.addSelectorOption(t.getId(),(e?"*":"")+t.getName()).toggleClass("out-of-range",e)},this),t=this.panels.element.getComponent(),l.setSelectorValue(t?t.getId():null,!0),this},t.prototype.getPlayer=function(){return this.player},t.prototype.addPlayer=function(t){return this.loadmask=new e.editor.overlay.LoadMask({autoShow:!0}),this.player_frame.attr("src","http://metascore.localhost/player/"+t),this},t.prototype.removePlayer=function(){return delete this.player,this.player_frame.attr("src","about:blank"),this.panels.block.unsetComponent(),this.updateMainmenu(),this},t.prototype.openGuideSelector=function(){return new e.editor.overlay.GuideSelector({url:this.configs.api_url+"guide.json",autoShow:!0}).addListener("select",e.Function.proxy(this.onGuideSelectorSelect,this)),this},t.prototype.saveGuide=function(){var t,n,i=this.getPlayer(),o=i.getId(),s=i.getComponents(".media, .controller, .block"),a=this.detailsOverlay.getValues();return a.blocks=[],s.each(function(n,i){t=i._metaScore,t.instanceOf("Media")?a.blocks.push(e.Object.extend({type:"media"},t.getProperties())):t.instanceOf("Controller")?a.blocks.push(e.Object.extend({type:"controller"},t.getProperties())):t.instanceOf("Block")&&a.blocks.push(t.getProperties())},this),n=e.Object.extend({},{data:JSON.stringify(a),dataType:"json",success:e.Function.proxy(this.onGuideSaveSuccess,this),error:e.Function.proxy(this.onGuideSaveError,this)},this.configs.ajax),this.loadmask=new e.editor.overlay.LoadMask({autoShow:!0}),e.Ajax.put(this.configs.api_url+"guide/"+o+".json",n),this},t}(),e.namespace("editor").Button=function(){function t(t){this.configs=this.getConfigs(t),e.Dom.call(this,"<button/>"),this.disabled=!1,this.configs.label&&this.setLabel(this.configs.label),this.addListener("click",e.Function.proxy(this.onClick,this))}return t.defaults={label:null},e.Dom.extend(t),t.prototype.onClick=function(t){this.disabled&&t.stopPropagation()},t.prototype.setLabel=function(t){return void 0===this.label&&(this.label=new e.Dom("<span/>",{"class":"label"}).appendTo(this)),this.label.text(t),this},t.prototype.disable=function(){return this.disabled=!0,this.addClass("disabled"),this},t.prototype.enable=function(){return this.disabled=!1,this.removeClass("disabled"),this},t}(),e.namespace("editor").DropDownMenu=function(){function t(t){this.configs=this.getConfigs(t),e.Dom.call(this,"<ul/>",{"class":"dropdown-menu"})}return e.Dom.extend(t),t.prototype.addItem=function(t,n){var i=new e.Dom("<li/>",{"data-action":t,text:n}).appendTo(this);return i},t.prototype.toggleItem=function(t,e){return this.child('[data-action="'+t+'"]').toggleClass("disabled",e===!1),this},t}(),e.namespace("editor").Field=function(){function t(t){this.configs=this.getConfigs(t),e.Dom.call(this,"<div/>",{"class":"field"}),this.setupUI(),this.get(0)._metaScore=this,null!==this.configs.value&&this.setValue(this.configs.value),this.configs.disabled?this.disable():this.enable(),this.readonly(this.configs.readonly)}return t.defaults={value:null,disabled:!1,readonly:!1},e.Dom.extend(t),t.prototype.setupUI=function(){var t="field-"+e.String.uuid(5);this.configs.label&&(this.label=new e.Dom("<label/>",{"for":t,text:this.configs.label}).appendTo(this)),this.input_wrapper=new e.Dom("<div/>",{"class":"input-wrapper"}).appendTo(this),this.input=new e.Dom("<input/>",{type:"text",id:t}).addListener("change",e.Function.proxy(this.onChange,this)).appendTo(this.input_wrapper)},t.prototype.onChange=function(){this.value=this.input.val(),this.triggerEvent("valuechange",{field:this,value:this.value},!0,!1)},t.prototype.setValue=function(t,e){this.input.val(t),this.value=t,e!==!0&&this.input.triggerEvent("change")},t.prototype.getValue=function(){return this.value},t.prototype.disable=function(){return this.disabled=!0,this.addClass("disabled"),this.input&&this.input.attr("disabled","disabled"),this},t.prototype.enable=function(){return this.disabled=!1,this.removeClass("disabled"),this.input&&this.input.attr("disabled",null),this},t.prototype.readonly=function(t){return this.is_readonly=t===!0,this.toggleClass("readonly",this.is_readonly),this.input&&this.input.attr("readonly",this.is_readonly?"readonly":null),this},t}(),e.namespace("editor").History=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this),this.commands=[],this.index=-1,this.executing=!1}return t.defaults={max_commands:30},e.Evented.extend(t),t.prototype.execute=function(t,e){return t&&e in t&&(this.executing=!0,t[e](t),this.executing=!1),this},t.prototype.add=function(t){return this.executing?this:(this.commands.splice(this.index+1,this.commands.length-this.index),this.commands.push(t),this.commands.length>this.configs.max_commands&&(this.commands=this.commands.slice(-1*this.configs.max_commands)),this.index=this.commands.length-1,this.triggerEvent("add",{command:t}),this)},t.prototype.undo=function(){var t=this.commands[this.index];return t?(this.execute(t,"undo"),this.index-=1,this.triggerEvent("undo",{command:t}),this):this},t.prototype.redo=function(){var t=this.commands[this.index+1];return t?(this.execute(t,"redo"),this.index+=1,this.triggerEvent("redo",{command:t}),this):this},t.prototype.clear=function(){var t=this.commands.length;this.commands=[],this.index=-1,t>0&&this.triggerEvent("clear")},t.prototype.hasUndo=function(){return-1!==this.index},t.prototype.hasRedo=function(){return this.index<this.commands.length-1},t}(),e.namespace("editor").MainMenu=function(){function t(){t.parent.call(this,"<div/>",{"class":"main-menu clearfix"}),this.setupUI()}return e.Dom.extend(t),t.prototype.setupUI=function(){var t,n;t=new e.Dom("<div/>",{"class":"left"}).appendTo(this),n=new e.Dom("<div/>",{"class":"right"}).appendTo(this),new e.Dom("<div/>",{"class":"logo-philharmonie"}).appendTo(t),(new e.editor.Button).attr({title:e.Locale.t("editor.MainMenu.new","New")}).data("action","new").appendTo(t),(new e.editor.Button).attr({title:e.Locale.t("editor.MainMenu.open","Open")}).data("action","open").appendTo(t),(new e.editor.Button).attr({title:e.Locale.t("editor.MainMenu.edit","Edit")}).data("action","edit").appendTo(t),(new e.editor.Button).attr({title:e.Locale.t("editor.MainMenu.save","Save")}).data("action","save").appendTo(t),(new e.editor.Button).attr({title:e.Locale.t("editor.MainMenu.delete","Delete")}).data("action","delete").appendTo(t),(new e.editor.Button).attr({title:e.Locale.t("editor.MainMenu.download","Download")}).data("action","download").appendTo(t),this.timefield=(new e.editor.field.Time).attr({title:e.Locale.t("editor.MainMenu.time","Time")}).addClass("time").appendTo(t),this.rindexfield=new e.editor.field.Number({min:0,max:999}).attr({title:e.Locale.t("editor.MainMenu.r-index","Reading index")}).addClass("r-index").appendTo(t),(new e.editor.Button).attr({title:e.Locale.t("editor.MainMenu.edit-toggle","Toggle edit mode")}).data("action","edit-toggle").appendTo(t),(new e.editor.Button).attr({title:e.Locale.t("editor.MainMenu.revert","Revert")}).data("action","revert").appendTo(t),(new e.editor.Button).attr({title:e.Locale.t("editor.MainMenu.undo","Undo")}).data("action","undo").appendTo(t),(new e.editor.Button).attr({title:e.Locale.t("editor.MainMenu.redo","Redo")}).data("action","redo").appendTo(t),(new e.editor.Button).attr({title:e.Locale.t("editor.MainMenu.settings","Settings")}).data("action","settings").appendTo(n),(new e.editor.Button).attr({title:e.Locale.t("editor.MainMenu.help","Help")}).data("action","help").appendTo(n)},t.prototype.toggleButton=function(t,e){return this.find('[data-action="'+t+'"]').toggleClass("disabled",e===!1),this},t}(),e.namespace("editor").Overlay=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this,"<div/>",{"class":"overlay clearfix"}),this.setupDOM(),this.configs.autoShow&&this.show()}return t.defaults={parent:".metaScore-editor",modal:!0,draggable:!0,autoShow:!1,toolbar:!1,title:""},e.Dom.extend(t),t.prototype.setupDOM=function(){this.configs.modal&&(this.mask=new e.Dom("<div/>",{"class":"overlay-mask"})),this.configs.toolbar&&(this.toolbar=new e.editor.overlay.Toolbar({title:this.configs.title}).appendTo(this),this.toolbar.addButton("close").addListener("click",e.Function.proxy(this.onCloseClick,this))),this.contents=new e.Dom("<div/>",{"class":"contents"}).appendTo(this),this.configs.draggable&&(this.draggable=new e.Draggable({target:this,handle:this.configs.toolbar?this.toolbar:this}))},t.prototype.show=function(){return this.configs.modal&&this.mask.appendTo(this.configs.parent),this.appendTo(this.configs.parent),this},t.prototype.hide=function(){return this.configs.modal&&this.mask.remove(),this.remove(),this},t.prototype.getToolbar=function(){return this.toolbar},t.prototype.getContents=function(){return this.contents},t.prototype.onCloseClick=function(){this.hide()},t}(),e.namespace("editor").Panel=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this,"<div/>",{"class":"panel"}),this.onComponentDragStart=e.Function.proxy(this.onComponentDragStart,this),this.onComponentDrag=e.Function.proxy(this.onComponentDrag,this),this.onComponentDragEnd=e.Function.proxy(this.onComponentDragEnd,this),this.onComponentResizeStart=e.Function.proxy(this.onComponentResizeStart,this),this.onComponentResize=e.Function.proxy(this.onComponentResize,this),this.onComponentResizeEnd=e.Function.proxy(this.onComponentResizeEnd,this),this.toolbar=new e.editor.panel.Toolbar(this.configs.toolbarConfigs).appendTo(this),this.toolbar.getTitle().addListener("click",e.Function.proxy(this.toggleState,this)),this.contents=new e.Dom("<div/>",{"class":"fields"}).appendTo(this),this.addDelegate(".fields .field","valuechange",e.Function.proxy(this.onFieldValueChange,this)).unsetComponent()}return t.defaults={toolbarConfigs:{buttons:["previous","next"]}},e.Dom.extend(t),t.prototype.setupFields=function(t){var n,i;return this.fields={},this.contents.empty(),e.Object.each(t,function(t,o){o.editable!==!1&&(n=o.configs||{},i=new e.editor.field[o.type](n).data("name",t).appendTo(this.contents),this.fields[t]=i)},this),this},t.prototype.getToolbar=function(){return this.toolbar},t.prototype.getField=function(t){return void 0===t?this.fields:this.fields[t]},t.prototype.enableFields=function(){e.Object.each(this.fields,function(t,e){e.enable()},this)},t.prototype.showField=function(t){return this.getField(t).show(),this},t.prototype.hideField=function(t){return this.getField(t).hide(),this},t.prototype.toggleState=function(){return this.toggleClass("collapsed"),this},t.prototype.disable=function(){return this.addClass("disabled"),this},t.prototype.enable=function(){return this.removeClass("disabled"),this},t.prototype.getComponent=function(){return this.component},t.prototype.setComponent=function(t,e){if(t!==this.getComponent()){if(!t)return this.unsetComponent();this.unsetComponent(!0),this.triggerEvent("componentbeforeset",{component:t},!1),this.component=t,this.setupFields(this.component.configs.properties).updateFieldValues(this.getValues(Object.keys(this.getField())),!0).updateDraggable(!0).updateResizable(!0).addClass("has-component").getToolbar().setSelectorValue(t.getId(),!0),t.instanceOf("Controller")||t.instanceOf("Media")||this.getToolbar().toggleMenuItem("delete",!0),t.addClass("selected"),e!==!0&&this.triggerEvent("componentset",{component:t},!1)}return this},t.prototype.unsetComponent=function(t){var e=this.getComponent();return this.removeClass("has-component").getToolbar().toggleMenuItem("delete",!1),e&&(this.updateDraggable(!1).updateResizable(!1).getToolbar().setSelectorValue(null,!0),e.removeClass("selected"),delete this.component,t!==!0&&this.triggerEvent("componentunset",{component:e},!1)),this},t.prototype.updateDraggable=function(t){var e=this.getComponent();return t=e.setDraggable(t),t?e.addListener("dragstart",this.onComponentDragStart).addListener("drag",this.onComponentDrag).addListener("dragend",this.onComponentDragEnd):e.removeListener("dragstart",this.onComponentDragStart).removeListener("drag",this.onComponentDrag).removeListener("dragend",this.onComponentDragEnd),this.toggleFields(["x","y"],t?!0:!1),this},t.prototype.updateResizable=function(t){var e=this.getComponent();return t=e.setResizable(t),t?e.addListener("resizestart",this.onComponentResizeStart).addListener("resize",this.onComponentResize).addListener("resizeend",this.onComponentResizeEnd):e.removeListener("resizestart",this.onComponentResizeStart).removeListener("resize",this.onComponentResize).removeListener("resizeend",this.onComponentResizeEnd),this.toggleFields(["width","height"],t?!0:!1),this},t.prototype.onComponentDragStart=function(){var t=["x","y"];this._beforeDragValues=this.getValues(t)},t.prototype.onComponentDrag=function(){var t=["x","y"];this.updateFieldValues(t,!0)},t.prototype.onComponentDragEnd=function(){var t=this.getComponent(),e=["x","y"];this.updateFieldValues(e,!0),this.triggerEvent("valueschange",{component:t,old_values:this._beforeDragValues,new_values:this.getValues(e)},!1),delete this._beforeDragValues},t.prototype.onComponentResizeStart=function(){var t=["x","y","width","height"];this._beforeResizeValues=this.getValues(t)},t.prototype.onComponentResize=function(){var t=["x","y","width","height"];this.updateFieldValues(t,!0)},t.prototype.onComponentResizeEnd=function(){var t=this.getComponent(),e=["x","y","width","height"];this.updateFieldValues(e,!0),this.triggerEvent("valueschange",{component:t,old_values:this._beforeResizeValues,new_values:this.getValues(e)},!1),delete this._beforeResizeValues},t.prototype.onFieldValueChange=function(t){var e,n,i,o=this.getComponent();if(o){switch(e=t.detail.field.data("name"),n=t.detail.value,i=this.getValues([e]),o.setProperty(e,n),e){case"locked":this.updateDraggable(!n),this.updateResizable(!n);break;case"name":this.getToolbar().updateSelectorOption(o.getId(),n);break;case"start-time":this.getField("end-time").setMin(n);break;case"end-time":this.getField("start-time").setMax(n)}this.triggerEvent("valueschange",{component:o,old_values:i,new_values:this.getValues([e])},!1)}},t.prototype.updateFieldValue=function(t,e,n){return this.getField(t).setValue(e,n),this},t.prototype.updateFieldValues=function(t,n){return e.Var.is(t,"array")?e.Array.each(t,function(t,e){this.updateFieldValue(e,this.getValue(e),n)},this):e.Object.each(t,function(t,e){this.updateFieldValue(t,e,n)},this),this},t.prototype.updateProperties=function(t,n){return e.Object.each(n,function(e,n){this.getField(e).disabled||t.setProperty(e,n)},this),this.updateFieldValues(n,!0),this},t.prototype.toggleFields=function(t,n){var i;return e.Array.each(t,function(t,e){(i=this.getField(e))&&(n?i.enable():i.disable())},this),this},t.prototype.getValue=function(t){return this.getComponent().getProperty(t)},t.prototype.getValues=function(t){var n={};return t=t||Object.keys(this.getField()),e.Array.each(t,function(t,e){this.getField(e).disabled||(n[e]=this.getValue(e))},this),n},t}(),e.namespace("editor.field").Boolean=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this,this.configs),this.addClass("booleanfield"),this.setValue(this.configs.checked?this.configs.checked_value:this.configs.unchecked_value)}return t.defaults={checked:!1,checked_value:!0,unchecked_value:!1},e.editor.Field.extend(t),t.prototype.setupUI=function(){var t="field-"+e.String.uuid(5);this.configs.label&&(this.label=new e.Dom("<label/>",{"for":t,text:this.configs.label}).appendTo(this)),this.input_wrapper=new e.Dom("<div/>",{"class":"input-wrapper"}).appendTo(this),this.input=new e.Dom("<input/>",{type:"checkbox",id:t}).addListener("click",e.Function.proxy(this.onClick,this)).addListener("change",e.Function.proxy(this.onChange,this)).appendTo(this.input_wrapper)},t.prototype.onClick=function(t){this.is_readonly&&t.preventDefault()},t.prototype.onChange=function(t){return this.is_readonly?(t.preventDefault(),void 0):(this.input.is(":checked")?(this.value=this.configs.checked_value,this.addClass("checked")):(this.value=this.configs.unchecked_value,this.removeClass("checked")),this.triggerEvent("valuechange",{field:this,value:this.value},!0,!1),void 0)},t.prototype.setValue=function(t,e){this.input.get(0).checked=t===this.configs.checked_value,e!==!0&&this.input.triggerEvent("change")},t}(),e.namespace("editor.field").BorderRadius=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this,this.configs),this.addClass("borderradiusrfield")}return e.editor.Field.extend(t),t.prototype.setupUI=function(){t.parent.prototype.setupUI.call(this),this.input.attr("readonly","readonly").addListener("click",e.Function.proxy(this.onClick,this)),this.overlay=(new e.editor.overlay.BorderRadius).addListener("submit",e.Function.proxy(this.onOverlaySubmit,this)),this.clear=new e.Dom("<button/>",{text:".","data-action":"clear"}).addListener("click",e.Function.proxy(this.onClearClick,this)).appendTo(this.input_wrapper)},t.prototype.setValue=function(e,n){t.parent.prototype.setValue.call(this,e,n),this.input.attr("title",e)},t.prototype.onClick=function(){this.disabled||this.overlay.setValue(this.value).show()},t.prototype.onOverlaySubmit=function(t){var e=t.detail.value;t.detail.overlay,this.setValue(e)},t.prototype.onClearClick=function(){this.setValue("0px")},t}(),e.namespace("editor.field").Buttons=function(){function t(n){this.configs=this.getConfigs(n),this.buttons={},this.onClick=e.Function.proxy(this.onClick,this),t.parent.call(this,this.configs),this.addClass("buttonsfield")}return t.defaults={buttons:{}},e.editor.Field.extend(t),t.prototype.setValue=function(){},t.prototype.setupUI=function(){var t=this;this.configs.label&&(this.label=new e.Dom("<label/>",{text:this.configs.label}).appendTo(this)),this.input_wrapper=new e.Dom("<div/>",{"class":"input-wrapper"}).appendTo(this),e.Object.each(this.configs.buttons,function(n,i){this.buttons[n]=new e.Dom("<button/>",i).addListener("click",function(){t.triggerEvent("valuechange",{field:t,value:n},!0,!1)}).appendTo(this.input_wrapper)},this)},t.prototype.getButtons=function(){return this.buttons},t.prototype.getButton=function(t){return this.buttons[t]},t}(),e.namespace("editor.field").Color=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this,this.configs),this.addClass("colorfield")}return t.defaults={value:{r:255,g:255,b:255,a:1}},e.editor.Field.extend(t),t.prototype.setupUI=function(){t.parent.prototype.setupUI.call(this),this.input.attr("readonly","readonly").addListener("click",e.Function.proxy(this.onClick,this)),this.clear=new e.Dom("<button/>",{text:".","data-action":"clear"}).addListener("click",e.Function.proxy(this.onClearClick,this)).appendTo(this.input_wrapper),this.overlay=(new e.editor.overlay.ColorSelector).addListener("select",e.Function.proxy(this.onColorSelect,this))},t.prototype.setValue=function(t,n){var i;this.value=t?e.Color.parse(t):null,i=this.value?"rgba("+this.value.r+","+this.value.g+","+this.value.b+","+this.value.a+")":null,this.input.attr("title",i).css("background-color",i),n!==!0&&this.triggerEvent("valuechange",{field:this,value:this.value},!0,!1)},t.prototype.onClick=function(){this.disabled||this.overlay.setValue(e.Object.copy(this.value)).show()},t.prototype.onColorSelect=function(t){var e=t.detail.value;t.detail.overlay,this.setValue(e)},t.prototype.onClearClick=function(){this.setValue(null)},t}(),e.namespace("editor.field").Image=function(){function t(n){this.configs=this.getConfigs(n),this.onFileSelect=e.Function.proxy(this.onFileSelect,this),t.parent.call(this,this.configs),this.addClass("imagefield")
}return t.defaults={placeholder:e.Locale.t("editor.field.Image.placeholder","Browse...")},e.editor.Field.extend(t),t.prototype.setupUI=function(){t.parent.prototype.setupUI.call(this),this.input.attr("readonly","readonly").attr("placeholder",this.configs.placeholder).addListener("click",e.Function.proxy(this.onClick,this)),this.clear=new e.Dom("<button/>",{text:".","data-action":"clear"}).addListener("click",e.Function.proxy(this.onClearClick,this)).appendTo(this.input_wrapper)},t.prototype.setValue=function(e,n){t.parent.prototype.setValue.call(this,e,n),this.input.attr("title",e)},t.prototype.onClick=function(){this.disabled||this.triggerEvent("filebrowser",{callback:this.onFileSelect},!0,!1)},t.prototype.onClearClick=function(){this.setValue(null)},t.prototype.onFileSelect=function(t){this.setValue(t)},t}(),e.namespace("editor.field").Number=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this,this.configs),this.addClass("numberfield")}return t.defaults={value:0,min:null,max:null},e.editor.Field.extend(t),t.prototype.setupUI=function(){var t="field-"+e.String.uuid(5);this.configs.label&&(this.label=new e.Dom("<label/>",{"for":t,text:this.configs.label}).appendTo(this)),this.input_wrapper=new e.Dom("<div/>",{"class":"input-wrapper"}).appendTo(this),this.input=new e.Dom("<input/>",{type:"number",id:t,min:this.configs.min,max:this.configs.max,step:this.configs.step}).addListener("change",e.Function.proxy(this.onChange,this)).appendTo(this.input_wrapper)},t}(),e.namespace("editor.field").Select=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this,this.configs),this.addClass("selectfield")}return t.defaults={options:{}},e.editor.Field.extend(t),t.prototype.setupUI=function(){var t="field-"+e.String.uuid(5);this.configs.label&&(this.label=new e.Dom("<label/>",{"for":t,text:this.configs.label}).appendTo(this)),this.input_wrapper=new e.Dom("<div/>",{"class":"input-wrapper"}).appendTo(this),this.input=new e.Dom("<select/>",{id:t}).addListener("change",e.Function.proxy(this.onChange,this)).appendTo(this.input_wrapper),e.Object.each(this.configs.options,function(t,e){this.addOption(t,e)},this)},t.prototype.addOption=function(t,n){var i=new e.Dom("<option/>",{value:t,text:n});return this.input.append(i),i},t.prototype.updateOption=function(t,e){var n=this.input.child('option[value="'+t+'"]');return n.text(e),n},t.prototype.removeOption=function(t){var e=this.input.child('option[value="'+t+'"]');return e.remove(),e},t.prototype.removeOptions=function(){return this.input.empty(),this},t}(),e.namespace("editor.field").Text=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this,this.configs),this.addClass("textfield")}return t.defaults={value:""},e.editor.Field.extend(t),t}(),e.namespace("editor.field").Textarea=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this,this.configs),this.addClass("textareafield")}return t.defaults={value:""},e.editor.Field.extend(t),t.prototype.setupUI=function(){var t="field-"+e.String.uuid(5);this.configs.label&&(this.label=new e.Dom("<label/>",{"for":t,text:this.configs.label}).appendTo(this)),this.input_wrapper=new e.Dom("<div/>",{"class":"input-wrapper"}).appendTo(this),this.input=new e.Dom("<textarea/>",{id:t}).addListener("change",e.Function.proxy(this.onChange,this)).appendTo(this.input_wrapper)},t}(),e.namespace("editor.field").Time=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this,this.configs),this.addClass("timefield")}return t.defaults={value:0,min:0,max:null,checkbox:!1,inButton:!1,outButton:!1},e.editor.Field.extend(t),t.prototype.setupUI=function(){var t;this.configs.label&&(this.label=new e.Dom("<label/>",{text:this.configs.label}).appendTo(this)),this.input_wrapper=new e.Dom("<div/>",{"class":"input-wrapper"}).appendTo(this),this.configs.checkbox&&(this.checkbox=new e.Dom("<input/>",{type:"checkbox"}).addListener("change",e.Function.proxy(this.onInput,this)).appendTo(this.input_wrapper)),this.hours=new e.Dom("<input/>",{type:"number","class":"hours"}).addListener("input",e.Function.proxy(this.onInput,this)).appendTo(this.input_wrapper),new e.Dom("<span/>",{text:":","class":"separator"}).appendTo(this.input_wrapper),this.minutes=new e.Dom("<input/>",{type:"number","class":"minutes"}).addListener("input",e.Function.proxy(this.onInput,this)).appendTo(this.input_wrapper),new e.Dom("<span/>",{text:":","class":"separator"}).appendTo(this.input_wrapper),this.seconds=new e.Dom("<input/>",{type:"number","class":"seconds"}).addListener("input",e.Function.proxy(this.onInput,this)).appendTo(this.input_wrapper),new e.Dom("<span/>",{text:".","class":"separator"}).appendTo(this.input_wrapper),this.centiseconds=new e.Dom("<input/>",{type:"number","class":"centiseconds"}).addListener("input",e.Function.proxy(this.onInput,this)).appendTo(this.input_wrapper),(this.configs.inButton||this.configs.outButton)&&(t=new e.Dom("<div/>",{"class":"buttons"}).appendTo(this.input_wrapper),this.configs.inButton&&(this.in=new e.Dom("<button/>",{text:".","data-action":"in"}).addListener("click",e.Function.proxy(this.onInClick,this)).appendTo(t)),this.configs.outButton&&(this.out=new e.Dom("<button/>",{text:".","data-action":"out"}).addListener("click",e.Function.proxy(this.onOutClick,this)).appendTo(t))),this.addListener("change",e.Function.proxy(this.onChange,this))},t.prototype.onChange=function(){this.triggerEvent("valuechange",{field:this,value:this.value},!0,!1)},t.prototype.onInput=function(t){var e,n,i,o,s=this.isActive();s?(e=parseInt(this.centiseconds.val(),10)||0,n=parseInt(this.seconds.val(),10)||0,i=parseInt(this.minutes.val(),10)||0,o=parseInt(this.hours.val(),10)||0,this.setValue(e+100*n+6e3*i+36e4*o)):this.setValue(null),t.stopPropagation()},t.prototype.onInClick=function(){this.triggerEvent("valuein")},t.prototype.onOutClick=function(){this.triggerEvent("valueout")},t.prototype.setValue=function(t,e){var n,i,o,s;t=parseFloat(t),isNaN(t)?(this.value=null,this.centiseconds.val(0),this.seconds.val(0),this.minutes.val(0),this.hours.val(0),this.disabled||(this.hours.attr("disabled","disabled"),this.minutes.attr("disabled","disabled"),this.seconds.attr("disabled","disabled"),this.centiseconds.attr("disabled","disabled"),this.in&&this.in.attr("disabled","disabled"),this.out&&this.out.attr("disabled","disabled")),this.checkbox&&this.checkbox.attr("checked",null)):(this.value=Math.floor(t),null!==this.configs.min&&(this.value=Math.max(this.value,this.configs.min)),null!==this.configs.max&&(this.value=Math.min(this.value,this.configs.max)),n=parseInt(this.value%100,10)||0,i=parseInt(this.value/100%60,10)||0,o=parseInt(this.value/6e3%60,10)||0,s=parseInt(this.value/36e4,10)||0,this.disabled||(this.hours.attr("disabled",null),this.minutes.attr("disabled",null),this.seconds.attr("disabled",null),this.centiseconds.attr("disabled",null),this.in&&this.in.attr("disabled",null),this.out&&this.out.attr("disabled",null)),this.centiseconds.val(n),this.seconds.val(i),this.minutes.val(o),this.hours.val(s),this.checkbox&&this.checkbox.attr("checked","checked")),e!==!0&&this.triggerEvent("change")},t.prototype.setMin=function(t){return this.configs.min=t,t>this.getValue()&&this.setValue(t),this},t.prototype.setMax=function(t){return this.configs.max=t,this.getValue()>t&&this.setValue(t),this},t.prototype.isActive=function(){return!this.checkbox||this.checkbox.is(":checked")},t.prototype.disable=function(){return this.disabled=!0,this.checkbox&&this.checkbox.attr("disabled","disabled"),this.hours.attr("disabled","disabled"),this.minutes.attr("disabled","disabled"),this.seconds.attr("disabled","disabled"),this.centiseconds.attr("disabled","disabled"),this.in&&this.in.attr("disabled","disabled"),this.out&&this.out.attr("disabled","disabled"),this.addClass("disabled"),this},t.prototype.enable=function(){var t=this.isActive();return this.disabled=!1,this.checkbox&&this.checkbox.attr("disabled",null),this.hours.attr("disabled",t?null:"disabled"),this.minutes.attr("disabled",t?null:"disabled"),this.seconds.attr("disabled",t?null:"disabled"),this.centiseconds.attr("disabled",t?null:"disabled"),this.in&&this.in.attr("disabled",t?null:"disabled"),this.out&&this.out.attr("disabled",t?null:"disabled"),this.removeClass("disabled"),this},t}(),e.namespace("editor.panel").Block=function(){function t(e){t.parent.call(this,e)}return t.defaults={toolbarConfigs:e.Object.extend({},e.editor.Panel.defaults.toolbarConfigs,{title:e.Locale.t("editor.panel.Block.title","Block"),menuItems:{synched:e.Locale.t("editor.panel.Block.menuItems.synched","Add a synchronized block"),"non-synched":e.Locale.t("editor.panel.Block.menuItems.non-synched","Add a non-synchronized block"),"delete":e.Locale.t("editor.panel.Block.menuItems.delete","Delete the active block")}})},e.editor.Panel.extend(t),t}(),e.namespace("editor.panel").Element=function(){function t(e){t.parent.call(this,e)}return t.defaults={toolbarConfigs:e.Object.extend({},e.editor.Panel.defaults.toolbarConfigs,{title:e.Locale.t("editor.panel.Element.title","Element"),menuItems:{Cursor:e.Locale.t("editor.panel.Element.menuItems.Cursor","Add a new cursor"),Image:e.Locale.t("editor.panel.Element.menuItems.Image","Add a new image"),Text:e.Locale.t("editor.panel.Element.menuItems.Text","Add a new text element"),"delete":e.Locale.t("editor.panel.Element.menuItems.delete","Delete the active element")}})},e.editor.Panel.extend(t),t}(),e.namespace("editor.panel").Page=function(){function t(e){t.parent.call(this,e)}return t.defaults={toolbarConfigs:e.Object.extend({},e.editor.Panel.defaults.toolbarConfigs,{title:e.Locale.t("editor.panel.Page.title","Page"),menuItems:{"new":e.Locale.t("editor.panel.Page.menuItems.new","Add a new page"),"delete":e.Locale.t("editor.panel.Page.menuItems.delete","Delete the active page")}})},e.editor.Panel.extend(t),t}(),e.namespace("editor.panel").Text=function(){function t(n){t.parent.call(this,n),this.onComponentContentsDblClick=e.Function.proxy(this.onComponentContentsDblClick,this),this.onComponentContentsClick=e.Function.proxy(this.onComponentContentsClick,this),this.onComponentContentsKey=e.Function.proxy(this.onComponentContentsKey,this),this.onComponentContentsMouseup=e.Function.proxy(this.onComponentContentsMouseup,this)}return t.defaults={toolbarConfigs:e.Object.extend({},e.editor.Panel.defaults.toolbarConfigs,{title:e.Locale.t("editor.panel.Text.title","Text"),buttons:[],selector:!1}),properties:{locked:{type:"Boolean",configs:{label:e.Locale.t("editor.panel.Text.locked","Locked ?")},setter:function(t){t?this.lock():this.unlock()}},foreColor:{type:"Color",configs:{label:e.Locale.t("editor.panel.Text.fore-color","Font color")},setter:function(t){this.execCommand("foreColor",t?"rgba("+t.r+","+t.g+","+t.b+","+t.a+")":"inherit")}},backColor:{type:"Color",configs:{label:e.Locale.t("editor.panel.Text.back-color","Background color")},setter:function(t){this.execCommand("backColor",t?"rgba("+t.r+","+t.g+","+t.b+","+t.a+")":"inherit")}},fontName:{type:"Select",configs:{label:e.Locale.t("editor.panel.Text.font","Font"),options:{inherit:"","Georgia, serif":"Georgia","'Times New Roman', Times, serif":"Times New Roman","Arial, Helvetica, sans-serif":"Arial","'Comic Sans MS', cursive, sans-serif":"Comic Sans MS","Impact, Charcoal, sans-serif":"Impact","'Lucida Sans Unicode', 'Lucida Grande', sans-serif":"Lucida Sans Unicode","Tahoma, Geneva, sans-serif":"Tahoma","Verdana, Geneva, sans-serif":"Verdana","'Courier New', Courier, monospace":"Courier New","'Lucida Console', Monaco, monospace":"Lucida Console"}},setter:function(t){this.execCommand("fontName",t)}},formatBlock:{type:"Select",configs:{label:e.Locale.t("editor.panel.Text.formatBlock","Format"),options:{p:e.Locale.t("editor.panel.Text.formatBlock.p","Normal"),h1:e.Locale.t("editor.panel.Text.formatBlock.h1","Heading 1"),h2:e.Locale.t("editor.panel.Text.formatBlock.h2","Heading 2"),h3:e.Locale.t("editor.panel.Text.formatBlock.h3","Heading 3"),h4:e.Locale.t("editor.panel.Text.formatBlock.h4","Heading 4"),pre:e.Locale.t("editor.panel.Text.formatBlock.pre","Formatted")}},setter:function(t){this.execCommand("formatBlock",t)}},fontSize:{type:"Select",configs:{label:e.Locale.t("editor.panel.Text.font-size","Font size"),options:{1:"1",2:"2",3:"3",4:"4",5:"5",6:"6"}},setter:function(t){this.execCommand("fontSize",t)}},formatting:{type:"Buttons",configs:{label:e.Locale.t("editor.panel.Text.formatting","Formatting"),buttons:{bold:{"data-action":"bold",title:e.Locale.t("editor.panel.Text.formatting.bold","Bold")},italic:{"data-action":"italic",title:e.Locale.t("editor.panel.Text.formatting.italic","Italic")},strikeThrough:{"data-action":"strikeThrough",title:e.Locale.t("editor.panel.Text.formatting.strikeThrough","Strikethrough")},underline:{"data-action":"underline",title:e.Locale.t("editor.panel.Text.formatting.underline","Underline")},subscript:{"data-action":"subscript",title:e.Locale.t("editor.panel.Text.formatting.subscript","Subscript")},superscript:{"data-action":"superscript",title:e.Locale.t("editor.panel.Text.formatting.superscript","Superscript")},justifyLeft:{"data-action":"justifyLeft",title:e.Locale.t("editor.panel.Text.formatting.justifyLeft","Left")},justifyCenter:{"data-action":"justifyCenter",title:e.Locale.t("editor.panel.Text.formatting.justifyCenter","Center")},justifyRight:{"data-action":"justifyRight",title:e.Locale.t("editor.panel.Text.formatting.justifyRight","Right")},justifyFull:{"data-action":"justifyFull",title:e.Locale.t("editor.panel.Text.formatting.justifyFull","Justify")},link:{"data-action":"link",title:e.Locale.t("editor.panel.Text.formatting.link","Add/Modify link")},unlink:{"data-action":"unlink",title:e.Locale.t("editor.panel.Text.formatting.unlink","Remove link")},insertImage:{"data-action":"insertImage",title:e.Locale.t("editor.panel.Text.formatting.insertImage","Add/Modify image")},removeFormat:{"data-action":"removeFormat",title:e.Locale.t("editor.panel.Text.formatting.removeFormat","Remove formatting")}}},setter:function(t){var n,i;switch(t){case"link":n=this.getSelectedElement(),i=e.Dom.is(n,"a")?n:null,i&&this.setSelectedElement(i),new e.editor.overlay.InsertLink({link:i,autoShow:!0}).addListener("submit",e.Function.proxy(this.onLinkOverlaySubmit,this));break;case"unlink":n=this.getSelectedElement(),i=e.Dom.is(n,"a")?n:null,i&&this.setSelectedElement(i),this.execCommand(t);break;case"insertImage":new e.editor.overlay.InsertImage({autoShow:!0}).addListener("submit",e.Function.proxy(this.onImageOverlaySubmit,this));break;default:this.execCommand(t)}}}}},e.editor.Panel.extend(t),t.prototype.onFieldValueChange=function(t){var e,n,i=this.getComponent();i&&(e=t.detail.field.data("name"),n=t.detail.value,e in this.configs.properties&&"setter"in this.configs.properties[e]&&this.configs.properties[e].setter.call(this,n))},t.prototype.setComponent=function(t,e){if(t!==this.getComponent()){if(!t)return this.unsetComponent();this.unsetComponent(!0),this.component=t,this.setupFields(this.configs.properties).updateFieldValue("locked",!0).addClass("has-component"),e!==!0&&this.triggerEvent("componentset",{component:t},!1)}return this},t.prototype.unsetComponent=function(t){var e=this.getComponent();return this.lock().removeClass("has-component"),e&&(this.component=null,t!==!0&&this.triggerEvent("componentunset",{component:e},!1)),this},t.prototype.lock=function(){var t=this.getComponent();return t&&(t.contents.attr("contenteditable",null).addListener("dblclick",this.onComponentContentsDblClick).removeListener("click",this.onComponentContentsClick).removeListener("keydown",this.onComponentContentsKey).removeListener("keypress",this.onComponentContentsKey).removeListener("keyup",this.onComponentContentsKey).removeListener("mouseup",this.onComponentContentsMouseup),this.toggleFields(e.Array.remove(Object.keys(this.getField()),"locked"),!1),t._draggable&&t._draggable.enable(),t._resizable&&t._resizable.enable()),this},t.prototype.unlock=function(){var t=this.getComponent();return t&&(t._draggable&&t._draggable.disable(),t._resizable&&t._resizable.disable(),t.contents.attr("contenteditable","true").removeListener("dblclick",this.onComponentContentsDblClick).addListener("click",this.onComponentContentsClick).addListener("keydown",this.onComponentContentsKey).addListener("keypress",this.onComponentContentsKey).addListener("keyup",this.onComponentContentsKey).addListener("mouseup",this.onComponentContentsMouseup).focus(),this.toggleFields(e.Array.remove(Object.keys(this.getField()),"locked"),!0).execCommand("styleWithCSS",!0).execCommand("enableObjectResizing",!0)),this},t.prototype.disable=function(){return this.lock(),t.parent.prototype.disable.call(this)},t.prototype.onComponentContentsDblClick=function(){this.updateFieldValue("locked",!1)},t.prototype.onComponentContentsClick=function(t){t.stopPropagation()},t.prototype.onComponentContentsKey=function(t){"keyup"===t.type&&this.updateButtons(),t.stopPropagation()},t.prototype.onComponentContentsMouseup=function(){this.updateButtons()},t.prototype.updateButtons=function(){var t,n,i=this.getComponent(),o=i.contents.get(0).ownerDocument;t=this.getSelectedElement(),n=e.Dom.is(t,"a"),e.Object.each(this.getField(),function(t,i){switch(t){case"formatting":e.Object.each(i.getButtons(),function(t,e){switch(t){case"link":e.toggleClass("pressed",n);break;default:e.toggleClass("pressed",o.queryCommandState(t))}});break;default:i.setValue(o.queryCommandValue(t),!0)}},this)},t.prototype.onLinkOverlaySubmit=function(t){var e=t.detail.url;this.execCommand("createLink",e)},t.prototype.onImageOverlaySubmit=function(t){var e=t.detail.url,n=t.detail.width,i=t.detail.height,o=t.detail.alignment;this.execCommand("insertHTML",'<img src="'+e+'" style="width: '+n+"px; height: "+i+"px"+(o?"; float: "+o:"")+';" />')},t.prototype.getSelectedElement=function(){var t,e,n=this.getComponent(),i=n.contents.get(0).ownerDocument;return t=i.getSelection(),e=t.anchorNode,e?"#text"===e.nodeName?e.parentNode:e:void 0},t.prototype.setSelectedElement=function(t){var e,n,i=this.getComponent(),o=i.contents.get(0).ownerDocument;e=o.getSelection(),n=o.createRange(),n.selectNodeContents(t),e.removeAllRanges(),e.addRange(n)},t.prototype.insertHtmlAtCaret=function(t){var e,n,i,o=this.getComponent(),s=o.contents.get(0).ownerDocument;return e=s.getSelection(),e.getRangeAt&&e.rangeCount&&(n=e.getRangeAt(0),n.deleteContents(),i=n.createContextualFragment(t),n.insertNode(i),e.removeAllRanges(),e.addRange(n)),this},t.prototype.execCommand=function(t,e){var n=this.getComponent(),i=n.contents.get(0);switch(i.focus(),t){case"insertHTML":this.insertHtmlAtCaret(e);break;default:i.ownerDocument.execCommand(t,!1,e)}return this.updateButtons(),this},t}(),e.namespace("editor.panel").Toolbar=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this,"<div/>",{"class":"toolbar clearfix"}),this.title=new e.Dom("<div/>",{"class":"title",text:this.configs.title}).appendTo(this),this.buttons=new e.Dom("<div/>",{"class":"buttons"}).appendTo(this),e.Array.each(this.configs.buttons,function(t,e){this.addButton(e)},this),this.configs.selector&&(this.selector=(new e.editor.field.Select).addClass("selector").appendTo(this),this.emptySelector()),e.Var.isEmpty(this.configs.menuItems)||(this.menu=new e.editor.DropDownMenu,e.Object.each(this.configs.menuItems,function(t,e){this.menu.addItem(t,e)},this),this.addButton("menu").append(this.menu))}return t.defaults={title:"",buttons:[],selector:!0,menuItems:{}},e.Dom.extend(t),t.prototype.getToggle=function(){return this.toggle},t.prototype.getTitle=function(){return this.title},t.prototype.getSelector=function(){return this.selector},t.prototype.getMenu=function(){return this.menu},t.prototype.addButton=function(t){var n=(new e.editor.Button).data("action",t).appendTo(this.buttons);return n},t.prototype.getButton=function(t){return this.buttons.children('[data-action="'+t+'"]')},t.prototype.emptySelector=function(){return this.selector&&this.selector.removeOptions(),this},t.prototype.addSelectorOption=function(t,e){var n;return this.selector&&(n=this.selector.addOption(t,e)),n},t.prototype.updateSelectorOption=function(t,e){var n;return this.selector&&(n=this.selector.updateOption(t,e)),n},t.prototype.setSelectorValue=function(t,e){return this.selector&&this.selector.setValue(t,e),this},t.prototype.toggleMenuItem=function(t,e){var n=this.getMenu();return n&&n.toggleItem(t,e),this},t}(),e.namespace("editor.overlay").Alert=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this,this.configs),this.addClass("alert")}return t.defaults={draggable:!1,text:"",buttons:[]},e.editor.Overlay.extend(t),t.prototype.setupDOM=function(){t.parent.prototype.setupDOM.call(this),this.text=new e.Dom("<div/>",{"class":"text"}).appendTo(this.contents),this.configs.text&&this.setText(this.configs.text),this.buttons=new e.Dom("<div/>",{"class":"buttons"}).addDelegate("button","click",e.Function.proxy(this.onButtonClick,this)).appendTo(this.contents),this.configs.buttons&&e.Object.each(this.configs.buttons,function(t,e){this.addButton(t,e)},this)},t.prototype.setText=function(t){this.text.text(t)},t.prototype.addButton=function(t,n){var i=(new e.editor.Button).setLabel(n).data("action",t).appendTo(this.buttons);return i},t.prototype.onButtonClick=function(t){var n=new e.Dom(t.target).data("action");this.hide(),this.triggerEvent(n+"click",{alert:this},!1),t.stopPropagation()},t}(),e.namespace("editor.overlay").BorderRadius=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this,this.configs),this.addClass("border-radius")}return t.defaults={toolbar:!0,title:e.Locale.t("editor.overlay.BorderRadius.title","Border Radius")},e.editor.Overlay.extend(t),t.prototype.setupDOM=function(){var n;t.parent.prototype.setupDOM.call(this),n=this.getContents(),this.fields={},this.buttons={},this.preview=new e.Dom("<div/>",{"class":"preview"}).appendTo(n),this.fields.tlw=new e.editor.field.Number({min:0}).addClass("tlw").addListener("valuechange",e.Function.proxy(this.onValueChange,this)).appendTo(this.preview),this.fields.tlh=new e.editor.field.Number({min:0}).addListener("valuechange",e.Function.proxy(this.onValueChange,this)).addClass("tlh").appendTo(this.preview),this.fields.trw=new e.editor.field.Number({min:0}).addListener("valuechange",e.Function.proxy(this.onValueChange,this)).addClass("trw").appendTo(this.preview),this.fields.trh=new e.editor.field.Number({min:0}).addListener("valuechange",e.Function.proxy(this.onValueChange,this)).addClass("trh").appendTo(this.preview),this.fields.brw=new e.editor.field.Number({min:0}).addListener("valuechange",e.Function.proxy(this.onValueChange,this)).addClass("brw").appendTo(this.preview),this.fields.brh=new e.editor.field.Number({min:0}).addListener("valuechange",e.Function.proxy(this.onValueChange,this)).addClass("brh").appendTo(this.preview),this.fields.blw=new e.editor.field.Number({min:0}).addListener("valuechange",e.Function.proxy(this.onValueChange,this)).addClass("blw").appendTo(this.preview),this.fields.blh=new e.editor.field.Number({min:0}).addListener("valuechange",e.Function.proxy(this.onValueChange,this)).addClass("blh").appendTo(this.preview),this.buttons.apply=new e.editor.Button({label:"Apply"}).addClass("apply").addListener("click",e.Function.proxy(this.onApplyClick,this)).appendTo(n),this.buttons.cancel=new e.editor.Button({label:"Cancel"}).addClass("cancel").addListener("click",e.Function.proxy(this.onCancelClick,this)).appendTo(n)},t.prototype.onValueChange=function(){var t="";t+=this.fields.tlw.getValue()+"px ",t+=this.fields.trw.getValue()+"px ",t+=this.fields.brw.getValue()+"px ",t+=this.fields.blw.getValue()+"px ",t+="/ ",t+=this.fields.tlh.getValue()+"px ",t+=this.fields.trh.getValue()+"px ",t+=this.fields.brh.getValue()+"px ",t+=this.fields.blh.getValue()+"px",this.preview.css("border-radius",t)},t.prototype.setValue=function(t){var n,i={tlw:0,tlh:0,trw:0,trh:0,blw:0,blh:0,brw:0,brh:0};return this.preview.css("border-radius",t),(n=this.preview.css("border-top-left-radius",void 0,!0).match(/(\d*)px/g))&&(n.length>1?(i.tlw=n[0],i.tlh=n[1]):i.tlw=i.tlh=n[0]),(n=this.preview.css("border-top-right-radius",void 0,!0).match(/(\d*)px/g))&&(n.length>1?(i.trw=n[0],i.trh=n[1]):i.trw=i.trh=n[0]),(n=this.preview.css("border-bottom-left-radius",void 0,!0).match(/(\d*)px/g))&&(n.length>1?(i.blw=n[0],i.blh=n[1]):i.blw=i.blh=n[0]),(n=this.preview.css("border-bottom-right-radius",void 0,!0).match(/(\d*)px/g))&&(n.length>1?(i.brw=n[0],i.brh=n[1]):i.brw=i.brh=n[0]),e.Object.each(this.fields,function(t,e){e.setValue(parseInt(i[t],10),!0)}),this},t.prototype.getValue=function(){return this.preview.css("border-radius")},t.prototype.onApplyClick=function(){this.triggerEvent("submit",{overlay:this,value:this.getValue()},!0,!1),this.hide()},t.prototype.onCancelClick=t.prototype.onCloseClick,t}(),e.namespace("editor.overlay").ColorSelector=function(){function t(n){this.configs=this.getConfigs(n),this.onGradientMousemove=e.Function.proxy(this.onGradientMousemove,this),this.onAlphaMousemove=e.Function.proxy(this.onAlphaMousemove,this),t.parent.call(this,this.configs),this.addClass("color-selector")}return t.defaults={parent:".metaScore-editor",draggable:!1},e.editor.Overlay.extend(t),t.prototype.setupDOM=function(){t.parent.prototype.setupDOM.call(this),this.gradient=new e.Dom("<div/>",{"class":"gradient"}).appendTo(this.contents),this.gradient.canvas=new e.Dom("<canvas/>",{width:"255",height:"255"}).addListener("click",e.Function.proxy(this.onGradientClick,this)).addListener("mousedown",e.Function.proxy(this.onGradientMousedown,this)).addListener("mouseup",e.Function.proxy(this.onGradientMouseup,this)).appendTo(this.gradient),this.gradient.position=new e.Dom("<div/>",{"class":"position"}).appendTo(this.gradient),this.alpha=new e.Dom("<div/>",{"class":"alpha"}).appendTo(this.contents),this.alpha.canvas=new e.Dom("<canvas/>",{width:"20",height:"255"}).addListener("click",e.Function.proxy(this.onAlphaClick,this)).addListener("mousedown",e.Function.proxy(this.onAlphaMousedown,this)).addListener("mouseup",e.Function.proxy(this.onAlphaMouseup,this)).appendTo(this.alpha),this.alpha.position=new e.Dom("<div/>",{"class":"position"}).appendTo(this.alpha),this.controls=new e.Dom("<div/>",{"class":"controls"}).appendTo(this.contents),this.controls.r=new e.Dom("<input/>",{type:"number",min:"0",max:"255",name:"r"}).addListener("input",e.Function.proxy(this.onControlInput,this)),new e.Dom("<div/>",{"class":"control-wrapper"}).append(new e.Dom("<label/>",{text:"R","for":"r"})).append(this.controls.r).appendTo(this.controls),this.controls.g=new e.Dom("<input/>",{type:"number",min:"0",max:"255",name:"g"}).addListener("input",e.Function.proxy(this.onControlInput,this)),new e.Dom("<div/>",{"class":"control-wrapper"}).append(new e.Dom("<label/>",{text:"G","for":"g"})).append(this.controls.g).appendTo(this.controls),this.controls.b=new e.Dom("<input/>",{type:"number",min:"0",max:"255",name:"b"}).addListener("input",e.Function.proxy(this.onControlInput,this)),new e.Dom("<div/>",{"class":"control-wrapper"}).append(new e.Dom("<label/>",{text:"B","for":"b"})).append(this.controls.b).appendTo(this.controls),this.controls.a=new e.Dom("<input/>",{type:"number",min:"0",max:"1",step:"0.01",name:"a"}).addListener("input",e.Function.proxy(this.onControlInput,this)),new e.Dom("<div/>",{"class":"control-wrapper"}).append(new e.Dom("<label/>",{text:"A","for":"a"})).append(this.controls.a).appendTo(this.controls),this.controls.current=new e.Dom("<canvas/>"),new e.Dom("<div/>",{"class":"canvas-wrapper current"}).append(this.controls.current).appendTo(this.controls),this.controls.previous=new e.Dom("<canvas/>"),new e.Dom("<div/>",{"class":"canvas-wrapper previous"}).append(this.controls.previous).appendTo(this.controls),this.controls.cancel=new e.editor.Button({label:"Cancel"}).addClass("cancel").addListener("click",e.Function.proxy(this.onCancelClick,this)).appendTo(this.controls),this.controls.apply=new e.editor.Button({label:"Apply"}).addClass("apply").addListener("click",e.Function.proxy(this.onApplyClick,this)).appendTo(this.controls),this.fillGradient()},t.prototype.setValue=function(t){return this.previous_value=t,this.fillPrevious(),this.updateValue(t),this},t.prototype.updateValue=function(t,n,i,o){var s;this.value=this.value||{},e.Var.is(t,"object")||(t=e.Color.parse(t)),"r"in t&&(this.value.r=parseInt(t.r,10)),"g"in t&&(this.value.g=parseInt(t.g,10)),"b"in t&&(this.value.b=parseInt(t.b,10)),"a"in t&&(this.value.a=parseFloat(t.a)),n!==!1&&this.fillAlpha(),o!==!1&&(this.controls.r.val(this.value.r),this.controls.g.val(this.value.g),this.controls.b.val(this.value.b),this.controls.a.val(this.value.a)),i!==!1&&(s=e.Color.rgb2hsv(this.value),this.gradient.position.css("left",255*(1-s.h)+"px"),this.gradient.position.css("top",127.5*s.s+127.5*(1-s.v/255)+"px"),this.alpha.position.css("top",255*(1-this.value.a)+"px")),this.fillCurrent()},t.prototype.fillPrevious=function(){var t=this.controls.previous.get(0).getContext("2d");t.fillStyle="rgba("+this.previous_value.r+","+this.previous_value.g+","+this.previous_value.b+","+this.previous_value.a+")",t.clearRect(0,0,t.canvas.width,t.canvas.height),t.fillRect(0,0,t.canvas.width,t.canvas.height)},t.prototype.fillCurrent=function(){var t=this.controls.current.get(0).getContext("2d");t.fillStyle="rgba("+this.value.r+","+this.value.g+","+this.value.b+","+this.value.a+")",t.clearRect(0,0,t.canvas.width,t.canvas.height),t.fillRect(0,0,t.canvas.width,t.canvas.height)},t.prototype.fillGradient=function(){var t,e=this.gradient.canvas.get(0).getContext("2d");t=e.createLinearGradient(0,0,e.canvas.width,0),t.addColorStop(0,"rgb(255, 0, 0)"),t.addColorStop(.15,"rgb(255, 0, 255)"),t.addColorStop(.33,"rgb(0, 0, 255)"),t.addColorStop(.49,"rgb(0, 255, 255)"),t.addColorStop(.67,"rgb(0, 255, 0)"),t.addColorStop(.84,"rgb(255, 255, 0)"),t.addColorStop(1,"rgb(255, 0, 0)"),e.fillStyle=t,e.fillRect(0,0,e.canvas.width,e.canvas.height),t=e.createLinearGradient(0,0,0,e.canvas.height),t.addColorStop(0,"rgba(255, 255, 255, 1)"),t.addColorStop(.5,"rgba(255, 255, 255, 0)"),t.addColorStop(.5,"rgba(0, 0, 0, 0)"),t.addColorStop(1,"rgba(0, 0, 0, 1)"),e.fillStyle=t,e.fillRect(0,0,e.canvas.width,e.canvas.height)},t.prototype.fillAlpha=function(){var t,e=this.alpha.canvas.get(0).getContext("2d");t=e.createLinearGradient(0,0,0,e.canvas.height),t.addColorStop(0,"rgb("+this.value.r+","+this.value.g+","+this.value.b+")"),t.addColorStop(1,"transparent"),e.fillStyle=t,e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillRect(0,0,e.canvas.width,e.canvas.height)},t.prototype.onControlInput=function(){this.updateValue({r:this.controls.r.val(),g:this.controls.g.val(),b:this.controls.b.val(),a:this.controls.a.val()},!0,!0,!1)},t.prototype.onGradientMousedown=function(t){this.gradient.canvas.addListener("mousemove",this.onGradientMousemove),t.stopPropagation()},t.prototype.onGradientMouseup=function(t){this.gradient.canvas.removeListener("mousemove",this.onGradientMousemove),t.stopPropagation()},t.prototype.onGradientClick=function(t){var e=t.target.getBoundingClientRect(),n=t.pageX-e.left,i=t.pageY-e.top,o=this.gradient.canvas.get(0).getContext("2d"),s=o.getImageData(n,i,1,1),a=this.value;this.gradient.position.css("left",n+"px"),this.gradient.position.css("top",i+"px"),a.r=s.data[0],a.g=s.data[1],a.b=s.data[2],this.updateValue(a,!0,!1),t.stopPropagation()},t.prototype.onGradientMousemove=t.prototype.onGradientClick,t.prototype.onAlphaMousedown=function(t){this.alpha.canvas.addListener("mousemove",this.onAlphaMousemove),t.stopPropagation()},t.prototype.onAlphaMouseup=function(t){this.alpha.canvas.removeListener("mousemove",this.onAlphaMousemove),t.stopPropagation()},t.prototype.onAlphaClick=function(t){var e=t.target.getBoundingClientRect(),n=t.pageY-e.top,i=this.alpha.canvas.get(0).getContext("2d"),o=i.getImageData(0,n,1,1),s=this.value;this.alpha.position.css("top",n+"px"),s.a=Math.round(100*(o.data[3]/255))/100,this.updateValue(s,!1,!1),t.stopPropagation()
},t.prototype.onAlphaMousemove=t.prototype.onAlphaClick,t.prototype.onApplyClick=function(){this.triggerEvent("select",{overlay:this,value:this.value},!0,!1),this.hide()},t.prototype.onCancelClick=function(){this.hide()},t}(),e.namespace("editor.overlay").GuideInfo=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this,this.configs),this.addClass("guide-details")}return t.defaults={toolbar:!0,title:e.Locale.t("editor.overlay.GuideInfo.title","Guide Info")},e.editor.Overlay.extend(t),t.prototype.setupDOM=function(){var n;t.parent.prototype.setupDOM.call(this),n=this.getContents(),this.fields={},this.buttons={},this.fields.title=new e.editor.field.Text({label:e.Locale.t("editor.overlay.GuideInfo.fields.title","Title")}).appendTo(n),this.fields.description=new e.editor.field.Textarea({label:e.Locale.t("editor.overlay.GuideInfo.fields.description","Description")}).appendTo(n),this.fields.css=new e.editor.field.Textarea({label:e.Locale.t("editor.overlay.GuideInfo.fields.css","CSS")}).appendTo(n),this.buttons.apply=new e.editor.Button({label:"Apply"}).addClass("apply").addListener("click",e.Function.proxy(this.onApplyClick,this)).appendTo(n),this.buttons.cancel=new e.editor.Button({label:"Cancel"}).addClass("cancel").addListener("click",e.Function.proxy(this.onCancelClick,this)).appendTo(n)},t.prototype.setValues=function(t){this.fields.title.setValue(t.title||null),this.fields.description.setValue(t.description||null),this.fields.css.setValue(t.css||null)},t.prototype.getValues=function(){return{title:this.fields.title.getValue(),description:this.fields.description.getValue(),css:this.fields.css.getValue()}},t.prototype.onApplyClick=function(){this.triggerEvent("submit",{overlay:this,values:this.getValues()},!0,!1),this.hide()},t.prototype.onCancelClick=t.prototype.onCloseClick=function(){this.setValues(this.previousValues),this.hide()},t.prototype.show=function(){return this.previousValues=this.getValues(),t.parent.prototype.show.call(this)},t}(),e.namespace("editor.overlay").GuideSelector=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this,this.configs),this.addClass("guide-selector")}return t.defaults={toolbar:!0,title:e.Locale.t("editor.overlay.GuideSelector.title","Select a guide"),emptyText:e.Locale.t("editor.overlay.GuideSelector.emptyText","No guides available"),url:null},e.editor.Overlay.extend(t),t.prototype.show=function(){this.loadmask=new e.editor.overlay.LoadMask({autoShow:!0}),e.Ajax.get(this.configs.url,{success:e.Function.proxy(this.onLoadSuccess,this),error:e.Function.proxy(this.onLoadError,this)})},t.prototype.onLoadSuccess=function(t){var n,i,o=this.getContents(),s=JSON.parse(t.response);n=new e.Dom("<table/>",{"class":"guides"}).appendTo(o),e.Var.isEmpty(s)?o.text(this.configs.emptyText):e.Object.each(s,function(t,o){i=new e.Dom("<tr/>",{"class":"guide guide-"+o.id}).addListener("click",e.Function.proxy(this.onGuideClick,this,[o])).appendTo(n),new e.Dom("<td/>",{"class":"thumbnail"}).append(new e.Dom("<img/>",{src:o.thumbnail})).appendTo(i),new e.Dom("<td/>",{"class":"details"}).append(new e.Dom("<h1/>",{"class":"title",text:o.title})).append(new e.Dom("<p/>",{"class":"description",text:o.description})).append(new e.Dom("<h2/>",{"class":"author",text:o.author.name})).appendTo(i)},this),this.loadmask.hide(),delete this.loadmask,this.configs.modal&&this.mask.appendTo(this.configs.parent),this.appendTo(this.configs.parent)},t.prototype.onLoadError=function(){},t.prototype.onGuideClick=function(t){this.triggerEvent("select",{overlay:this,guide:t},!0,!1),this.hide()},t}(),e.namespace("editor.overlay").InsertImage=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this,this.configs),this.addClass("insert-image"),this.configs.image&&this.setValuesFromImage(this.configs.image)}return t.defaults={toolbar:!0,title:e.Locale.t("editor.overlay.InsertImage.title","Insert Image"),image:null},e.editor.Overlay.extend(t),t.prototype.setupDOM=function(){var n,i,o;t.parent.prototype.setupDOM.call(this),n=this.getContents(),this.fields={},this.buttons={},this.fields.image=new e.editor.field.Image({label:e.Locale.t("editor.overlay.InsertImage.fields.image","Image")}).addClass("image").addListener("valuechange",e.Function.proxy(this.onURLChange,this)).appendTo(n),i=new e.Dom("<div/>",{"class":"size-wrapper clearfix"}).appendTo(n),this.fields.width=new e.editor.field.Number({label:e.Locale.t("editor.overlay.InsertImage.fields.width","Width"),min:0}).addClass("width").addListener("valuechange",e.Function.proxy(this.onWidthChange,this)).appendTo(i),o=new e.Dom("<div/>",{"class":"size-buttons"}).appendTo(i),this.fields.lock_ratio=new e.editor.field.Boolean({checked:!0,label:"&nbsp;"}).addClass("lock-ratio").attr("title",e.Locale.t("editor.overlay.InsertImage.lock-ratio","Lock ratio")).addListener("valuechange",e.Function.proxy(this.onLockRatioChange,this)).appendTo(o),this.fields.reset_size=new e.editor.Button({}).addClass("reset-size").attr("title",e.Locale.t("editor.overlay.InsertImage.reset-size","Reset size")).addListener("click",e.Function.proxy(this.onRevertSizeClick,this)).appendTo(o),this.fields.height=new e.editor.field.Number({label:e.Locale.t("editor.overlay.InsertImage.fields.height","Height"),min:0}).addClass("height").addListener("valuechange",e.Function.proxy(this.onHeightChange,this)).appendTo(i),this.fields.alignment=new e.editor.field.Select({label:e.Locale.t("editor.overlay.InsertImage.fields.alignment","Alignment"),options:{"":e.Locale.t("editor.overlay.InsertImage.fields.alignment.unset","&lt;not set&gt;"),left:e.Locale.t("editor.overlay.InsertImage.fields.alignment.left","Left"),right:e.Locale.t("editor.overlay.InsertImage.fields.alignment.right","Right")}}).addClass("alignment").appendTo(n),this.buttons.apply=new e.editor.Button({label:"Apply"}).addClass("apply").addListener("click",e.Function.proxy(this.onApplyClick,this)).appendTo(n),this.buttons.cancel=new e.editor.Button({label:"Cancel"}).addClass("cancel").addListener("click",e.Function.proxy(this.onCancelClick,this)).appendTo(n)},t.prototype.setValuesFromImage=function(t){this.fields.image.setValue(t.url)},t.prototype.onURLChange=function(t){var n=t.detail.value;n&&new e.Dom("<img/>").addListener("load",e.Function.proxy(function(t){this.img=t.target,this.fields.width.setValue(this.img.width,!0),this.fields.height.setValue(this.img.height,!0)},this)).attr("src",n)},t.prototype.onWidthChange=function(){var t,e,n=this.fields.lock_ratio.getValue();n&&this.img&&(t=this.fields.width.getValue(),e=Math.round(t*this.img.height/this.img.width),this.fields.height.setValue(e,!0))},t.prototype.onHeightChange=function(){var t,e,n=this.fields.lock_ratio.getValue();n&&this.img&&(e=this.fields.height.getValue(),t=Math.round(e*this.img.width/this.img.height),this.fields.width.setValue(t,!0))},t.prototype.onLockRatioChange=function(t){var e=t.detail.value;e&&this.img&&this.fields.width.setValue(this.fields.width.getValue())},t.prototype.onRevertSizeClick=function(){this.img&&(this.fields.width.setValue(this.img.width),this.fields.height.setValue(this.img.height))},t.prototype.onApplyClick=function(){var t,e,n,i;t=this.fields.image.getValue(),e=this.fields.width.getValue(),n=this.fields.height.getValue(),i=this.fields.alignment.getValue(),this.triggerEvent("submit",{overlay:this,url:t,width:e,height:n,alignment:i},!0,!1),this.hide()},t.prototype.onCancelClick=function(){this.hide()},t}(),e.namespace("editor.overlay").InsertLink=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this,this.configs),this.addClass("insert-link"),this.toggleFields(),this.configs.link&&this.setValuesFromLink(this.configs.link)}return t.defaults={toolbar:!0,title:e.Locale.t("editor.overlay.InsertLink.title","Insert Link"),link:null},e.editor.Overlay.extend(t),t.prototype.setupDOM=function(){var n;t.parent.prototype.setupDOM.call(this),n=this.getContents(),this.fields={},this.buttons={},this.fields.type=new e.editor.field.Select({label:e.Locale.t("editor.overlay.InsertLink.fields.type","Type"),options:{url:e.Locale.t("editor.overlay.InsertLink.fields.type.url","URL"),page:e.Locale.t("editor.overlay.InsertLink.fields.type.page","Page"),time:e.Locale.t("editor.overlay.InsertLink.fields.type.time","Time")}}).addListener("valuechange",e.Function.proxy(this.onTypeChange,this)).appendTo(n),this.fields.url=new e.editor.field.Text({label:e.Locale.t("editor.overlay.InsertLink.fields.url","URL")}).appendTo(n),this.fields.page=new e.editor.field.Number({label:e.Locale.t("editor.overlay.InsertLink.fields.page","Page")}).appendTo(n),this.fields.inTime=new e.editor.field.Time({label:e.Locale.t("editor.overlay.InsertLink.fields.in-time","Start time"),inButton:!0}).appendTo(n),this.fields.outTime=new e.editor.field.Time({label:e.Locale.t("editor.overlay.InsertLink.fields.out-time","End time"),inButton:!0}).appendTo(n),this.fields.rIndex=new e.editor.field.Number({label:e.Locale.t("editor.overlay.InsertLink.fields.r-index","Reading index")}).appendTo(n),this.buttons.apply=new e.editor.Button({label:"Apply"}).addClass("apply").addListener("click",e.Function.proxy(this.onApplyClick,this)).appendTo(n),this.buttons.cancel=new e.editor.Button({label:"Cancel"}).addClass("cancel").addListener("click",e.Function.proxy(this.onCancelClick,this)).appendTo(n)},t.prototype.setValuesFromLink=function(t){var e;(e=t.hash.match(/^#p=(\d+)/))?(this.fields.type.setValue("page"),this.fields.page.setValue(e[1])):(e=t.hash.match(/^#t=(\d+),(\d+)&r=(\d+)/))?(this.fields.type.setValue("time"),this.fields.inTime.setValue(e[1]),this.fields.outTime.setValue(e[2]),this.fields.rIndex.setValue(e[3])):(this.fields.type.setValue("url"),this.fields.url.setValue(t.href))},t.prototype.toggleFields=function(){var t=this.fields.type.getValue();switch(t){case"page":this.fields.url.hide(),this.fields.page.show(),this.fields.inTime.hide(),this.fields.outTime.hide(),this.fields.rIndex.hide();break;case"time":this.fields.url.hide(),this.fields.page.hide(),this.fields.inTime.show(),this.fields.outTime.show(),this.fields.rIndex.show();break;default:this.fields.url.show(),this.fields.page.hide(),this.fields.inTime.hide(),this.fields.outTime.hide(),this.fields.rIndex.hide()}},t.prototype.onTypeChange=function(){this.toggleFields()},t.prototype.onApplyClick=function(){var t,e=this.fields.type.getValue();switch(e){case"page":t="#p="+this.fields.page.getValue();break;case"time":t="#t="+this.fields.inTime.getValue()+","+this.fields.outTime.getValue(),t+="&r="+this.fields.rIndex.getValue();break;default:t=this.fields.url.getValue()}this.triggerEvent("submit",{overlay:this,url:t},!0,!1),this.hide()},t.prototype.onCancelClick=function(){this.hide()},t}(),e.namespace("editor.overlay").LoadMask=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this,this.configs),this.addClass("loadmask"),this.text=new e.Dom("<div/>",{"class":"text",text:this.configs.text}).appendTo(this.contents)}return t.defaults={draggable:!1,text:e.Locale.t("editor.overlay.LoadMask.text","Loading...")},e.editor.Overlay.extend(t),t}(),e.namespace("editor.overlay").Toolbar=function(){function t(n){this.configs=this.getConfigs(n),t.parent.call(this,"<div/>",{"class":"toolbar clearfix"}),this.title=new e.Dom("<div/>",{"class":"title"}).appendTo(this),this.buttons=new e.Dom("<div/>",{"class":"buttons"}).appendTo(this),this.configs.title&&this.title.text(this.configs.title)}return t.defaults={title:null},e.Dom.extend(t),t.prototype.getTitle=function(){return this.title},t.prototype.addButton=function(t){var n=(new e.editor.Button).data("action",t).appendTo(this.buttons);return n},t.prototype.getButton=function(t){return this.buttons.children('[data-action="'+t+'"]')},t}(),e.namespace("editor.overlay").iFrame=function(){function t(e){this.configs=this.getConfigs(e),t.parent.call(this,this.configs),this.addClass("iframe")}return t.defaults={toolbar:!0,url:null},e.editor.Overlay.extend(t),t.prototype.setupDOM=function(){t.parent.prototype.setupDOM.call(this),this.frame=new e.Dom("<iframe/>",{src:this.configs.url}).appendTo(this.contents)},t}()})(this);