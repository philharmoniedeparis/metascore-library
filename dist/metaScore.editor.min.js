/*! metaScore - v0.0.1 - 2014-06-30 - Oussama Mubarak */
(function(t){"use strict";var e={version:"0.0.1"};(function(t){function e(t){t.parent instanceof Function&&(e.apply(this,[t.parent]),this.super=n(this,i(this,this.constructor))),t.apply(this,arguments)}function n(t,e){for(var n in t)"super"!==n&&t[n]instanceof Function&&(e[n]=t[n].super||i(t,t[n]));return e}function i(t,e){var n=t.super;return e.super=function(){return t.super=n,e.apply(t,arguments)}}t.Base=function(){},t.Base.extend=function s(t){function i(){e!==arguments[0]&&(e.apply(this,[t]),n(this,this),this.initializer instanceof Function&&this.initializer.apply(this),this.constructor.apply(this,arguments))}return i.prototype=new this(e),i.prototype.constructor=i,i.toString=function(){return""+t},i.extend=function(e){return e.parent=t,s.apply(i,arguments)},i},t.Base=t.Base.extend(function(){this.constructor=function(){},this.initConfig=function(e){e=e||{},this.configs=this.defaults?t.Object.extend({},this.defaults,e):e}})})(e),Element&&function(t){t.matches=t.matchesSelector=t.matchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector||function(t){for(var e=(this.parentNode||this.document).querySelectorAll(t),n=-1;e[++n]&&e[n]!==this;);return!!e[n]}}(Element.prototype),e.Ajax=e.Base.extend(function(){}),e.Ajax.createXHR=function(){var t,e,n,i=["MSXML2.XMLHttp.5.0","MSXML2.XMLHttp.4.0","MSXML2.XMLHttp.3.0","MSXML2.XMLHttp","Microsoft.XMLHttp"];if("undefined"!=typeof XMLHttpRequest)return t=new XMLHttpRequest;if(window.ActiveXObject)for(e=0,n=i.length;n>e;e++)try{return t=new ActiveXObject(i[e])}catch(s){}throw Error("XMLHttp object could be created.")},e.Ajax.send=function(t,n){var i,s=e.Ajax.createXHR(),a=[],o={method:"GET",headers:[],async:!0,data:{},complete:null,success:null,error:null};return n=e.Object.extend(function(){},o,n),e.Object.each(n.data,function(t,e){a.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}),"POST"===n.method?(i=a.join("&"),n.headers["Content-type"]="application/x-www-form-urlencoded"):t+="?"+a.join("&"),s.open(n.method,t,n.async),e.Object.each(n.headers,function(t,e){s.setRequestHeader(t,e)}),s.onreadystatechange=function(){4===s.readyState&&(e.Var.is(n.complete,"function")&&n.complete(s),s.status>=200&&300>status||304===status?e.Var.is(n.success,"function")&&n.success(s):e.Var.is(n.error,"function")&&n.error(s))},s.send(i),s},e.Ajax.get=function(t,n){return e.Object.extend(n,{method:"GET"}),e.Ajax.send(t,n)},e.Ajax.post=function(t,n){return e.Object.extend(n,{method:"POST"}),e.Ajax.send(t,n)},e.Array=e.Base.extend(function(){}),e.Array.inArray=function(t,e){var n,i=0;if(e){if(e.indexOf)return e.indexOf(t);for(n=e.length;n>i;i++)if(i in e&&e[i]===t)return i}return-1},e.Array.copy=function(t){return[].concat(t)},e.Array.shuffle=function(t){var n=e.Array.copy(t);return n.sort(function(){return(0|3*Math.random())-1}),n},e.Array.unique=function(t){for(var e=[],n=t.length,i=0;n>i;i++){for(var s=i+1;n>s;s++)t[i]===t[s]&&(s=++i);e.push(t[i])}return e},e.Array.each=function(t,e,n){for(var i,s=0,a=t.length,o=void 0!==n;a>s&&(i=e.call(o?n:t[s],s,t[s]),i!==!1);s++);return t},e.Array.remove=function(t,n){for(var i=e.Array.inArray(n,t);i>-1;)t.splice(i,1),i=e.Array.inArray(n,t);return t},e.Dom=e.Base.extend(function(){this.constructor=function(){var t;this.elements=[],arguments.length>0&&(t=e.Dom.elementsFromString.apply(this,arguments)||e.Dom.selectElements.apply(this,arguments),t&&(this.add(t),arguments.length>1&&this.attr(arguments[1])))},this.add=function(t){if(t.hasOwnProperty("length"))for(var e=0;t.length>e;e++)this.elements.push(t[e]);else this.elements.push(t)},this.get=function(t){return this.elements[t]},this.filter=function(t){var n=[];return e.Array.each(this.elements,function(i,s){e.Dom.is(s,t)&&n.push(s)},this),this.elements=n,this},this.children=function(t){var n=new e.Dom;return e.Array.each(this.elements,function(i,s){n.add(e.Dom.selectElements.call(this,t,s))},this),n},this.parents=function(t){var n=new e.Dom;return e.Array.each(this.elements,function(t,e){n.add(e.parentElement)},this),t&&n.filter(t),n},this.addClass=function(t){return e.Array.each(this.elements,function(n,i){e.Dom.addClass(i,t)},this),this},this.removeClass=function(t){return e.Array.each(this.elements,function(n,i){e.Dom.removeClass(i,t)},this),this},this.toggleClass=function(t){return e.Array.each(this.elements,function(n,i){e.Dom.toggleClass(i,t)},this),this},this.addListener=function(t,n,i){return e.Array.each(this.elements,function(s,a){e.Dom.addListener(a,t,n,i)},this),this},this.addDelegate=function(t,n,i,s){return this.addListener(n,function(n){e.Dom.is(n.target,t)&&i.call(this,n)},s)},this.removeListener=function(t,n,i){return e.Array.each(this.elements,function(s,a){e.Dom.removeListener(a,t,n,i)},this),this},this.triggerEvent=function(t,n,i,s){e.Array.each(this.elements,function(a,o){e.Dom.triggerEvent(o,t,n,i,s)},this)},this.text=function(t){return void 0===t?e.Dom.text(this.get(0)):(e.Array.each(this.elements,function(n,i){e.Dom.text(i,t)},this),void 0)},this.val=function(t){return void 0!==t?(e.Array.each(this.elements,function(n,i){e.Dom.val(i,t)},this),this):e.Dom.val(this.get(0))},this.attr=function(t,n){return void 0!==n||e.Var.is(t,"object")?(e.Array.each(this.elements,function(i,s){e.Dom.attr(s,t,n)},this),this):e.Dom.attr(this.get(0),t)},this.css=function(t,n){return void 0!==n?(e.Array.each(this.elements,function(i,s){e.Dom.css(s,t,n)},this),this):e.Dom.css(this.get(0),t)},this.data=function(t,n){return void 0!==n?(e.Array.each(this.elements,function(i,s){e.Dom.data(s,t,n)},this),this):e.Dom.data(this.get(0),t)},this.append=function(t){return t instanceof e.Dom&&(t=t.elements),e.Dom.append(this.get(0),t),this},this.appendTo=function(t){return t instanceof e.Dom||(t=new e.Dom(t)),t=t.get(0),e.Array.each(this.elements,function(n,i){e.Dom.append(t,i)},this),this},this.remove=function(){return e.Array.each(this.elements,function(t,n){e.Dom.remove(n)},this),this},this.is=function(t){var n;return e.Array.each(this.elements,function(i,s){return n=e.Dom.is(s,t)},this),n}}),e.Dom.stringRe=/^<(.)+>$/,e.Dom.camelRe=/-([\da-z])/gi,e.Dom.camelReplaceFn=function(t,e){return e.toUpperCase()},e.Dom.camel=function(t){return t.replace(e.Dom.camelRe,e.Dom.camelReplaceFn)},e.Dom.bubbleEvents={click:!0,submit:!0,mousedown:!0,mousemove:!0,mouseup:!0,mouseover:!0,mouseout:!0,transitionend:!0},e.Dom.selectElements=function(t,n){var i;return n||(n=document),i=e.Var.is(t,"string")?n.querySelectorAll(t):t.length?t:[t]},e.Dom.elementsFromString=function(t){var e,n,i,s={option:[1,"<select multiple='multiple'>","</select>"],optgroup:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tbody:[1,"<table>","</table>"],tfoot:[1,"<table>","</table>"],colgroup:[1,"<table>","</table>"],caption:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],th:[3,"<table><tbody><tr>","</tr></tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[1,"<div>","</div>"]},a=document.createElement("div"),o=/<\s*\w.*?>/g.exec(t);if(null!=o){for(e=o[0].replace(/</g,"").replace(/\/?>/g,""),n=s[e]||s._default,t=n[1]+t+n[2],a.innerHTML=t,i=n[0];i--;)a=a.lastChild;return a.childNodes}return null},e.Dom.hasClass=function(t,e){return t.classList.contains(e)},e.Dom.addClass=function(t,e){for(var n=e.split(" "),i=0,s=n.length;s>i;i++)t.classList.add(n[i])},e.Dom.removeClass=function(t,e){for(var n=e.split(" "),i=0,s=n.length;s>i;i++)t.classList.remove(n[i])},e.Dom.toggleClass=function(t,e){for(var n=e.split(" "),i=0,s=n.length;s>i;i++)t.classList.toggle(n[i])},e.Dom.addListener=function(t,n,i,s){return void 0===s&&(s=e.Dom.bubbleEvents.hasOwnProperty("type")?e.Dom.bubbleEvents[n]:!1),t.addEventListener(n,i,s)},e.Dom.removeListener=function(t,n,i,s){return void 0===s&&(s=e.Dom.bubbleEvents.hasOwnProperty("type")?e.Dom.bubbleEvents[n]:!1),t.removeEventListener(n,i,s)},e.Dom.triggerEvent=function(t,e,n,i,s){var a=new CustomEvent(e,{detail:n,bubbles:i,cancelable:s});return t.dispatchEvent(a)},e.Dom.text=function(t,e){return void 0!==e&&(t.innerHTML=e),t.innerHTML},e.Dom.val=function(t,e){return void 0!==e&&(t.value=e),t.value},e.Dom.attr=function(t,n,i){if(e.Var.is(n,"object"))e.Object.each(n,function(n,i){e.Dom.attr(t,n,i)},this);else switch(n){case"class":this.addClass(t,i);break;case"text":this.text(t,i);break;default:if(null!==i)return void 0!==i&&t.setAttribute(n,i),t.getAttribute(n);t.removeAttribute(n)}},e.Dom.css=function(t,e,n){var i,s;return i=this.camel(e),void 0!==n&&(t.style[i]=n),s=window.getComputedStyle(t),s.getPropertyValue(e)},e.Dom.data=function(t,e,n){return e=this.camel(e),null===n?delete t.dataset[e]:void 0!==n&&(t.dataset[e]=n),t.dataset[e]},e.Dom.append=function(t,n){e.Var.is(n,"array")||(n=[n]),e.Array.each(n,function(e,n){t.appendChild(n)},this)},e.Dom.remove=function(t){t.parentElement.removeChild(t)},e.Dom.is=function(t,e){return t.matches(e)},e.Draggable=e.Base.extend(function(){var t,n,i,s,a;this.constructor=function(s,a,o){return s._draggable?s._draggable:(t=s,n=a,i=o||new e.Dom("body"),n.addListener("mousedown",this.onMouseDown),t.addClass("draggable"),t._draggable=this,void 0)},this.onMouseDown=function(e){a===!0&&(s={left:parseInt(t.css("left"),10)-e.clientX,top:parseInt(t.css("top"),10)-e.clientY},i.addListener("mouseup",this.onMouseUp).addListener("mousemove",this.onMouseMove),t.addClass("dragging"),e.stopPropagation())},this.onMouseMove=function(e){var n=e.clientX+s.left,i=e.clientY+s.top;t.css("left",n+"px").css("top",i+"px").triggerEvent("drag",null,!1,!0),e.stopPropagation()},this.onMouseUp=function(e){i.removeListener("mousemove",this.onMouseMove).removeListener("mouseup",this.onMouseUp),t.removeClass("dragging"),e.stopPropagation()},this.enable=function(){return a=!0,t.addClass("draggable"),this},this.disable=function(){return a=!1,t.removeClass("draggable"),this}}),e.Function=e.Base.extend(function(){}),e.Function.proxy=function(t,n){return e.Var.type(t,"function")?function(){return t.apply(n||this,arguments)}:void 0},e.Function.emptyFn=function(){},e.Object=e.Base.extend(function(){}),e.Object.extend=function(){for(var t,e,n,i,s=arguments[0]||{},a=1,o=arguments.length;o>a;a++)if(null!=(t=arguments[a]))for(e in t)n=s[e],i=t[e],n!==i&&void 0!==i&&(s[e]=i);return s},e.Object.copy=function(t){return e.Object.extend({},t)},e.Object.each=function(t,e,n){var i,s,a=void 0!==n;for(i in t)if(t.hasOwnProperty(i)&&(s=e.call(a?n:t[i],i,t[i]),s===!1))break;return t},e.Resizable=e.Base.extend(function(){var t,n,i,s,a;this.constructor=function(s,a){return s._resizable?s._resizable:(t=s,n=a||new e.Dom("body"),i={},i.top_left=new e.Dom("<div/>",{"class":"resize-handle"}).data("direction","top-left").addListener("mousedown",this.onMouseDown).appendTo(t),i.top_right=new e.Dom("<div/>",{"class":"resize-handle"}).data("direction","top-right").addListener("mousedown",this.onMouseDown).appendTo(t),i.bottom_left=new e.Dom("<div/>",{"class":"resize-handle"}).data("direction","bottom-left").addListener("mousedown",this.onMouseDown).appendTo(t),i.bottom_right=new e.Dom("<div/>",{"class":"resize-handle"}).data("direction","bottom-right").addListener("mousedown",this.onMouseDown).appendTo(t),t._resizable=this,void 0)},this.onMouseDown=function(e){a===!0&&(s={handle:e.target,x:e.clientX,y:e.clientY,left:parseInt(t.css("left"),10)-e.clientX,top:parseInt(t.css("top"),10)-e.clientY,w:parseInt(t.css("width"),10),h:parseInt(t.css("height"),10)},n.addListener("mousemove",this.onMouseMove).addListener("mouseup",this.onMouseUp),t.addClass("resizing"),e.stopPropagation())},this.onMouseMove=function(n){var i,a,o,r,l=new e.Dom(s.handle);switch(l.data("direction")){case"top-left":i=s.w-n.clientX+s.x,a=s.h-n.clientY+s.y,o=n.clientY+s.top,r=n.clientX+s.left;break;case"top-right":i=s.w+n.clientX-s.x,a=s.h-n.clientY+s.y,o=n.clientY+s.top;break;case"bottom-left":i=s.w-n.clientX+s.x,a=s.h+n.clientY-s.y,r=n.clientX+s.left;break;case"bottom-right":i=s.w+n.clientX-s.x,a=s.h+n.clientY-s.y}void 0!==o&&t.css("top",o+"px"),void 0!==r&&t.css("left",r+"px"),t.css("width",i+"px").css("height",a+"px").triggerEvent("resize",null,!1,!0),n.stopPropagation()},this.onMouseUp=function(e){n.removeListener("mousemove",this.onMouseMove).removeListener("mouseup",this.onMouseUp),t.removeClass("resizing"),e.stopPropagation()},this.enable=function(){return a=!0,t.addClass("resizable"),this},this.disable=function(){return a=!1,t.removeClass("resizable"),this}}),e.String=e.Base.extend(function(){}),e.String.capitalize=function(t){return t.replace(/(?:^|\s)\S/g,function(t){return t.toUpperCase()})},e.String.t=function(t){return t},e.String.uuid=function(t,e){var n,i=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],s=[];if(e=e||i.length,t)for(n=0;t>n;n++)s[n]=i[0|Math.random()*e];else{var a;for(s[8]=s[13]=s[18]=s[23]="-",s[14]="4",n=0;36>n;n++)s[n]||(a=0|16*Math.random(),s[n]=i[19===n?8|3&a:a])}return s.join("")},e.Var=e.Base.extend(function(){}),e.Var.classes2types={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},e.Var.type=function(t){return null==t?t+"":e.Var.classes2types[Object.prototype.toString.call(t)]||"object"},e.Var.is=function(t,n){return e.Var.type(t)===n.toLowerCase()},e.Editor=e.Dom.extend(function(){var t,n,i,s,a;this.constructor=function(o){this.super("<div/>",{"class":"metaScore-editor"}),void 0!==o&&this.appendTo(o),t=new e.Dom("<div/>",{"class":"workspace"}).appendTo(this),n=(new e.Editor.MainMenu).appendTo(this),i=(new e.Editor.Sidebar).appendTo(this),s=(new e.Player).appendTo(t),a=new e.Dom("<div/>",{"class":"grid"}).appendTo(t),i.getPanel("block").getToolbar().addDelegate(".buttons .menu .new","click",function(){var t=s.addBlock();i.getPanel("block").selectBlock(t)}).addDelegate(".buttons .menu .delete","click",function(){var t=i.getPanel("block").getBlock();s.deleteBlock(t)}),s.addDelegate(".block .pager","click",function(t){var n=new e.Dom(t.target).parents(".block").attr("id"),a=s.getBlock(n);i.getPanel("block").selectBlock(a)})}}),e.Editor.Button=e.Dom.extend(function(){var t;this.disabled=!1,this.defaults={label:null},this.constructor=function(t){var e=this;this.super("<button/>"),this.initConfig(t),this.configs.label&&this.setLabel(this.configs.label),this.addListener("click",function(t){e.disabled&&t.stopPropagation()})},this.setLabel=function(n){void 0===t&&(t=new e.Dom("<span/>",{"class":"label"}).appendTo(this)),t.text(n)},this.disable=function(){return this.disabled=!0,this.addClass("disabled"),this},this.enable=function(){return this.disabled=!1,this.removeClass("disabled"),this}}),e.Editor.DropDownMenu=e.Dom.extend(function(){this.constructor=function(t){this.super("<ul/>",{"class":"dropdown-menu"}),this.initConfig(t)},this.addItem=function(t){var n=new e.Dom("<li/>",t).appendTo(this);return n}}),e.Editor.Field=e.Dom.extend(function(){this.defaults={value:null,disabled:!1},this.tag="<input/>",this.attributes={type:"text","class":"field"},this.constructor=function(t){this.super(this.tag,this.attributes),this.initConfig(t),null!==this.configs.value&&this.setValue(this.configs.value),this.configs.disabled&&this.disable(),this.addListener("change",this.onChange)},this.onChange=function(t){t.hasOwnProperty("detail")||(t.stopPropagation(),this.value=this.val(),this.triggerEvent("change",{field:this,value:this.value},!0,!1))},this.setValue=function(t){this.val(t)},this.disable=function(){return this.disabled=!0,this.addClass("disabled"),this.attr("disabled","disabled"),this},this.enable=function(){return this.disabled=!1,this.removeClass("disabled"),this.attr("disabled",null),this}}),e.Editor.MainMenu=e.Dom.extend(function(){this.constructor=function(){this.super("<div/>",{"class":"main-menu clearfix"}),this.setupUI()},this.setupUI=function(){var t,n;this.buttons={},t=new e.Dom("<div/>",{"class":"left"}).appendTo(this),n=new e.Dom("<div/>",{"class":"right"}).appendTo(this),this.buttons["new"]=(new e.Editor.Button).attr({"class":"new",title:e.String.t("New")}).appendTo(t),this.buttons.open=(new e.Editor.Button).attr({"class":"open",title:e.String.t("Open")}).appendTo(t),this.buttons.edit=(new e.Editor.Button).attr({"class":"edit",title:e.String.t("edit")}).disable().appendTo(t),this.buttons.save=(new e.Editor.Button).attr({"class":"save",title:e.String.t("save")}).disable().appendTo(t),this.buttons.download=(new e.Editor.Button).attr({"class":"download",title:e.String.t("download")}).disable().appendTo(t),this.buttons["delete"]=(new e.Editor.Button).attr({"class":"delete",title:e.String.t("delete")}).disable().appendTo(t),this.buttons.time=(new e.Editor.Field.TimeField).attr({"class":"time",title:e.String.t("time")}).appendTo(t),this.buttons.revert=(new e.Editor.Button).attr({"class":"revert",title:e.String.t("revert")}).appendTo(t),this.buttons.undo=(new e.Editor.Button).attr({"class":"undo",title:e.String.t("undo")}).appendTo(t),this.buttons.redo=(new e.Editor.Button).attr({"class":"redo",title:e.String.t("redo")}).disable().appendTo(t),this.buttons.settings=(new e.Editor.Button).attr({"class":"settings",title:e.String.t("settings")}).appendTo(n),this.buttons.help=(new e.Editor.Button).attr({"class":"help",title:e.String.t("help")}).appendTo(n)}}),e.Editor.Overlay=e.Dom.extend(function(){var t;this.defaults={value:null,disabled:!1,parent:".metaScore-editor",modal:!0,draggable:!0},this.constructor=function(n){this.super("<div/>",{"class":"overlay clearfix"}),this.initConfig(n),this.configs.modal&&(this.mask=new e.Dom("<div/>",{"class":"overlay-mask"})),this.configs.draggable&&(t=new e.Draggable(this,this))},this.show=function(){this.configs.modal&&this.mask.appendTo(this.configs.parent),this.appendTo(this.configs.parent)},this.hide=function(){this.configs.modal&&this.mask.remove(),this.remove()}}),e.Editor.Panel=e.Dom.extend(function(){var t,n={};this.defaults={title:"",fields:{}},this.constructor=function(n){this.super("<div/>",{"class":"panel"}),this.initConfig(n),t=new e.Editor.Toolbar({title:this.configs.title}).appendTo(this),t.getTitle().addListener("click",e.Function.proxy(this.toggleState,this)),this.contents=new e.Dom("<table/>",{"class":"fields"}).appendTo(this),this.setupFields()},this.setupFields=function(){var t,i,s;e.Object.each(this.configs.fields,function(a,o){t=new e.Dom("<tr/>",{"class":"field-wrapper"}).appendTo(this.contents),i="field-"+e.String.uuid(5),n[a]=s=(new o.type).attr("id",i),s.data("name",a),new e.Dom("<td/>").appendTo(t).append(new e.Dom("<label/>",{text:o.label,"for":i})),new e.Dom("<td/>").appendTo(t).append(s)},this)},this.getToolbar=function(){return t},this.getField=function(t){return void 0===t?n:n[t]},this.toggleState=function(){this.toggleClass("collapsed")}}),e.Editor.Sidebar=e.Dom.extend(function(){var t={};this.constructor=function(){this.super("<div/>",{"class":"sidebar"}),t.block=(new e.Editor.Panel.Block).appendTo(this),t.page=(new e.Editor.Panel.Page).appendTo(this),t.element=(new e.Editor.Panel.Element).appendTo(this),t.text=(new e.Editor.Panel.Text).appendTo(this)},this.getPanel=function(e){return t[e]}}),e.Editor.Toolbar=e.Dom.extend(function(){var t,n;this.defaults={title:null},this.constructor=function(i){this.super("<div/>",{"class":"toolbar clearfix"}),this.initConfig(i),t=new e.Dom("<div/>",{"class":"title"}).appendTo(this),n=new e.Dom("<div/>",{"class":"buttons"}).appendTo(this),this.configs.title&&t.text(this.configs.title)},this.getTitle=function(){return t},this.addButton=function(t){return new e.Editor.Button(t).appendTo(n)}}),e.Editor.Field.BooleanField=e.Editor.Field.extend(function(){this.defaults={value:!0,unchecked_value:!1,checked:!1,disabled:!1},this.attributes={type:"checkbox","class":"field booleanfield"},this.constructor=function(t){this.super(t),this.configs.checked&&this.attr("checked","checked")},this.onChange=function(t){t.hasOwnProperty("detail")||(t.stopPropagation(),this.value=this.is(":checked")?this.val():this.configs.unchecked_value,this.triggerEvent("change",{field:this,value:this.value},!0,!1))},this.setChecked=function(t){this.attr("checked",t?"checked":"")}}),e.Editor.Field.ColorField=e.Editor.Field.extend(function(){var t,n,i;this.defaults={value:{r:255,g:255,b:255,a:1},disabled:!1},this.tag="<div/>",this.attributes={"class":"field colorfield"},this.constructor=function(i){t=(new e.Editor.Button).addListener("click",this.onClick),n=(new e.Editor.Overlay).addClass("colorfield-overlay"),n.gradient=new e.Dom("<div/>",{"class":"gradient"}).appendTo(n),n.gradient.canvas=new e.Dom("<canvas/>",{width:"255",height:"255"}).addListener("click",this.onGradientClick).addListener("mousedown",this.onGradientMousedown).addListener("mouseup",this.onGradientMouseup).appendTo(n.gradient),n.gradient.position=new e.Dom("<div/>",{"class":"position"}).appendTo(n.gradient),n.alpha=new e.Dom("<div/>",{"class":"alpha"}).appendTo(n),n.alpha.canvas=new e.Dom("<canvas/>",{width:"20",height:"255"}).addListener("click",this.onAlphaClick).addListener("mousedown",this.onAlphaMousedown).addListener("mouseup",this.onAlphaMouseup).appendTo(n.alpha),n.alpha.position=new e.Dom("<div/>",{"class":"position"}).appendTo(n.alpha),n.controls=new e.Dom("<div/>",{"class":"controls"}).appendTo(n),n.controls.r=new e.Dom("<input/>",{type:"number",min:"0",max:"255",name:"r"}).addListener("input",this.onControlInput),new e.Dom("<div/>",{"class":"control-wrapper"}).append(new e.Dom("<label/>",{text:"R","for":"r"})).append(n.controls.r).appendTo(n.controls),n.controls.g=new e.Dom("<input/>",{type:"number",min:"0",max:"255",name:"g"}).addListener("input",this.onControlInput),new e.Dom("<div/>",{"class":"control-wrapper"}).append(new e.Dom("<label/>",{text:"G","for":"g"})).append(n.controls.g).appendTo(n.controls),n.controls.b=new e.Dom("<input/>",{type:"number",min:"0",max:"255",name:"b"}).addListener("input",this.onControlInput),new e.Dom("<div/>",{"class":"control-wrapper"}).append(new e.Dom("<label/>",{text:"B","for":"b"})).append(n.controls.b).appendTo(n.controls),n.controls.a=new e.Dom("<input/>",{type:"number",min:"0",max:"1",step:"0.01",name:"a"}).addListener("input",this.onControlInput),new e.Dom("<div/>",{"class":"control-wrapper"}).append(new e.Dom("<label/>",{text:"A","for":"a"})).append(n.controls.a).appendTo(n.controls),n.controls.current=new e.Dom("<canvas/>"),new e.Dom("<div/>",{"class":"canvas-wrapper current"}).append(n.controls.current).appendTo(n.controls),n.controls.previous=new e.Dom("<canvas/>"),new e.Dom("<div/>",{"class":"canvas-wrapper previous"}).append(n.controls.previous).appendTo(n.controls),n.controls.cancel=new e.Editor.Button({label:"Cancel"}).addClass("cancel").addListener("click",this.onCancelClick).appendTo(n.controls),n.controls.apply=new e.Editor.Button({label:"Apply"}).addClass("apply").addListener("click",this.onApplyClick).appendTo(n.controls),n.mask.addListener("click",this.onApplyClick),this.super(i),new e.Dom("<div/>",{"class":"icon"}).appendTo(this),t.appendTo(this),this.fillGradient()},this.setValue=function(i,s,a,o){var r;this.hasOwnProperty("value")||(this.value={}),e.Var.is(i,"object")||(i=this.parseColor(i)),i.hasOwnProperty("r")&&(this.value.r=parseInt(i.r,10)),i.hasOwnProperty("g")&&(this.value.g=parseInt(i.g,10)),i.hasOwnProperty("b")&&(this.value.b=parseInt(i.b,10)),i.hasOwnProperty("a")&&(this.value.a=parseFloat(i.a)),s!==!1&&this.fillAlpha(),o!==!1&&(n.controls.r.val(this.value.r),n.controls.g.val(this.value.g),n.controls.b.val(this.value.b),n.controls.a.val(this.value.a)),a!==!1&&(r=this.rgb2hsv(this.value),n.gradient.position.css("left",255*(1-r.h)+"px"),n.gradient.position.css("top",127.5*r.s+127.5*(1-r.v/255)+"px"),n.alpha.position.css("top",255*(1-this.value.a)+"px")),this.fillCurrent(),t.css("background-color","rgba("+this.value.r+","+this.value.g+","+this.value.b+","+this.value.a+")")},this.onClick=function(){i=e.Object.copy(this.value),this.fillPrevious(),n.show()},this.onControlInput=function(){this.setValue({r:n.controls.r.val(),g:n.controls.g.val(),b:n.controls.b.val(),a:n.controls.a.val()},!0,!0,!1)},this.onCancelClick=function(t){this.setValue(i),n.hide(),t.stopPropagation()},this.onApplyClick=function(t){n.hide(),this.triggerEvent("change",{field:this,value:this.value},!0,!1),t.stopPropagation()},this.fillPrevious=function(){var t=n.controls.previous.get(0).getContext("2d");t.fillStyle="rgba("+i.r+","+i.g+","+i.b+","+i.a+")",t.clearRect(0,0,t.canvas.width,t.canvas.height),t.fillRect(0,0,t.canvas.width,t.canvas.height)},this.fillCurrent=function(){var t=n.controls.current.get(0).getContext("2d");t.fillStyle="rgba("+this.value.r+","+this.value.g+","+this.value.b+","+this.value.a+")",t.clearRect(0,0,t.canvas.width,t.canvas.height),t.fillRect(0,0,t.canvas.width,t.canvas.height)},this.fillGradient=function(){var t,e=n.gradient.canvas.get(0).getContext("2d");t=e.createLinearGradient(0,0,e.canvas.width,0),t.addColorStop(0,"rgb(255, 0, 0)"),t.addColorStop(.15,"rgb(255, 0, 255)"),t.addColorStop(.33,"rgb(0, 0, 255)"),t.addColorStop(.49,"rgb(0, 255, 255)"),t.addColorStop(.67,"rgb(0, 255, 0)"),t.addColorStop(.84,"rgb(255, 255, 0)"),t.addColorStop(1,"rgb(255, 0, 0)"),e.fillStyle=t,e.fillRect(0,0,e.canvas.width,e.canvas.height),t=e.createLinearGradient(0,0,0,e.canvas.height),t.addColorStop(0,"rgba(255, 255, 255, 1)"),t.addColorStop(.5,"rgba(255, 255, 255, 0)"),t.addColorStop(.5,"rgba(0, 0, 0, 0)"),t.addColorStop(1,"rgba(0, 0, 0, 1)"),e.fillStyle=t,e.fillRect(0,0,e.canvas.width,e.canvas.height)},this.fillAlpha=function(){var t,e=n.alpha.canvas.get(0).getContext("2d");t=e.createLinearGradient(0,0,0,e.canvas.height),t.addColorStop(0,"rgb("+this.value.r+","+this.value.g+","+this.value.b+")"),t.addColorStop(1,"transparent"),e.fillStyle=t,e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillRect(0,0,e.canvas.width,e.canvas.height)},this.onGradientMousedown=function(t){n.gradient.canvas.addListener("mousemove",this.onGradientMousemove),t.stopPropagation()},this.onGradientMouseup=function(t){n.gradient.canvas.removeListener("mousemove",this.onGradientMousemove),t.stopPropagation()},this.onGradientClick=this.onGradientMousemove=function(t){var e=t.target.getBoundingClientRect(),i=t.pageX-e.left,s=t.pageY-e.top,a=n.gradient.canvas.get(0).getContext("2d"),o=a.getImageData(i,s,1,1),r=this.value;n.gradient.position.css("left",i+"px"),n.gradient.position.css("top",s+"px"),r.r=o.data[0],r.g=o.data[1],r.b=o.data[2],this.setValue(r,!0,!1),t.stopPropagation()},this.onAlphaMousedown=function(t){n.alpha.canvas.addListener("mousemove",this.onAlphaMousemove),t.stopPropagation()},this.onAlphaMouseup=function(t){n.alpha.canvas.removeListener("mousemove",this.onAlphaMousemove),t.stopPropagation()},this.onAlphaClick=this.onAlphaMousemove=function(t){var e=t.target.getBoundingClientRect(),i=t.pageY-e.top,s=n.alpha.canvas.get(0).getContext("2d"),a=s.getImageData(0,i,1,1),o=this.value;n.alpha.position.css("top",i+"px"),o.a=Math.round(100*(a.data[3]/255))/100,this.setValue(o,!1,!1),t.stopPropagation()},this.rgb2hsv=function(t){var e,n,i,s=t.r,a=t.g,o=t.b,r=Math.max(s,a,o),l=Math.min(s,a,o),d=r-l;if(n=0===r?0:d/r,i=r,r===l)e=0;else{switch(r){case s:e=(a-o)/d+(o>a?6:0);break;case a:e=(o-s)/d+2;break;case o:e=(s-a)/d+4}e/=6}return{h:e,s:n,v:i}},this.parseColor=function(t){var e,n={};return t=t.replace(/\s\s*/g,""),(e=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})/.exec(t))?(n.r=parseInt(e[1],16),n.g=parseInt(e[2],16),n.b=parseInt(e[3],16),n.a=1):(e=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])/.exec(t))?(n.r=17*parseInt(e[1],16),n.g=17*parseInt(e[2],16),n.b=17*parseInt(e[3],16),n.a=1):(e=/^rgba\(([\d]+),([\d]+),([\d]+),([\d]+|[\d]*.[\d]+)\)/.exec(t))?(n.r=+e[1],n.g=+e[2],n.b=+e[3],n.a=+e[4]):(e=/^rgb\(([\d]+),([\d]+),([\d]+)\)/.exec(t))&&(n.r=+e[1],n.g=+e[2],n.b=+e[3],n.a=1),n}}),e.Editor.Field.CornerField=e.Editor.Field.extend(function(){this.defaults={value:null,disabled:!1},this.constructor=function(t){this.super(t)}}),e.Editor.Field.ImageField=e.Editor.Field.extend(function(){var t;this.defaults={value:null,disabled:!1},this.attributes={type:"file","class":"field imagefield"},this.constructor=function(t){this.super(t),this.addListener("change",this.onFileSelect,!1)},this.setValue=function(t,e){this.value=t,e!==!1&&this.triggerEvent("change",{field:this,value:this.value},!1,!0)},this.onFileSelect=function(e){var n=e.target.files;t=n.length>0&&n[0].type.match("image.*")?n[0]:null},this.getBase64=function(n){var i;t&&(i=new FileReader,i.onload=e.Function.proxy(function(t){n.call(this,t.target.result,t)},this),i.readAsDataURL(t))}}),e.Editor.Field.IntegerField=e.Editor.Field.extend(function(){this.defaults={value:0,disabled:!1,min:null,max:null},this.attributes={type:"number","class":"field integerfield"},this.constructor=function(t){this.super(t)}}),e.Editor.Field.TimeField=e.Editor.Field.extend(function(){var t,n,i,s;this.defaults={value:0,disabled:!1,min:0,max:null},this.tag="<div/>",this.attributes={"class":"field timefield"},this.constructor=function(a){t=new e.Dom("<input/>",{type:"number","class":"hours"}),n=new e.Dom("<input/>",{type:"number","class":"minutes"}),i=new e.Dom("<input/>",{type:"number","class":"seconds"}),s=new e.Dom("<input/>",{type:"number","class":"centiseconds"}),this.super(a),t.addListener("input",this.onInput).appendTo(this),new e.Dom("<span/>",{text:":","class":"separator"}).appendTo(this),n.addListener("input",this.onInput).appendTo(this),new e.Dom("<span/>",{text:":","class":"separator"}).appendTo(this),i.addListener("input",this.onInput).appendTo(this),new e.Dom("<span/>",{text:".","class":"separator"}).appendTo(this),s.addListener("input",this.onInput).appendTo(this)},this.onInput=function(e){var a=parseInt(s.val(),10),o=parseInt(i.val(),10),r=parseInt(n.val(),10),l=parseInt(t.val(),10);e.stopPropagation(),this.setValue(10*a+1e3*o+6e4*r+36e5*l)},this.setValue=function(e){var a,o,r,l;this.value=e,null!==this.configs.min&&(this.value=Math.max(this.value,this.configs.min)),null!==this.configs.max&&(this.value=Math.min(this.value,this.configs.max)),a=parseInt(this.value/10%100,10),o=parseInt(this.value/1e3%60,10),r=parseInt(this.value/6e4%60,10),l=parseInt(this.value/36e5,10),s.val(a),i.val(o),n.val(r),t.val(l),this.triggerEvent("change",{field:this,value:this.value},!0,!1)},this.getValue=function(){return this.value},this.disable=function(){return this.disabled=!0,t.attr("disabled","disabled"),n.attr("disabled","disabled"),i.attr("disabled","disabled"),s.attr("disabled","disabled"),this.addClass("disabled"),this},this.enable=function(){return this.disabled=!1,t.attr("disabled",null),n.attr("disabled",null),i.attr("disabled",null),s.attr("disabled",null),this.removeClass("disabled"),this}}),e.Editor.Panel.Block=e.Editor.Panel.extend(function(){var t,n;this.defaults={title:"Block",fields:{x:{type:e.Editor.Field.IntegerField,label:"X"},y:{type:e.Editor.Field.IntegerField,label:"Y"},width:{type:e.Editor.Field.IntegerField,label:"Width"},height:{type:e.Editor.Field.IntegerField,label:"Height"},bg_color:{type:e.Editor.Field.ColorField,label:"Background color"},bg_image:{type:e.Editor.Field.ImageField,label:"Background image"},synched:{type:e.Editor.Field.BooleanField,label:"Synchronized pages ?"}}},this.constructor=function(i){this.super(i),t=new e.Editor.DropDownMenu,t.addItem({text:"Add a new block","class":"new"}),t.addItem({text:"Delete the active block","class":"delete"}),this.getToolbar().addButton().addClass("menu").append(t),this.addDelegate(".field","change",function(t){var e=t.detail.field,i=t.detail.value;if(n)switch(e.data("name")){case"x":n.css("left",i+"px");break;case"y":n.css("top",i+"px");break;
case"width":n.css("width",i+"px");break;case"height":n.css("height",i+"px");break;case"bg_color":n.css("background-color","rgba("+i.r+","+i.g+","+i.b+","+i.a+")");break;case"bg_image":break;case"synched":n.data("synched",i)}})},this.getMenu=function(){return t},this.selectBlock=function(t){var i=n;n=t,this.unSelectBlock(i),n._draggable||new e.Draggable(n,n.children(".pager"),n.parents()),n._draggable.enable(),n._resizable||new e.Resizable(n,n.parents()),n._resizable.enable(),n.addListener("drag",this.onBlockDrag).addListener("resize",this.onBlockResize).addClass("selected"),this.updateValues()},this.unSelectBlock=function(t){t&&(t._draggable&&t._draggable.disable(),t._resizable&&t._resizable.disable(),t.removeListener("drag",this.onBlockDrag).removeListener("resize",this.onBlockResize).removeClass("selected"))},this.onBlockDrag=function(){this.updateValues(["x","y"])},this.onBlockResize=function(){this.updateValues(["x","y","width","height"])},this.updateValue=function(t){var e=this.getField(t);switch(t){case"x":e.setValue(parseInt(n.css("left"),10));break;case"y":e.setValue(parseInt(n.css("top"),10));break;case"width":e.setValue(parseInt(n.css("width"),10));break;case"height":e.setValue(parseInt(n.css("height"),10));break;case"bg_color":e.setValue(n.css("background-color"));break;case"bg_image":break;case"synched":e.setChecked("true"===n.data("synched"));break;default:return}},this.updateValues=function(t){void 0===t&&(t=Object.keys(this.getField())),e.Object.each(t,function(t,e){this.updateValue(e)},this)},this.getBlock=function(){return n}}),e.Editor.Panel.Element=e.Editor.Panel.extend(function(){this.defaults={title:"Element",fields:{x:{type:e.Editor.Field.IntegerField,label:"X"},y:{type:e.Editor.Field.IntegerField,label:"Y"},width:{type:e.Editor.Field.IntegerField,label:"Width"},height:{type:e.Editor.Field.IntegerField,label:"Height"},r_index:{type:e.Editor.Field.IntegerField,configs:{min:0},label:"Reading index"},z_index:{type:e.Editor.Field.IntegerField,label:"Display index"},bg_color:{type:e.Editor.Field.ColorField,label:"Background color"},bg_image:{type:e.Editor.Field.ImageField,label:"Background image"},border_width:{type:e.Editor.Field.IntegerField,label:"Border width"},border_color:{type:e.Editor.Field.ColorField,label:"Border color"},rounded_conrners:{type:e.Editor.Field.CornerField,label:"Rounded conrners"},start_time:{type:e.Editor.Field.TimeField,label:"Start time"},end_time:{type:e.Editor.Field.TimeField,label:"End time"}}}}),e.Editor.Panel.Page=e.Editor.Panel.extend(function(){this.defaults={title:"Page",fields:{bg_color:{type:e.Editor.Field.ColorField,label:"Background color"},bg_image:{type:e.Editor.Field.ImageField,label:"Background image"},start_time:{type:e.Editor.Field.TimeField,label:"Start time"},end_time:{type:e.Editor.Field.TimeField,label:"End time"}}}}),e.Editor.Panel.Text=e.Editor.Panel.extend(function(){this.defaults={title:"Text",fields:{x:{type:e.Editor.Field.IntegerField,label:"X"},y:{type:e.Editor.Field.IntegerField,label:"Y"},endtime:{type:e.Editor.Field.TimeField,label:"End time"}}}}),e.Player=e.Dom.extend(function(){var t;this.constructor=function(e){t={},this.super("<div/>",{"class":"metaScore-player"}),void 0!==e&&this.appendTo(e)},this.addBlock=function(n){var i,s;return i=new e.Player.Block(n).appendTo(this),s=i.attr("id"),t[s]=i,i},this.getBlock=function(e){return t[e]},this.deleteBlock=function(e){var n;e&&(n=e.attr("id"),e.remove(),delete t[n])}}),e.Player.Block=e.Dom.extend(function(){var t,n;this.constructor=function(){this.super("<div/>",{"class":"block",id:e.String.uuid(5)}),n=[],t=(new e.Player.Pager).appendTo(this)},this.addPage=function(t){var i=new e.Player.Page(t).appendTo(this);return n.push(i),i},this.setProperty=function(t,e){switch(t){case"x":this.css("left",e+"px");break;case"y":this.css("top",e+"px");break;case"width":this.css("width",e+"px");break;case"height":this.css("height",e+"px");break;case"bg-color":this.css("background-color",e);break;case"bg-image":this.css("background-image","url("+e+")");break;case"synched":this.data("synched",e)}}}),e.Player.Element=e.Dom.extend(function(){this.constructor=function(){this.super("<div/>",{"class":"element"})},this.setProperty=function(t,e){switch(t){case"x":this.css("left",e+"px");break;case"y":this.css("top",e+"px");break;case"width":this.css("width",e+"px");break;case"height":this.css("height",e+"px");break;case"reading-index":this.data("r-index",e);break;case"z-index":this.css("z-index",e);break;case"bg-color":this.css("background-color",e);break;case"bg-image":this.css("background-image","url("+e+")");break;case"border-width":this.css("border-width",e+"px");break;case"border-color":this.css("border-color",e);break;case"start":this.data("start",e);break;case"end":this.data("end",e)}}}),e.Player.Page=e.Dom.extend(function(){var t=[];this.constructor=function(){this.super("<div/>",{"class":"page"})},this.addElement=function(n){var i=new e.Player.Element(n).appendTo(this);return t.push(i),i},this.setProperty=function(t,e){switch(t){case"bg-color":this.css("background-color",e);break;case"bg-image":this.css("background-image","url("+e+")");break;case"start":this.data("start",e);break;case"end":this.data("end",e)}}}),e.Player.Pager=e.Dom.extend(function(){var t,n;this.constructor=function(){this.super("<div/>",{"class":"pager"}),t=new e.Dom("<div/>",{"class":"count"}).appendTo(this),n=new e.Dom("<div/>",{"class":"buttons"}).appendTo(this),n.first=new e.Dom("<div/>",{"class":"first"}).appendTo(n),n.previous=new e.Dom("<div/>",{"class":"previous"}).appendTo(n),n.next=new e.Dom("<div/>",{"class":"next"}).appendTo(n)}}),e.Player.Media=e.Dom.extend(function(){}),e.Player.Media.CuePoint=e.Base.extend(function(){var t,n;this.constructor=function(e){n=[],t=e,t.addEventListener("timeupdate",this.onMediaTimeUpdate)},this.onMediaTimeUpdate=function(t){var i,s;i=t.target,s=parseFloat(i.currentTime),e.Object.each(n,function(t,e){!e.timer&&s>=e.inTime-.5&&e.inTime>s&&this.setupTriggerTimer(e,1e3*(e.inTime-s))})},this.addTrigger=function(t){return n.push(t)-1},this.removeTrigger=function(t){var e=n[t];this.stopTrigger(e,!1),n.splice(t,1)},this.setupTriggerTimer=function(t,n){t.timer=setTimeout(e.Function.proxy(this.launchTrigger,this,t),n)},this.launchTrigger=function(n){n.hasOwnProperty("onStart")&&e.Var.is(n.onStart,"function")&&n.onStart(t)},this.stopTrigger=function(n,i){n.hasOwnProperty("timer")&&(clearTimeout(n.timer),delete n.timer),n.hasOwnProperty("interval")&&(clearInterval(n.interval),delete n.interval),i!==!1&&n.hasOwnProperty("onEnd")&&e.Var.is(n.onEnd,"function")&&n.onEnd(t)}}),t.metaScore=e})(this);