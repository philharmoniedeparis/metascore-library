/*! metaScore - v0.0.2 - 2016-02-25 - Oussama Mubarak */

!function(a){"use strict";Element&&!Element.prototype.matches&&(Element.prototype.matches=Element.prototype.matchesSelector=Element.prototype.matchesSelector||Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||function(a){for(var b=this,c=(b.document||b.ownerDocument).querySelectorAll(a),d=0;c[d]&&c[d]!==b;)d++;return c[d]?!0:!1}),Element&&!Element.prototype.closest&&(Element.prototype.closest=function(a){for(var b=this;b;){if(b.matches(a))return b;b=b.parentElement}return null}),window.CustomEvent&&"function"==typeof window.CustomEvent||(window.CustomEvent=function(a,b){var c;return b=b||{bubbles:!1,cancelable:!1,detail:void 0},c=document.createEvent("CustomEvent"),c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c},window.CustomEvent.prototype=window.Event.prototype),function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var d=(new Date).getTime(),e=Math.max(0,16-(d-a)),f=window.setTimeout(function(){b(d+e)},e);return a=d+e,f}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}();var b={getVersion:function(){return"0.0.2"},getRevision:function(){return"15a73a"},namespace:function(a){for(var b,c=this,d=a.split("."),e=0,f=d.length;f>e;e++)b=d[e],c[b]=c[b]||{},c=c[b];return c}};b.Class=function(){function a(){}return a.defaults={},a.extend=function(a){a.prototype=Object.create(this.prototype,{constructor:{value:a}}),a.parent=this,a.extend=this.extend,"defaults"in a||(a.defaults={});for(var b in this.defaults)b in a.defaults||(a.defaults[b]=this.defaults[b])},a.prototype.getConfigs=function(a){a=a||{};for(var b in this.constructor.defaults)b in a||(a[b]=this.constructor.defaults[b]);return a},a}(),b.Evented=function(){function a(){a.parent.call(this),this.listeners={}}return b.Class.extend(a),a.prototype.addListener=function(a,b){return"undefined"==typeof this.listeners[a]&&(this.listeners[a]=[]),this.listeners[a].push(b),this},a.prototype.removeListener=function(a,b){if(this.listeners[a]instanceof Array)for(var c=this.listeners[a],d=0,e=c.length;e>d;d++)if(c[d]===b){c.splice(d,1);break}return this},a.prototype.hasListener=function(a){return this.listeners[a]instanceof Array?this.listeners[a].length>0:!1},a.prototype.triggerEvent=function(a,c,d,e){var f,g;return this.listeners[a]instanceof Array&&(f=this.listeners[a],g={target:this,type:a,detail:c,bubbles:d!==!1,cancelable:e!==!1},b.Object.each(f,function(a,b){b.call(this,g)},this)),this},a}(),b.Dom=function(){function a(){var a;this.elements=[],arguments.length>0&&((a=b.Dom.elementsFromString.apply(this,arguments))?(this.add(a),arguments.length>1&&this.attr(arguments[1])):(a=b.Dom.selectElements.apply(this,arguments))&&(this.add(a),arguments.length>2&&this.attr(arguments[2])))}var c="beforeremove",d="childremove";return b.Class.extend(a),a.camelRe=/-([\da-z])/gi,a.bubbleEvents={click:!0,submit:!0,mousedown:!0,mousemove:!0,mouseup:!0,mouseover:!0,mouseout:!0,transitionend:!0},a.camelReplaceFn=function(a,b){return b.toUpperCase()},a.camel=function(b){return b.replace(a.camelRe,a.camelReplaceFn)},a.selectElement=function(a,c){var d;return c||(c=document),d=b.Var.is(a,"string")?c.querySelector(a):a.length?a[0]:a},a.selectElements=function(c,d){var e;return void 0!==c&&(d?d instanceof a&&(d=d.get(0)):d=document,e=b.Var.is(c,"string")?d.querySelectorAll(c):"length"in c?c:[c]),e},a.elementsFromString=function(a){var b,c,d,e={option:[1,"<select multiple='multiple'>","</select>"],optgroup:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tbody:[1,"<table>","</table>"],tfoot:[1,"<table>","</table>"],colgroup:[1,"<table>","</table>"],caption:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],th:[3,"<table><tbody><tr>","</tr></tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[1,"<div>","</div>"]},f=document.createElement("div"),g=/<\s*\w.*?>/g.exec(a);if(null!=g){for(b=g[0].replace(/</g,"").replace(/\/?>/g,""),c=e[b]||e._default,a=c[1]+a+c[2],f.innerHTML=a,d=c[0];d--;)f=f.lastChild;return f.childNodes}return null},a.getElementWindow=function(a){var b=a.ownerDocument;return b.defaultView||b.parentWindow},a.hasClass=function(a,b){return a.classList.contains(b)},a.addClass=function(a,b){for(var c=b.split(" "),d=0,e=c.length;e>d;d++)a.classList.add(c[d])},a.removeClass=function(a,b){for(var c=b.split(" "),d=0,e=c.length;e>d;d++)a.classList.remove(c[d])},a.toggleClass=function(a,b,c){var d=b.split(" "),e=0,f=d.length;if(void 0===c)for(;f>e;e++)a.classList.toggle(d[e]);else for(;f>e;e++)a.classList.toggle(d[e],c)},a.addListener=function(b,c,d,e){return void 0===e&&(e="type"in a.bubbleEvents?a.bubbleEvents[c]:!1),b.addEventListener(c,d,e),b},a.removeListener=function(b,c,d,e){return void 0===e&&(e="type"in a.bubbleEvents?a.bubbleEvents[c]:!1),b.removeEventListener(c,d,e),b},a.triggerEvent=function(b,c,d,e,f){var g=CustomEvent||a.getElementWindow(b).CustomEvent,h=new g(c,{detail:d,bubbles:e!==!1,cancelable:f!==!1});return b.dispatchEvent(h)},a.text=function(a,b){return void 0!==b&&(a.innerHTML=b),a.innerHTML},a.val=function(c,d){var e,f;return a.is(c,"select[multiple]")?(d&&(b.Var.is(d,"array")||(d=[d]),e=a.selectElements("option",c),b.Array.each(e,function(c,e){a.prop(e,"selected",b.Array.inArray(a.val(e),d)>-1)})),e=a.selectElements("option:checked",c),f=[],b.Array.each(e,function(b,c){f.push(a.val(c))}),f):(void 0!==d&&(c.value=d),c.value)},a.attr=function(c,d,e){if(b.Var.is(d,"object"))b.Object.each(d,function(b,d){a.attr(c,b,d)},this);else switch(d){case"class":this.addClass(c,e);break;case"text":this.text(c,e);break;default:if(null!==e)return void 0!==e&&c.setAttribute(d,e),c.getAttribute(d);c.removeAttribute(d)}},a.prop=function(c,d,e){if(b.Var.is(d,"object"))b.Object.each(d,function(b,d){a.prop(c,b,d)},this);else{if(null!==e)return void 0!==e&&(c[d]=e),c[d];try{c[d]=void 0,delete c[d]}catch(f){}}},a.css=function(a,b,c,d){var e,f;return e=this.camel(b),void 0!==c&&(a.style[e]=c),f=d===!0?a.style:window.getComputedStyle(a),f.getPropertyValue(b)},a.data=function(a,b,c){return b=this.camel(b),null===c?a.dataset[b]&&delete a.dataset[b]:void 0!==c&&(a.dataset[b]=c),a.dataset[b]},a.append=function(a,c){b.Var.is(c,"array")||(c=[c]),b.Array.each(c,function(b,c){a.appendChild(c)},this)},a.before=function(a,c){b.Var.is(c,"array")||(c=[c]),b.Array.each(c,function(b,c){a.parentElement.insertBefore(c,a)},this)},a.after=function(a,c){b.Var.is(c,"array")||(c=[c]),b.Array.each(c,function(b,c){a.parentElement.insertBefore(c,a.nextSibling)},this)},a.empty=function(a){for(;a.firstChild;)a.removeChild(a.firstChild)},a.remove=function(a){a.parentElement&&a.parentElement.removeChild(a)},a.is=function(b,c){var d;return b instanceof Element?Element.prototype.matches.call(b,c):(d=a.getElementWindow(b),b instanceof d.Element&&Element.prototype.matches.call(b,c))},a.closest=function(a,b){var c,d;return a instanceof Element?Element.prototype.closest.call(a,b):(c=a.ownerDocument)&&(d=c.defaultView||c.parentWindow)&&a instanceof d.Element?Element.prototype.closest.call(a,b):null},a.prototype.add=function(a){if("length"in a)for(var b=0;b<a.length;b++)this.elements.push(a[b]);else this.elements.push(a)},a.prototype.count=function(){return this.elements.length},a.prototype.get=function(a){return this.elements[a]},a.prototype.filter=function(b){var c=new a;return this.each(function(d,e){a.is(e,b)&&c.add(e)},this),c},a.prototype.index=function(b){var c=-1;return this.each(function(d,e){return a.is(e,b)?(c=d,!1):void 0},this),c},a.prototype.find=function(b){var c=new a;return this.each(function(d,e){c.add(a.selectElements.call(this,b,e))},this),c},a.prototype.children=function(b){var c=new a;return this.each(function(a,b){c.add(b.children)},this),b&&(c=c.filter(b)),c},a.prototype.child=function(b){return new a(this.children(b).get(0))},a.prototype.parents=function(b){var c=new a;return this.each(function(a,b){c.add(b.parentElement)},this),b&&(c=c.filter(b)),c},a.prototype.each=function(a,c){c=c||this,b.Array.each(this.elements,a,c)},a.prototype.hasClass=function(b){var c;return this.each(function(d,e){return c=a.hasClass(e,b),!c},this),c},a.prototype.addClass=function(b){return this.each(function(c,d){a.addClass(d,b)},this),this},a.prototype.removeClass=function(b){return this.each(function(c,d){a.removeClass(d,b)},this),this},a.prototype.toggleClass=function(b,c){return this.each(function(d,e){a.toggleClass(e,b,c)},this),this},a.prototype.addListener=function(b,c,d){return this.each(function(e,f){a.addListener(f,b,c,d)},this),this},a.prototype.addDelegate=function(b,c,d,e,f){return e=e||this,this.addListener(c,function(c){for(var f,g=c.target;g;){if(a.is(g,b)){f=g;break}g=g.parentElement}f&&d.call(e,c,f)},f),this},a.prototype.removeListener=function(b,c,d){return this.each(function(e,f){a.removeListener(f,b,c,d)},this),this},a.prototype.triggerEvent=function(b,c,d,e){var f=!0;return this.each(function(g,h){f=a.triggerEvent(h,b,c,d,e)&&f},this),f},a.prototype.text=function(b){return void 0===b?a.text(this.get(0)):void this.each(function(c,d){a.text(d,b)},this)},a.prototype.val=function(b){return void 0!==b?(this.each(function(c,d){a.val(d,b)},this),this):a.val(this.get(0))},a.prototype.attr=function(c,d){return void 0!==d||b.Var.is(c,"object")?(this.each(function(b,e){a.attr(e,c,d)},this),this):a.attr(this.get(0),c)},a.prototype.prop=function(c,d){return void 0!==d||b.Var.is(c,"object")?(this.each(function(b,e){a.prop(e,c,d)},this),this):a.prop(this.get(0),c)},a.prototype.css=function(b,c,d){return void 0!==c?(this.each(function(e,f){a.css(f,b,c,d)},this),this):a.css(this.get(0),b,c,d)},a.prototype.data=function(b,c){return void 0!==c?(this.each(function(d,e){a.data(e,b,c)},this),this):a.data(this.get(0),b)},a.prototype.append=function(b){return b instanceof a&&(b=b.elements),a.append(this.get(0),b),this},a.prototype.appendTo=function(b){return b instanceof a||(b=new a(b)),b=b.get(0),this.each(function(c,d){a.append(b,d)},this),this},a.prototype.insertAt=function(b,c){var d;return b instanceof a||(b=new a(b)),d=b.children().get(c),d?a.before(d,this.elements):this.appendTo(b),this},a.prototype.empty=function(){return this.each(function(b,c){a.empty(c)},this),this},a.prototype.show=function(){return this.css("display",""),this},a.prototype.hide=function(){return this.css("display","none"),this},a.prototype.focus=function(){return this.get(0).focus(),this},a.prototype.blur=function(){return this.get(0).blur(),this},a.prototype.remove=function(){return this.triggerEvent(c)!==!1&&this.each(function(b,c){var e=c.parentElement;a.remove(c),a.triggerEvent(e,d,{child:c})},this),this},a.prototype.is=function(b){var c;return this.each(function(d,e){return c=a.is(e,b)},this),c},a.prototype.closest=function(b){var c;return this.each(function(d,e){return c=a.closest(e,b),null!==c},this),c},a}(),b.Ajax=function(){function a(){}return a.send=function(a,c){var d=new XMLHttpRequest,e={method:"GET",headers:{},async:!0,data:{},dataType:"json",complete:null,success:null,error:null,scope:this};return c=b.Object.extend({},e,c),d.open(c.method,a,c.async),b.Object.each(c.headers,function(a,b){d.setRequestHeader(a,b)}),d.onreadystatechange=function(){4===d.readyState&&(b.Var.is(c.complete,"function")&&c.complete.call(c.scope,d),d.status>=200&&d.status<300||304===d.status?b.Var.is(c.success,"function")&&c.success.call(c.scope,d):b.Var.is(c.error,"function")&&c.error.call(c.scope,d))},d.send(c.data),d},a.get=function(c,d){return b.Object.extend(d,{method:"GET"}),a.send(c,d)},a.post=function(c,d){return b.Object.extend(d,{method:"POST"}),a.send(c,d)},a.put=function(c,d){return b.Object.extend(d,{method:"PUT"}),a.send(c,d)},a}(),b.Array=function(){function a(){}return a.inArray=function(a,b){var c,d=0;if(b){if(b.indexOf)return b.indexOf(a);for(c=b.length;c>d;d++)if(d in b&&b[d]===a)return d}return-1},a.copy=function(a){return[].concat(a)},a.shuffle=function(b){var c=a.copy(b);return c.sort(function(){return(3*Math.random()|0)-1}),c},a.unique=function(a){for(var b=[],c=a.length,d=0;c>d;d++){for(var e=d+1;c>e;e++)a[d]===a[e]&&(e=++d);b.push(a[d])}return b},a.each=function(a,b,c){for(var d,e=0,f=a.length,g=void 0!==c;f>e&&(d=b.call(g?c:a[e],e,a[e]),d!==!1);e++);return a},a.remove=function(b,c){for(var d=a.inArray(c,b);d>-1;)b.splice(d,1),d=a.inArray(c,b);return b},a.naturalSort=function(a){return function(b,c){var d,e,f=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,g=/(^[ ]*|[ ]*$)/g,h=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,i=/^0x[0-9a-f]+$/i,j=/^0/,k=function(b){return a&&(""+b).toLowerCase()||""+b},l=k(b).replace(g,"")||"",m=k(c).replace(g,"")||"",n=l.replace(f,"\x00$1\x00").replace(/\0$/,"").replace(/^\0/,"").split("\x00"),o=m.replace(f,"\x00$1\x00").replace(/\0$/,"").replace(/^\0/,"").split("\x00"),p=parseInt(l.match(i))||1!==n.length&&l.match(h)&&Date.parse(l),q=parseInt(m.match(i))||p&&m.match(h)&&Date.parse(m)||null;if(q){if(q>p)return-1;if(p>q)return 1}for(var r=0,s=Math.max(n.length,o.length);s>r;r++){if(d=!(n[r]||"").match(j)&&parseFloat(n[r])||n[r]||0,e=!(o[r]||"").match(j)&&parseFloat(o[r])||o[r]||0,isNaN(d)!==isNaN(e))return isNaN(d)?1:-1;if(typeof d!=typeof e&&(d+="",e+=""),e>d)return-1;if(d>e)return 1}return 0}},a.naturalSortInsensitive=a.naturalSort(!0),a.naturalSortSensitive=a.naturalSort(!1),a}(),b.Button=function(){function a(a){this.configs=this.getConfigs(a),b.Dom.call(this,"<button/>"),this.disabled=!1,this.configs.label&&this.setLabel(this.configs.label),this.addListener("click",b.Function.proxy(this.onClick,this))}return a.defaults={label:null},b.Dom.extend(a),a.prototype.onClick=function(a){this.disabled&&a.stopPropagation()},a.prototype.setLabel=function(a){return void 0===this.label&&(this.label=new b.Dom("<span/>",{"class":"label"}).appendTo(this)),this.label.text(a),this},a.prototype.disable=function(){return this.disabled=!0,this.addClass("disabled"),this},a.prototype.enable=function(){return this.disabled=!1,this.removeClass("disabled"),this},a}(),b.Clipboard=function(){function a(){a.parent.call(this),this.data=null}return b.Evented.extend(a),a.prototype.setData=function(a,b){return this.data={type:a,data:b},this},a.prototype.getData=function(){return this.data?this.data.data:null},a.prototype.getDataType=function(){return this.data?this.data.type:null},a.prototype.clearData=function(){return this.data=null,this},a}(),b.Color=function(){function a(){}return a.rgb2hsv=function(a){var b,c,d,e=a.r,f=a.g,g=a.b,h=Math.max(e,f,g),i=Math.min(e,f,g),j=h-i;if(c=0===h?0:j/h,d=h,h===i)b=0;else{switch(h){case e:b=(f-g)/j+(g>f?6:0);break;case f:b=(g-e)/j+2;break;case g:b=(e-f)/j+4}b/=6}return{h:b,s:c,v:d}},a.parse=function(a){var c,d;return c={r:0,g:0,b:0,a:0},b.Var.is(a,"object")?(c.r="r"in a?a.r:0,c.g="g"in a?a.g:0,c.b="b"in a?a.b:0,c.a="a"in a?a.a:1):b.Var.is(a,"string")&&(a=a.replace(/\s\s*/g,""),(d=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})/.exec(a))?(c.r=parseInt(d[1],16),c.g=parseInt(d[2],16),c.b=parseInt(d[3],16),c.a=1):(d=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])/.exec(a))?(c.r=17*parseInt(d[1],16),c.g=17*parseInt(d[2],16),c.b=17*parseInt(d[3],16),c.a=1):(d=/^rgba\(([\d]+),([\d]+),([\d]+),([\d]+|[\d]*.[\d]+)\)/.exec(a))?(c.r=+d[1],c.g=+d[2],c.b=+d[3],c.a=+d[4]):(d=/^rgb\(([\d]+),([\d]+),([\d]+)\)/.exec(a))&&(c.r=+d[1],c.g=+d[2],c.b=+d[3],c.a=1)),c},a}(),b.ContextMenu=function(){function a(c){this.configs=this.getConfigs(c),this.configs.target instanceof b.Dom||(this.configs.target=new b.Dom(this.configs.target)),a.parent.call(this,"<ul/>",{"class":"contextmenu"}),this.tasks={},this.context=null,this.onTargetContextmenu=b.Function.proxy(this.onTargetContextmenu,this),this.onTargetMousedown=b.Function.proxy(this.onTargetMousedown,this),this.onTaskClick=b.Function.proxy(this.onTaskClick,this),this.addListener("mousedown",b.Function.proxy(this.onMousedown,this)),this.hide(),this.enable()}var c="taskclick";return b.Dom.extend(a),a.defaults={target:"body"},a.prototype.onMousedown=function(a){a.stopPropagation()},a.prototype.onTargetContextmenu=function(a){var b,c;a.ctrlKey||(a.pageX||a.pageY?(b=a.pageX,c=a.pageY):a.clientX||a.clientY?(b=a.clientX+document.body.scrollLeft,c=a.clientY+document.body.scrollTop):(b=0,c=0),this.show(a.target,b,c),a.preventDefault())},a.prototype.onTargetMousedown=function(a){this.hide()},a.prototype.onTaskClick=function(a){var d=new b.Dom(a.target).data("action");d in this.tasks&&this.triggerEvent(c,{action:d,context:this.context},!0,!1),this.hide()},a.prototype.addTask=function(a,c,d){var e=new b.Dom("<li/>",{"data-action":a,text:c}).addListener("click",this.onTaskClick).appendTo(this);return this.tasks[a]={toggler:d,el:e},this},a.prototype.addSeparator=function(){return new b.Dom("<li/>",{"class":"separator"}).appendTo(this),this},a.prototype.show=function(c,d,e){return this.context=c,b.Object.each(this.tasks,function(a,c){var d=b.Var.is(c.toggler,"function")?c.toggler(this.context)===!0:c.toggler!==!1;d?c.el.removeClass("disabled"):c.el.addClass("disabled")},this),this.configs.target.addListener("mousedown",this.onTargetMousedown),this.css("left",d+"px").css("top",e+"px"),a.parent.prototype.show.call(this),this},a.prototype.hide=function(){return this.configs.target.removeListener("mousedown",this.onTargetMousedown),this.context=null,a.parent.prototype.hide.call(this),this},a.prototype.enable=function(){return this.enabled=!0,this.configs.target.addListener("contextmenu",this.onTargetContextmenu),this},a.prototype.disable=function(){return this.configs.target.removeListener("contextmenu",this.onTargetContextmenu),this.hide(),this.enabled=!1,this},a}(),b.Draggable=function(){function a(a){this.configs=this.getConfigs(a),this.doc=new b.Dom(this.configs.target.get(0).ownerDocument),this.onMouseDown=b.Function.proxy(this.onMouseDown,this),this.onMouseMove=b.Function.proxy(this.onMouseMove,this),this.onMouseUp=b.Function.proxy(this.onMouseUp,this),this.configs.handle.addListener("mousedown",this.onMouseDown),this.enable()}var c="dragstart",d="drag",e="dragend";return a.defaults={target:null,handle:null,limits:{top:null,left:null}},b.Class.extend(a),a.prototype.onMouseDown=function(a){this.enabled&&(this.start_state={left:parseInt(this.configs.target.css("left"),10)-a.clientX,top:parseInt(this.configs.target.css("top"),10)-a.clientY},this.doc.addListener("mouseup",this.onMouseUp).addListener("mousemove",this.onMouseMove),this.configs.target.addClass("dragging").triggerEvent(c,null,!1,!0),a.stopPropagation())},a.prototype.onMouseMove=function(a){var b=a.clientX+this.start_state.left,c=a.clientY+this.start_state.top;isNaN(this.configs.limits.top)||(c=Math.max(c,this.configs.limits.top)),isNaN(this.configs.limits.left)||(b=Math.max(b,this.configs.limits.left)),this.configs.target.css("left",b+"px").css("top",c+"px").triggerEvent(d,null,!1,!0),a.stopPropagation()},a.prototype.onMouseUp=function(a){this.doc.removeListener("mousemove",this.onMouseMove).removeListener("mouseup",this.onMouseUp),this.configs.target.removeClass("dragging").triggerEvent(e,null,!1,!0),a.stopPropagation()},a.prototype.enable=function(){return this.configs.target.addClass("draggable"),this.configs.handle.addClass("drag-handle"),this.enabled=!0,this},a.prototype.disable=function(){return this.configs.target.removeClass("draggable"),this.configs.handle.removeClass("drag-handle"),this.enabled=!1,this},a.prototype.destroy=function(){return this.disable(),this.configs.handle.removeListener("mousedown",this.onMouseDown),this},a}(),b.Function=function(){function a(){}return a.proxy=function(a,c,d){return b.Var.type(a,"function")?function(){var b;return d?(b=Array.prototype.slice.call(d),b=b.concat(Array.prototype.slice.call(arguments))):b=arguments,a.apply(c||this,b)}:void 0},a}(),b.Locale=function(){function a(){}return a.t=function(b,c,d){return"undefined"!=typeof metaScoreLocale&&metaScoreLocale.hasOwnProperty(b)&&(c=metaScoreLocale[b]),a.formatString(c,d)},a.formatString=function(a,c){return b.Object.each(c,function(b,d){a=a.replace(b,c[b])},this),a},a}(),b.Object=function(){function a(){}return a.extend=function(){for(var a,b,c,d,e=arguments[0]||{},f=1,g=arguments.length;g>f;f++)if(null!=(a=arguments[f]))for(b in a)c=e[b],d=a[b],c!==d&&void 0!==d&&(e[b]=d);return e},a.copy=function(b){return a.extend({},b)},a.each=function(a,b,c){var d,e,f=void 0!==c;for(d in a)if(e=b.call(f?c:a[d],d,a[d]),e===!1)break;return a},a}(),b.Overlay=function(){function a(b){this.configs=this.getConfigs(b),a.parent.call(this,"<div/>",{"class":"overlay clearfix"}),this.setupUI(),this.configs.autoShow&&this.show()}var c="show",d="hide";return a.defaults={parent:"body",modal:!0,draggable:!0,autoShow:!1,toolbar:!1,title:""},b.Dom.extend(a),a.prototype.setupUI=function(){this.configs.modal&&(this.mask=new b.Dom("<div/>",{"class":"overlay-mask"})),this.configs.toolbar&&(this.toolbar=new b.overlay.Toolbar({title:this.configs.title}).appendTo(this),this.toolbar.addButton("close").addListener("click",b.Function.proxy(this.onCloseClick,this))),this.contents=new b.Dom("<div/>",{"class":"contents"}).appendTo(this),this.configs.draggable&&(this.draggable=new b.Draggable({target:this,handle:this.configs.toolbar?this.toolbar:this}))},a.prototype.show=function(){return this.configs.modal&&this.mask.appendTo(this.configs.parent),this.appendTo(this.configs.parent),this.triggerEvent(c,{overlay:this},!0,!1),this},a.prototype.hide=function(){return this.configs.modal&&this.mask.remove(),this.remove(),this.triggerEvent(d,{overlay:this},!0,!1),this},a.prototype.getToolbar=function(){return this.toolbar},a.prototype.getContents=function(){return this.contents},a.prototype.onCloseClick=function(a){this.hide()},a}(),b.Resizable=function(){function a(a){this.configs=this.getConfigs(a),this.doc=new b.Dom(this.configs.target.get(0).ownerDocument),this.handles={},this.onMouseDown=b.Function.proxy(this.onMouseDown,this),this.onMouseMove=b.Function.proxy(this.onMouseMove,this),this.onMouseUp=b.Function.proxy(this.onMouseUp,this),b.Array.each(this.configs.directions,function(a,c){this.handles[c]=new b.Dom("<div/>",{"class":"resize-handle"}).data("direction",c).addListener("mousedown",this.onMouseDown).appendTo(this.configs.target)},this),this.enable()}var c="resizestart",d="resize",e="resizeend";return a.defaults={target:null,directions:["top","right","bottom","left","top-left","top-right","bottom-left","bottom-right"]},b.Class.extend(a),a.prototype.onMouseDown=function(a){this.enabled&&(this.start_state={handle:a.target,x:a.clientX,y:a.clientY,left:parseInt(this.configs.target.css("left"),10),top:parseInt(this.configs.target.css("top"),10),w:parseInt(this.configs.target.css("width"),10),h:parseInt(this.configs.target.css("height"),10)},this.doc.addListener("mousemove",this.onMouseMove,this).addListener("mouseup",this.onMouseUp,this),this.configs.target.addClass("resizing").triggerEvent(c,null,!1,!0),a.stopPropagation())},a.prototype.onMouseMove=function(a){var c,e,f,g,h=new b.Dom(this.start_state.handle);switch(h.data("direction")){case"top":e=this.start_state.h-a.clientY+this.start_state.y,f=this.start_state.top+a.clientY-this.start_state.y;break;case"right":c=this.start_state.w+a.clientX-this.start_state.x;break;case"bottom":e=this.start_state.h+a.clientY-this.start_state.y;break;case"left":c=this.start_state.w-a.clientX+this.start_state.x,g=this.start_state.left+a.clientX-this.start_state.x;break;case"top-left":c=this.start_state.w-a.clientX+this.start_state.x,e=this.start_state.h-a.clientY+this.start_state.y,f=this.start_state.top+a.clientY-this.start_state.y,g=this.start_state.left+a.clientX-this.start_state.x;break;case"top-right":c=this.start_state.w+a.clientX-this.start_state.x,e=this.start_state.h-a.clientY+this.start_state.y,f=this.start_state.top+a.clientY-this.start_state.y;break;case"bottom-left":c=this.start_state.w-a.clientX+this.start_state.x,e=this.start_state.h+a.clientY-this.start_state.y,g=this.start_state.left+a.clientX-this.start_state.x;break;case"bottom-right":c=this.start_state.w+a.clientX-this.start_state.x,e=this.start_state.h+a.clientY-this.start_state.y}void 0!==f&&this.configs.target.css("top",f+"px"),void 0!==g&&this.configs.target.css("left",g+"px"),this.configs.target.css("width",c+"px").css("height",e+"px").triggerEvent(d,null,!1,!0),a.stopPropagation()},a.prototype.onMouseUp=function(a){this.doc.removeListener("mousemove",this.onMouseMove,this).removeListener("mouseup",this.onMouseUp,this),this.configs.target.removeClass("resizing").triggerEvent(e,null,!1,!0),a.stopPropagation()},a.prototype.getHandle=function(a){return this.handles[a]},a.prototype.enable=function(){return this.configs.target.addClass("resizable"),this.enabled=!0,this},a.prototype.disable=function(){return this.configs.target.removeClass("resizable"),this.enabled=!1,this},a.prototype.destroy=function(){return this.disable(),b.Object.each(this.handles,function(a,b){b.remove()},this),this},a}(),b.String=function(){function a(){}return a.capitalize=function(a){return a.replace(/(?:^|\s)\S/g,function(a){return a.toUpperCase()})},a.uuid=function(a,b){var c,d=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],e=[];if(b=b||d.length,a)for(c=0;a>c;c++)e[c]=d[0|Math.random()*b];else{var f;for(e[8]=e[13]=e[18]=e[23]="-",e[14]="4",c=0;36>c;c++)e[c]||(f=0|16*Math.random(),e[c]=d[19===c?3&f|8:f])}return e.join("")},a.pad=function(a,b,c,d){var e,f,g;if("undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=" "),"undefined"==typeof d&&(d="right"),a+="",b+1>=a.length)switch(d){case"left":a=Array(b+1-a.length).join(c)+a;break;case"both":g=b-a.length,e=Math.ceil(g/2),f=g-e,a=Array(f+1).join(c)+a+Array(e+1).join(c);break;default:a+=Array(b+1-a.length).join(c)}return a},a}(),b.StyleSheet=function(){function a(){b.Dom.call(this,"<style/>",{type:"text/css"}),this.el=this.get(0),this.setInternalValue("")}return b.Dom.extend(a),a.prototype.addRule=function(a,b,c){var d=this.el.sheet;return void 0===c&&(c=d.cssRules.length),"insertRule"in d?d.insertRule(a+"{"+b+"}",c):"addRule"in d&&d.addRule(a,b,c),this},a.prototype.removeRule=function(a){var b=this.el.sheet;return"deleteRule"in b?b.deleteRule(a):"removeRule"in b&&b.removeRule(a),this},a.prototype.removeRulesBySelector=function(a){var b=this.el.sheet,c=b.cssRules||b.rules;a=a.toLowerCase();for(var d=0;d<c.length;d++)if(c[d].selectorText.toLowerCase()===a){this.removeRule(d);break}return this},a.prototype.removeRules=function(){for(var a=this.el.sheet,b=a.cssRules||a.rules;b.length>0;)this.removeRule(0);return this},a.prototype.setInternalValue=function(a){return this.el.styleSheet?this.el.styleSheet.cssText=a:this.text(a),this},a}(),b.Var=function(){function a(){}return a.classes2types={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},a.type=function(b){return null==b?String(b):a.classes2types[Object.prototype.toString.call(b)]||"object"},a.is=function(b,c){return a.type(b)===c.toLowerCase()},a.isEmpty=function(a){return void 0===a||null==a?!0:a.hasOwnProperty("length")?a.length<=0:b.Var.is(a,"object")?Object.keys(a).length<=0:!1},a}(),b.namespace("overlay").Alert=function(){function a(b){this.configs=this.getConfigs(b),a.parent.call(this,this.configs),this.addClass("alert")}var c="buttonclick";return a.defaults={draggable:!1,text:"",buttons:{}},b.Overlay.extend(a),a.prototype.setupUI=function(){a.parent.prototype.setupUI.call(this),this.text=new b.Dom("<div/>",{"class":"text"}).appendTo(this.contents),this.configs.text&&this.setText(this.configs.text),this.buttons=new b.Dom("<div/>",{"class":"buttons"}).addDelegate("button","click",b.Function.proxy(this.onButtonClick,this)).appendTo(this.contents),this.configs.buttons&&b.Object.each(this.configs.buttons,function(a,b){this.addButton(a,b)},this)},a.prototype.setText=function(a){return this.text.text(a),this},a.prototype.addButton=function(a,c){var d=(new b.Button).setLabel(c).data("action",a).appendTo(this.buttons);return d},a.prototype.onButtonClick=function(a){var d=new b.Dom(a.target).data("action");this.hide(),this.triggerEvent(c,{alert:this,action:d},!1),a.stopPropagation()},a}(),b.namespace("overlay").LoadMask=function(){function a(c){this.configs=this.getConfigs(c),a.parent.call(this,this.configs),this.addClass("loadmask"),this.text=new b.Dom("<div/>",{"class":"text",text:this.configs.text}).appendTo(this.contents)}return a.defaults={draggable:!1,text:b.Locale.t("overlay.LoadMask.text","Loading...")},b.Overlay.extend(a),a}(),b.namespace("overlay").Toolbar=function(){function a(c){this.configs=this.getConfigs(c),a.parent.call(this,"<div/>",{"class":"toolbar clearfix"}),this.title=new b.Dom("<div/>",{"class":"title"}).appendTo(this),this.buttons=new b.Dom("<div/>",{"class":"buttons"}).appendTo(this),this.configs.title&&this.title.text(this.configs.title)}return a.defaults={title:null},b.Dom.extend(a),a.prototype.getTitle=function(){return this.title},a.prototype.addButton=function(a){var c=(new b.Button).data("action",a).appendTo(this.buttons);return c},a.prototype.getButton=function(a){return this.buttons.children('[data-action="'+a+'"]')},a}(),b.namespace("overlay").iFrame=function(){function a(b){this.configs=this.getConfigs(b),a.parent.call(this,this.configs),this.addClass("iframe")}return a.defaults={toolbar:!0,url:null},b.Overlay.extend(a),a.prototype.setupUI=function(){a.parent.prototype.setupUI.call(this),this.frame=new b.Dom("<iframe/>",{src:this.configs.url}).appendTo(this.contents)},a}(),b.Editor=function(){function a(c){this.configs=this.getConfigs(c),a.parent.call(this,"<div/>",{"class":"metaScore-editor"}),this.configs.container&&this.appendTo(this.configs.container),this.h_ruler=new b.Dom("<div/>",{"class":"ruler horizontal"}).appendTo(this),this.v_ruler=new b.Dom("<div/>",{"class":"ruler vertical"}).appendTo(this),this.workspace=new b.Dom("<div/>",{"class":"workspace"}).appendTo(this),this.mainmenu=(new b.editor.MainMenu).appendTo(this).addDelegate("button[data-action]:not(.disabled)","click",b.Function.proxy(this.onMainmenuClick,this)).addDelegate(".time","valuechange",b.Function.proxy(this.onMainmenuTimeFieldChange,this)).addDelegate(".r-index","valuechange",b.Function.proxy(this.onMainmenuRindexFieldChange,this)),this.sidebar_wrapper=new b.Dom("<div/>",{"class":"sidebar-wrapper"}).appendTo(this).addListener("resizestart",b.Function.proxy(this.onSidebarResizeStart,this)).addListener("resize",b.Function.proxy(this.onSidebarResize,this)).addListener("resizeend",b.Function.proxy(this.onSidebarResizeEnd,this)),this.sidebar_resizer=new b.Resizable({target:this.sidebar_wrapper,directions:["left"]}),this.sidebar_resizer.getHandle("left").addListener("dblclick",b.Function.proxy(this.onSidebarResizeDblclick,this)),this.sidebar=new b.Dom("<div/>",{"class":"sidebar"}).appendTo(this.sidebar_wrapper),this.panels={},this.panels.block=(new b.editor.panel.Block).appendTo(this.sidebar).addListener("componentbeforeset",b.Function.proxy(this.onBlockBeforeSet,this)).addListener("componentset",b.Function.proxy(this.onBlockSet,this)).addListener("componentunset",b.Function.proxy(this.onBlockUnset,this)).addListener("valueschange",b.Function.proxy(this.onBlockPanelValueChange,this)),
this.panels.block.getToolbar().addDelegate(".selector","valuechange",b.Function.proxy(this.onBlockPanelSelectorChange,this)).addDelegate(".buttons [data-action]","click",b.Function.proxy(this.onBlockPanelToolbarClick,this)),this.panels.page=(new b.editor.panel.Page).appendTo(this.sidebar).addListener("componentbeforeset",b.Function.proxy(this.onPageBeforeSet,this)).addListener("componentset",b.Function.proxy(this.onPageSet,this)).addListener("componentunset",b.Function.proxy(this.onPageUnset,this)).addListener("valueschange",b.Function.proxy(this.onPagePanelValueChange,this)),this.panels.page.getToolbar().addDelegate(".selector","valuechange",b.Function.proxy(this.onPagePanelSelectorChange,this)).addDelegate(".buttons [data-action]","click",b.Function.proxy(this.onPagePanelToolbarClick,this)),this.panels.element=(new b.editor.panel.Element).appendTo(this.sidebar).addListener("componentbeforeset",b.Function.proxy(this.onElementBeforeSet,this)).addListener("componentset",b.Function.proxy(this.onElementSet,this)).addListener("componentunset",b.Function.proxy(this.onElementUnset,this)).addListener("valueschange",b.Function.proxy(this.onElementPanelValueChange,this)),this.panels.element.getToolbar().addDelegate(".selector","valuechange",b.Function.proxy(this.onElementPanelSelectorChange,this)).addDelegate(".buttons [data-action]","click",b.Function.proxy(this.onElementPanelToolbarClick,this)),this.panels.text=(new b.editor.panel.Text).appendTo(this.sidebar),this.grid=new b.Dom("<div/>",{"class":"grid"}).appendTo(this.workspace),this.player_frame=new b.Dom("<iframe/>",{src:"about:blank","class":"player-frame"}).appendTo(this.workspace).addListener("load",b.Function.proxy(this.onPlayerFrameLoadSuccess,this)).addListener("error",b.Function.proxy(this.onPlayerFrameLoadError,this)),this.history=(new b.editor.History).addListener("add",b.Function.proxy(this.onHistoryAdd,this)).addListener("undo",b.Function.proxy(this.onHistoryUndo,this)).addListener("redo",b.Function.proxy(this.onHistoryRedo,this)),this.clipboard=new b.Clipboard,this.contextmenu=new b.ContextMenu({target:this}).addTask("about",b.Locale.t("editor.contextmenu.about","metaScore v.!version r.!revision",{"!version":b.getVersion(),"!revision":b.getRevision()}),!1).appendTo(this),this.detailsOverlay=new b.editor.overlay.GuideDetails({groups:this.configs.user_groups,submit_text:b.Locale.t("editor.detailsOverlay.submit_text","Apply")}).addListener("show",b.Function.proxy(this.onDetailsOverlayShow,this)).addListener("submit",b.Function.proxy(this.onDetailsOverlaySubmit,this,["update"])),this.detailsOverlay.getField("type").readonly(!0),b.Dom.addListener(window,"hashchange",b.Function.proxy(this.onWindowHashChange,this)),b.Dom.addListener(window,"beforeunload",b.Function.proxy(this.onWindowBeforeUnload,this)),this.addListener("mousedown",b.Function.proxy(this.onMousedown,this)).addListener("keydown",b.Function.proxy(this.onKeydown,this)).addListener("keyup",b.Function.proxy(this.onKeyup,this)).addDelegate(".timefield","valuein",b.Function.proxy(this.onTimeFieldIn,this)).addDelegate(".timefield","valueout",b.Function.proxy(this.onTimeFieldOut,this)).setDirty(!1).setEditing(!1).updateMainmenu().loadPlayerFromHash()}return b.Dom.extend(a),a.defaults={container:"body",player_url:"",api_url:"",ajax:{},user_groups:{}},a.prototype.onGuideCreateSuccess=function(a,b){var c=JSON.parse(b.response);this.loadmask.hide(),delete this.loadmask,a.hide(),this.loadPlayer(c.id,c.vid)},a.prototype.onGuideCreateError=function(a){this.loadmask.hide(),delete this.loadmask,new b.overlay.Alert({parent:this,text:b.Locale.t("editor.onGuideCreateError.msg","The following error occured:<br/><strong><em>@error (@code)</em></strong><br/>Please try again.",{"@error":a.statusText,"@code":a.status}),buttons:{ok:b.Locale.t("editor.onGuideCreateError.ok","OK")},autoShow:!0})},a.prototype.onGuideSaveSuccess=function(a){var b=this.getPlayer(),c=JSON.parse(a.response);this.loadmask.hide(),delete this.loadmask,c.id!==b.getId()?this.loadPlayer(c.id,c.vid):(this.detailsOverlay.clearValues(!0).setValues(c,!0),b.setRevision(c.vid))},a.prototype.onGuideSaveError=function(a){this.loadmask.hide(),delete this.loadmask,new b.overlay.Alert({parent:this,text:b.Locale.t("editor.onGuideSaveError.msg","The following error occured:<br/><strong><em>@error (@code)</em></strong><br/>Please try again.",{"@error":a.statusText,"@code":a.status}),buttons:{ok:b.Locale.t("editor.onGuideSaveError.ok","OK")},autoShow:!0})},a.prototype.onGuideDeleteConfirm=function(){var a,c=this.getPlayer().getId();a=b.Object.extend({},{dataType:"json",method:"DELETE",success:b.Function.proxy(this.onGuideDeleteSuccess,this),error:b.Function.proxy(this.onGuideDeleteError,this)},this.configs.ajax),this.loadmask=new b.overlay.LoadMask({parent:this,autoShow:!0}),b.Ajax.send(this.configs.api_url+"guide/"+c+".json",a)},a.prototype.onGuideDeleteSuccess=function(a){this.unloadPlayer(),this.loadmask.hide(),delete this.loadmask},a.prototype.onGuideDeleteError=function(a){this.loadmask.hide(),delete this.loadmask,new b.overlay.Alert({parent:this,text:b.Locale.t("editor.onGuideDeleteError.msg","The following error occured:<br/><strong><em>@error (@code)</em></strong><br/>Please try again.",{"@error":a.statusText,"@code":a.status}),buttons:{ok:b.Locale.t("editor.onGuideDeleteError.ok","OK")},autoShow:!0})},a.prototype.onGuideRevertConfirm=function(){var a=this.getPlayer();this.loadPlayer(a.getId(),a.getRevision())},a.prototype.onGuideSelectorSubmit=function(a){this.loadPlayer(a.detail.guide.id,a.detail.vid)},a.prototype.onKeydown=function(a){var b;switch(a.keyCode){case 18:a.repeat||(this.setEditing(!this.persistentEditing,!1),a.preventDefault());break;case 72:a.ctrlKey&&(b=this.getPlayer(),b&&b.addClass("show-contents"),a.preventDefault());break;case 90:a.ctrlKey&&(this.history.undo(),a.preventDefault());break;case 89:a.ctrlKey&&(this.history.redo(),a.preventDefault())}},a.prototype.onKeyup=function(a){var b;switch(a.keyCode){case 18:this.setEditing(this.persistentEditing,!1),a.preventDefault();break;case 72:a.ctrlKey&&(b=this.getPlayer(),b&&b.removeClass("show-contents"),a.preventDefault())}},a.prototype.onMousedown=function(a){this.player_contextmenu&&this.player_contextmenu.hide()},a.prototype.onMainmenuClick=function(a){var c;switch(b.Dom.data(a.target,"action")){case"new":c=b.Function.proxy(function(){new b.editor.overlay.GuideDetails({groups:this.configs.user_groups,autoShow:!0}).addListener("show",b.Function.proxy(this.onDetailsOverlayShow,this)).addListener("submit",b.Function.proxy(this.onDetailsOverlaySubmit,this,["create"]))},this),this.isDirty()?new b.overlay.Alert({parent:this,text:b.Locale.t("editor.onMainmenuClick.open.msg","Are you sure you want to open another guide ?<br/><strong>Any unsaved data will be lost.</strong>"),buttons:{confirm:b.Locale.t("editor.onMainmenuClick.open.yes","Yes"),cancel:b.Locale.t("editor.onMainmenuClick.open.no","No")},autoShow:!0}).addListener("buttonclick",function(a){"confirm"===a.detail.action&&c()}):c();break;case"open":c=b.Function.proxy(this.openGuideSelector,this),this.isDirty()?new b.overlay.Alert({parent:this,text:b.Locale.t("editor.onMainmenuClick.open.msg","Are you sure you want to open another guide ?<br/><strong>Any unsaved data will be lost.</strong>"),buttons:{confirm:b.Locale.t("editor.onMainmenuClick.open.yes","Yes"),cancel:b.Locale.t("editor.onMainmenuClick.open.no","No")},autoShow:!0}).addListener("buttonclick",function(a){"confirm"===a.detail.action&&c()}):c();break;case"edit":this.detailsOverlay.show();break;case"save":this.saveGuide("update");break;case"clone":this.saveGuide("clone");break;case"publish":c=b.Function.proxy(function(){this.saveGuide("update",!0)},this),new b.overlay.Alert({parent:this,text:b.Locale.t("editor.onMainmenuClick.publish.msg","This action will make this version the public version.<br/>Are you sure you want to continue?"),buttons:{confirm:b.Locale.t("editor.onMainmenuClick.publish.yes","Yes"),cancel:b.Locale.t("editor.onMainmenuClick.publish.no","No")},autoShow:!0}).addListener("buttonclick",function(a){"confirm"===a.detail.action&&c()});break;case"download":break;case"delete":new b.overlay.Alert({parent:this,text:b.Locale.t("editor.onMainmenuClick.delete.msg","Are you sure you want to delete this guide ?"),buttons:{confirm:b.Locale.t("editor.onMainmenuClick.delete.yes","Yes"),cancel:b.Locale.t("editor.onMainmenuClick.delete.no","No")},autoShow:!0}).addListener("buttonclick",b.Function.proxy(function(a){"confirm"===a.detail.action&&this.onGuideDeleteConfirm()},this));break;case"revert":new b.overlay.Alert({parent:this,text:b.Locale.t("editor.onMainmenuClick.revert.msg","Are you sure you want to revert back to the last saved version ?<br/><strong>Any unsaved data will be lost.</strong>"),buttons:{confirm:b.Locale.t("editor.onMainmenuClick.revert.yes","Yes"),cancel:b.Locale.t("editor.onMainmenuClick.revert.no","No")},autoShow:!0}).addListener("buttonclick",b.Function.proxy(function(a){"confirm"===a.detail.action&&this.onGuideRevertConfirm()},this));break;case"undo":this.history.undo();break;case"redo":this.history.redo();break;case"edit-toggle":this.setEditing(!b.editing);break;case"settings":}},a.prototype.onMainmenuTimeFieldChange=function(a){var b=a.target._metaScore,c=b.getValue();this.getPlayer().media.setTime(c)},a.prototype.onMainmenuRindexFieldChange=function(a){var b=a.target._metaScore,c=b.getValue();this.getPlayer().setReadingIndex(c,!0)},a.prototype.onTimeFieldIn=function(a){var b=a.target._metaScore,c=this.getPlayer().media.getTime();b.setValue(c)},a.prototype.onTimeFieldOut=function(a){var b=a.target._metaScore,c=b.getValue();this.getPlayer().media.setTime(c)},a.prototype.onSidebarResizeStart=function(a){this.addClass("sidebar-resizing")},a.prototype.onSidebarResize=function(a){var b=parseInt(this.sidebar_wrapper.css("width"),10);this.workspace.css("right",b+"px")},a.prototype.onSidebarResizeEnd=function(a){this.removeClass("sidebar-resizing")},a.prototype.onSidebarResizeDblclick=function(a){this.toggleClass("sidebar-hidden"),this.toggleSidebarResizer()},a.prototype.onBlockBeforeSet=function(a){a.detail.component;this.panels.element.unsetComponent(),this.panels.page.unsetComponent()},a.prototype.onBlockSet=function(a){var b=a.detail.component;b.instanceOf("Block")&&(this.panels.page.getToolbar().toggleMenuItem("new",!0),this.panels.page.setComponent(b.getActivePage()),this.panels.element.getToolbar().toggleMenuItem("Cursor",!0).toggleMenuItem("Image",!0).toggleMenuItem("Text",!0)),this.updatePageSelector(),a.stopPropagation()},a.prototype.onBlockUnset=function(a){this.panels.page.unsetComponent(),this.panels.page.getToolbar().toggleMenuItem("new",!1)},a.prototype.onBlockPanelValueChange=function(a){var b=this.panels.block,c=a.detail.component,d=a.detail.old_values,e=a.detail.new_values;this.history.add({undo:function(){b.updateProperties(c,d)},redo:function(){b.updateProperties(c,e)}})},a.prototype.onBlockPanelToolbarClick=function(a){var c,d,e,f,g=b.Dom.data(a.target,"action");switch(g){case"synched":case"non-synched":c=this.getPlayer(),d=this.panels.block,e=c.addBlock({name:b.Locale.t("editor.onBlockPanelToolbarClick.defaultBlockName","untitled"),synched:"synched"===g}),f={},"synched"===g&&(f["start-time"]=0,f["end-time"]=this.getPlayer().getMedia().getDuration()),e.addPage(f),d.setComponent(e),this.history.add({undo:function(){d.unsetComponent(),e.remove()},redo:function(){c.addBlock(e),d.setComponent(e)}});break;case"delete":e=this.panels.block.getComponent(),this.deletePlayerComponent(e)}a.stopPropagation()},a.prototype.onBlockPanelSelectorChange=function(a){var b,c=a.detail.value;c?(b=this.getPlayer().getComponent(".media#"+c+", .controller#"+c+", .block#"+c),b&&b._metaScore&&this.panels.block.setComponent(b._metaScore)):this.panels.block.unsetComponent()},a.prototype.onPageBeforeSet=function(a){var b=a.detail.component,c=b.getBlock();this.panels.element.unsetComponent(),this.panels.block.setComponent(c)},a.prototype.onPageSet=function(a){var b,c,d,e=(a.detail.component,this.panels.block.getComponent()),f=this.panels.page.getField("start-time"),g=this.panels.page.getField("end-time");this.panels.page.getToolbar().toggleMenuItem("new",!0),this.panels.element.unsetComponent().getToolbar().toggleMenuItem("Cursor",!0).toggleMenuItem("Image",!0).toggleMenuItem("Text",!0),e.getProperty("synched")?(b=e.getActivePageIndex(),c=e.getPage(b-1),d=e.getPage(b+1),c?f.readonly(!1).enable().setMin(c.getProperty("start-time")):f.readonly(!0).enable(),d?g.readonly(!1).enable().setMax(d.getProperty("end-time")):g.readonly(!0).enable()):(f.disable(),g.disable()),this.updateElementSelector(),a.stopPropagation()},a.prototype.onPageUnset=function(a){this.panels.element.unsetComponent().getToolbar().toggleMenuItem("Cursor",!1).toggleMenuItem("Image",!1).toggleMenuItem("Text",!1)},a.prototype.onPagePanelValueChange=function(a){var b,c,d,e,f=this,g=this.panels.page,h=a.detail.component,i=a.detail.old_values,j=a.detail.new_values;("start-time"in j||"end-time"in j)&&((b=h.getBlock())&&b.getProperty("synched")&&(c=b.getActivePageIndex(),d=b.getPage(c-1),e=b.getPage(c+1),"start-time"in j&&d&&d.setProperty("end-time",j["start-time"]),"end-time"in j&&e&&e.setProperty("start-time",j["end-time"])),f.updateElementSelector()),this.history.add({undo:function(){g.updateProperties(h,i),("start-time"in j||"end-time"in j)&&("start-time"in j&&d&&d.setProperty("end-time",i["start-time"]),"end-time"in j&&e&&e.setProperty("start-time",i["end-time"]),f.updateElementSelector())},redo:function(){g.updateProperties(h,j),("start-time"in j||"end-time"in j)&&("start-time"in j&&d&&d.setProperty("end-time",j["start-time"]),"end-time"in j&&e&&e.setProperty("start-time",j["end-time"]),f.updateElementSelector())}})},a.prototype.onPagePanelToolbarClick=function(a){var c,d,e,f,g,h,i,j,k=b.Dom.data(a.target,"action");switch(k){case"new":c=this.panels.page,d=this.panels.block.getComponent(),h={},d.getProperty("synched")&&(j=d.getActivePageIndex(),i=d.getPage(j),f=this.getPlayer().media.getTime(),g=i.getProperty("end-time"),h["start-time"]=f,h["end-time"]=g,i.setProperty("end-time",f)),e=d.addPage(h,j+1),c.setComponent(e),this.history.add({undo:function(){c.unsetComponent(),d.removePage(e),d.getProperty("synched")&&i.setProperty("end-time",g),d.setActivePage(j)},redo:function(){d.getProperty("synched")&&i.setProperty("end-time",f),d.addPage(e,j+1),c.setComponent(e)}});break;case"delete":e=this.panels.page.getComponent(),this.deletePlayerComponent(e)}a.stopPropagation()},a.prototype.onPagePanelSelectorChange=function(a){var b,c,d=this.panels.block.getComponent();d&&(b=a.detail.value,c=this.getPlayer().getComponent(".page#"+b),c&&c._metaScore&&d.setActivePage(c._metaScore))},a.prototype.onElementBeforeSet=function(a){var b=a.detail.component,c=b.parents().get(0)._metaScore;this.panels.page.setComponent(c)},a.prototype.onElementSet=function(a){var b=a.detail.component,c=this.getPlayer();"Text"===b.getProperty("type")?this.panels.text.setComponent(b):this.panels.text.unsetComponent(),c.setReadingIndex(b.getProperty("r-index")||0),a.stopPropagation()},a.prototype.onElementUnset=function(a){this.panels.text.unsetComponent(),a.stopPropagation()},a.prototype.onElementPanelValueChange=function(a){var b=this,c=this.panels.element,d=a.detail.component,e=a.detail.old_values,f=a.detail.new_values;("start-time"in f||"end-time"in f)&&b.updateElementSelector(),this.history.add({undo:function(){c.updateProperties(d,e),("start-time"in f||"end-time"in f)&&b.updateElementSelector()},redo:function(){c.updateProperties(d,f),("start-time"in f||"end-time"in f)&&b.updateElementSelector()}})},a.prototype.onElementPanelToolbarClick=function(a){var c,d,e,f=b.Dom.data(a.target,"action");switch(f){case"Cursor":case"Image":case"Text":c=this.panels.element,d=this.panels.page.getComponent(),e=d.addElement({type:f,name:b.Locale.t("editor.onElementPanelToolbarClick.defaultElementName","untitled")}),c.setComponent(e),this.history.add({undo:function(){c.unsetComponent(),e.remove()},redo:function(){d.addElement(e),c.setComponent(e)}});break;case"delete":e=this.panels.element.getComponent(),this.deletePlayerComponent(e)}},a.prototype.onElementPanelSelectorChange=function(a){var b,c=a.detail.value;c?(b=this.getPlayer().getComponent(".element#"+c),b&&b._metaScore&&this.panels.element.setComponent(b._metaScore)):this.panels.element.unsetComponent()},a.prototype.onPlayerIdSet=function(a){var b=a.detail.player;window.history.replaceState(null,null,"#guide="+b.getId()+":"+b.getRevision())},a.prototype.onPlayerRevisionSet=function(a){var b=a.detail.player;window.history.replaceState(null,null,"#guide="+b.getId()+":"+b.getRevision())},a.prototype.onPlayerTimeUpdate=function(a){var b=a.detail.media.getTime();this.mainmenu.timefield.setValue(b,!0)},a.prototype.onPlayerReadingIndex=function(a){var b=a.detail.value;this.mainmenu.rindexfield.setValue(b,!0)},a.prototype.onPlayerMousedown=function(a){this.contextmenu.hide()},a.prototype.onPlayerBlockAdd=function(a){this.updateBlockSelector()},a.prototype.onPlayerChildRemove=function(a){var b=a.detail.child,c=b._metaScore;c&&(c.instanceOf("Block")?this.updateBlockSelector():c.instanceOf("Page")?this.updatePageSelector():c.instanceOf("Element")&&this.updateElementSelector())},a.prototype.onPlayerFrameLoadSuccess=function(a){var c=this.player_frame.get(0).contentWindow.player;c&&c.addListener("load",b.Function.proxy(this.onPlayerLoadSuccess,this)).addListener("error",b.Function.proxy(this.onPlayerLoadError,this)).addListener("idset",b.Function.proxy(this.onPlayerIdSet,this)).addListener("revisionset",b.Function.proxy(this.onPlayerRevisionSet,this))},a.prototype.onPlayerFrameLoadError=function(a){this.loadmask.hide(),delete this.loadmask,new b.overlay.Alert({parent:this,text:b.Locale.t("editor.onPlayerLoadError.msg","An error occured while trying to load the guide. Please try again."),buttons:{ok:b.Locale.t("editor.onPlayerLoadError.ok","OK")},autoShow:!0})},a.prototype.onPlayerLoadSuccess=function(a){var c,d=this.player_frame.get(0).contentWindow.document.body;this.player=a.detail.player.addClass("in-editor").addDelegate(".metaScore-component","click",b.Function.proxy(this.onComponentClick,this)).addDelegate(".metaScore-component.block","pageadd",b.Function.proxy(this.onBlockPageAdd,this)).addDelegate(".metaScore-component.block","pageactivate",b.Function.proxy(this.onBlockPageActivate,this)).addDelegate(".metaScore-component.page","elementadd",b.Function.proxy(this.onPageElementAdd,this)).addListener("mousedown",b.Function.proxy(this.onPlayerMousedown,this)).addListener("blockadd",b.Function.proxy(this.onPlayerBlockAdd,this)).addListener("keydown",b.Function.proxy(this.onKeydown,this)).addListener("keyup",b.Function.proxy(this.onKeyup,this)).addListener("click",b.Function.proxy(this.onPlayerClick,this)).addListener("timeupdate",b.Function.proxy(this.onPlayerTimeUpdate,this)).addListener("rindex",b.Function.proxy(this.onPlayerReadingIndex,this)).addListener("childremove",b.Function.proxy(this.onPlayerChildRemove,this)),this.player.contextmenu.disable(),this.player_contextmenu=new b.ContextMenu({target:d}).addTask("copy-block",b.Locale.t("editor.contextmenu.copy-block","Copy block"),function(a){return b.Dom.closest(a,".metaScore-component.block")?!0:!1}).addTask("paste-block",b.Locale.t("editor.contextmenu.paste-block","Paste block"),b.Function.proxy(function(a){return"block"===this.clipboard.getDataType()},this)).addTask("delete-block",b.Locale.t("editor.contextmenu.delete-block","Delete block"),b.Function.proxy(function(a){return b.Dom.closest(a,".metaScore-component.block")?!0:!1},this)).addSeparator().addTask("copy-element",b.Locale.t("editor.contextmenu.copy-element","Copy element"),function(a){return b.Dom.closest(a,".metaScore-component.element")?!0:!1}).addTask("paste-element",b.Locale.t("editor.contextmenu.paste-element","Paste element"),b.Function.proxy(function(a){return"element"===this.clipboard.getDataType()&&(b.Dom.closest(a,".metaScore-component.page")?!0:!1)},this)).addTask("delete-element",b.Locale.t("editor.contextmenu.delete-element","Delete element"),b.Function.proxy(function(a){return b.Dom.closest(a,".metaScore-component.element")?!0:!1},this)).addSeparator().addTask("about",b.Locale.t("editor.contextmenu.about","metaScore v.!version r.!revision",{"!version":b.getVersion(),"!revision":b.getRevision()}),!1).addListener("taskclick",b.Function.proxy(this.onContextMenuTaskClick,this)).appendTo(this.workspace),c=this.player.getData(),new b.Dom(d).addListener("keydown",b.Function.proxy(this.onKeydown,this)).addListener("keyup",b.Function.proxy(this.onKeyup,this)),this.setEditing(!0).updateMainmenu().updateBlockSelector(),this.mainmenu.toggleButton("save",c.permissions.update).toggleButton("clone",c.permissions.clone).toggleButton("publish",c.permissions.update).toggleButton("delete",c.permissions["delete"]).rindexfield.setValue(0,!0),this.detailsOverlay.clearValues(!0).setValues(c,!0),this.loadmask.hide(),delete this.loadmask},a.prototype.onPlayerLoadError=function(a){this.loadmask.hide(),delete this.loadmask,new b.overlay.Alert({parent:this,text:b.Locale.t("editor.onPlayerLoadError.msg","An error occured while trying to load the guide. Please try again."),buttons:{ok:b.Locale.t("editor.onPlayerLoadError.ok","OK")},autoShow:!0})},a.prototype.onPlayerClick=function(a){b.editing===!0&&(this.panels.block.unsetComponent(),a.stopPropagation())},a.prototype.onComponentClick=function(a,c){var d;b.editing===!0&&(d=c._metaScore,d.instanceOf("Element")?this.panels.element.setComponent(d):d.instanceOf("Page")?this.panels.page.setComponent(d):this.panels.block.setComponent(d),a.stopImmediatePropagation())},a.prototype.onBlockPageAdd=function(a){var b=a.detail.block;b===this.panels.block.getComponent()&&this.updatePageSelector(),a.stopPropagation()},a.prototype.onBlockPageActivate=function(a){var c,d;b.editing===!0&&(c=a.detail.page,d=a.detail.basis,("pagecuepoint"!==d||c.getBlock()===this.panels.block.getComponent())&&this.panels.page.setComponent(c))},a.prototype.onPageElementAdd=function(a){var b=a.detail.page;b===this.panels.page.getComponent()&&this.updateElementSelector(),a.stopPropagation()},a.prototype.onHistoryAdd=function(a){this.setDirty(!0).updateMainmenu()},a.prototype.onHistoryUndo=function(a){this.updateMainmenu()},a.prototype.onHistoryRedo=function(a){this.updateMainmenu()},a.prototype.onContextMenuTaskClick=function(a){var c,d;switch(a.detail.action){case"copy-block":c=b.Dom.closest(a.detail.context,".metaScore-component.block"),d=c._metaScore,this.clipboard.setData("block",d.getProperties());break;case"paste-block":this.getPlayer().addBlock(this.clipboard.getData());break;case"delete-block":c=b.Dom.closest(a.detail.context,".metaScore-component.block"),d=c._metaScore,this.deletePlayerComponent(d);break;case"copy-element":c=b.Dom.closest(a.detail.context,".metaScore-component.element"),d=c._metaScore,this.clipboard.setData("element",d.getProperties());break;case"paste-element":c=b.Dom.closest(a.detail.context,".metaScore-component.page"),d=c._metaScore,d.addElement(this.clipboard.getData());break;case"delete-element":c=b.Dom.closest(a.detail.context,".metaScore-component.element"),d=c._metaScore,this.deletePlayerComponent(d)}},a.prototype.onDetailsOverlayShow=function(a){var b=this.getPlayer();b&&b.getMedia().pause()},a.prototype.onDetailsOverlaySubmit=function(a,c){var d,e,f=c.detail.overlay,g=c.detail.values;switch(a){case"create":this.createGuide(g,f);break;case"update":d=this.getPlayer(),e=b.Function.proxy(function(){d.updateData(g),f.setValues(b.Object.extend({},d.getData(),g),!0).hide(),this.setDirty(!0).updateMainmenu()},this),"media"in g?this.getMediaFileDuration(g.media.url,b.Function.proxy(function(a){var c,f=d.getMedia().getDuration(),g=[];a!==f?(f>a&&d.getComponents(".block").each(function(d,e){e._metaScore&&(c=e._metaScore,c.getProperty("synched")&&b.Array.each(c.getPages(),function(b,d){return d.getProperty("start-time")>a?(g.push(c.getProperty("name")),!1):void 0}))}),g.length>0?new b.overlay.Alert({parent:this,text:b.Locale.t("editor.onDetailsOverlaySubmit.update.shorter.msg","The duration of selected media file (!new_duration centiseconds) is less than the current one (!old_duration centiseconds).<br/><strong>This will cause some pages of the following blocks to become out of reach: !blocks</strong><br/>Please modify the start time of those pages and try again.",{"!new_duration":a,"!old_duration":f,"!blocks":g.join(", ")}),buttons:{ok:b.Locale.t("editor.onDetailsOverlaySubmit.update.shorter.ok","OK")},autoShow:!0}):new b.overlay.Alert({parent:this,text:b.Locale.t("editor.onDetailsOverlaySubmit.update.diffferent.msg","The duration of selected media file (!new_duration centiseconds) differs from the current one (!old_duration centiseconds).<br/><strong>This can cause pages and elements to become desynchronized.</strong><br/>Are you sure you want to use the new media file?",{"!new_duration":a,"!old_duration":f}),buttons:{confirm:b.Locale.t("editor.onDetailsOverlaySubmit.update.diffferent.yes","Yes"),cancel:b.Locale.t("editor.onDetailsOverlaySubmit.update.diffferent.no","No")},autoShow:!0}).addListener("buttonclick",function(a){"confirm"===a.detail.action&&e()})):e()},this)):e()}},a.prototype.onWindowHashChange=function(a){var c=b.Function.proxy(this.loadPlayerFromHash,this),d=a.oldURL;this.isDirty()?new b.overlay.Alert({parent:this,text:b.Locale.t("editor.onWindowHashChange.alert.msg","Are you sure you want to open another guide ?<br/><strong>Any unsaved data will be lost.</strong>"),buttons:{confirm:b.Locale.t("editor.onWindowHashChange.alert.yes","Yes"),cancel:b.Locale.t("editor.onWindowHashChange.alert.no","No")},autoShow:!0}).addListener("buttonclick",function(a){"confirm"===a.detail.action?c():window.history.replaceState(null,null,d)}):c(),a.preventDefault()},a.prototype.onWindowBeforeUnload=function(a){this.isDirty()&&(a.returnValue=b.Locale.t("editor.onWindowBeforeUnload.msg","Any unsaved data will be lost."))},a.prototype.setEditing=function(a,c){var d=this.getPlayer();return b.editing=a!==!1,c!==!1&&(this.persistentEditing=b.editing),b.Object.each(this.panels,function(a,c){b.editing?c.enable():c.disable()}),this.toggleClass("editing",b.editing),d&&d.toggleClass("editing",b.editing),this.toggleSidebarResizer(),this},a.prototype.toggleSidebarResizer=function(){return!this.hasClass("editing")||this.hasClass("sidebar-hidden")?this.sidebar_resizer.disable():this.sidebar_resizer.enable(),this},a.prototype.loadPlayerFromHash=function(){var a,b;return a=window.location.hash,(b=a.match(/(#|&)guide=(\w+)(:(\d+))?/))&&this.loadPlayer(b[2],b[4]),this},a.prototype.updateMainmenu=function(){var a=this.getPlayer()?!0:!1;return this.mainmenu.toggleButton("edit",a),this.mainmenu.toggleButton("save",a),this.mainmenu.toggleButton("clone",a),this.mainmenu.toggleButton("publish",a),this.mainmenu.toggleButton("delete",a),this.mainmenu.toggleButton("undo",this.history.hasUndo()),this.mainmenu.toggleButton("redo",this.history.hasRedo()),this.mainmenu.toggleButton("revert",this.isDirty()),this},a.prototype.updateBlockSelector=function(){var a,c,d=this.panels.block.getToolbar(),e=d.getSelector();return e.clear().addOption(null,""),this.getPlayer().getComponents(".media.video, .controller, .block").each(function(d,f){f._metaScore&&(a=f._metaScore,c=a.instanceOf("Block")?a.getProperty("synched")?b.Locale.t("editor.blockSelectorOptionLabelSynched","!name (synched)",{"!name":a.getName()}):b.Locale.t("editor.blockSelectorOptionLabelNotSynched","!name (not synched)",{"!name":a.getName()}):a.getName(),e.addOption(a.getId(),c))},this),a=this.panels.block.getComponent(),e.setValue(a?a.getId():null,!0),this},a.prototype.updatePageSelector=function(){var a=this.panels.block.getComponent(),c=this.panels.page.getComponent(),d=this.panels.page.getToolbar(),e=d.getSelector();return e.clear(),a.instanceOf("Block")&&b.Array.each(a.getPages(),function(a,b){e.addOption(b.getId(),a+1)}),e.setValue(c?c.getId():null,!0),this},a.prototype.updateElementSelector=function(){var a,c,d,e,f,g,h,i=this.panels.block.getComponent(),j=this.panels.page.getComponent(),k=this.panels.element.getToolbar(),l=k.getSelector(),m=i.getProperty("synched"),n={};return l.clear(),j.instanceOf("Page")&&(m&&(d=j.getProperty("start-time"),e=j.getProperty("end-time")),b.Array.each(j.getElements(),function(a,b){c=!1,m&&(f=b.getProperty("start-time"),g=b.getProperty("end-time"),c=null!==f&&d>f||null!==g&&g>e),h=b.getProperty("r-index")||0,h in n||(n[h]=[]),n[h].push({element:b,out_of_range:c})},this)),b.Array.each(Object.keys(n).sort(b.Array.naturalSortInsensitive),function(a,c){var d,e=n[c];e.sort(function(a,c){return b.Array.naturalSortInsensitive(a.element.getName(),c.element.getName())}),d=l.addGroup(b.Locale.t("editor.elementSelectorGroupLabel","Reading index !rindex",{"!rindex":c})).attr("data-rindex",c),b.Array.each(e,function(a,b){var c=b.element,e=b.out_of_range;l.addOption(c.getId(),(e?"*":"")+c.getName(),d).toggleClass("out-of-range",e)},this)},this),a=this.panels.element.getComponent(),l.setValue(a?a.getId():null,!0),this},a.prototype.setDirty=function(a){return this.dirty=a,this},a.prototype.isDirty=function(){return this.dirty},a.prototype.getPlayer=function(){return this.player},a.prototype.loadPlayer=function(a,c){var d=this.configs.player_url+a;return c&&(d+="?vid="+c),this.loadmask=new b.overlay.LoadMask({parent:this,autoShow:!0}),this.unloadPlayer(),this.player_frame.get(0).contentWindow.location.replace(d),this},a.prototype.unloadPlayer=function(){return delete this.player,this.player_contextmenu&&(this.player_contextmenu.remove(),delete this.player_contextmenu),this.player_frame.get(0).contentWindow.location.replace("about:blank"),this.panels.block.unsetComponent(),this.history.clear(),this.setDirty(!1).updateMainmenu(),this},a.prototype.deletePlayerComponent=function(a){var b,c,d,e,f,g;return console.log(a),a&&(a.instanceOf("Block")?(console.log("block"),b=this.panels.block,b.getComponent()===a&&b.unsetComponent(),a.remove(),this.history.add({undo:function(){this.getPlayer().addBlock(a),b.setComponent(a)},redo:function(){b.unsetComponent(),a.remove()}})):a.instanceOf("Page")?(b=this.panels.page,c=a.getBlock(),e=c.getActivePageIndex(),b.unsetComponent(),c.removePage(a),e--,c.getPageCount()<1&&(f={},c.getProperty("synched")&&(f["start-time"]=0,f["end-time"]=this.getPlayer().getMedia().getDuration()),g=c.addPage(f),b.setComponent(g)),c.setActivePage(Math.max(0,e)),this.history.add({undo:function(){g&&c.removePage(g,!0),c.addPage(a),b.setComponent(a)},redo:function(){b.unsetComponent(),c.removePage(a,!0),g&&(c.addPage(g),b.setComponent(g)),c.setActivePage(e)}})):a.instanceOf("Element")&&(b=this.panels.element,d=a.getPage(),b.getComponent()===a&&b.unsetComponent(),a.remove(),this.history.add({undo:function(){d.addElement(a),b.setComponent(a)},redo:function(){b.unsetComponent(),a.remove()}}))),this},a.prototype.openGuideSelector=function(){return new b.editor.overlay.GuideSelector({url:this.configs.api_url+"guide.json",autoShow:!0}).addListener("submit",b.Function.proxy(this.onGuideSelectorSubmit,this)),this},a.prototype.createGuide=function(a,c){var d,e=new FormData;return b.Object.each(a,function(a,b){"thumbnail"===a||"media"===a?e.append("files["+a+"]",b.object):e.append(a,b)}),d=b.Object.extend({data:e,dataType:"json",success:b.Function.proxy(this.onGuideCreateSuccess,this,[c]),error:b.Function.proxy(this.onGuideCreateError,this)},this.configs.ajax),this.loadmask=new b.overlay.LoadMask({parent:this,text:b.Locale.t("editor.createGuide.LoadMask.text","Saving..."),autoShow:!0}),b.Ajax.post(this.configs.api_url+"guide.json",d),this},a.prototype.saveGuide=function(a,c){var d,e,f=this.getPlayer(),g=f.getId(),h=f.getRevision(),i=f.getComponents(".media, .controller, .block"),j=new FormData,k=this.detailsOverlay.getValues();return c===!0&&j.append("publish",!0),b.Object.each(k,function(a,c){"thumbnail"===a||"media"===a?j.append("files["+a+"]",c.object):b.Var.is(c,"array")?b.Array.each(c,function(b,c){
j.append(a+"[]",c)}):j.append(a,c)}),i.each(function(a,c){d=c._metaScore,d.instanceOf("Media")?j.append("blocks[]",JSON.stringify(b.Object.extend({type:"media"},d.getProperties()))):d.instanceOf("Controller")?j.append("blocks[]",JSON.stringify(b.Object.extend({type:"controller"},d.getProperties()))):d.instanceOf("Block")&&j.append("blocks[]",JSON.stringify(d.getProperties()))},this),e=b.Object.extend({data:j,dataType:"json",success:b.Function.proxy(this.onGuideSaveSuccess,this),error:b.Function.proxy(this.onGuideSaveError,this)},this.configs.ajax),this.loadmask=new b.overlay.LoadMask({parent:this,text:b.Locale.t("editor.saveGuide.LoadMask.text","Saving..."),autoShow:!0}),b.Ajax.post(this.configs.api_url+"guide/"+g+"/"+a+".json?vid="+h,e),this},a.prototype.getMediaFileDuration=function(a,c){var d=new b.Dom("<audio/>",{src:a}).addListener("loadedmetadata",function(a){var b=100*parseFloat(d.get(0).duration);c(b)})},a}(),b.namespace("editor").DropDownMenu=function(){function a(){b.Dom.call(this,"<ul/>",{"class":"dropdown-menu"})}return b.Dom.extend(a),a.prototype.addItem=function(a,c){var d=new b.Dom("<li/>",{"data-action":a,text:c}).appendTo(this);return d},a.prototype.toggleItem=function(a,b){return this.child('[data-action="'+a+'"]').toggleClass("disabled",b===!1),this},a}(),b.namespace("editor").Field=function(){function a(a){this.configs=this.getConfigs(a),b.Dom.call(this,"<div/>",{"class":"field"}),this.setupUI(),this.get(0)._metaScore=this,null!==this.configs.value&&this.setValue(this.configs.value),this.input&&(this.configs.name&&this.input.attr("name",this.configs.name),this.configs.required&&(this.addClass("required"),this.input.attr("required",""))),this.configs.disabled?this.disable():this.enable(),this.configs.description&&this.setDescription(this.configs.description),this.readonly(this.configs.readonly)}var c="valuechange";return a.defaults={value:null,required:!1,disabled:!1,readonly:!1,description:null},b.Dom.extend(a),a.prototype.setupUI=function(){var a="field-"+b.String.uuid(5);this.configs.label&&(this.label=new b.Dom("<label/>",{"for":a,text:this.configs.label}).appendTo(this)),this.input_wrapper=new b.Dom("<div/>",{"class":"input-wrapper"}).appendTo(this),this.input=new b.Dom("<input/>",{id:a}).addListener("change",b.Function.proxy(this.onChange,this)).appendTo(this.input_wrapper)},a.prototype.setDescription=function(a){return"description"in this||(this.description=new b.Dom("<div/>",{"class":"description"}).appendTo(this.input_wrapper)),this.description.text(a),this},a.prototype.onChange=function(a){this.value=this.input.val(),this.triggerEvent(c,{field:this,value:this.value},!0,!1)},a.prototype.setValue=function(a,b){return this.input.val(a),this.value=a,b!==!0&&this.input.triggerEvent("change"),this},a.prototype.getValue=function(){return this.value},a.prototype.disable=function(){return this.disabled=!0,this.addClass("disabled"),this.input&&this.input.attr("disabled","disabled"),this},a.prototype.enable=function(){return this.disabled=!1,this.removeClass("disabled"),this.input&&this.input.attr("disabled",null),this},a.prototype.readonly=function(a){return this.is_readonly=a===!0,this.toggleClass("readonly",this.is_readonly),this.input&&this.input.attr("readonly",this.is_readonly?"readonly":null),this},a}(),b.namespace("editor").History=function(){function a(b){this.configs=this.getConfigs(b),a.parent.call(this),this.commands=[],this.index=-1,this.executing=!1}var c="add",d="undo",e="redo",f="clear";return a.defaults={max_commands:30},b.Evented.extend(a),a.prototype.execute=function(a,b){return a&&b in a&&(this.executing=!0,a[b](a),this.executing=!1),this},a.prototype.add=function(a){return this.executing?this:(this.commands.splice(this.index+1,this.commands.length-this.index),this.commands.push(a),this.commands.length>this.configs.max_commands&&(this.commands=this.commands.slice(-1*this.configs.max_commands)),this.index=this.commands.length-1,this.triggerEvent(c,{command:a}),this)},a.prototype.undo=function(){var a=this.commands[this.index];return a?(this.execute(a,"undo"),this.index-=1,this.triggerEvent(d,{command:a}),this):this},a.prototype.redo=function(){var a=this.commands[this.index+1];return a?(this.execute(a,"redo"),this.index+=1,this.triggerEvent(e,{command:a}),this):this},a.prototype.clear=function(){var a=this.commands.length;return this.commands=[],this.index=-1,a>0&&this.triggerEvent(f),this},a.prototype.hasUndo=function(){return-1!==this.index},a.prototype.hasRedo=function(){return this.index<this.commands.length-1},a}(),b.namespace("editor").MainMenu=function(){function a(){a.parent.call(this,"<div/>",{"class":"main-menu clearfix"}),this.setupUI()}return b.Dom.extend(a),a.prototype.setupUI=function(){var a,c;new b.Dom("<div/>",{"class":"logo-philharmonie"}).appendTo(this),new b.Dom("<div/>",{"class":"separator"}).appendTo(this),(new b.Button).attr({title:b.Locale.t("editor.MainMenu.new","New")}).data("action","new").appendTo(this),(new b.Button).attr({title:b.Locale.t("editor.MainMenu.open","Open")}).data("action","open").appendTo(this),(new b.Button).attr({title:b.Locale.t("editor.MainMenu.edit","Edit")}).data("action","edit").appendTo(this),a=new b.Dom("<div/>",{"class":"button-group"}).appendTo(this),(new b.Button).attr({title:b.Locale.t("editor.MainMenu.save","Save as draft")}).data("action","save").appendTo(a),c=new b.Dom("<div/>",{"class":"sub-menu"}).appendTo(a),(new b.Button).attr({title:b.Locale.t("editor.MainMenu.clone","Save as copy")}).data("action","clone").appendTo(c),(new b.Button).attr({title:b.Locale.t("editor.MainMenu.publish","Save & Publish")}).data("action","publish").appendTo(c),(new b.Button).attr({title:b.Locale.t("editor.MainMenu.delete","Delete")}).data("action","delete").appendTo(this),new b.Dom("<div/>",{"class":"separator"}).appendTo(this),(new b.Button).attr({title:b.Locale.t("editor.MainMenu.download","Download")}).data("action","download").disable().appendTo(this),new b.Dom("<div/>",{"class":"separator"}).appendTo(this),this.timefield=(new b.editor.field.Time).attr({title:b.Locale.t("editor.MainMenu.time","Time")}).addClass("time").appendTo(this),new b.Dom("<div/>",{"class":"separator"}).appendTo(this),this.rindexfield=new b.editor.field.Number({min:0,max:999}).attr({title:b.Locale.t("editor.MainMenu.r-index","Reading index")}).addClass("r-index").appendTo(this),new b.Dom("<div/>",{"class":"separator"}).appendTo(this),(new b.Button).attr({title:b.Locale.t("editor.MainMenu.edit-toggle","Toggle edit mode")}).data("action","edit-toggle").appendTo(this),new b.Dom("<div/>",{"class":"separator"}).appendTo(this),(new b.Button).attr({title:b.Locale.t("editor.MainMenu.revert","Revert")}).data("action","revert").appendTo(this),(new b.Button).attr({title:b.Locale.t("editor.MainMenu.undo","Undo")}).data("action","undo").appendTo(this),(new b.Button).attr({title:b.Locale.t("editor.MainMenu.redo","Redo")}).data("action","redo").appendTo(this),new b.Dom("<div/>",{"class":"separator"}).css("flex","20").appendTo(this),(new b.Button).attr({title:b.Locale.t("editor.MainMenu.settings","Settings")}).data("action","settings").disable().appendTo(this),(new b.Button).attr({title:b.Locale.t("editor.MainMenu.help","Help")}).data("action","help").disable().appendTo(this),(new b.Button).attr({title:b.Locale.t("editor.MainMenu.logout","Logout")}).data("action","logout").appendTo(this)},a.prototype.toggleButton=function(a,b){return this.find('[data-action="'+a+'"]').toggleClass("disabled",b===!1),this},a}(),b.namespace("editor").Panel=function(){function a(c){this.configs=this.getConfigs(c),a.parent.call(this,"<div/>",{"class":"panel"}),this.onComponentDragStart=b.Function.proxy(this.onComponentDragStart,this),this.onComponentDrag=b.Function.proxy(this.onComponentDrag,this),this.onComponentDragEnd=b.Function.proxy(this.onComponentDragEnd,this),this.onComponentResizeStart=b.Function.proxy(this.onComponentResizeStart,this),this.onComponentResize=b.Function.proxy(this.onComponentResize,this),this.onComponentResizeEnd=b.Function.proxy(this.onComponentResizeEnd,this),this.toolbar=new b.editor.panel.Toolbar(this.configs.toolbarConfigs).addDelegate(".buttons [data-action]","click",b.Function.proxy(this.onToolbarButtonClick,this)).appendTo(this),this.toolbar.getTitle().addListener("click",b.Function.proxy(this.toggleState,this)),this.contents=new b.Dom("<div/>",{"class":"fields"}).appendTo(this),this.addDelegate(".fields .field","valuechange",b.Function.proxy(this.onFieldValueChange,this)).unsetComponent()}var c="componentbeforeset",d="componentset",e="componentunset",f="valueschange";return a.defaults={toolbarConfigs:{}},b.Dom.extend(a),a.prototype.setupFields=function(a){var c,d;return this.fields={},this.contents.empty(),b.Object.each(a,function(a,e){e.editable!==!1&&(c=e.configs||{},d=new b.editor.field[e.type](c).data("name",a).appendTo(this.contents),this.fields[a]=d)},this),this},a.prototype.getToolbar=function(){return this.toolbar},a.prototype.getField=function(a){return void 0===a?this.fields:this.fields[a]},a.prototype.enableFields=function(){return b.Object.each(this.fields,function(a,b){b.enable()},this),this},a.prototype.showField=function(a){return this.getField(a).show(),this},a.prototype.hideField=function(a){return this.getField(a).hide(),this},a.prototype.toggleState=function(){return this.toggleClass("collapsed"),this},a.prototype.disable=function(){return this.addClass("disabled"),this},a.prototype.enable=function(){return this.removeClass("disabled"),this},a.prototype.getComponent=function(){return this.component},a.prototype.setComponent=function(a,b){if(a!==this.getComponent()){if(!a)return this.unsetComponent();this.unsetComponent(!0),this.triggerEvent(c,{component:a},!1),this.component=a,this.setupFields(this.component.configs.properties).updateFieldValues(this.getValues(Object.keys(this.getField())),!0).updateDraggable(!0).updateResizable(!0).addClass("has-component"),this.getToolbar().getSelector().setValue(a.getId(),!0),a.instanceOf("Controller")||a.instanceOf("Media")||this.getToolbar().toggleMenuItem("delete",!0),a.addClass("selected").addListener("dragstart",this.onComponentDragStart).addListener("drag",this.onComponentDrag).addListener("dragend",this.onComponentDragEnd).addListener("resizestart",this.onComponentResizeStart).addListener("resize",this.onComponentResize).addListener("resizeend",this.onComponentResizeEnd),b!==!0&&this.triggerEvent(d,{component:a},!1)}return this},a.prototype.unsetComponent=function(a){var b=this.getComponent(),c=this.getToolbar();return this.removeClass("has-component"),c.toggleMenuItem("delete",!1),b&&(this.updateDraggable(!1).updateResizable(!1),c.getSelector().setValue(null,!0),b.removeClass("selected").removeListener("dragstart",this.onComponentDragStart).removeListener("drag",this.onComponentDrag).removeListener("dragend",this.onComponentDragEnd).removeListener("resizestart",this.onComponentResizeStart).removeListener("resize",this.onComponentResize).removeListener("resizeend",this.onComponentResizeEnd),delete this.component,a!==!0&&this.triggerEvent(e,{component:b},!1)),this},a.prototype.updateDraggable=function(a){var c=this.getComponent();return a=b.Var.is(c.setDraggable,"function")?c.setDraggable(a):!1,this.toggleFields(["x","y"],a?!0:!1),this},a.prototype.updateResizable=function(a){var c=this.getComponent();return a=b.Var.is(c.setResizable,"function")?c.setResizable(a):!1,this.toggleFields(["width","height"],a?!0:!1),this},a.prototype.onToolbarButtonClick=function(a){var c,d,e,f,g=b.Dom.data(a.target,"action");switch(g){case"previous":c=this.getToolbar().getSelector(),d=c.find('option[value^="component"]'),e=d.count(),e>0&&(f=d.index(":checked")-1,0>f&&(f=e-1),c.setValue(new b.Dom(d.get(f)).val())),a.stopPropagation();break;case"next":c=this.getToolbar().getSelector(),d=c.find('option[value^="component"]'),e=d.count(),e>0&&(f=d.index(":checked")+1,f>=e&&(f=0),c.setValue(new b.Dom(d.get(f)).val())),a.stopPropagation()}},a.prototype.onComponentDragStart=function(a){var b=["x","y"];this._beforeDragValues=this.getValues(b)},a.prototype.onComponentDrag=function(a){var b=["x","y"];this.updateFieldValues(b,!0)},a.prototype.onComponentDragEnd=function(a){var b=this.getComponent(),c=["x","y"];this.updateFieldValues(c,!0),this.triggerEvent(f,{component:b,old_values:this._beforeDragValues,new_values:this.getValues(c)},!1),delete this._beforeDragValues},a.prototype.onComponentResizeStart=function(a){var b=["x","y","width","height"];this._beforeResizeValues=this.getValues(b)},a.prototype.onComponentResize=function(a){var b=["x","y","width","height"];this.updateFieldValues(b,!0)},a.prototype.onComponentResizeEnd=function(a){var b=this.getComponent(),c=["x","y","width","height"];this.updateFieldValues(c,!0),this.triggerEvent(f,{component:b,old_values:this._beforeResizeValues,new_values:this.getValues(c)},!1),delete this._beforeResizeValues},a.prototype.onFieldValueChange=function(a){var b,c,d,e=this.getComponent();if(e){switch(b=a.detail.field.data("name"),c=a.detail.value,d=this.getValues([b]),e.setProperty(b,c),b){case"locked":this.updateDraggable(!c),this.updateResizable(!c);break;case"name":this.getToolbar().getSelector().updateOption(e.getId(),c);break;case"start-time":this.getField("end-time").setMin(c);break;case"end-time":this.getField("start-time").setMax(c)}this.triggerEvent(f,{component:e,old_values:d,new_values:this.getValues([b])},!1)}},a.prototype.updateFieldValue=function(a,b,c){return this.getField(a).setValue(b,c),this},a.prototype.updateFieldValues=function(a,c){return b.Var.is(a,"array")?b.Array.each(a,function(a,b){this.updateFieldValue(b,this.getValue(b),c)},this):b.Object.each(a,function(a,b){this.updateFieldValue(a,b,c)},this),this},a.prototype.updateProperties=function(a,c){return b.Object.each(c,function(b,c){this.getField(b).disabled||a.setProperty(b,c)},this),this.updateFieldValues(c,!0),this},a.prototype.toggleFields=function(a,c){var d;return b.Array.each(a,function(a,b){(d=this.getField(b))&&(c?d.enable():d.disable())},this),this},a.prototype.getValue=function(a){return this.getComponent().getProperty(a)},a.prototype.getValues=function(a){var c={};return a=a||Object.keys(this.getField()),b.Array.each(a,function(a,b){this.getField(b).disabled||(c[b]=this.getValue(b))},this),c},a}(),b.namespace("editor.field").Boolean=function(){function a(b){this.configs=this.getConfigs(b),a.parent.call(this,this.configs),this.addClass("booleanfield"),this.setValue(this.configs.checked?this.configs.checked_value:this.configs.unchecked_value)}var c="valuechange";return a.defaults={checked:!1,checked_value:!0,unchecked_value:!1},b.editor.Field.extend(a),a.prototype.setupUI=function(){var a="field-"+b.String.uuid(5);this.configs.label&&(this.label=new b.Dom("<label/>",{"for":a,text:this.configs.label}).appendTo(this)),this.input_wrapper=new b.Dom("<div/>",{"class":"input-wrapper"}).appendTo(this),this.input=new b.Dom("<input/>",{type:"checkbox",id:a}).addListener("click",b.Function.proxy(this.onClick,this)).addListener("change",b.Function.proxy(this.onChange,this)).appendTo(this.input_wrapper)},a.prototype.onClick=function(a){this.is_readonly&&a.preventDefault()},a.prototype.onChange=function(a){return this.is_readonly?void a.preventDefault():(this.input.is(":checked")?(this.value=this.configs.checked_value,this.addClass("checked")):(this.value=this.configs.unchecked_value,this.removeClass("checked")),void this.triggerEvent(c,{field:this,value:this.value},!0,!1))},a.prototype.setValue=function(a,b){return this.input.get(0).checked=a===this.configs.checked_value,b!==!0&&this.input.triggerEvent("change"),this},a}(),b.namespace("editor.field").BorderRadius=function(){function a(b){this.configs=this.getConfigs(b),a.parent.call(this,this.configs),this.addClass("borderradiusrfield")}return b.editor.Field.extend(a),a.prototype.setupUI=function(){a.parent.prototype.setupUI.call(this),this.input.attr("readonly","readonly").addListener("click",b.Function.proxy(this.onClick,this)),this.overlay=(new b.editor.overlay.BorderRadius).addListener("submit",b.Function.proxy(this.onOverlaySubmit,this)),this.clear=new b.Dom("<button/>",{text:".","data-action":"clear"}).addListener("click",b.Function.proxy(this.onClearClick,this)).appendTo(this.input_wrapper)},a.prototype.setValue=function(b,c){return a.parent.prototype.setValue.call(this,b,c),this.input.attr("title",b),this},a.prototype.onClick=function(a){this.disabled||this.overlay.setValue(this.value).show()},a.prototype.onOverlaySubmit=function(a){var b=a.detail.value;a.detail.overlay;this.setValue(b)},a.prototype.onClearClick=function(a){this.setValue("0px")},a}(),b.namespace("editor.field").Buttons=function(){function a(c){this.configs=this.getConfigs(c),this.buttons={},this.onClick=b.Function.proxy(this.onClick,this),a.parent.call(this,this.configs),this.addClass("buttonsfield")}var c="valuechange";return a.defaults={buttons:{}},b.editor.Field.extend(a),a.prototype.setupUI=function(){var a=this;this.configs.label&&(this.label=new b.Dom("<label/>",{text:this.configs.label}).appendTo(this)),this.input_wrapper=new b.Dom("<div/>",{"class":"input-wrapper"}).appendTo(this),b.Object.each(this.configs.buttons,function(d,e){this.buttons[d]=new b.Dom("<button/>",e).addListener("click",function(){a.triggerEvent(c,{field:a,value:d},!0,!1)}).appendTo(this.input_wrapper)},this)},a.prototype.setValue=function(){return this},a.prototype.getButtons=function(){return this.buttons},a.prototype.getButton=function(a){return this.buttons[a]},a}(),b.namespace("editor.field").Color=function(){function a(b){this.configs=this.getConfigs(b),a.parent.call(this,this.configs),this.addClass("colorfield")}var c="valuechange";return a.defaults={value:{r:255,g:255,b:255,a:1}},b.editor.Field.extend(a),a.prototype.setupUI=function(){a.parent.prototype.setupUI.call(this),this.input.attr("readonly","readonly").addListener("click",b.Function.proxy(this.onClick,this)),this.clear=new b.Dom("<button/>",{text:".","data-action":"clear"}).addListener("click",b.Function.proxy(this.onClearClick,this)).appendTo(this.input_wrapper),this.overlay=(new b.editor.overlay.ColorSelector).addListener("submit",b.Function.proxy(this.onOverlaySubmit,this))},a.prototype.setValue=function(a,d){var e;return this.value=a?b.Color.parse(a):null,e=this.value?"rgba("+this.value.r+","+this.value.g+","+this.value.b+","+this.value.a+")":null,this.input.attr("title",e).css("background-color",e),d!==!0&&this.triggerEvent(c,{field:this,value:this.value},!0,!1),this},a.prototype.onClick=function(a){this.disabled||this.overlay.setValue(b.Object.copy(this.value)).show()},a.prototype.onOverlaySubmit=function(a){var b=a.detail.value;a.detail.overlay;this.setValue(b)},a.prototype.onClearClick=function(a){this.setValue(null)},a}(),b.namespace("editor.field").File=function(){function a(b){this.configs=this.getConfigs(b),a.parent.call(this,this.configs),this.configs.accept&&this.setAcceptedTypes(this.configs.accept),this.addClass("filefield")}return a.defaults={accept:null},b.editor.Field.extend(a),a.prototype.setupUI=function(){a.parent.prototype.setupUI.call(this),this.input.attr("type","file"),this.current=new b.Dom("<div/>").appendTo(this.input_wrapper)},a.prototype.setAcceptedTypes=function(a){this.input.attr("accept",a)},a.prototype.setValue=function(a){var c;return this.current.empty(),this.input.val(""),a&&"name"in a&&(c=new b.Dom("<a/>",{text:a.name}).attr("target","_blank").appendTo(this.current),"url"in a&&c.attr("href",a.url)),this},a.prototype.getFile=function(a){var b=this.input.get(0).files;return void 0!==a?b[a]:b},a}(),b.namespace("editor.field").Image=function(){function a(c){this.configs=this.getConfigs(c),this.onFileSelect=b.Function.proxy(this.onFileSelect,this),a.parent.call(this,this.configs),this.addClass("imagefield")}var c="filebrowser";return a.defaults={placeholder:b.Locale.t("editor.field.Image.placeholder","Browse...")},b.editor.Field.extend(a),a.prototype.setupUI=function(){a.parent.prototype.setupUI.call(this),this.input.attr("readonly","readonly").attr("placeholder",this.configs.placeholder).addListener("click",b.Function.proxy(this.onClick,this)),this.clear=new b.Dom("<button/>",{text:".","data-action":"clear"}).addListener("click",b.Function.proxy(this.onClearClick,this)).appendTo(this.input_wrapper)},a.prototype.setValue=function(b,c){return a.parent.prototype.setValue.call(this,b,c),this.input.attr("title",b),this},a.prototype.onClick=function(a){this.disabled||this.triggerEvent(c,{callback:this.onFileSelect},!0,!1)},a.prototype.onClearClick=function(a){this.setValue(null)},a.prototype.onFileSelect=function(a){this.setValue(a)},a}(),b.namespace("editor.field").Number=function(){function a(c){this.configs=this.getConfigs(c),a.parent.call(this,this.configs),this.spinDown=b.Function.proxy(this.spinDown,this),this.spinUp=b.Function.proxy(this.spinUp,this),this.addClass("numberfield")}var c="valuechange";return a.defaults={value:0,min:null,max:null,step:1,spinButtons:!0,spinInterval:200,spinDirection:"horizontal",flipSpinButtons:!1},b.editor.Field.extend(a),a.prototype.setupUI=function(){var a,c="field-"+b.String.uuid(5);this.configs.label&&(this.label=new b.Dom("<label/>",{"for":c,text:this.configs.label}).appendTo(this)),this.input_wrapper=new b.Dom("<div/>",{"class":"input-wrapper"}).appendTo(this),this.input=new b.Dom("<input/>",{type:"text",id:c}).addListener("input",b.Function.proxy(this.onInput,this)).addListener("mousewheel",b.Function.proxy(this.onMouseWheel,this)).addListener("DOMMouseScroll",b.Function.proxy(this.onMouseWheel,this)).addListener("keydown",b.Function.proxy(this.onKeyDown,this)).appendTo(this.input_wrapper),this.configs.spinButtons&&(a=new b.Dom("<div/>",{"class":"buttons"}).appendTo(this.input_wrapper),this.configs.flipSpinButtons&&a.addClass("flip"),this.spindown_btn=new b.Dom("<button/>",{text:"-","data-action":"spin-down"}).addListener("mousedown",b.Function.proxy(this.onSpinBtnMouseDown,this)).addListener("mouseup",b.Function.proxy(this.onSpinBtnMouseUp,this)).addListener("mouseout",b.Function.proxy(this.onSpinBtnMouseOut,this)).appendTo(a),this.spinup_btn=new b.Dom("<button/>",{text:"+","data-action":"spin-up"}).addListener("mousedown",b.Function.proxy(this.onSpinBtnMouseDown,this)).addListener("mouseup",b.Function.proxy(this.onSpinBtnMouseUp,this)).addListener("mouseout",b.Function.proxy(this.onSpinBtnMouseOut,this)).appendTo(a)),this.addClass("vertical"===this.configs.spinDirection?"vertical":"horizontal"),this.addListener("change",b.Function.proxy(this.onChange,this))},a.prototype.onChange=function(a){this.triggerEvent(c,{field:this,value:this.value},!0,!1)},a.prototype.onInput=function(a){this.setValue(this.input.val()),a.stopPropagation()},a.prototype.onMouseWheel=function(a){var b;this.input.is(":focus")&&(b=Math.max(-1,Math.min(1,a.wheelDelta||-a.detail)),this.setValue(this.getValue()+this.configs.step*b),a.preventDefault())},a.prototype.onKeyDown=function(a){switch(a.keyCode){case 38:this.spinUp(),a.preventDefault();break;case 40:this.spinDown(),a.preventDefault()}},a.prototype.onSpinBtnMouseDown=function(a){var c;switch(b.Dom.data(a.target,"action")){case"spin-down":c=this.spinDown;break;default:c=this.spinUp}c(),this.interval=setInterval(c,this.configs.spinInterval)},a.prototype.onSpinBtnMouseUp=function(a){clearInterval(this.interval)},a.prototype.onSpinBtnMouseOut=a.prototype.onSpinBtnMouseUp,a.prototype.spinDown=function(){this.setValue(this.getValue()-this.configs.step)},a.prototype.spinUp=function(){this.setValue(this.getValue()+this.configs.step)},a.prototype.setValue=function(a,b){return a=parseFloat(a),isNaN(a)?isNaN(this.value)&&(this.value=0):this.value=a,null!==this.configs.min&&(this.value=Math.max(this.value,this.configs.min)),null!==this.configs.max&&(this.value=Math.min(this.value,this.configs.max)),this.input.val(this.value),b!==!0&&this.triggerEvent("change"),this},a.prototype.setMin=function(a){return this.configs.min=a,this.getValue()<a&&this.setValue(a),this},a.prototype.setMax=function(a){return this.configs.max=a,this.getValue()>a&&this.setValue(a),this},a}(),b.namespace("editor.field").Select=function(){function a(b){this.configs=this.getConfigs(b),a.parent.call(this,this.configs),this.addClass("selectfield")}return a.defaults={options:{},multiple:!1},b.editor.Field.extend(a),a.prototype.setupUI=function(){var a="field-"+b.String.uuid(5);this.configs.label&&(this.label=new b.Dom("<label/>",{"for":a,text:this.configs.label}).appendTo(this)),this.input_wrapper=new b.Dom("<div/>",{"class":"input-wrapper"}).appendTo(this),this.input=new b.Dom("<select/>",{id:a}).addListener("change",b.Function.proxy(this.onChange,this)).appendTo(this.input_wrapper),b.Object.each(this.configs.options,function(a,b){this.addOption(a,b)},this),this.configs.multiple&&this.input.attr("multiple","multiple")},a.prototype.addGroup=function(a){var c=new b.Dom("<optgroup/>",{label:a});return this.input.append(c),c},a.prototype.addOption=function(a,c,d){var e=new b.Dom("<option/>",{value:a,text:c});return e.appendTo(d?d:this.input),e},a.prototype.updateOption=function(a,b){var c=this.input.find('option[value="'+a+'"]');return c.text(b),c},a.prototype.removeOption=function(a){var b=this.input.find('option[value="'+a+'"]');return b.remove(),b},a.prototype.clear=function(){return this.input.empty(),this},a.prototype.readonly=function(b){return a.parent.prototype.readonly.apply(this,arguments),this.input.attr("disabled",this.is_readonly?"disabled":null),this},a}(),b.namespace("editor.field").Text=function(){function a(b){this.configs=this.getConfigs(b),a.parent.call(this,this.configs),this.addClass("textfield")}return a.defaults={value:""},b.editor.Field.extend(a),a.prototype.setupUI=function(){a.parent.prototype.setupUI.call(this),this.input.attr("type","text")},a}(),b.namespace("editor.field").Textarea=function(){function a(b){this.configs=this.getConfigs(b),a.parent.call(this,this.configs),this.addClass("textareafield")}return a.defaults={value:""},b.editor.Field.extend(a),a.prototype.setupUI=function(){var a="field-"+b.String.uuid(5);this.configs.label&&(this.label=new b.Dom("<label/>",{"for":a,text:this.configs.label}).appendTo(this)),this.input_wrapper=new b.Dom("<div/>",{"class":"input-wrapper"}).appendTo(this),this.input=new b.Dom("<textarea></textarea>",{id:a}).addListener("change",b.Function.proxy(this.onChange,this)).appendTo(this.input_wrapper)},a}(),b.namespace("editor.field").Time=function(){function a(b){this.configs=this.getConfigs(b),a.parent.call(this,this.configs),this.addClass("timefield")}var c="valuechange",d="valuein",e="valueout";return a.defaults={value:0,min:0,max:null,checkbox:!1,inButton:!1,outButton:!1},b.editor.Field.extend(a),a.prototype.setupUI=function(){var a;this.configs.label&&(this.label=new b.Dom("<label/>",{text:this.configs.label}).appendTo(this)),this.input_wrapper=new b.Dom("<div/>",{"class":"input-wrapper"}).appendTo(this),this.configs.checkbox&&(this.checkbox=new b.Dom("<input/>",{type:"checkbox"}).addListener("change",b.Function.proxy(this.onInput,this)).appendTo(this.input_wrapper)),this.hours=new b.Dom("<input/>",{type:"number","class":"hours"}).addListener("input",b.Function.proxy(this.onInput,this)).appendTo(this.input_wrapper),new b.Dom("<span/>",{text:":","class":"separator"}).appendTo(this.input_wrapper),this.minutes=new b.Dom("<input/>",{type:"number","class":"minutes"}).addListener("input",b.Function.proxy(this.onInput,this)).appendTo(this.input_wrapper),new b.Dom("<span/>",{text:":","class":"separator"}).appendTo(this.input_wrapper),this.seconds=new b.Dom("<input/>",{type:"number","class":"seconds"}).addListener("input",b.Function.proxy(this.onInput,this)).appendTo(this.input_wrapper),new b.Dom("<span/>",{text:".","class":"separator"}).appendTo(this.input_wrapper),this.centiseconds=new b.Dom("<input/>",{type:"number","class":"centiseconds"}).addListener("input",b.Function.proxy(this.onInput,this)).appendTo(this.input_wrapper),(this.configs.inButton||this.configs.outButton)&&(a=new b.Dom("<div/>",{"class":"buttons"}).appendTo(this.input_wrapper),this.configs.inButton&&(this["in"]=new b.Dom("<button/>",{text:".","data-action":"in"}).addListener("click",b.Function.proxy(this.onInClick,this)).appendTo(a)),this.configs.outButton&&(this.out=new b.Dom("<button/>",{text:".","data-action":"out"}).addListener("click",b.Function.proxy(this.onOutClick,this)).appendTo(a))),this.addListener("change",b.Function.proxy(this.onChange,this))},a.prototype.onChange=function(a){this.triggerEvent(c,{field:this,value:this.value},!0,!1)},a.prototype.onInput=function(a){var b,c,d,e,f=this.isActive();f?(b=parseInt(this.centiseconds.val(),10)||0,c=parseInt(this.seconds.val(),10)||0,d=parseInt(this.minutes.val(),10)||0,e=parseInt(this.hours.val(),10)||0,this.setValue(b+100*c+6e3*d+36e4*e)):this.setValue(null),a.stopPropagation()},a.prototype.onInClick=function(a){this.triggerEvent(d)},a.prototype.onOutClick=function(a){this.triggerEvent(e)},a.prototype.setValue=function(a,b){var c,d,e,f;return a=parseFloat(a),isNaN(a)?(this.value=null,this.centiseconds.val(0),this.seconds.val(0),this.minutes.val(0),this.hours.val(0),this.disabled||(this.hours.attr("disabled","disabled"),this.minutes.attr("disabled","disabled"),this.seconds.attr("disabled","disabled"),this.centiseconds.attr("disabled","disabled"),this["in"]&&this["in"].attr("disabled","disabled"),this.out&&this.out.attr("disabled","disabled")),this.checkbox&&this.checkbox.attr("checked",null)):(this.value=Math.floor(a),null!==this.configs.min&&(this.value=Math.max(this.value,this.configs.min)),null!==this.configs.max&&(this.value=Math.min(this.value,this.configs.max)),c=parseInt(this.value%100,10)||0,d=parseInt(this.value/100%60,10)||0,e=parseInt(this.value/6e3%60,10)||0,f=parseInt(this.value/36e4,10)||0,this.disabled||(this.hours.attr("disabled",null),this.minutes.attr("disabled",null),this.seconds.attr("disabled",null),this.centiseconds.attr("disabled",null),this["in"]&&this["in"].attr("disabled",null),this.out&&this.out.attr("disabled",null)),this.centiseconds.val(c),this.seconds.val(d),this.minutes.val(e),this.hours.val(f),this.checkbox&&this.checkbox.attr("checked","checked")),b!==!0&&this.triggerEvent("change"),this},a.prototype.setMin=function(a){return this.configs.min=a,this.getValue()<a&&this.setValue(a),this},a.prototype.setMax=function(a){return this.configs.max=a,this.getValue()>a&&this.setValue(a),this},a.prototype.isActive=function(){return!this.checkbox||this.checkbox.is(":checked")},a.prototype.disable=function(){return a.parent.prototype.disable.call(this),this.checkbox&&this.checkbox.attr("disabled","disabled"),this.hours.attr("disabled","disabled"),this.minutes.attr("disabled","disabled"),this.seconds.attr("disabled","disabled"),this.centiseconds.attr("disabled","disabled"),this["in"]&&this["in"].attr("disabled","disabled"),this.out&&this.out.attr("disabled","disabled"),this},a.prototype.enable=function(){var b,c=this.isActive();return a.parent.prototype.enable.call(this),this.checkbox&&this.checkbox.attr("disabled",null),b=c?null:"disabled",this.hours.attr("disabled",b),this.minutes.attr("disabled",b),this.seconds.attr("disabled",b),this.centiseconds.attr("disabled",b),this["in"]&&this["in"].attr("disabled",b),this.out&&this.out.attr("disabled",b),this},a.prototype.readonly=function(b){var c;return a.parent.prototype.readonly.call(this,b),c=this.is_readonly?"readonly":null,this.checkbox&&this.checkbox.attr("readonly",c),this.hours.attr("readonly",c),this.minutes.attr("readonly",c),this.seconds.attr("readonly",c),this.centiseconds.attr("readonly",c),this["in"]&&this["in"].attr("readonly",c),this},a}(),b.namespace("editor.panel").Block=function(){function a(b){a.parent.call(this,b),this.addClass("block")}return a.defaults={toolbarConfigs:{title:b.Locale.t("editor.panel.Block.title","Block"),menuItems:{synched:b.Locale.t("editor.panel.Block.menuItems.synched","Add a synchronized block"),"non-synched":b.Locale.t("editor.panel.Block.menuItems.non-synched","Add a non-synchronized block"),
"delete":b.Locale.t("editor.panel.Block.menuItems.delete","Delete the active block")}}},b.editor.Panel.extend(a),a}(),b.namespace("editor.panel").Element=function(){function a(b){a.parent.call(this,b),this.addClass("element")}return a.defaults={toolbarConfigs:{title:b.Locale.t("editor.panel.Element.title","Element"),menuItems:{Cursor:b.Locale.t("editor.panel.Element.menuItems.Cursor","Add a new cursor"),Image:b.Locale.t("editor.panel.Element.menuItems.Image","Add a new image"),Text:b.Locale.t("editor.panel.Element.menuItems.Text","Add a new text element"),"delete":b.Locale.t("editor.panel.Element.menuItems.delete","Delete the active element")}}},b.editor.Panel.extend(a),a.prototype.onFieldValueChange=function(b){var c=this.getComponent(),d=b.detail.field.data("name");c&&"Image"===c.getProperty("type")&&"background-image"===b.detail.field.data("name")&&this.onBeforeImageSet(d,b.detail.value),a.parent.prototype.onFieldValueChange.call(this,b)},a.prototype.onBeforeImageSet=function(a,b){var c,d,e=this,f=e.getComponent();c=f.getProperty(a),d=b,c?e.getImageMetadata(c,function(a){var b=f.getProperty("name"),c=f.getProperty("width"),g=f.getProperty("height");(a.name===b||a.width===c&&a.height===g)&&e.getImageMetadata(d,function(d){a.name===b&&e.updateFieldValue("name",d.name),a.width===c&&a.height===g&&(e.updateFieldValue("width",d.width),e.updateFieldValue("height",d.height))})}):e.getImageMetadata(d,function(a){e.updateFieldValue("name",a.name),e.updateFieldValue("width",a.width),e.updateFieldValue("height",a.height)})},a.prototype.getImageMetadata=function(a,c){var d=new b.Dom("<img/>").addListener("load",function(a){var b,e,f=d.get(0);(b=f.src.match(/([^/]*)\.[^.]*$/))&&(e=b[1]),c({name:e,width:f.naturalWidth,height:f.naturalHeight})}).attr("src",a)},a}(),b.namespace("editor.panel").Page=function(){function a(b){a.parent.call(this,b),this.addClass("page")}return a.defaults={toolbarConfigs:{title:b.Locale.t("editor.panel.Page.title","Page"),menuItems:{"new":b.Locale.t("editor.panel.Page.menuItems.new","Add a new page"),"delete":b.Locale.t("editor.panel.Page.menuItems.delete","Delete the active page")}}},b.editor.Panel.extend(a),a}(),b.namespace("editor.panel").Text=function(){function a(c){a.parent.call(this,c),this.addClass("text"),this.onComponentDblClick=b.Function.proxy(this.onComponentDblClick,this),this.onComponentContentsClick=b.Function.proxy(this.onComponentContentsClick,this),this.onComponentContentsKey=b.Function.proxy(this.onComponentContentsKey,this)}var c="componentset",d="componentunset",e="componentlock",f="componentunlock";return a.defaults={toolbarConfigs:{title:b.Locale.t("editor.panel.Text.title","Text"),buttons:[],selector:!1},properties:{locked:{type:"Boolean",configs:{label:b.Locale.t("editor.panel.Text.locked","Locked ?")},setter:function(a){a?this.lock():this.unlock()}}}},b.editor.Panel.extend(a),a.prototype.onFieldValueChange=function(a){var b,c,d=this.getComponent();d&&(b=a.detail.field.data("name"),c=a.detail.value,b in this.configs.properties&&"setter"in this.configs.properties[b]&&this.configs.properties[b].setter.call(this,c))},a.prototype.setComponent=function(a,b){if(a!==this.getComponent()){if(!a)return this.unsetComponent();this.unsetComponent(!0),this.component=a,this.setupFields(this.configs.properties).updateFieldValue("locked",!0).addClass("has-component"),b!==!0&&this.triggerEvent(c,{component:a},!1)}return this},a.prototype.unsetComponent=function(a){var b=this.getComponent();return this.lock().removeClass("has-component"),b&&(this.component=null,a!==!0&&this.triggerEvent(d,{component:b},!1)),this},a.prototype.lock=function(a){var c=this.getComponent();return c&&(c.addListener("dblclick",this.onComponentDblClick).removeClass("unlocked"),c.contents.attr("contenteditable",null).removeListener("click",this.onComponentContentsClick).removeListener("keydown",this.onComponentContentsKey).removeListener("keypress",this.onComponentContentsKey).removeListener("keyup",this.onComponentContentsKey),this.toggleFields(b.Array.remove(Object.keys(this.getField()),"locked"),!1),c._draggable&&c._draggable.enable(),c._resizable&&c._resizable.enable(),a!==!0&&this.triggerEvent(e,{component:c},!1)),this},a.prototype.unlock=function(a){var c=this.getComponent();return c&&(c._draggable&&c._draggable.disable(),c._resizable&&c._resizable.disable(),this.toggleFields(b.Array.remove(Object.keys(this.getField()),"locked"),!0),c.contents.attr("contenteditable","true").addListener("click",this.onComponentContentsClick).addListener("keydown",this.onComponentContentsKey).addListener("keypress",this.onComponentContentsKey).addListener("keyup",this.onComponentContentsKey),c.removeListener("dblclick",this.onComponentDblClick).addClass("unlocked"),a!==!0&&this.triggerEvent(f,{component:c},!1)),this},a.prototype.disable=function(){return this.lock(),a.parent.prototype.disable.call(this)},a.prototype.onComponentDblClick=function(a){this.updateFieldValue("locked",!1)},a.prototype.onComponentContentsClick=function(a){a.stopPropagation()},a.prototype.onComponentContentsKey=function(a){a.stopPropagation()},a}(),b.namespace("editor.panel").Toolbar=function(){function a(c){this.configs=this.getConfigs(c),a.parent.call(this,"<div/>",{"class":"toolbar clearfix"}),this.title=new b.Dom("<div/>",{"class":"title",text:this.configs.title}).appendTo(this),this.buttons=new b.Dom("<div/>",{"class":"buttons"}).appendTo(this),b.Array.each(this.configs.buttons,function(a,b){this.addButton(b)},this),this.configs.selector&&(this.selector=(new b.editor.field.Select).addClass("selector").appendTo(this)),b.Var.isEmpty(this.configs.menuItems)||(this.menu=new b.editor.DropDownMenu,b.Object.each(this.configs.menuItems,function(a,b){this.menu.addItem(a,b)},this),new b.Dom("<div/>",{"class":"menu"}).appendTo(this.buttons).append(this.menu))}return a.defaults={title:"",buttons:["previous","next"],selector:!0,menuItems:{}},b.Dom.extend(a),a.prototype.getTitle=function(){return this.title},a.prototype.getSelector=function(){return this.selector},a.prototype.getMenu=function(){return this.menu},a.prototype.addButton=function(a){var c=(new b.Button).data("action",a).appendTo(this.buttons);return c},a.prototype.getButton=function(a){return this.buttons.children('[data-action="'+a+'"]')},a.prototype.toggleMenuItem=function(a,b){var c=this.getMenu();return c&&c.toggleItem(a,b),this},a}(),b.namespace("editor.overlay").BorderRadius=function(){function a(b){this.configs=this.getConfigs(b),a.parent.call(this,this.configs),this.addClass("border-radius")}var c="submit";return a.defaults={parent:".metaScore-editor",toolbar:!0,title:b.Locale.t("editor.overlay.BorderRadius.title","Border Radius")},b.Overlay.extend(a),a.prototype.setupUI=function(){var c;a.parent.prototype.setupUI.call(this),c=this.getContents(),this.fields={},this.buttons={},this.preview=new b.Dom("<div/>",{"class":"preview"}).appendTo(c),this.fields.tlw=new b.editor.field.Number({min:0}).addClass("tlw").addListener("valuechange",b.Function.proxy(this.onValueChange,this)).appendTo(this.preview),this.fields.tlh=new b.editor.field.Number({min:0}).addListener("valuechange",b.Function.proxy(this.onValueChange,this)).addClass("tlh").appendTo(this.preview),this.fields.trw=new b.editor.field.Number({min:0}).addListener("valuechange",b.Function.proxy(this.onValueChange,this)).addClass("trw").appendTo(this.preview),this.fields.trh=new b.editor.field.Number({min:0}).addListener("valuechange",b.Function.proxy(this.onValueChange,this)).addClass("trh").appendTo(this.preview),this.fields.brw=new b.editor.field.Number({min:0}).addListener("valuechange",b.Function.proxy(this.onValueChange,this)).addClass("brw").appendTo(this.preview),this.fields.brh=new b.editor.field.Number({min:0}).addListener("valuechange",b.Function.proxy(this.onValueChange,this)).addClass("brh").appendTo(this.preview),this.fields.blw=new b.editor.field.Number({min:0}).addListener("valuechange",b.Function.proxy(this.onValueChange,this)).addClass("blw").appendTo(this.preview),this.fields.blh=new b.editor.field.Number({min:0}).addListener("valuechange",b.Function.proxy(this.onValueChange,this)).addClass("blh").appendTo(this.preview),this.buttons.apply=new b.Button({label:"Apply"}).addClass("apply").addListener("click",b.Function.proxy(this.onApplyClick,this)).appendTo(c),this.buttons.cancel=new b.Button({label:"Cancel"}).addClass("cancel").addListener("click",b.Function.proxy(this.onCancelClick,this)).appendTo(c)},a.prototype.onValueChange=function(){var a="";a+=this.fields.tlw.getValue()+"px ",a+=this.fields.trw.getValue()+"px ",a+=this.fields.brw.getValue()+"px ",a+=this.fields.blw.getValue()+"px ",a+="/ ",a+=this.fields.tlh.getValue()+"px ",a+=this.fields.trh.getValue()+"px ",a+=this.fields.brh.getValue()+"px ",a+=this.fields.blh.getValue()+"px",this.preview.css("border-radius",a)},a.prototype.setValue=function(a){var c,d={tlw:0,tlh:0,trw:0,trh:0,blw:0,blh:0,brw:0,brh:0};return this.preview.css("border-radius",a),(c=this.preview.css("border-top-left-radius",void 0,!0).match(/(\d*)px/g))&&(c.length>1?(d.tlw=c[0],d.tlh=c[1]):d.tlw=d.tlh=c[0]),(c=this.preview.css("border-top-right-radius",void 0,!0).match(/(\d*)px/g))&&(c.length>1?(d.trw=c[0],d.trh=c[1]):d.trw=d.trh=c[0]),(c=this.preview.css("border-bottom-left-radius",void 0,!0).match(/(\d*)px/g))&&(c.length>1?(d.blw=c[0],d.blh=c[1]):d.blw=d.blh=c[0]),(c=this.preview.css("border-bottom-right-radius",void 0,!0).match(/(\d*)px/g))&&(c.length>1?(d.brw=c[0],d.brh=c[1]):d.brw=d.brh=c[0]),b.Object.each(this.fields,function(a,b){b.setValue(parseInt(d[a],10),!0)}),this},a.prototype.getValue=function(){return this.preview.css("border-radius")},a.prototype.onApplyClick=function(a){this.triggerEvent(c,{overlay:this,value:this.getValue()},!0,!1),this.hide()},a.prototype.onCancelClick=a.prototype.onCloseClick,a}(),b.namespace("editor.overlay").ColorSelector=function(){function a(c){this.configs=this.getConfigs(c),this.onGradientMousemove=b.Function.proxy(this.onGradientMousemove,this),this.onAlphaMousemove=b.Function.proxy(this.onAlphaMousemove,this),a.parent.call(this,this.configs),this.addClass("color-selector")}var c="submit";return a.defaults={parent:".metaScore-editor",draggable:!1},b.Overlay.extend(a),a.prototype.setupUI=function(){a.parent.prototype.setupUI.call(this),this.gradient=new b.Dom("<div/>",{"class":"gradient"}).appendTo(this.contents),this.gradient.canvas=new b.Dom("<canvas/>",{width:"255",height:"255"}).addListener("click",b.Function.proxy(this.onGradientClick,this)).addListener("mousedown",b.Function.proxy(this.onGradientMousedown,this)).addListener("mouseup",b.Function.proxy(this.onGradientMouseup,this)).appendTo(this.gradient),this.gradient.position=new b.Dom("<div/>",{"class":"position"}).appendTo(this.gradient),this.alpha=new b.Dom("<div/>",{"class":"alpha"}).appendTo(this.contents),this.alpha.canvas=new b.Dom("<canvas/>",{width:"20",height:"255"}).addListener("click",b.Function.proxy(this.onAlphaClick,this)).addListener("mousedown",b.Function.proxy(this.onAlphaMousedown,this)).addListener("mouseup",b.Function.proxy(this.onAlphaMouseup,this)).appendTo(this.alpha),this.alpha.position=new b.Dom("<div/>",{"class":"position"}).appendTo(this.alpha),this.controls=new b.Dom("<div/>",{"class":"controls"}).appendTo(this.contents),this.controls.r=new b.Dom("<input/>",{type:"number",min:"0",max:"255",name:"r"}).addListener("input",b.Function.proxy(this.onControlInput,this)),new b.Dom("<div/>",{"class":"control-wrapper"}).append(new b.Dom("<label/>",{text:"R","for":"r"})).append(this.controls.r).appendTo(this.controls),this.controls.g=new b.Dom("<input/>",{type:"number",min:"0",max:"255",name:"g"}).addListener("input",b.Function.proxy(this.onControlInput,this)),new b.Dom("<div/>",{"class":"control-wrapper"}).append(new b.Dom("<label/>",{text:"G","for":"g"})).append(this.controls.g).appendTo(this.controls),this.controls.b=new b.Dom("<input/>",{type:"number",min:"0",max:"255",name:"b"}).addListener("input",b.Function.proxy(this.onControlInput,this)),new b.Dom("<div/>",{"class":"control-wrapper"}).append(new b.Dom("<label/>",{text:"B","for":"b"})).append(this.controls.b).appendTo(this.controls),this.controls.a=new b.Dom("<input/>",{type:"number",min:"0",max:"1",step:"0.01",name:"a"}).addListener("input",b.Function.proxy(this.onControlInput,this)),new b.Dom("<div/>",{"class":"control-wrapper"}).append(new b.Dom("<label/>",{text:"A","for":"a"})).append(this.controls.a).appendTo(this.controls),this.controls.current=new b.Dom("<canvas/>"),new b.Dom("<div/>",{"class":"canvas-wrapper current"}).append(this.controls.current).appendTo(this.controls),this.controls.previous=new b.Dom("<canvas/>"),new b.Dom("<div/>",{"class":"canvas-wrapper previous"}).append(this.controls.previous).appendTo(this.controls),this.controls.cancel=new b.Button({label:"Cancel"}).addClass("cancel").addListener("click",b.Function.proxy(this.onCancelClick,this)).appendTo(this.controls),this.controls.apply=new b.Button({label:"Apply"}).addClass("apply").addListener("click",b.Function.proxy(this.onApplyClick,this)).appendTo(this.controls),this.fillGradient()},a.prototype.setValue=function(a){return this.updateValue(a),this.previous_value=this.value,this.fillPrevious(),this},a.prototype.updateValue=function(a,c,d,e){var f;return this.value=this.value||{},b.Var.is(a,"object")||(a=b.Color.parse(a)),"r"in a&&(this.value.r=parseInt(a.r,10)),"g"in a&&(this.value.g=parseInt(a.g,10)),"b"in a&&(this.value.b=parseInt(a.b,10)),"a"in a&&(this.value.a=parseFloat(a.a)),c!==!1&&this.fillAlpha(),e!==!1&&(this.controls.r.val(this.value.r),this.controls.g.val(this.value.g),this.controls.b.val(this.value.b),this.controls.a.val(this.value.a)),d!==!1&&(f=b.Color.rgb2hsv(this.value),this.gradient.position.css("left",255*(1-f.h)+"px"),this.gradient.position.css("top",127.5*f.s+127.5*(1-f.v/255)+"px"),this.alpha.position.css("top",255*(1-this.value.a)+"px")),this.fillCurrent(),this},a.prototype.fillGradient=function(){var a,b=this.gradient.canvas.get(0).getContext("2d");return a=b.createLinearGradient(0,0,b.canvas.width,0),a.addColorStop(0,"rgb(255, 0, 0)"),a.addColorStop(.15,"rgb(255, 0, 255)"),a.addColorStop(.33,"rgb(0, 0, 255)"),a.addColorStop(.49,"rgb(0, 255, 255)"),a.addColorStop(.67,"rgb(0, 255, 0)"),a.addColorStop(.84,"rgb(255, 255, 0)"),a.addColorStop(1,"rgb(255, 0, 0)"),b.fillStyle=a,b.fillRect(0,0,b.canvas.width,b.canvas.height),a=b.createLinearGradient(0,0,0,b.canvas.height),a.addColorStop(0,"rgba(255, 255, 255, 1)"),a.addColorStop(.5,"rgba(255, 255, 255, 0)"),a.addColorStop(.5,"rgba(0, 0, 0, 0)"),a.addColorStop(1,"rgba(0, 0, 0, 1)"),b.fillStyle=a,b.fillRect(0,0,b.canvas.width,b.canvas.height),this},a.prototype.fillPrevious=function(){var a=this.controls.previous.get(0).getContext("2d");return a.fillStyle="rgba("+this.previous_value.r+","+this.previous_value.g+","+this.previous_value.b+","+this.previous_value.a+")",a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillRect(0,0,a.canvas.width,a.canvas.height),this},a.prototype.fillCurrent=function(){var a=this.controls.current.get(0).getContext("2d");return a.fillStyle="rgba("+this.value.r+","+this.value.g+","+this.value.b+","+this.value.a+")",a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillRect(0,0,a.canvas.width,a.canvas.height),this},a.prototype.fillAlpha=function(){var a,b=this.alpha.canvas.get(0).getContext("2d");return a=b.createLinearGradient(0,0,0,b.canvas.height),a.addColorStop(0,"rgb("+this.value.r+","+this.value.g+","+this.value.b+")"),a.addColorStop(1,"transparent"),b.fillStyle=a,b.clearRect(0,0,b.canvas.width,b.canvas.height),b.fillRect(0,0,b.canvas.width,b.canvas.height),this},a.prototype.onControlInput=function(a){this.updateValue({r:this.controls.r.val(),g:this.controls.g.val(),b:this.controls.b.val(),a:this.controls.a.val()},!0,!0,!1)},a.prototype.onGradientMousedown=function(a){this.gradient.canvas.addListener("mousemove",this.onGradientMousemove),a.stopPropagation()},a.prototype.onGradientMouseup=function(a){this.gradient.canvas.removeListener("mousemove",this.onGradientMousemove),a.stopPropagation()},a.prototype.onGradientClick=function(a){var b=a.target.getBoundingClientRect(),c=a.pageX-b.left,d=a.pageY-b.top,e=this.gradient.canvas.get(0).getContext("2d"),f=e.getImageData(c,d,1,1),g=this.value;this.gradient.position.css("left",c+"px"),this.gradient.position.css("top",d+"px"),g.r=f.data[0],g.g=f.data[1],g.b=f.data[2],g.a?this.updateValue(g,!0,!1):(g.a=1,this.updateValue(g,!0,!0)),a.stopPropagation()},a.prototype.onGradientMousemove=a.prototype.onGradientClick,a.prototype.onAlphaMousedown=function(a){this.alpha.canvas.addListener("mousemove",this.onAlphaMousemove),a.stopPropagation()},a.prototype.onAlphaMouseup=function(a){this.alpha.canvas.removeListener("mousemove",this.onAlphaMousemove),a.stopPropagation()},a.prototype.onAlphaClick=function(a){var b=a.target.getBoundingClientRect(),c=a.pageY-b.top,d=this.alpha.canvas.get(0).getContext("2d"),e=d.getImageData(0,c,1,1),f=this.value;this.alpha.position.css("top",c+"px"),f.a=Math.round(e.data[3]/255*100)/100,this.updateValue(f,!1,!1),a.stopPropagation()},a.prototype.onAlphaMousemove=a.prototype.onAlphaClick,a.prototype.onApplyClick=function(a){this.triggerEvent(c,{overlay:this,value:this.value},!0,!1),this.hide()},a.prototype.onCancelClick=function(a){this.hide()},a}(),b.namespace("editor.overlay").GuideDetails=function(){function a(b){this.configs=this.getConfigs(b),a.parent.call(this,this.configs),this.changed={},this.previous_values=null,this.addClass("guide-details")}var c="submit";return a.defaults={parent:".metaScore-editor",toolbar:!0,title:b.Locale.t("editor.overlay.GuideDetails.title","Guide Info"),groups:{},submit_text:b.Locale.t("editor.overlay.GuideDetails.submitText","Save")},b.Overlay.extend(a),a.prototype.setupUI=function(){var c,d;a.parent.prototype.setupUI.call(this),c=this.getContents(),this.fields={},d=new b.Dom("<form>").addListener("submit",b.Function.proxy(this.onFormSubmit,this)).appendTo(c),this.fields.type=new b.editor.field.Select({label:b.Locale.t("editor.overlay.GuideDetails.fields.type.label","Type"),options:{"":"",audio:b.Locale.t("editor.overlay.GuideDetails.fields.type.options.audio","Audio"),video:b.Locale.t("editor.overlay.GuideDetails.fields.type.options.video","Video")},required:!0}).data("name","type").addListener("valuechange",b.Function.proxy(this.onFieldValueChange,this)).appendTo(d),this.fields.title=new b.editor.field.Text({label:b.Locale.t("editor.overlay.GuideDetails.fields.title.label","Title"),required:!0}).data("name","title").addListener("valuechange",b.Function.proxy(this.onFieldValueChange,this)).appendTo(d),this.fields.description=new b.editor.field.Textarea({label:b.Locale.t("editor.overlay.GuideDetails.fields.description.label","Description")}).data("name","description").addListener("valuechange",b.Function.proxy(this.onFieldValueChange,this)).appendTo(d),this.fields.credits=new b.editor.field.Textarea({label:b.Locale.t("editor.overlay.GuideDetails.fields.credits.label","Credits")}).data("name","credits").addListener("valuechange",b.Function.proxy(this.onFieldValueChange,this)).appendTo(d),this.fields.thumbnail=new b.editor.field.File({label:b.Locale.t("editor.overlay.GuideDetails.fields.thumbnail.label","Thumbnail"),description:b.Locale.t("editor.overlay.GuideDetails.fields.thumbnail.description","Allowed file types: !types",{"!types":"png gif jpg jpeg"}),accept:".png,.gif,.jpg,.jpeg"}).data("name","thumbnail").addListener("valuechange",b.Function.proxy(this.onFieldValueChange,this)).appendTo(d),this.fields.media=new b.editor.field.File({label:b.Locale.t("editor.overlay.GuideDetails.fields.media.label","Media"),description:b.Locale.t("editor.overlay.GuideDetails.fields.media.description","Allowed file types: !types",{"!types":"mp4 m4v m4a mp3"}),accept:".mp4,.m4v,.m4a,.mp3"}).data("name","media").addListener("valuechange",b.Function.proxy(this.onFieldValueChange,this)).appendTo(d),this.fields.css=new b.editor.field.Textarea({label:b.Locale.t("editor.overlay.GuideDetails.fields.css.label","CSS")}).data("name","css").addListener("valuechange",b.Function.proxy(this.onFieldValueChange,this)).appendTo(d),b.Var.isEmpty(this.configs.groups)||(this.fields.groups=new b.editor.field.Select({label:b.Locale.t("editor.overlay.GuideDetails.fields.groups.label","Groups"),description:b.Locale.t("editor.overlay.GuideDetails.fields.groups.description","The groups this guide is shared with<br/><em>Hold down the Ctrl/Cmd key to select multiple groups</em>"),multiple:!0,options:this.configs.groups}).data("name","groups").addListener("valuechange",b.Function.proxy(this.onFieldValueChange,this)).appendTo(d)),new b.Button({label:this.configs.submit_text}).addClass("apply").appendTo(d),new b.Button({label:"Cancel"}).addClass("cancel").addListener("click",b.Function.proxy(this.onCancelClick,this)).appendTo(d),new b.Dom("<div/>",{"class":"info",text:b.Locale.t("editor.overlay.GuideDetails.info","The guide needs to be saved in order for applied changes to become permanent")}).appendTo(d)},a.prototype.getField=function(a){var b=this.fields;return a?b[a]:b},a.prototype.setValues=function(a,c){return b.Object.each(a,function(d,e){var f;d in this.fields&&(f=this.fields[d],"shared_with"===d&&(f.clear(),a.available_groups&&b.Object.each(a.available_groups,function(a,b){f.addOption(a,b)})),f.setValue(e,c))},this),this.previous_values=a,this},a.prototype.clearValues=function(a){return b.Object.each(this.fields,function(b,c){c.setValue(null,a)},this),this},a.prototype.getValues=function(){return b.Object.extend({},this.changed)},a.prototype.onFieldValueChange=function(a){var c,d=a.detail.field,e=a.detail.value,f=d.data("name");d instanceof b.editor.field.File?(c=d.getFile(0))?this.changed[f]={name:c.name,url:URL.createObjectURL(c),mime:c.type,object:c}:delete this.changed[f]:this.changed[f]=e},a.prototype.onFormSubmit=function(a){this.triggerEvent(c,{overlay:this,values:this.getValues()},!0,!1),a.preventDefault(),a.stopPropagation()},a.prototype.onCloseClick=function(a){this.previous_values&&this.clearValues(!0).setValues(this.previous_values,!0),this.hide(),a.preventDefault()},a.prototype.onCancelClick=a.prototype.onCloseClick,a}(),b.namespace("editor.overlay").GuideSelector=function(){function a(b){this.configs=this.getConfigs(b),a.parent.call(this,this.configs),this.addClass("guide-selector")}var c="submit";return a.defaults={parent:".metaScore-editor",toolbar:!0,title:b.Locale.t("editor.overlay.GuideSelector.title","Select a guide"),empty_text:b.Locale.t("editor.overlay.GuideSelector.emptyText","No guides available"),url:null},b.Overlay.extend(a),a.prototype.show=function(){return this.loadmask=new b.overlay.LoadMask({parent:this.configs.parent,autoShow:!0}),b.Ajax.get(this.configs.url,{success:b.Function.proxy(this.onLoadSuccess,this),error:b.Function.proxy(this.onLoadError,this)}),this},a.prototype.onLoadSuccess=function(a){var d,e,f,g,h,i,j=this.getContents(),k=JSON.parse(a.response),l=k.items;d=new b.Dom("<table/>",{"class":"guides"}).appendTo(j),b.Var.isEmpty(l)?j.text(this.configs.empty_text):b.Array.each(l,function(a,j){(j.permissions.update||j.permissions.clone)&&(e=new b.Dom("<tr/>",{"class":"guide guide-"+j.id}).appendTo(d),new b.Dom("<td/>",{"class":"thumbnail"}).append(new b.Dom("<img/>",{src:j.thumbnail?j.thumbnail.url:null})).appendTo(e),g=(new b.editor.field.Select).addClass("revisions"),"revisions"in j?(h={},b.Object.each(j.revisions,function(a,c){var d,e,f,i;switch(c.state){case 0:d="archives",e=b.Locale.t("editor.overlay.GuideSelector.archivesGroup","archives");break;case 1:d="published",e=b.Locale.t("editor.overlay.GuideSelector.publishedGroup","published");break;case 2:d="drafts",e=b.Locale.t("editor.overlay.GuideSelector.draftsGroup","drafts")}d in h||(h[d]=g.addGroup(e).addClass(d)),f=h[d],i=b.Locale.t("editor.overlay.GuideSelector.revisionText","!date by !author (!id:!vid)",{"!date":c.date,"!author":c.author,"!id":j.id,"!vid":a}),g.addOption(a,i,f)}),"latest_revision"in j&&g.setValue(j.latest_revision)):g.disable(),i=(new b.Button).setLabel(b.Locale.t("editor.overlay.GuideSelector.button","Select")).addListener("click",b.Function.proxy(function(a,b,d){this.triggerEvent(c,{overlay:this,guide:a,vid:b.getValue()},!0,!1),this.hide(),d.stopPropagation()},this,[j,g])).data("action","select"),f=new b.Dom("<div/>",{"class":"revision-wrapper"}).append(g).append(i),new b.Dom("<td/>",{"class":"details"}).append(new b.Dom("<h1/>",{"class":"title",text:j.title})).append(new b.Dom("<p/>",{"class":"description",text:j.description})).append(new b.Dom("<h2/>",{"class":"author",text:j.author})).append(f).appendTo(e))},this),this.loadmask.hide(),delete this.loadmask,this.configs.modal&&this.mask.appendTo(this.configs.parent),this.appendTo(this.configs.parent)},a.prototype.onLoadError=function(a){},a}(),a.metaScore=b}(this);
//# sourceMappingURL=metaScore.editor.min.js.map