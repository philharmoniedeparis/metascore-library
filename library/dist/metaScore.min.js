/*! metaScore - v0.0.1 - 2014-06-24 - Oussama Mubarak */
(function(t){"use strict";"function"!=typeof Object.create&&function(){var t=function(){};Object.create=function(e){if(arguments.length>1)throw Error("Second argument not supported");if(null===e)throw Error("Cannot set a null [[Prototype]]");if("object"!=typeof e)throw TypeError("Argument must be an object");return t.prototype=e,new t}}();var e={version:"0.0.1"};(function(t){function e(t){t.parent instanceof Function&&(e.apply(this,[t.parent]),this.super=i(this,n(this,this.constructor))),t.apply(this,arguments)}function i(t,e){for(var i in t)"super"!==i&&t[i]instanceof Function&&(e[i]=t[i].super||n(t,t[i]));return e}function n(t,e){var i=t.super;return e.super=function(){return t.super=i,e.apply(t,arguments)}}t.Base=function(){},t.Base.extend=function o(t){function n(){e!==arguments[0]&&(e.apply(this,[t]),i(this,this),this.initializer instanceof Function&&this.initializer.apply(this),this.constructor.apply(this,arguments))}return n.prototype=new this(e),n.prototype.constructor=n,n.toString=function(){return""+t},n.extend=function(e){return e.parent=t,o.apply(n,arguments)},n},t.Base=t.Base.extend(function(){this.constructor=function(){},this.initConfig=function(e){e=e||{},this.configs=this.defaults?t.Object.extend({},this.defaults,e):e}})})(e),e.Ajax=e.Base.extend(function(){}),e.Ajax.createXHR=function(){var t,e,i,n=["MSXML2.XMLHttp.5.0","MSXML2.XMLHttp.4.0","MSXML2.XMLHttp.3.0","MSXML2.XMLHttp","Microsoft.XMLHttp"];if("undefined"!=typeof XMLHttpRequest)return t=new XMLHttpRequest;if(window.ActiveXObject)for(e=0,i=n.length;i>e;e++)try{return t=new ActiveXObject(n[e])}catch(o){}throw Error("XMLHttp object could be created.")},e.Ajax.send=function(t,i){var n,o=e.Ajax.createXHR(),s=[],a={method:"GET",headers:[],async:!0,data:{},complete:null,success:null,error:null};return i=e.Object.extend(function(){},a,i),e.Object.each(i.data,function(t,e){s.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}),"POST"===i.method?(n=s.join("&"),i.headers["Content-type"]="application/x-www-form-urlencoded"):t+="?"+s.join("&"),o.open(i.method,t,i.async),e.Object.each(i.headers,function(t,e){o.setRequestHeader(t,e)}),o.onreadystatechange=function(){4===o.readyState&&(e.Var.is(i.complete,"function")&&i.complete(o),o.status>=200&&300>status||304===status?e.Var.is(i.success,"function")&&i.success(o):e.Var.is(i.error,"function")&&i.error(o))},o.send(n),o},e.Ajax.get=function(t,i){return e.Object.extend(i,{method:"GET"}),e.Ajax.send(t,i)},e.Ajax.post=function(t,i){return e.Object.extend(i,{method:"POST"}),e.Ajax.send(t,i)},e.Array=e.Base.extend(function(){}),e.Array.inArray=function(t,e){var i,n=0;if(e){if(e.indexOf)return e.indexOf(t);for(i=e.length;i>n;n++)if(n in e&&e[n]===t)return n}return-1},e.Array.copy=function(t){return[].concat(t)},e.Array.shuffle=function(t){var i=e.Array.copy(t);return i.sort(function(){return(0|3*Math.random())-1}),i},e.Array.unique=function(t){for(var e=[],i=t.length,n=0;i>n;n++){for(var o=n+1;i>o;o++)t[n]===t[o]&&(o=++n);e.push(t[n])}return e},e.Array.each=function(t,e,i){for(var n,o=0,s=t.length,a=void 0!==i;s>o&&(n=e.call(a?i:t[o],o,t[o]),n!==!1);o++);return t},e.Dom=e.Base.extend(function(){this.constructor=function(){var t;if(this.elements=[],arguments.length>0&&(t=e.Dom.elementsFromString.apply(this,arguments)||e.Dom.selectElements.apply(this,arguments))){for(var i=0;t.length>i;i++)this.elements[i]=t[i];arguments.length>1&&this.attr(arguments[1])}},this.get=function(t){return this.elements[t]},this.addClass=function(t){return e.Array.each(this.elements,function(i,n){e.Dom.addClass(n,t)},this),this},this.removeClass=function(t){return e.Array.each(this.elements,function(i,n){e.Dom.removeClass(n,t)},this),this},this.toggleClass=function(t){return e.Array.each(this.elements,function(i,n){e.Dom.toggleClass(n,t)},this),this},this.addListener=function(t,i,n){return e.Array.each(this.elements,function(o,s){e.Dom.addListener(s,t,i,n)},this),this},this.removeListener=function(t,i,n){return e.Array.each(this.elements,function(o,s){e.Dom.removeListener(s,t,i,n)},this),this},this.triggerEvent=function(t,i,n){e.Array.each(this.elements,function(o,s){e.Dom.triggerEvent(s,t,i,n)},this)},this.text=function(t){return void 0===t?e.Dom.text(this.get(0)):(e.Array.each(this.elements,function(i,n){e.Dom.text(n,t)},this),void 0)},this.val=function(t){return void 0===t?e.Dom.val(this.get(0)):(e.Array.each(this.elements,function(i,n){e.Dom.val(n,t)},this),void 0)},this.attr=function(t,i){return e.Array.each(this.elements,function(n,o){e.Dom.attr(o,t,i)},this),this},this.css=function(t,i){return e.Array.each(this.elements,function(n,o){e.Dom.css(o,t,i)},this),this},this.append=function(t){return t instanceof e.Dom&&(t=t.elements),e.Dom.append(this.get(0),t),this},this.appendTo=function(t){return t instanceof e.Dom||(t=new e.Dom(t)),t=t.get(0),e.Array.each(this.elements,function(i,n){e.Dom.append(t,n)},this),this},this.remove=function(){return e.Array.each(this.elements,function(t,i){e.Dom.remove(i)},this),this}}),e.Dom.stringRe=/^<(.)+>$/,e.Dom.camelRe=/-([\da-z])/gi,e.Dom.camelReplaceFn=function(t,e){return e.toUpperCase()},e.Dom.camel=function(t){return t.replace(this.camelRe,this.camelReplaceFn)},e.Dom.bubbleEvents={click:!0,submit:!0,mousedown:!0,mousemove:!0,mouseup:!0,mouseover:!0,mouseout:!0,transitionend:!0},e.Dom.selectElements=function(t,i){var n;return i||(i=document),n=e.Var.is(t,"string")?i.querySelectorAll(t):t.length?t:[t]},e.Dom.elementsFromString=function(t){var e,i,n,o={option:[1,"<select multiple='multiple'>","</select>"],optgroup:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tbody:[1,"<table>","</table>"],tfoot:[1,"<table>","</table>"],colgroup:[1,"<table>","</table>"],caption:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],th:[3,"<table><tbody><tr>","</tr></tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[1,"<div>","</div>"]},s=document.createElement("div"),a=/<\s*\w.*?>/g.exec(t);if(null!=a){for(e=a[0].replace(/</g,"").replace(/\/?>/g,""),i=o[e]||o._default,t=i[1]+t+i[2],s.innerHTML=t,n=i[0];n--;)s=s.lastChild;return s.childNodes}return null},e.Dom.hasClass=function(t,e){return t.classList.contains(e)},e.Dom.addClass=function(t,e){for(var i=e.split(" "),n=0,o=i.length;o>n;n++)t.classList.add(i[n])},e.Dom.removeClass=function(t,e){for(var i=e.split(" "),n=0,o=i.length;o>n;n++)t.classList.remove(i[n])},e.Dom.toggleClass=function(t,e){for(var i=e.split(" "),n=0,o=i.length;o>n;n++)t.classList.toggle(i[n])},e.Dom.addListener=function(t,i,n,o){return void 0===o&&(o=e.Dom.bubbleEvents.hasOwnProperty("type")?e.Dom.bubbleEvents[i]:!1),t.addEventListener(i,n,o)},e.Dom.removeListener=function(t,i,n,o){return void 0===o&&(o=e.Dom.bubbleEvents.hasOwnProperty("type")?e.Dom.bubbleEvents[i]:!1),t.removeEventListener(i,n,o)},e.Dom.triggerEvent=function(t,e,i,n){var o=document.createEvent("HTMLEvents");return o.initEvent(e,i,n),t.dispatchEvent(o)},e.Dom.text=function(t,e){return void 0!==e&&(t.innerHTML=e),t.innerHTML},e.Dom.val=function(t,e){return void 0!==e&&(t.value=e),t.value},e.Dom.attr=function(t,i,n){if(e.Var.is(i,"object"))e.Object.each(i,function(i,n){e.Dom.attr(t,i,n)},this);else switch(i){case"class":this.addClass(t,n);break;case"text":this.text(t,n);break;default:void 0!==n?t.setAttribute(i,n):t.removeAttribute(i)}},e.Dom.css=function(t,e,i){return e=this.camel(e),void 0!==i&&(t.style[e]=i),t.style[e]},e.Dom.append=function(t,i){e.Var.is(i,"array")||(i=[i]),e.Array.each(i,function(e,i){t.appendChild(i)},this)},e.Dom.remove=function(t){t.parentElement.removeChild(t)},e.Function=e.Base.extend(function(){}),e.Function.proxy=function(t,i){return e.Var.type(t,"function")?function(){return t.apply(i||this,arguments)}:void 0},e.Function.emptyFn=function(){},e.Object=e.Base.extend(function(){}),e.Object.extend=function(){for(var t,e,i,n,o=arguments[0]||{},s=1,a=arguments.length;a>s;s++)if(null!=(t=arguments[s]))for(e in t)i=o[e],n=t[e],i!==n&&void 0!==n&&(o[e]=n);return o},e.Object.each=function(t,e,i){var n,o,s=void 0!==i;for(n in t)if(t.hasOwnProperty(n)&&(o=e.call(s?i:t[n],n,t[n]),o===!1))break;return t},e.String=e.Base.extend(function(){}),e.String.capitalize=function(t){return t.replace(/(?:^|\s)\S/g,function(t){return t.toUpperCase()})},e.String.t=function(t){return t},e.String.uuid=function(t,e){var i,n=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],o=[];if(e=e||n.length,t)for(i=0;t>i;i++)o[i]=n[0|Math.random()*e];else{var s;for(o[8]=o[13]=o[18]=o[23]="-",o[14]="4",i=0;36>i;i++)o[i]||(s=0|16*Math.random(),o[i]=n[19===i?8|3&s:s])}return o.join("")},e.Var=e.Base.extend(function(){}),e.Var.classes2types={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},e.Var.type=function(t){return null==t?t+"":e.Var.classes2types[Object.prototype.toString.call(t)]||"object"},e.Var.is=function(t,i){return e.Var.type(t)===i.toLowerCase()},e.Media=e.Media||{},e.Media.CuePoint=e.Base.extend(function(){this.triggers=[],this.constructor=function(t){this.media=t,this.media.addEventListener("timeupdate",this.onMediaTimeUpdate)},this.onMediaTimeUpdate=function(t){var i,n;i=t.target,n=parseFloat(i.currentTime),e.Object.each(this.triggers,function(t,e){!e.timer&&n>=e.inTime-.5&&e.inTime>n&&this.setupTriggerTimer(e,1e3*(e.inTime-n))})},this.addTrigger=function(t){return this.triggers.push(t)-1},this.removeTrigger=function(t){var e=this.triggers[t];this.stopTrigger(e,!1),this.triggers.splice(t,1)},this.setupTriggerTimer=function(t,i){t.timer=setTimeout(e.Function.proxy(this.launchTrigger,this,t),i)},this.launchTrigger=function(t){t.hasOwnProperty("onStart")&&e.Var.is(t.onStart,"function")&&t.onStart(this.media)},this.stopTrigger=function(t,i){t.hasOwnProperty("timer")&&(clearTimeout(t.timer),delete t.timer),t.hasOwnProperty("interval")&&(clearInterval(t.interval),delete t.interval),i!==!1&&t.hasOwnProperty("onEnd")&&e.Var.is(t.onEnd,"function")&&t.onEnd(this.media)}}),e.Media=e.Media||{},e.Media.Element=e.Base.extend(function(){}),e.Player=e.Dom.extend(function(){this.constructor=function(t){this.super("<div/>",{"class":"metaScore-player"}),void 0!==t&&this.appendTo(t)}}),e.Editor=e.Dom.extend(function(){this.constructor=function(t){this.super("<div/>",{"class":"metaScore-editor"}),void 0!==t&&this.appendTo(t),this.setupUI()},this.setupUI=function(){this.workspace=new e.Dom("<div/>",{"class":"workspace"}).appendTo(this),this.mainmenu=(new e.Editor.MainMenu).appendTo(this),this.sidebar=(new e.Editor.Sidebar).appendTo(this),this.player=(new e.Player).appendTo(this.workspace),this.grid=new e.Dom("<div/>",{"class":"grid"}).appendTo(this.workspace)}}),e.Editor.Button=e.Dom.extend(function(){this.disabled=!1,this.defaults={label:null},this.constructor=function(t){var i=this;this.super("<button/>"),this.initConfig(t),this.configs.label&&(this.label=new e.Dom("<span/>",{"class":"label",text:this.configs.label}),this.append(this.label)),this.addListener("click",function(t){i.disabled&&t.stopPropagation()})},this.disable=function(){return this.disabled=!0,this.addClass("disabled"),this},this.enable=function(){return this.disabled=!1,this.removeClass("disabled"),this}}),e.Editor.Field=e.Dom.extend(function(){this.defaults={value:null,disabled:!1},this.tag="<input/>",this.attributes={type:"text","class":"field"},this.constructor=function(t){this.super(this.tag,this.attributes),this.initConfig(t),null!==this.configs.value&&this.setValue(this.configs.value),this.configs.disabled&&this.disable()},this.setValue=function(t){this.value=t,this.val(this.value)},this.disable=function(){return this.disabled=!0,this.addClass("disabled"),this.attr("disabled","disabled"),this},this.enable=function(){return this.disabled=!1,this.removeClass("disabled"),this.attr("disabled",null),this}}),e.Editor.MainMenu=e.Dom.extend(function(){this.constructor=function(){this.super("<div/>",{"class":"main-menu clearfix"}),this.setupUI()},this.setupUI=function(){var t,i;this.buttons={},t=new e.Dom("<div/>",{"class":"left"}).appendTo(this),i=new e.Dom("<div/>",{"class":"right"}).appendTo(this),this.buttons["new"]=(new e.Editor.Button).attr({"class":"new",title:e.String.t("New")}).appendTo(t),this.buttons.open=(new e.Editor.Button).attr({"class":"open",title:e.String.t("Open")}).appendTo(t),this.buttons.save=(new e.Editor.Button).attr({"class":"save",title:e.String.t("save")}).appendTo(t),this.buttons.download=(new e.Editor.Button).attr({"class":"download",title:e.String.t("download")}).appendTo(t),this.buttons["delete"]=(new e.Editor.Button).attr({"class":"delete",title:e.String.t("delete")}).appendTo(t),this.buttons.time=(new e.Editor.Field.TimeField).attr({"class":"time",title:e.String.t("time")}).appendTo(t),this.buttons.revert=(new e.Editor.Button).attr({"class":"revert",title:e.String.t("revert")}).appendTo(t),this.buttons.undo=(new e.Editor.Button).attr({"class":"undo",title:e.String.t("undo")}).appendTo(t),this.buttons.redo=(new e.Editor.Button).attr({"class":"redo",title:e.String.t("redo")}).disable().appendTo(t),this.buttons.edit=(new e.Editor.Button).attr({"class":"edit",title:e.String.t("edit")}).appendTo(i),this.buttons.grid=(new e.Editor.Button).attr({"class":"grid",title:e.String.t("grid")}).appendTo(i),this.buttons.settings=(new e.Editor.Button).attr({"class":"settings",title:e.String.t("settings")}).appendTo(i),this.buttons.help=(new e.Editor.Button).attr({"class":"help",title:e.String.t("help")}).appendTo(i)}}),e.Editor.Overlay=e.Dom.extend(function(){var t;this.defaults={value:null,disabled:!1,parent:"body",modal:!0},this.constructor=function(i){this.super("<div/>",{"class":"overlay clearfix"}),this.initConfig(i),this.configs.modal&&(t=new e.Dom("<div/>",{"class":"mask"}).appendTo(this))},this.show=function(){this.appendTo(this.configs.parent)},this.hide=function(){this.remove()}}),e.Editor.Panel=e.Dom.extend(function(){this.defaults={title:"",fields:{}},this.constructor=function(t){this.super("<div/>",{"class":"panel"}),this.initConfig(t),this.setupUI()},this.setupUI=function(){this.toolbar=new e.Dom("<div/>",{"class":"toolbar"}).appendTo(this),this.toolbar.title=new e.Dom("<div/>",{"class":"title"}).appendTo(this.toolbar).addListener("click",e.Function.proxy(this.toggleState,this)),this.toolbar.buttons=new e.Dom("<div/>",{"class":"buttons"}).appendTo(this.toolbar),this.setTitle(this.configs.title),this.contents=new e.Dom("<table/>",{"class":"fields"}).appendTo(this),this.setupFields()},this.setupFields=function(){var t,i,n;this.fields={},e.Object.each(this.configs.fields,function(o,s){t=new e.Dom("<tr/>",{"class":"field-wrapper"}).appendTo(this.contents),i="field-"+e.String.uuid(5),this.fields[o]=n=(new s.type).attr("id",i),new e.Dom("<td/>").appendTo(t).append(new e.Dom("<label/>",{text:s.label,"for":i})),new e.Dom("<td/>").appendTo(t).append(n)},this)},this.setTitle=function(t){this.toolbar.title.text(t)},this.toggleState=function(){this.toggleClass("collapsed")}}),e.Editor.Sidebar=e.Dom.extend(function(){this.constructor=function(){this.super("<div/>",{"class":"sidebar"}),this.addPanels()},this.addPanels=function(){(new e.Editor.Panel.Block).appendTo(this),(new e.Editor.Panel.Page).appendTo(this),(new e.Editor.Panel.Element).appendTo(this),(new e.Editor.Panel.Text).appendTo(this)}}),e.Editor.Field.BooleanField=e.Editor.Field.extend(function(){this.defaults={value:!0,disabled:!1},this.attributes={type:"checkbox","class":"field booleanfield"},this.constructor=function(t){this.super(t)}}),e.Editor.Field.ColorField=e.Editor.Field.extend(function(){var t;this.defaults={value:{r:255,g:255,b:255,a:1},disabled:!1},this.tag="<div/>",this.attributes={"class":"field colorfield"},this.constructor=function(i){t=new e.Editor.Overlay({parent:".metaScore-editor",modal:!1}).addClass("colorfield-overlay"),t.gradient=new e.Dom("<div/>",{"class":"gradient"}).appendTo(t),t.gradient.canvas=new e.Dom("<canvas/>",{width:"255",height:"255"}).addListener("click",this.onGradientClick).addListener("mousedown",this.onGradientMousedown).addListener("mouseup",this.onGradientMouseup).appendTo(t.gradient),t.gradient.position=new e.Dom("<div/>",{"class":"position"}).appendTo(t.gradient),t.alpha=new e.Dom("<div/>",{"class":"alpha"}).appendTo(t),t.alpha.canvas=new e.Dom("<canvas/>",{width:"20",height:"255"}).addListener("click",this.onAlphaClick).addListener("mousedown",this.onAlphaMousedown).addListener("mouseup",this.onAlphaMouseup).appendTo(t.alpha),t.alpha.position=new e.Dom("<div/>",{"class":"position"}).appendTo(t.alpha),t.controls=new e.Dom("<div/>",{"class":"controls"}).appendTo(t),t.controls.r=new e.Dom("<input/>",{type:"number",min:"0",max:"255",name:"r"}),new e.Dom("<div/>",{"class":"control-wrapper"}).append(new e.Dom("<label/>",{text:"R","for":"r"})).append(t.controls.r).appendTo(t.controls),t.controls.g=new e.Dom("<input/>",{type:"number",min:"0",max:"255",name:"g"}),new e.Dom("<div/>",{"class":"control-wrapper"}).append(new e.Dom("<label/>",{text:"G","for":"g"})).append(t.controls.g).appendTo(t.controls),t.controls.b=new e.Dom("<input/>",{type:"number",min:"0",max:"255",name:"b"}),new e.Dom("<div/>",{"class":"control-wrapper"}).append(new e.Dom("<label/>",{text:"B","for":"b"})).append(t.controls.b).appendTo(t.controls),t.controls.a=new e.Dom("<input/>",{type:"number",min:"0",max:"255",name:"a"}),new e.Dom("<div/>",{"class":"control-wrapper"}).append(new e.Dom("<label/>",{text:"A","for":"a"})).append(t.controls.a).appendTo(t.controls),t.controls.current=new e.Dom("<canvas/>",{width:"100",height:"50"}).appendTo(t.controls),t.controls.previous=new e.Dom("<canvas/>",{width:"100",height:"25"}).appendTo(t.controls),t.controls.cancel=new e.Editor.Button({label:"Cancel"}).appendTo(t.controls),t.controls.apply=new e.Editor.Button({label:"Apply"}).appendTo(t.controls),this.super(i),this.fillGradient(),this.addListener("click",this.onClick)},this.setValue=function(e,i){this.value=e,t.controls.r.val(this.value.r),t.controls.g.val(this.value.g),t.controls.b.val(this.value.b),t.controls.a.val(this.value.a),i!==!1&&this.fillAlpha(),this.fillCurrent()},this.onClick=function(){this.previous_value=this.value,this.fillPrevious(),t.show()},this.fillPrevious=function(){var e=t.controls.previous.get(0).getContext("2d");e.fillStyle="rgba("+this.previous_value.r+","+this.previous_value.g+","+this.previous_value.b+","+this.previous_value.a+")",e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillRect(0,0,e.canvas.width,e.canvas.height)},this.fillCurrent=function(){var e=t.controls.current.get(0).getContext("2d");e.fillStyle="rgba("+this.value.r+","+this.value.g+","+this.value.b+","+this.value.a+")",e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillRect(0,0,e.canvas.width,e.canvas.height)},this.fillGradient=function(){var e,i=t.gradient.canvas.get(0).getContext("2d");e=i.createLinearGradient(0,0,i.canvas.width,0),e.addColorStop(0,"rgb(255, 0, 0)"),e.addColorStop(.15,"rgb(255, 0, 255)"),e.addColorStop(.33,"rgb(0, 0, 255)"),e.addColorStop(.49,"rgb(0, 255, 255)"),e.addColorStop(.67,"rgb(0, 255, 0)"),e.addColorStop(.84,"rgb(255, 255, 0)"),e.addColorStop(1,"rgb(255, 0, 0)"),i.fillStyle=e,i.fillRect(0,0,i.canvas.width,i.canvas.height),e=i.createLinearGradient(0,0,0,i.canvas.height),e.addColorStop(0,"rgba(255, 255, 255, 1)"),e.addColorStop(.5,"rgba(255, 255, 255, 0)"),e.addColorStop(.5,"rgba(0, 0, 0, 0)"),e.addColorStop(1,"rgba(0, 0, 0, 1)"),i.fillStyle=e,i.fillRect(0,0,i.canvas.width,i.canvas.height)},this.fillAlpha=function(){var e,i=t.alpha.canvas.get(0).getContext("2d");e=i.createLinearGradient(0,0,0,i.canvas.height),e.addColorStop(0,"rgb("+this.value.r+","+this.value.g+","+this.value.b+")"),e.addColorStop(1,"transparent"),i.fillStyle=e,i.clearRect(0,0,i.canvas.width,i.canvas.height),i.fillRect(0,0,i.canvas.width,i.canvas.height)},this.onGradientMousedown=function(){t.gradient.canvas.addListener("mousemove",this.onGradientMousemove)},this.onGradientMouseup=function(){t.gradient.canvas.removeListener("mousemove",this.onGradientMousemove)},this.onGradientClick=this.onGradientMousemove=function(e){var i=e.target.getBoundingClientRect(),n=e.pageX-i.left,o=e.pageY-i.top,s=t.gradient.canvas.get(0).getContext("2d"),a=s.getImageData(n,o,1,1),r=this.value;t.gradient.position.css("left",n+"px"),t.gradient.position.css("top",o+"px"),r.r=a.data[0],r.g=a.data[1],r.b=a.data[2],this.setValue(r)},this.onAlphaMousedown=function(){t.alpha.canvas.addListener("mousemove",this.onAlphaMousemove)},this.onAlphaMouseup=function(){t.alpha.canvas.removeListener("mousemove",this.onAlphaMousemove)},this.onAlphaClick=this.onAlphaMousemove=function(e){var i=e.target.getBoundingClientRect(),n=e.pageY-i.top,o=t.alpha.canvas.get(0).getContext("2d"),s=o.getImageData(0,n,1,1),a=this.value;t.alpha.position.css("top",n+"px"),a.a=Math.round(100*(s.data[3]/255))/100,this.setValue(a,!1)}}),e.Editor.Field.CornerField=e.Editor.Field.extend(function(){this.defaults={value:null,disabled:!1},this.constructor=function(t){this.super(t)}}),e.Editor.Field.ImageField=e.Editor.Field.extend(function(){this.defaults={value:null,disabled:!1},this.constructor=function(t){this.super(t)}}),e.Editor.Field.IntegerField=e.Editor.Field.extend(function(){this.defaults={value:0,disabled:!1,min:null,max:null},this.attributes={type:"number","class":"field integerfield"},this.constructor=function(t){this.super(t)}}),e.Editor.Field.TimeField=e.Editor.Field.extend(function(){var t,i,n,o;this.defaults={value:0,disabled:!1,min:null,max:null},this.tag="<div/>",this.attributes={"class":"field timefield"},this.constructor=function(s){t=new e.Dom("<input/>",{type:"number","class":"hours"}),i=new e.Dom("<input/>",{type:"number","class":"minutes"}),n=new e.Dom("<input/>",{type:"number","class":"seconds"}),o=new e.Dom("<input/>",{type:"number","class":"centiseconds"}),this.super(s),t.addListener("input",this.onInput).appendTo(this),new e.Dom("<span/>",{text:":","class":"separator"}).appendTo(this),i.addListener("input",this.onInput).appendTo(this),new e.Dom("<span/>",{text:":","class":"separator"}).appendTo(this),n.addListener("input",this.onInput).appendTo(this),new e.Dom("<span/>",{text:".","class":"separator"}).appendTo(this),o.addListener("input",this.onInput).appendTo(this)},this.onInput=function(e){var s=parseInt(o.val(),10),a=parseInt(n.val(),10),r=parseInt(i.val(),10),l=parseInt(t.val(),10);e.stopPropagation(),this.setValue(10*s+1e3*a+6e4*r+36e5*l)},this.setValue=function(e){var s,a,r,l;this.value=e,null!==this.configs.min&&(this.value=Math.max(this.value,this.configs.min)),null!==this.configs.max&&(this.value=Math.min(this.value,this.configs.max)),s=parseInt(this.value/10%100,10),a=parseInt(this.value/1e3%60,10),r=parseInt(this.value/6e4%60,10),l=parseInt(this.value/36e5,10),o.val(s),n.val(a),i.val(r),t.val(l),this.triggerEvent("change",!0,!1)},this.getValue=function(){return this.value},this.disable=function(){return this.disabled=!0,t.attr("disabled","disabled"),i.attr("disabled","disabled"),n.attr("disabled","disabled"),o.attr("disabled","disabled"),this.addClass("disabled"),this},this.enable=function(){return this.disabled=!1,t.attr("disabled",null),i.attr("disabled",null),n.attr("disabled",null),o.attr("disabled",null),this.removeClass("disabled"),this}}),e.Editor.Panel.Block=e.Editor.Panel.extend(function(){this.defaults={title:"Block",fields:{x:{type:e.Editor.Field.IntegerField,label:"X"},y:{type:e.Editor.Field.IntegerField,label:"Y"},width:{type:e.Editor.Field.IntegerField,label:"Width"},height:{type:e.Editor.Field.IntegerField,label:"Height"},bg_color:{type:e.Editor.Field.ColorField,label:"Background color"},bg_image:{type:e.Editor.Field.ImageField,label:"Background image"},synched:{type:e.Editor.Field.BooleanField,label:"Synchronized pages ?"}}}}),e.Editor.Panel.Element=e.Editor.Panel.extend(function(){this.defaults={title:"Element",fields:{x:{type:e.Editor.Field.IntegerField,label:"X"},y:{type:e.Editor.Field.IntegerField,label:"Y"},width:{type:e.Editor.Field.IntegerField,label:"Width"},height:{type:e.Editor.Field.IntegerField,label:"Height"},r_index:{type:e.Editor.Field.IntegerField,configs:{min:0},label:"Reading index"},z_index:{type:e.Editor.Field.IntegerField,label:"Display index"},bg_color:{type:e.Editor.Field.ColorField,label:"Background color"},bg_image:{type:e.Editor.Field.ImageField,label:"Background image"},border_width:{type:e.Editor.Field.IntegerField,label:"Border width"},border_color:{type:e.Editor.Field.ColorField,label:"Border color"},rounded_conrners:{type:e.Editor.Field.CornerField,label:"Rounded conrners"},start_time:{type:e.Editor.Field.TimeField,label:"Start time"},end_time:{type:e.Editor.Field.TimeField,label:"End time"}}}}),e.Editor.Panel.Page=e.Editor.Panel.extend(function(){this.defaults={title:"Page",fields:{bg_color:{type:e.Editor.Field.ColorField,label:"Background color"},bg_image:{type:e.Editor.Field.ImageField,label:"Background image"},start_time:{type:e.Editor.Field.TimeField,label:"Start time"},end_time:{type:e.Editor.Field.TimeField,label:"End time"}}}}),e.Editor.Panel.Text=e.Editor.Panel.extend(function(){this.defaults={title:"Text",fields:{x:{type:e.Editor.Field.IntegerField,label:"X"},y:{type:e.Editor.Field.IntegerField,label:"Y"},endtime:{type:e.Editor.Field.TimeField,label:"End time"}}}}),t.metaScore=e})(this);