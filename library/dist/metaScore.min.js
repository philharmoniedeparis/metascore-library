/*! metaScore - v0.0.1 - 2014-06-20 - Oussama Mubarak */
(function(t){"function"!=typeof Object.create&&function(){var t=function(){};Object.create=function(e){if(arguments.length>1)throw Error("Second argument not supported");if(null===e)throw Error("Cannot set a null [[Prototype]]");if("object"!=typeof e)throw TypeError("Argument must be an object");return t.prototype=e,new t}}();(function(t){t.metaScore={version:"0.0.1"}})(t),function(t){var e=t.metaScore;e.Base={inheritableStatics:["inheritableStatics","extend","create"],extend:function(t){var n,i,s,a;if(n=function(){},n.prototype=Object.create(this.prototype),n.prototype.$super=this,this.hasOwnProperty("inheritableStatics"))for(i=0,s=this.inheritableStatics.length;s>i;i++)a=this.inheritableStatics[i],this.hasOwnProperty(a)&&e.Base.addStatic.call(n,a,this[a]);for(a in t)t.hasOwnProperty(a)&&("statics"===a?e.Base.addStatics.call(n,t.statics):e.Base.addPrototype.call(n,a,t[a]));return n},create:function(){var t=Object.create(this.prototype);return"function"==typeof t.init&&t.init.apply(t,arguments),t},addStatics:function(t){var n;for(n in t)t.hasOwnProperty(n)&&e.Base.addStatic.call(this,n,t[n])},addStatic:function(t,e){this[t]=e,"function"==typeof e&&(this[t].$name=t)},addPrototypes:function(t){var n;for(n in t)t.hasOwnProperty(n)&&e.Base.addPrototype.call(this,n,t[n])},addPrototype:function(t,e){this.prototype[t]=e,"function"==typeof e&&(this.prototype[t].$name=t)}},e.Base.prototype={callSuper:function(){var t,e,n;this.$super&&(t=this.callSuper.caller,e=t.$name,e&&this.$super.prototype.hasOwnProperty(e)?n=this.$super.prototype[e]:e||t!==this.constructor||(n=this.$super.constructor),n&&n.apply(this,arguments))},initConfig:function(t){t=t||{},this.configs=this.defaults?e.Object.extend({},this.defaults,t):t}}}(t),function(t){var e=t.metaScore;e.Ajax=e.Base.extend({statics:{defaults:{method:"GET",headers:[],async:!0,data:{},complete:null,success:null,error:null},activeX:["MSXML2.XMLHttp.5.0","MSXML2.XMLHttp.4.0","MSXML2.XMLHttp.3.0","MSXML2.XMLHttp","Microsoft.XMLHttp"],createXHR:function(){var t,n,i;if("undefined"!=typeof XMLHttpRequest)return t=new XMLHttpRequest;if(window.ActiveXObject)for(n=0,i=e.Ajax.activeX.length;i>n;n++)try{return t=new ActiveXObject(e.Ajax.activeX[n])}catch(s){}throw Error("XMLHttp object could be created.")},send:function(t,n){var i,s=e.Ajax.createXHR(),a=[];return n=e.Object.extend({},e.Ajax.defaults,n),e.Object.each(n.data,function(t,e){a.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}),"POST"===n.method?(i=a.join("&"),n.headers["Content-type"]="application/x-www-form-urlencoded"):t+="?"+a.join("&"),s.open(n.method,t,n.async),e.Object.each(n.headers,function(t,e){s.setRequestHeader(t,e)}),s.onreadystatechange=function(){4===s.readyState&&(e.Var.is(n.complete,"function")&&n.complete(s),s.status>=200&&300>status||304===status?e.Var.is(n.success,"function")&&n.success(s):e.Var.is(n.error,"function")&&n.error(s))},s.send(i),s},get:function(t,n){return e.Object.extend(n,{method:"GET"}),e.Ajax.send(t,n)},post:function(t,n){return e.Object.extend(n,{method:"POST"}),e.Ajax.send(t,n)}}})}(t),function(t){var e=t.metaScore;e.Array=e.Base.extend({statics:{inArray:function(t,e){var n,i=0;if(e){if(e.indexOf)return e.indexOf(t);for(n=e.length;n>i;i++)if(i in e&&e[i]===t)return i}return-1},copy:function(t){return[].concat(t)},shuffle:function(t){var n=e.Array.copy(t);return n.sort(function(){return(0|3*Math.random())-1}),n},unique:function(t){for(var e=[],n=t.length,i=0;n>i;i++){for(var s=i+1;n>s;s++)t[i]===t[s]&&(s=++i);e.push(t[i])}return e},each:function(t,e,n){for(var i,s=0,a=t.length,r=void 0!==n;a>s&&(i=e.call(r?n:t[s],s,t[s]),i!==!1);s++);return t}}})}(t),function(t){var e=t.metaScore;e.Dom=e.Base.extend({statics:{stringRe:/^<(.)+>$/,camelRe:/-([\da-z])/gi,camelReplaceFn:function(t,e){return e.toUpperCase()},camel:function(t){return t.replace(this.camelRe,this.camelReplaceFn)},bubbleEvents:{click:!0,submit:!0,mousedown:!0,mousemove:!0,mouseup:!0,mouseover:!0,mouseout:!0,transitionend:!0},selectElements:function(t,n){var i;return n||(n=document),i=e.Var.is(t,"string")?n.querySelectorAll(t):t.length?t:[t]},elementsFromString:function(t){var n;return e.Var.is(t,"string")&&t.match(/^<(.)+>$/)?(n=document.createElement("div"),n.innerHTML=t,n.childNodes):null},hasClass:function(t,e){return t.classList.contains(e)},addClass:function(t,e){for(var n=e.split(" "),i=0,s=n.length;s>i;i++)t.classList.add(n[i])},removeClass:function(t,e){for(var n=e.split(" "),i=0,s=n.length;s>i;i++)t.classList.remove(n[i])},toggleClass:function(t,e){for(var n=e.split(" "),i=0,s=n.length;s>i;i++)t.classList.toggle(n[i])},addListener:function(t,n,i,s){return void 0===s&&(s=e.Dom.bubbleEvents.hasOwnProperty("type")?e.Dom.bubbleEvents[n]:!1),t.addEventListener(n,i,s)},triggerEvent:function(t,e,n,i){var s=document.createEvent("HTMLEvents");return s.initEvent(e,n,i),t.dispatchEvent(s)},removeListener:function(t,n,i,s){return void 0===s&&(s=e.Dom.bubbleEvents.hasOwnProperty("type")?e.Dom.bubbleEvents[n]:!1),t.removeEventListener(n,i,s)},text:function(t,e){return void 0!==e&&(t.innerHTML=e),t.innerHTML},val:function(t,e){return void 0!==e&&(t.value=e),t.value},attr:function(t,n,i){if(e.Var.is(n,"object"))e.Object.each(n,function(n,i){e.Dom.attr(t,n,i)},this);else switch(n){case"class":this.addClass(t,i);break;case"text":this.text(t,i);break;default:void 0!==i?t.setAttribute(n,i):t.removeAttribute(n)}},css:function(t,e,n){return e=this.camel(e),void 0!==n&&(t.style[e]=n),t.style[e]},append:function(t,n){e.Var.is(n,"array")||(n=[n]),e.Array.each(n,function(e,n){t.appendChild(n)},this)},remove:function(t){t.parentElement.removeChild(t)}},init:function(){var t;if(this.elements=[],arguments.length>0&&(t=e.Dom.elementsFromString(arguments[0])||e.Dom.selectElements.apply(this,arguments))){for(var n=0;t.length>n;n++)this.elements[n]=t[n];arguments.length>1&&this.attr(arguments[1])}},get:function(t){return this.elements[t]},addClass:function(t){return e.Array.each(this.elements,function(n,i){e.Dom.addClass(i,t)},this),this},removeClass:function(t){return e.Array.each(this.elements,function(n,i){e.Dom.removeClass(i,t)},this),this},toggleClass:function(t){return e.Array.each(this.elements,function(n,i){e.Dom.toggleClass(i,t)},this),this},addListener:function(t,n,i){return e.Array.each(this.elements,function(s,a){e.Dom.addListener(a,t,n,i)},this),this},triggerEvent:function(t,n,i){e.Array.each(this.elements,function(s,a){e.Dom.triggerEvent(a,t,n,i)},this)},text:function(t){return void 0===t?e.Dom.text(this.get(0)):(e.Array.each(this.elements,function(n,i){e.Dom.text(i,t)},this),void 0)},val:function(t){return void 0===t?e.Dom.val(this.get(0)):(e.Array.each(this.elements,function(n,i){e.Dom.val(i,t)},this),void 0)},attr:function(t,n){return e.Array.each(this.elements,function(i,s){e.Dom.attr(s,t,n)},this),this},css:function(t,n){return e.Array.each(this.elements,function(i,s){e.Dom.css(s,t,n)},this),this},append:function(t){return t instanceof e.Dom&&(t=t.elements),e.Dom.append(this.get(0),t),this},appendTo:function(t){return t instanceof e.Dom||(t=e.Dom.create(t)),t=t.get(0),e.Array.each(this.elements,function(n,i){e.Dom.append(t,i)},this),this},remove:function(){return e.Array.each(this.elements,function(t,n){e.Dom.remove(n)},this),this}})}(t),function(t){var e=t.metaScore;e.Function=e.Base.extend({statics:{proxy:function(t,n){return e.Var.type(t,"function")?function(){return t.apply(n||this,arguments)}:void 0},emptyFn:function(){}}})}(t),function(t){var e=t.metaScore;e.Object=e.Base.extend({statics:{extend:function(){for(var t,e,n,i,s=arguments[0]||{},a=1,r=arguments.length;r>a;a++)if(null!=(t=arguments[a]))for(e in t)n=s[e],i=t[e],n!==i&&void 0!==i&&(s[e]=i);return s},each:function(t,e,n){var i,s,a=void 0!==n;for(i in t)if(t.hasOwnProperty(i)&&(s=e.call(a?n:t[i],i,t[i]),s===!1))break;return t}}})}(t),function(t){var e=t.metaScore;e.String=e.Base.extend({statics:{capitalize:function(t){return t.replace(/(?:^|\s)\S/g,function(t){return t.toUpperCase()})},t:function(t){return t},uuid:function(t,e){var n,i=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],s=[];if(e=e||i.length,t)for(n=0;t>n;n++)s[n]=i[0|Math.random()*e];else{var a;for(s[8]=s[13]=s[18]=s[23]="-",s[14]="4",n=0;36>n;n++)s[n]||(a=0|16*Math.random(),s[n]=i[19===n?8|3&a:a])}return s.join("")}}})}(t),function(t){var e=t.metaScore;e.Var=e.Base.extend({statics:{classes2types:{"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},type:function(t){return null==t?t+"":e.Var.classes2types[Object.prototype.toString.call(t)]||"object"},is:function(t,n){return e.Var.type(t)===n.toLowerCase()}}})}(t),function(t){var e=t.metaScore;e.Form=e.Form||{},e.Form.Button=e.Dom.extend({disabled:!1,defaults:{label:null},init:function(t){var n=this;this.initConfig(t),this.callSuper("<button/>"),this.configs.label&&(this.label=e.Dom.create("<span/>",{"class":"label",text:this.configs.label}),this.append(this.label)),this.addListener("click",function(t){n.disabled&&t.stopPropagation()})},disable:function(){return this.addClass("disabled"),this.disabled=!0,this},enable:function(){return this.removeClass("disabled"),this.disabled=!1,this}})}(t),function(t){var e=t.metaScore;e.Form=e.Form||{},e.Form.IntegerField=e.Dom.extend({disabled:!1,value:0,defaults:{min:null,max:null},init:function(t){var n=e.Function.proxy(this.onInput,this);this.initConfig(t),this.callSuper("<input/>",{type:"number","class":"field integerfield",size:2,value:0}),this.addListener("input",n),this.el=this.get(0)},onInput:function(t){t.stopPropagation(),this.triggerEvent("change",!0,!1)},disable:function(){return this.addClass("disabled"),this.disabled=!0,this},enable:function(){return this.removeClass("disabled"),this.disabled=!1,this}})}(t),function(t){var e=t.metaScore;e.Form=e.Form||{},e.Form.TimeField=e.Dom.extend({disabled:!1,value:0,defaults:{min:0,max:null},init:function(t){var n=e.Function.proxy(this.onInput,this);this.initConfig(t),this.callSuper("<div/>",{"class":"field timefield"}),this.el=this.get(0),this.hours=e.Dom.create("<input/>",{type:"number","class":"hours",size:2,maxlength:3,value:0}).addListener("input",n).appendTo(this),e.Dom.create("<span/>",{text:":","class":"separator"}).appendTo(this),this.minutes=e.Dom.create("<input/>",{type:"number","class":"minutes",size:2,maxlength:3,value:0}).addListener("input",n).appendTo(this),e.Dom.create("<span/>",{text:":","class":"separator"}).appendTo(this),this.seconds=e.Dom.create("<input/>",{type:"number","class":"seconds",size:2,maxlength:3,value:0}).addListener("input",n).appendTo(this),e.Dom.create("<span/>",{text:".","class":"separator"}).appendTo(this),this.centiseconds=e.Dom.create("<input/>",{type:"number","class":"centiseconds",size:2,maxlength:2,value:0}).addListener("input",n).appendTo(this)},onInput:function(t){var e=parseInt(this.centiseconds.val(),10),n=parseInt(this.seconds.val(),10),i=parseInt(this.minutes.val(),10),s=parseInt(this.hours.val(),10);t.stopPropagation(),this.setValue(10*e+1e3*n+6e4*i+36e5*s)},setValue:function(t){var e,n,i,s;this.value=t,null!==this.configs.min&&(this.value=Math.max(this.value,this.configs.min)),null!==this.configs.max&&(this.value=Math.min(this.value,this.configs.max)),e=parseInt(this.value/10%100,10),n=parseInt(this.value/1e3%60,10),i=parseInt(this.value/6e4%60,10),s=parseInt(this.value/36e5,10),this.centiseconds.val(e),this.seconds.val(n),this.minutes.val(i),this.hours.val(s),this.triggerEvent("change",!0,!1)},getValue:function(){return this.value},disable:function(){return this.addClass("disabled"),this.disabled=!0,this},enable:function(){return this.removeClass("disabled"),this.disabled=!1,this}})}(t),function(t){var e=t.metaScore;e.Media=e.Media||{},e.Media.CuePoint=e.Base.extend({triggers:[],init:function(t){this.media=t,this.media.addEventListener("timeupdate",this.onMediaTimeUpdate)},onMediaTimeUpdate:function(t){var n,i;n=t.target,i=parseFloat(n.currentTime),e.Object.each(this.triggers,function(t,e){!e.timer&&i>=e.inTime-.5&&e.inTime>i&&this.setupTriggerTimer(e,1e3*(e.inTime-i))})},addTrigger:function(t){return this.triggers.push(t)-1},removeTrigger:function(t){var e=this.triggers[t];this.stopTrigger(e,!1),this.triggers.splice(t,1)},setupTriggerTimer:function(t,n){t.timer=setTimeout(e.Function.proxy(this.launchTrigger,this,t),n)},launchTrigger:function(t){t.hasOwnProperty("onStart")&&e.Var.is(t.onStart,"function")&&t.onStart(this.media)},stopTrigger:function(t,n){t.hasOwnProperty("timer")&&(clearTimeout(t.timer),delete t.timer),t.hasOwnProperty("interval")&&(clearInterval(t.interval),delete t.interval),n!==!1&&t.hasOwnProperty("onEnd")&&e.Var.is(t.onEnd,"function")&&t.onEnd(this.media)}})}(t),function(t){var e=t.metaScore;e.Media=e.Media||{},e.Media.Element=e.Base.extend({})}(t),function(t){var e=t.metaScore;e.Player=e.Dom.extend({init:function(t){this.callSuper("<div/>",{"class":"metaScore-player"}),void 0!==t&&this.appendTo(t)}})}(t),function(t){var e=t.metaScore;e.Editor=e.Dom.extend({init:function(t){this.callSuper("<div/>",{"class":"metaScore-editor"}),void 0!==t&&this.appendTo(t),this.setupUI()},setupUI:function(){var t,n,i;this.mainmenu=e.Editor.MainMenu.create().appendTo(this),t=e.Dom.create("<div/>",{"class":"bottom"}).appendTo(this),n=e.Dom.create("<div/>",{"class":"workspace"}).appendTo(t),i=e.Dom.create("<div/>",{"class":"grid"}).appendTo(n),this.player=e.Player.create().appendTo(n),this.sidebar=e.Editor.Sidebar.create().appendTo(t)}})}(t),function(t){var e=t.metaScore;e.Editor=e.Editor||{},e.Editor.MainMenu=e.Dom.extend({init:function(){this.callSuper("<div/>",{"class":"main-menu clearfix"}),this.setupUI()},setupUI:function(){var t,n;this.buttons={},t=e.Dom.create("<div/>",{"class":"left"}).appendTo(this),n=e.Dom.create("<div/>",{"class":"right"}).appendTo(this),this.buttons["new"]=e.Form.Button.create().attr({"class":"new",title:e.String.t("New")}).appendTo(t),this.buttons.open=e.Form.Button.create().attr({"class":"open",title:e.String.t("Open")}).appendTo(t),this.buttons.save=e.Form.Button.create().attr({"class":"save",title:e.String.t("save")}).appendTo(t),this.buttons.download=e.Form.Button.create().attr({"class":"download",title:e.String.t("download")}).appendTo(t),this.buttons["delete"]=e.Form.Button.create().attr({"class":"delete",title:e.String.t("delete")}).appendTo(t),this.buttons.time=e.Form.TimeField.create().attr({"class":"time",title:e.String.t("time")}).appendTo(t),this.buttons.revert=e.Form.Button.create().attr({"class":"revert",title:e.String.t("revert")}).appendTo(t),this.buttons.undo=e.Form.Button.create().attr({"class":"undo",title:e.String.t("undo")}).appendTo(t),this.buttons.redo=e.Form.Button.create().attr({"class":"redo",title:e.String.t("redo")}).disable().appendTo(t),this.buttons.edit=e.Form.Button.create().attr({"class":"edit",title:e.String.t("edit")}).appendTo(n),this.buttons.grid=e.Form.Button.create().attr({"class":"grid",title:e.String.t("grid")}).appendTo(n),this.buttons.settings=e.Form.Button.create().attr({"class":"settings",title:e.String.t("settings")}).appendTo(n),this.buttons.help=e.Form.Button.create().attr({"class":"help",title:e.String.t("help")}).appendTo(n)}})}(t),function(t){var e=t.metaScore;e.Editor=e.Editor||{},e.Editor.Panel=e.Dom.extend({defaults:{title:"",fields:{}},init:function(t){this.initConfig(t),this.callSuper("<div/>",{"class":"panel"}),this.setupUI()},setupUI:function(){this.toolbar=e.Dom.create("<div/>",{"class":"toolbar"}).appendTo(this),this.toolbar.title=e.Dom.create("<div/>",{"class":"title"}).appendTo(this.toolbar).addListener("click",e.Function.proxy(this.toggleState,this)),this.toolbar.buttons=e.Dom.create("<div/>",{"class":"buttons"}).appendTo(this.toolbar),this.setTitle(this.configs.title),this.contents=e.Dom.create("<div/>",{"class":"contents"}).appendTo(this),this.setupFields()},setupFields:function(){var t,n,i,s=e.Dom.create("<table/>").appendTo(this.contents);this.fields={},e.Object.each(this.configs.fields,function(a,r){t=e.Dom.create(document.createElement("tr"),{"class":"field-wrapper"}).appendTo(s),n="field-"+e.String.uuid(5),this.fields[a]=i=r.type.create().attr("id",n),e.Dom.create(document.createElement("td")).appendTo(t).append(e.Dom.create("<label/>",{text:r.label,"for":n})),e.Dom.create(document.createElement("td")).appendTo(t).append(i)},this)},setTitle:function(t){this.toolbar.title.text(t)},toggleState:function(){this.toggleClass("collapsed")}})}(t),function(t){var e=t.metaScore;e.Editor=e.Editor||{},e.Editor.Sidebar=e.Dom.extend({init:function(){this.callSuper("<div/>",{"class":"sidebar"}),this.addPanels()},addPanels:function(){this.panels={},this.panels.block=e.Editor.Panel.create({title:"Block",fields:{x:{type:e.Form.IntegerField,label:"X"},y:{type:e.Form.IntegerField,label:"Y"},endtime:{type:e.Form.TimeField,label:"End time"}}}).appendTo(this),this.panels.page=e.Editor.Panel.create({title:"Page"}).appendTo(this),this.panels.element=e.Editor.Panel.create({title:"Element"}).appendTo(this),this.panels.text=e.Editor.Panel.create({title:"Text"}).appendTo(this)}})}(t)})(this);